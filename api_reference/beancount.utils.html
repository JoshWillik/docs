<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://beancount.github.io/docs/api_reference/beancount.utils.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.utils - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.utils";
    var mkdocs_page_input_path = "api_reference/beancount.utils.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.utils.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.utils.html">beancount.utils</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils">beancount.utils</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.bisect_key">bisect_key</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_left_with_key">bisect_left_with_key()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_right_with_key">bisect_right_with_key()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.csv_utils">csv_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.as_rows">as_rows()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_clean_header">csv_clean_header()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_dict_reader">csv_dict_reader()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_split_sections">csv_split_sections()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_split_sections_with_titles">csv_split_sections_with_titles()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_tuple_reader">csv_tuple_reader()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.iter_sections">iter_sections()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.iter_until_empty">iter_until_empty()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.csv_utils_test">csv_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils_test.linearize">linearize()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.date_utils">date_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.intimezone">intimezone()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.iter_dates">iter_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.next_month">next_month()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.parse_date_liberally">parse_date_liberally()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.render_ofx_date">render_ofx_date()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.defdict">defdict</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.DefaultDictWithKey">DefaultDictWithKey</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault">ImmutableDictWithDefault</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">__setitem__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.get">get()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption">encryption</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_encrypted_file">is_encrypted_file()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_gpg_installed">is_gpg_installed()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.read_encrypted_file">read_encrypted_file()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption_test">encryption_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase">TestEncryptedBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_type">file_type</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_type.guess_file_type">guess_file_type()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils">file_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.chdir">chdir()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.find_files">find_files()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.guess_file_format">guess_file_format()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.path_greedy_split">path_greedy_split()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.touch_file">touch_file()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils_test">file_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils_test.TestFileUtilsFind">TestFileUtilsFind</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.file_utils_test.TestFileUtilsFind.setUp">setUp()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.import_utils">import_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.import_utils.import_symbol">import_symbol()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants">invariants</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.instrument_invariants">instrument_invariants()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.invariant_check">invariant_check()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.uninstrument_invariants">uninstrument_invariants()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants_test">invariants_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants_test.Dummy">Dummy</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants">TestInvariants</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.memo">memo</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.memoize_recent_fileobj">memoize_recent_fileobj()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.now">now()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils">misc_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy">LineFileProxy</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.close">close()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.flush">flush()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.write">write()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.TypeComparable">TypeComparable</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.box">box()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.cmptuple">cmptuple()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.compute_unique_clean_ids">compute_unique_clean_ids()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.deprecated">deprecated()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.dictmap">dictmap()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.escape_string">escape_string()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.filter_type">filter_type()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.first_paragraph">first_paragraph()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_height">get_screen_height()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_width">get_screen_width()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_tuple_values">get_tuple_values()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.groupby">groupby()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.idify">idify()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.import_curses">import_curses()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.is_sorted">is_sorted()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.log_time">log_time()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.longest">longest()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.map_namedtuple_attributes">map_namedtuple_attributes()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.replace_namedtuple_values">replace_namedtuple_values()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.skipiter">skipiter()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.sorted_uniquify">sorted_uniquify()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.staticvar">staticvar()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.swallow">swallow()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.uniquify">uniquify()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils_test">misc_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils_test.raise_import_error">raise_import_error()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.net_utils">net_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.net_utils.retrying_urlopen">retrying_urlopen()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager">pager</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager">ConditionalPager</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__enter__">__enter__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__exit__">__exit__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.flush_accumulated">flush_accumulated()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.write">write()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.create_pager">create_pager()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.flush_only">flush_only()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager_test">pager_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.regexp_utils">regexp_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.regexp_utils.re_replace_unicode">re_replace_unicode()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.snoop">snoop</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.Snoop">Snoop</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__getattr__">__getattr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__init__">__init__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.snoopify">snoopify()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.test_utils">test_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.RCall">RCall</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TestCase">TestCase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertLines">assertLines()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertOutput">assertOutput()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.call_command">call_command()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.capture">capture()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.create_temporary_files">create_temporary_files()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile">docfile()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile_extra">docfile_extra()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.environ">environ()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_python_lib">find_python_lib()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_repository_root">find_repository_root()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.make_failing_importer">make_failing_importer()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.nottest">nottest()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.patch">patch()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.record">record()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.run_with_args">run_with_args()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.search_words">search_words()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.skipIfRaises">skipIfRaises()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.subprocess_env">subprocess_env()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.tempdir">tempdir()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.text_utils">text_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.entitize_ampersand">entitize_ampersand()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.replace_number">replace_number()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.replace_numbers">replace_numbers()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.text_utils_test">text_utils_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.version">version</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.version.ArgumentParser">ArgumentParser()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.version.compute_version_string">compute_version_string()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.utils</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/beancount/docs/edit/master/docs/api_reference/beancount.utils.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountutils">beancount.utils<a class="headerlink" href="#beancountutils" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.utils" id="beancount.utils" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.utils" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Generic utility packages and functions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.bisect_key">
<code>bisect_key</code>
<a class="headerlink" href="#beancount.utils.bisect_key" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A version of bisect that accepts a custom key function, like the sorting ones do.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.bisect_key.bisect_left_with_key">
<code class="highlight language-python">
bisect_left_with_key
(sequence, value, key=None)

        </code>
<a class="headerlink" href="#beancount.utils.bisect_key.bisect_left_with_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find the last element before the given value in a sorted list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sequence</code></td>
<td><code></code></td>
<td>
<p>A sorted sequence of elements.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value to search for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>An optional function used to extract the value from the elements of
sequence.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Return the index. May return None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def bisect_left_with_key(sequence, value, key=None):
    """Find the last element before the given value in a sorted list.

    Args:
      sequence: A sorted sequence of elements.
      value: The value to search for.
      key: An optional function used to extract the value from the elements of
        sequence.
    Returns:
      Return the index. May return None.
    """
    # pylint: disable=invalid-name
    if key is None:
        key = lambda x: x  # Identity.

    lo = 0
    hi = len(sequence)

    while lo &lt; hi:
        mid = (lo + hi) // 2
        if key(sequence[mid]) &lt; value:
            lo = mid + 1
        else:
            hi = mid
    return lo
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.bisect_key.bisect_right_with_key">
<code class="highlight language-python">
bisect_right_with_key
(a, x, key, lo=0, hi=None)

        </code>
<a class="headerlink" href="#beancount.utils.bisect_key.bisect_right_with_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Like bisect.bisect_right, but with a key lookup parameter.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a</code></td>
<td><code></code></td>
<td>
<p>The list to search in.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>x</code></td>
<td><code></code></td>
<td>
<p>The element to search for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A function, to extract the value from the list.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lo</code></td>
<td><code></code></td>
<td>
<p>The smallest index to search.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>hi</code></td>
<td><code></code></td>
<td>
<p>The largest index to search.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>As in bisect.bisect_right, an element from list 'a'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def bisect_right_with_key(a, x, key, lo=0, hi=None):
    """Like bisect.bisect_right, but with a key lookup parameter.

    Args:
      a: The list to search in.
      x: The element to search for.
      key: A function, to extract the value from the list.
      lo: The smallest index to search.
      hi: The largest index to search.
    Returns:
      As in bisect.bisect_right, an element from list 'a'.
    """
    # pylint: disable=invalid-name
    if lo &lt; 0:
        raise ValueError('lo must be non-negative')
    if hi is None:
        hi = len(a)
    while lo &lt; hi:
        mid = (lo+hi)//2
        if x &lt; key(a[mid]):
            hi = mid
        else:
            lo = mid+1
    return lo
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.csv_utils">
<code>csv_utils</code>
<a class="headerlink" href="#beancount.utils.csv_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Utilities for reading and writing CSV files.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.as_rows">
<code class="highlight language-python">
as_rows
(string)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.as_rows" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Split a string as rows of a CSV file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string to be split, the contents of a CSV file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Lists of lists of strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def as_rows(string):
    """Split a string as rows of a CSV file.

    Args:
      string: A string to be split, the contents of a CSV file.
    Returns:
      Lists of lists of strings.
    """
    return list(csv.reader(io.StringIO(textwrap.dedent(string))))
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_clean_header">
<code class="highlight language-python">
csv_clean_header
(header_row)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_clean_header" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a new class for the following rows from the header line.
This both normalizes the header line and assign</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>header_row</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the row with header titles.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of strings, with possibly modified (cleaned) row titles, of the
same lengths.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def csv_clean_header(header_row):
    """Create a new class for the following rows from the header line.
    This both normalizes the header line and assign

    Args:
      header_row: A list of strings, the row with header titles.
    Returns:
      A list of strings, with possibly modified (cleaned) row titles, of the
      same lengths.
    """
    fieldnames = []
    for index, column in enumerate(header_row):
        field = column.lower()
        field = re.sub(r'\bp/l\b', 'pnl', field)
        field = re.sub('[^a-z0-9]', '_', field)
        field = field.strip(' _')
        field = re.sub('__+', '_', field)
        if not field:
            field = 'col{}'.format(index)
        assert field not in fieldnames, field
        fieldnames.append(field)
    return fieldnames
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_dict_reader">
<code class="highlight language-python">
csv_dict_reader
    (fileobj, **
kw)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_dict_reader" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Read a CSV file yielding normalized dictionary fields.</p>
<p>This is basically an alternative constructor for csv.DictReader that
normalized the field names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to be read.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Optional arguments forwarded to csv.DictReader.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A csv.DictReader object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def csv_dict_reader(fileobj, **kw):
    """Read a CSV file yielding normalized dictionary fields.

    This is basically an alternative constructor for csv.DictReader that
    normalized the field names.

    Args:
      fileobj: A file object to be read.
      **kw: Optional arguments forwarded to csv.DictReader.
    Returns:
      A csv.DictReader object.
    """
    reader = csv.DictReader(fileobj, **kw)
    reader.fieldnames = csv_clean_header(reader.fieldnames)
    return reader
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_split_sections">
<code class="highlight language-python">
csv_split_sections
(rows)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_split_sections" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given rows, split them in at empty lines.
This is useful for structured CSV files with multiple sections.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rows</code></td>
<td><code></code></td>
<td>
<p>A list of rows, which are themselves lists of strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of sections, which are lists of rows, which are lists of strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def csv_split_sections(rows):
    """Given rows, split them in at empty lines.
    This is useful for structured CSV files with multiple sections.

    Args:
      rows: A list of rows, which are themselves lists of strings.
    Returns:
      A list of sections, which are lists of rows, which are lists of strings.
    """
    sections = []
    current_section = []
    for row in rows:
        if row:
            current_section.append(row)
        else:
            sections.append(current_section)
            current_section = []
    if current_section:
        sections.append(current_section)
    return sections
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_split_sections_with_titles">
<code class="highlight language-python">
csv_split_sections_with_titles
(rows)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_split_sections_with_titles" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a list of rows, split their sections. If the sections have single
column titles, consume those lines as their names and return a mapping of
section names.</p>
<p>This is useful for CSV files with multiple sections, where the separator is
a title. We use this to separate the multiple tables within the CSV files.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rows</code></td>
<td><code></code></td>
<td>
<p>A list of rows (list-of-strings).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of lists of rows (list-of-strings).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def csv_split_sections_with_titles(rows):
    """Given a list of rows, split their sections. If the sections have single
    column titles, consume those lines as their names and return a mapping of
    section names.

    This is useful for CSV files with multiple sections, where the separator is
    a title. We use this to separate the multiple tables within the CSV files.

    Args:
      rows: A list of rows (list-of-strings).
    Returns:
     A list of lists of rows (list-of-strings).

    """
    sections_map = {}
    for index, section in enumerate(csv_split_sections(rows)):
        # Skip too short sections, cannot possibly be a title.
        if len(section) &lt; 2:
            continue
        if len(section[0]) == 1 and len(section[1]) != 1:
            name = section[0][0]
            section = section[1:]
        else:
            name = 'Section {}'.format(index)
        sections_map[name] = section
    return sections_map
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_tuple_reader">
<code class="highlight language-python">
csv_tuple_reader
    (fileobj, **
kw)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_tuple_reader" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Read a CSV file yielding namedtuple instances. The CSV file must have a
header line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to be read.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Optional arguments forwarded to csv.DictReader.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Nametuple instances, one for each row.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def csv_tuple_reader(fileobj, **kw):
    """Read a CSV file yielding namedtuple instances. The CSV file must have a
    header line.

    Args:
      fileobj: A file object to be read.
      **kw: Optional arguments forwarded to csv.DictReader.
    Yields:
      Nametuple instances, one for each row.
    """
    reader = csv.reader(fileobj, **kw)
    ireader = iter(reader)
    fieldnames = csv_clean_header(next(ireader))
    Tuple = collections.namedtuple('Row', fieldnames)
    for row in ireader:
        try:
            yield Tuple(*row)
        except TypeError:
            # If there's an error, it's usually from a line that has a 'END OF
            # LINE' marker at the end, or some comment line.
            assert len(row) in (0, 1)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.iter_sections">
<code class="highlight language-python">
iter_sections
(fileobj, separating_predicate=None)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.iter_sections" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>For a given file object, yield file-like objects for each of the sections
contained therein. A section is defined as a list of lines that don't match
the predicate. For example, if you want to split by empty lines, provide a
predicate that will be true given an empty line, which will cause a new
section to be begun.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to read from.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>separating_predicate</code></td>
<td><code></code></td>
<td>
<p>A boolean predicate that is true on separating lines.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A list of lines that you can use to iterate.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def iter_sections(fileobj, separating_predicate=None):
    """For a given file object, yield file-like objects for each of the sections
    contained therein. A section is defined as a list of lines that don't match
    the predicate. For example, if you want to split by empty lines, provide a
    predicate that will be true given an empty line, which will cause a new
    section to be begun.

    Args:
      fileobj: A file object to read from.
      separating_predicate: A boolean predicate that is true on separating lines.
    Yields:
      A list of lines that you can use to iterate.
    """
    if separating_predicate is None:
        separating_predicate = lambda line: bool(line.strip())

    lineiter = iter(fileobj)
    for line in lineiter:
        if separating_predicate(line):
            iterator = itertools.chain((line,),
                                       iter_until_empty(lineiter,
                                                        separating_predicate))
            yield iterator
            for _ in iterator:
                pass
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.iter_until_empty">
<code class="highlight language-python">
iter_until_empty
(iterator, separating_predicate=None)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils.iter_until_empty" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An iterator of lines that will stop at the first empty line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterator</code></td>
<td><code></code></td>
<td>
<p>An iterator of lines.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>separating_predicate</code></td>
<td><code></code></td>
<td>
<p>A boolean predicate that is true on separating lines.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Non-empty lines. EOF when we hit an empty line.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def iter_until_empty(iterator, separating_predicate=None):
    """An iterator of lines that will stop at the first empty line.

    Args:
      iterator: An iterator of lines.
      separating_predicate: A boolean predicate that is true on separating lines.
    Yields:
      Non-empty lines. EOF when we hit an empty line.
    """
    if separating_predicate is None:
        separating_predicate = lambda line: bool(line.strip())

    for line in iterator:
        if not separating_predicate(line):
            break
        yield line
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.csv_utils_test">
<code>csv_utils_test</code>
<a class="headerlink" href="#beancount.utils.csv_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils_test.linearize">
<code class="highlight language-python">
linearize
(iterator, joiner=&lt;class 'list'&gt;)

        </code>
<a class="headerlink" href="#beancount.utils.csv_utils_test.linearize" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Consume a section iterator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterator</code></td>
<td><code></code></td>
<td>
<p>An iterator of iterators.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>joiner</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the sub-iterators.</p>
</td>
<td><code>&lt;class 'list'&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of return values from joiner.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def linearize(iterator, joiner=list):
    """Consume a section iterator.

    Args:
      iterator: An iterator of iterators.
      joiner: A callable to apply to the sub-iterators.
    Returns:
      A list of return values from joiner.
    """
    return list(map(list, iterator))
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.date_utils">
<code>date_utils</code>
<a class="headerlink" href="#beancount.utils.date_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Parse the date from various formats.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.intimezone">
<code class="highlight language-python">
intimezone
(tz_value)

        </code>
<a class="headerlink" href="#beancount.utils.date_utils.intimezone" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Temporarily reset the value of TZ.</p>
<p>This is used for testing.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tz_value</code></td>
<td><code>str</code></td>
<td>
<p>The value of TZ to set for the duration of this context.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A contextmanager in the given timezone locale.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def intimezone(tz_value: str):
    """Temporarily reset the value of TZ.

    This is used for testing.

    Args:
      tz_value: The value of TZ to set for the duration of this context.
    Returns:
      A contextmanager in the given timezone locale.
    """
    tz_old = os.environ.get('TZ', None)
    os.environ['TZ'] = tz_value
    time.tzset()
    try:
        yield
    finally:
        if tz_old is None:
            del os.environ['TZ']
        else:
            os.environ['TZ'] = tz_old
        time.tzset()
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.iter_dates">
<code class="highlight language-python">
iter_dates
(start_date, end_date)

        </code>
<a class="headerlink" href="#beancount.utils.date_utils.iter_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Yield all the dates between 'start_date' and 'end_date'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start_date</code></td>
<td><code></code></td>
<td>
<p>An instance of datetime.date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>end_date</code></td>
<td><code></code></td>
<td>
<p>An instance of datetime.date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of datetime.date.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def iter_dates(start_date, end_date):
    """Yield all the dates between 'start_date' and 'end_date'.

    Args:
      start_date: An instance of datetime.date.
      end_date: An instance of datetime.date.
    Yields:
      Instances of datetime.date.
    """
    oneday = datetime.timedelta(days=1)
    date = start_date
    while date &lt; end_date:
        yield date
        date += oneday
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.next_month">
<code class="highlight language-python">
next_month
(date)

        </code>
<a class="headerlink" href="#beancount.utils.date_utils.next_month" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the date at the beginning of the following month from the given date.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A datetime.date instance, the first day of the month following 'date'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def next_month(date):
    """Compute the date at the beginning of the following month from the given date.

    Args:
      date: A datetime.date instance.
    Returns:
      A datetime.date instance, the first day of the month following 'date'.
    """
    # Compute the date at the beginning of the following month.
    year = date.year
    month = date.month + 1
    if date.month == 12:
        year += 1
        month = 1
    return datetime.date(year, month, 1)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.parse_date_liberally">
<code class="highlight language-python">
parse_date_liberally
(string, parse_kwargs_dict=None)

        </code>
<a class="headerlink" href="#beancount.utils.date_utils.parse_date_liberally" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse arbitrary strings to dates.</p>
<p>This function is intended to support liberal inputs, so that we can use it
in accepting user-specified dates on command-line scripts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string to parse.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>parse_kwargs_dict</code></td>
<td><code></code></td>
<td>
<p>Dict of kwargs to pass to dateutil parser.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A datetime.date object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def parse_date_liberally(string, parse_kwargs_dict=None):
    """Parse arbitrary strings to dates.

    This function is intended to support liberal inputs, so that we can use it
    in accepting user-specified dates on command-line scripts.

    Args:
      string: A string to parse.
      parse_kwargs_dict: Dict of kwargs to pass to dateutil parser.
    Returns:
      A datetime.date object.
    """
    # At the moment, rely on the most excellent dateutil.
    if parse_kwargs_dict is None:
        parse_kwargs_dict = {}
    return dateutil.parser.parse(string, **parse_kwargs_dict).date()
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.render_ofx_date">
<code class="highlight language-python">
render_ofx_date
(dtime)

        </code>
<a class="headerlink" href="#beancount.utils.date_utils.render_ofx_date" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render a datetime to the OFX format.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dtime</code></td>
<td><code></code></td>
<td>
<p>A datetime.datetime instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, rendered to milliseconds.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def render_ofx_date(dtime):
    """Render a datetime to the OFX format.

    Args:
      dtime: A datetime.datetime instance.
    Returns:
      A string, rendered to milliseconds.
    """
    return '{}.{:03d}'.format(dtime.strftime('%Y%m%d%H%M%S'),
                              int(dtime.microsecond / 1000))
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.defdict">
<code>defdict</code>
<a class="headerlink" href="#beancount.utils.defdict" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>An instance of collections.defaultdict whose factory accepts a key.</p>
<p>Note: This really ought to be an enhancement to Python itself. I should bother
adding this in eventually.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.defdict.DefaultDictWithKey">
<code>DefaultDictWithKey</code>
<a class="headerlink" href="#beancount.utils.defdict.DefaultDictWithKey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A version of defaultdict whose factory accepts the key as an argument.
    Note: collections.defaultdict would be improved by supporting this directly,
    this is a common occurence.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault">
<code>ImmutableDictWithDefault</code>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An immutable dict which returns a default value for missing keys.</p>
<pre><code>This differs from a defualtdict in that it does not insert a missing default
value when one is materialized (from a missing fetch), and furtheremore, the
set method is make unavailable to prevent mutation beyond construction.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">
<code class="highlight language-python">
__setitem__
(self, key, value)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Disallow mutating the dict in the usual way.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/defdict.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __setitem__(self, key, value):
    """Disallow mutating the dict in the usual way."""
    raise NotImplementedError
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault.get">
<code class="highlight language-python">
get
(self, key, _=None)

        </code>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault.get" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the value for key if key is in the dictionary, else default.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/defdict.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def get(self, key, _=None):
    return self.__getitem__(key)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.encryption">
<code>encryption</code>
<a class="headerlink" href="#beancount.utils.encryption" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Support for encrypted tests.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.is_encrypted_file">
<code class="highlight language-python">
is_encrypted_file
(filename)

        </code>
<a class="headerlink" href="#beancount.utils.encryption.is_encrypted_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given filename contains an encrypted file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A path string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the file contains an encrypted file.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def is_encrypted_file(filename):
    """Return true if the given filename contains an encrypted file.

    Args:
      filename: A path string.
    Returns:
      A boolean, true if the file contains an encrypted file.
    """
    _, ext = path.splitext(filename)
    if ext == '.gpg':
        return True
    if ext == '.asc':
        with open(filename) as encfile:
            head = encfile.read(1024)
            if re.search('--BEGIN PGP MESSAGE--', head):
                return True
    return False
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.is_gpg_installed">
<code class="highlight language-python">
is_gpg_installed
()

        </code>
<a class="headerlink" href="#beancount.utils.encryption.is_gpg_installed" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if GPG 1.4.x or 2.x are installed, which is what we use and support.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def is_gpg_installed():
    """Return true if GPG 1.4.x or 2.x are installed, which is what we use and support."""
    try:
        pipe = subprocess.Popen(['gpg', '--version'], shell=0,
                                stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        out, err = pipe.communicate()
        version_text = out.decode('utf8')
        return pipe.returncode == 0 and re.match(r'gpg \(GnuPG\) (1\.4|2)\.', version_text)
    except OSError:
        return False
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.read_encrypted_file">
<code class="highlight language-python">
read_encrypted_file
(filename)

        </code>
<a class="headerlink" href="#beancount.utils.encryption.read_encrypted_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decrypt and read an encrypted file without temporary storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the path to the encrypted file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the contents of the file.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OSError</code></td>
<td>
<p>If we could not properly decrypt the file.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def read_encrypted_file(filename):
    """Decrypt and read an encrypted file without temporary storage.

    Args:
      filename: A string, the path to the encrypted file.
    Returns:
      A string, the contents of the file.
    Raises:
      OSError: If we could not properly decrypt the file.
    """
    command = ['gpg', '--batch', '--decrypt', path.realpath(filename)]
    pipe = subprocess.Popen(command,
                            shell=False,
                            stdout=subprocess.PIPE,
                            stderr=subprocess.PIPE)
    contents, errors = pipe.communicate()
    if pipe.returncode != 0:
        raise OSError("Could not decrypt file ({}): {}".format(pipe.returncode,
                                                               errors.decode('utf8')))
    return contents.decode('utf-8')
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.encryption_test">
<code>encryption_test</code>
<a class="headerlink" href="#beancount.utils.encryption_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase">
<code>TestEncryptedBase</code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase.setUp">
<code class="highlight language-python">
setUp
(self)

        </code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def setUp(self):
    self.tmpdir = tempfile.TemporaryDirectory(prefix='beancount.')
    self.ringdir = path.join(self.tmpdir.name, 'keyring')
    os.makedirs(self.ringdir)
    os.chmod(self.ringdir, 0o700)

    # Import secret and public keys.
    self.run_gpg('--import', stdin=TEST_PUBLIC_KEY.encode('ascii'))
    self.run_gpg('--import', stdin=TEST_SECRET_KEY.encode('ascii'))
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase.tearDown">
<code class="highlight language-python">
tearDown
(self)

        </code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def tearDown(self):
    try:
        self.tmpdir.cleanup()
    except FileNotFoundError:
        pass  # Ignore those, GPG agent sometimes causes this problem.
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_type">
<code>file_type</code>
<a class="headerlink" href="#beancount.utils.file_type" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code that can guess a MIME type for a filename.</p>
<p>This attempts to identify the mim-type of a file suing</p>
<ol>
<li>The built-in mimetypes library, then</li>
<li>python-magic (if available), and finally</li>
<li>some custom mappers for datatypes used in financial downloads, such as
   Quicken files.</li>
</ol>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_type.guess_file_type">
<code class="highlight language-python">
guess_file_type
(filename)

        </code>
<a class="headerlink" href="#beancount.utils.file_type.guess_file_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Attempt to guess the type of the input file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to ugess the type for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A suitable mimetype string, or None if we could not guess.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_type.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def guess_file_type(filename):
    """Attempt to guess the type of the input file.

    Args:
      filename: A string, the name of the file to ugess the type for.
    Returns:
      A suitable mimetype string, or None if we could not guess.
    """

    # Try the standard mimetypes association.
    filetype, _ = mimetypes.guess_type(filename, False)
    if filetype:
        return filetype

    # Try out some extra types that only we know about.
    for regexp, mimetype in EXTRA_FILE_TYPES:
        if regexp.match(filename):
            return mimetype

    # Try out libmagic, if it is installed.
    if magic:
        filetype = magic.from_file(filename, mime=True)
        if isinstance(filetype, bytes):
            filetype = filetype.decode('utf8')
        return filetype
    else:
        raise ValueError(("Could not identify the type of file '{}'; "
                          "try installing python-magic").format(filename))
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_utils">
<code>file_utils</code>
<a class="headerlink" href="#beancount.utils.file_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>File utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.chdir">
<code class="highlight language-python">
chdir
(directory)

        </code>
<a class="headerlink" href="#beancount.utils.file_utils.chdir" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Temporarily chdir to the given directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>directory</code></td>
<td><code></code></td>
<td>
<p>The directory to switch do.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A context manager which restores the cwd after running.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def chdir(directory):
    """Temporarily chdir to the given directory.

    Args:
      directory: The directory to switch do.
    Returns:
      A context manager which restores the cwd after running.
    """
    cwd = os.getcwd()
    os.chdir(directory)
    try:
        yield cwd
    finally:
        os.chdir(cwd)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.find_files">
<code class="highlight language-python">
find_files
(fords, ignore_dirs=('.hg', '.svn', '.git'), ignore_files=('.DS_Store',))

        </code>
<a class="headerlink" href="#beancount.utils.file_utils.find_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Enumerate the files under the given directories, stably.</p>
<p>Invalid file or directory names will be logged to the error log.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fords</code></td>
<td><code></code></td>
<td>
<p>A list of strings, file or directory names.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>ignore_dirs</code></td>
<td><code></code></td>
<td>
<p>A list of strings, filenames or directories to be ignored.</p>
</td>
<td><code>('.hg', '.svn', '.git')</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Strings, full filenames from the given roots.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def find_files(fords,
               ignore_dirs=('.hg', '.svn', '.git'),
               ignore_files=('.DS_Store',)):
    """Enumerate the files under the given directories, stably.

    Invalid file or directory names will be logged to the error log.

    Args:
      fords: A list of strings, file or directory names.
      ignore_dirs: A list of strings, filenames or directories to be ignored.
    Yields:
      Strings, full filenames from the given roots.
    """
    if isinstance(fords, str):
        fords = [fords]
    assert isinstance(fords, (list, tuple))
    for ford in fords:
        if path.isdir(ford):
            for root, dirs, filenames in os.walk(ford):
                dirs[:] = sorted(dirname for dirname in dirs if dirname not in ignore_dirs)
                for filename in sorted(filenames):
                    if filename in ignore_files:
                        continue
                    yield path.join(root, filename)
        elif path.isfile(ford) or path.islink(ford):
            yield ford
        elif not path.exists(ford):
            logging.error("File or directory '{}' does not exist.".format(ford))
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.guess_file_format">
<code class="highlight language-python">
guess_file_format
(filename, default=None)

        </code>
<a class="headerlink" href="#beancount.utils.file_utils.guess_file_format" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Guess the file format from the filename.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file. This can be None.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the extension of the format, without a leading period.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def guess_file_format(filename, default=None):
    """Guess the file format from the filename.

    Args:
      filename: A string, the name of the file. This can be None.
    Returns:
      A string, the extension of the format, without a leading period.
    """
    if filename:
        if filename.endswith('.txt') or filename.endswith('.text'):
            format = 'text'
        elif filename.endswith('.csv'):
            format = 'csv'
        elif filename.endswith('.html') or filename.endswith('.xhtml'):
            format = 'html'
        else:
            format = default
    else:
        format = default
    return format
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.path_greedy_split">
<code class="highlight language-python">
path_greedy_split
(filename)

        </code>
<a class="headerlink" href="#beancount.utils.file_utils.path_greedy_split" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Split a path, returning the longest possible extension.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the filename to split.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of basename, extension (which includes the leading period).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def path_greedy_split(filename):
    """Split a path, returning the longest possible extension.

    Args:
      filename: A string, the filename to split.
    Returns:
      A pair of basename, extension (which includes the leading period).
    """
    basename = path.basename(filename)
    index = basename.find('.')
    if index == -1:
        extension = None
    else:
        extension = basename[index:]
        basename = basename[:index]
    return (path.join(path.dirname(filename), basename), extension)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.touch_file">
<code class="highlight language-python">
touch_file
    (filename, *
otherfiles)

        </code>
<a class="headerlink" href="#beancount.utils.file_utils.touch_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Touch a file and wait until its timestamp has been changed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string path, the name of the file to touch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>otherfiles</code></td>
<td><code></code></td>
<td>
<p>A list of other files to ensure the timestamp is beyond of.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def touch_file(filename, *otherfiles):
    """Touch a file and wait until its timestamp has been changed.

    Args:
      filename: A string path, the name of the file to touch.
      otherfiles: A list of other files to ensure the timestamp is beyond of.
    """
    # Note: You could set os.stat_float_times() but then the main function would
    # have to set that up as well. It doesn't help so much, however, since
    # filesystems tend to have low resolutions, e.g. one second.
    orig_mtime_ns = max(os.stat(minfile).st_mtime_ns
                        for minfile in (filename,) + otherfiles)
    delay_secs = 0.05
    while True:
        with open(filename, 'a'):
            os.utime(filename)
        time.sleep(delay_secs)
        new_stat = os.stat(filename)
        if new_stat.st_mtime_ns &gt; orig_mtime_ns:
            break
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_utils_test">
<code>file_utils_test</code>
<a class="headerlink" href="#beancount.utils.file_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for file utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.file_utils_test.TestFileUtilsFind">
<code>TestFileUtilsFind</code>
<a class="headerlink" href="#beancount.utils.file_utils_test.TestFileUtilsFind" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.file_utils_test.TestFileUtilsFind.setUp">
<code class="highlight language-python">
setUp
(self)

        </code>
<a class="headerlink" href="#beancount.utils.file_utils_test.TestFileUtilsFind.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def setUp(self):
    super().setUp()
    for filename in [
            'alice/',
            'alice/bottle.txt',
            'rabbit/',
            'rabbit/suit/',
            'rabbit/suit/glasses.txt',
            'caterpillar/',
            'caterpillar/who-are-you.txt',
            ]:
        abs_filename = path.join(self.tempdir, filename)
        if filename.endswith('/'):
            os.makedirs(abs_filename)
        else:
            open(abs_filename, 'w').close()
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.import_utils">
<code>import_utils</code>
<a class="headerlink" href="#beancount.utils.import_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Utilities for importing symbols programmatically.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.import_utils.import_symbol">
<code class="highlight language-python">
import_symbol
(dotted_name)

        </code>
<a class="headerlink" href="#beancount.utils.import_utils.import_symbol" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Import a symbol in an arbitrary module.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dotted_name</code></td>
<td><code></code></td>
<td>
<p>A dotted path to a symbol.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The object referenced by the given name.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ImportError</code></td>
<td>
<p>If the module not not be imported.</p>
</td>
</tr>
<tr>
<td><code>AttributeError</code></td>
<td>
<p>If the symbol could not be found in the module.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/import_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def import_symbol(dotted_name):
    """Import a symbol in an arbitrary module.

    Args:
      dotted_name: A dotted path to a symbol.
    Returns:
      The object referenced by the given name.
    Raises:
      ImportError: If the module not not be imported.
      AttributeError: If the symbol could not be found in the module.
    """
    comps = dotted_name.split('.')
    module_name = '.'.join(comps[:-1])
    symbol_name = comps[-1]
    module = importlib.import_module(module_name)
    return getattr(module, symbol_name)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.invariants">
<code>invariants</code>
<a class="headerlink" href="#beancount.utils.invariants" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Functions to register auxiliary functions on a class' methods to check for invariants.</p>
<p>This is intended to be used in a test, whereby your test will setup a class to
automatically run invariant verification functions before and after each
function call, to ensure some extra sanity checks that wouldn't be used in
non-tests.</p>
<p>Example: Instrument the Inventory class with the check_inventory_invariants()
function.</p>
<p>def setUp(module):
      instrument_invariants(Inventory,
                            check_inventory_invariants,
                            check_inventory_invariants)</p>
<p>def tearDown(module):
      uninstrument_invariants(Inventory)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.instrument_invariants">
<code class="highlight language-python">
instrument_invariants
(klass, prefun, postfun)

        </code>
<a class="headerlink" href="#beancount.utils.invariants.instrument_invariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Instrument the class 'klass' with pre/post invariant
checker functions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>klass</code></td>
<td><code></code></td>
<td>
<p>A class object, whose methods to be instrumented.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postfun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def instrument_invariants(klass, prefun, postfun):
    """Instrument the class 'klass' with pre/post invariant
    checker functions.

    Args:
      klass: A class object, whose methods to be instrumented.
      prefun: A function that checks invariants pre-call.
      postfun: A function that checks invariants pre-call.
    """
    instrumented = {}
    for attrname, object_ in klass.__dict__.items():
        if attrname.startswith('_'):
            continue
        if not isinstance(object_, types.FunctionType):
            continue
        instrumented[attrname] = object_
        setattr(klass, attrname,
                invariant_check(object_, prefun, postfun))
    klass.__instrumented = instrumented
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.invariant_check">
<code class="highlight language-python">
invariant_check
(method, prefun, postfun)

        </code>
<a class="headerlink" href="#beancount.utils.invariants.invariant_check" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorate a method with the pre/post invariant checkers.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>method</code></td>
<td><code></code></td>
<td>
<p>An unbound method to instrument.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postfun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants post-call.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An unbound method, decorated.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def invariant_check(method, prefun, postfun):
    """Decorate a method with the pre/post invariant checkers.

    Args:
      method: An unbound method to instrument.
      prefun: A function that checks invariants pre-call.
      postfun: A function that checks invariants post-call.
    Returns:
      An unbound method, decorated.
    """
    reentrant = []
    def new_method(self, *args, **kw):
        reentrant.append(None)
        if len(reentrant) == 1:
            prefun(self)
        result = method(self, *args, **kw)
        if len(reentrant) == 1:
            postfun(self)
        reentrant.pop()
        return result
    return new_method
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.uninstrument_invariants">
<code class="highlight language-python">
uninstrument_invariants
(klass)

        </code>
<a class="headerlink" href="#beancount.utils.invariants.uninstrument_invariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Undo the instrumentation for invariants.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>klass</code></td>
<td><code></code></td>
<td>
<p>A class object, whose methods to be uninstrumented.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def uninstrument_invariants(klass):
    """Undo the instrumentation for invariants.

    Args:
      klass: A class object, whose methods to be uninstrumented.
    """
    instrumented = getattr(klass, '__instrumented', None)
    if instrumented:
        for attrname, object_ in instrumented.items():
            setattr(klass, attrname, object_)
    del klass.__instrumented
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.invariants_test">
<code>invariants_test</code>
<a class="headerlink" href="#beancount.utils.invariants_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.invariants_test.Dummy">
<code>Dummy</code>
<a class="headerlink" href="#beancount.utils.invariants_test.Dummy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Just a dummy class as a target to instrument.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants">
<code>TestInvariants</code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants.setUp">
<code class="highlight language-python">
setUp
(self)

        </code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def setUp(self):
    incr = lambda obj: setattr(obj, 'counter', obj.counter + 1)
    invariants.instrument_invariants(Dummy, incr, incr)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants.tearDown">
<code class="highlight language-python">
tearDown
(self)

        </code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def tearDown(self):
    invariants.uninstrument_invariants(Dummy)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.memo">
<code>memo</code>
<a class="headerlink" href="#beancount.utils.memo" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Memoization utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.memo.memoize_recent_fileobj">
<code class="highlight language-python">
memoize_recent_fileobj
(function, cache_filename, expiration=None)

        </code>
<a class="headerlink" href="#beancount.utils.memo.memoize_recent_fileobj" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Memoize recent calls to the given function which returns a file object.</p>
<p>The results of the cache expire after some time.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A callable object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cache_filename</code></td>
<td><code></code></td>
<td>
<p>A string, the path to the database file to cache to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expiration</code></td>
<td><code></code></td>
<td>
<p>The time during which the results will be kept valid. Use
'None' to never expire the cache (this is the default).</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A memoized version of the function.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/memo.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def memoize_recent_fileobj(function, cache_filename, expiration=None):
    """Memoize recent calls to the given function which returns a file object.

    The results of the cache expire after some time.

    Args:
      function: A callable object.
      cache_filename: A string, the path to the database file to cache to.
      expiration: The time during which the results will be kept valid. Use
        'None' to never expire the cache (this is the default).
    Returns:
      A memoized version of the function.
    """
    urlcache = shelve.open(cache_filename, 'c')
    urlcache.lock = threading.Lock()  # Note: 'shelve' is not thread-safe.
    @functools.wraps(function)
    def memoized(*args, **kw):
        # Encode the arguments, including a date string in order to invalidate
        # results over some time.
        md5 = hashlib.md5()
        md5.update(str(args).encode('utf-8'))
        md5.update(str(sorted(kw.items())).encode('utf-8'))

        hash_ = md5.hexdigest()
        time_now = now()
        try:
            with urlcache.lock:
                time_orig, contents = urlcache[hash_]
            if expiration is not None and (time_now - time_orig) &gt; expiration:
                raise KeyError
        except KeyError:
            fileobj = function(*args, **kw)
            if fileobj:
                contents = fileobj.read()
                with urlcache.lock:
                    urlcache[hash_] = (time_now, contents)
            else:
                contents = None

        return io.BytesIO(contents) if contents else None
    return memoized
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.memo.now">
<code class="highlight language-python">
now
()

        </code>
<a class="headerlink" href="#beancount.utils.memo.now" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Indirection on datetime.datetime.now() for testing.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/memo.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def now():
    "Indirection on datetime.datetime.now() for testing."
    return datetime.datetime.now()
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.misc_utils">
<code>misc_utils</code>
<a class="headerlink" href="#beancount.utils.misc_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Generic utility packages and functions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy">
<code>LineFileProxy</code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A file object that will delegate writing full lines to another logging function.
    This may be used for writing data to a logging level without having to worry about
    lines.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.__init__">
<code class="highlight language-python">
__init__
(self, line_writer, prefix=None, write_newlines=False)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Construct a new line delegator file object proxy.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>line_writer</code></td>
<td><code></code></td>
<td>
<p>A callable function, used to write to the delegated output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefix</code></td>
<td><code></code></td>
<td>
<p>An optional string, the prefix to insert before every line.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>write_newlines</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should output the newline characters.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __init__(self, line_writer, prefix=None, write_newlines=False):
    """Construct a new line delegator file object proxy.

    Args:
      line_writer: A callable function, used to write to the delegated output.
      prefix: An optional string, the prefix to insert before every line.
      write_newlines: A boolean, true if we should output the newline characters.
    """
    self.line_writer = line_writer
    self.prefix = prefix
    self.write_newlines = write_newlines
    self.data = []
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.close">
<code class="highlight language-python">
close
(self)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.close" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Close the line delegator.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def close(self):
    """Close the line delegator."""
    self.flush()
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.flush">
<code class="highlight language-python">
flush
(self)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.flush" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Flush the data to the line writer.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def flush(self):
    """Flush the data to the line writer."""
    data = ''.join(self.data)
    if data:
        lines = data.splitlines()
        self.data = [lines.pop(-1)] if data[-1] != '\n' else []
        for line in lines:
            if self.prefix:
                line = self.prefix + line
            if self.write_newlines:
                line += '\n'
            self.line_writer(line)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.write">
<code class="highlight language-python">
write
(self, data)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.write" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Write some string data to the output.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code></code></td>
<td>
<p>A string, with or without newlines.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def write(self, data):
    """Write some string data to the output.

    Args:
      data: A string, with or without newlines.
    """
    if '\n' in data:
        self.data.append(data)
        self.flush()
    else:
        self.data.append(data)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.TypeComparable">
<code>TypeComparable</code>
<a class="headerlink" href="#beancount.utils.misc_utils.TypeComparable" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A base class whose equality comparison includes comparing the
    type of the instance itself.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.box">
<code class="highlight language-python">
box
(name=None, file=None)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.box" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that prints out a box around a block.
This is useful for printing out stuff from tests in a way that is readable.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the box to use.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>The file object to print to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  None.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def box(name=None, file=None):
    """A context manager that prints out a box around a block.
    This is useful for printing out stuff from tests in a way that is readable.

    Args:
      name: A string, the name of the box to use.
      file: The file object to print to.
    Yields:
      None.
    """
    file = file or sys.stdout
    file.write('\n')
    if name:
        header = ',--------({})--------\n'.format(name)
        footer = '`{}\n'.format('-' * (len(header)-2))
    else:
        header = ',----------------\n'
        footer = '`----------------\n'

    file.write(header)
    yield
    file.write(footer)
    file.flush()
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.cmptuple">
<code class="highlight language-python">
cmptuple
(name, attributes)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.cmptuple" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Manufacture a comparable namedtuple class, similar to collections.namedtuple.</p>
<p>A comparable named tuple is a tuple which compares to False if contents are
equal but the data types are different. We define this to supplement
collections.namedtuple because by default a namedtuple disregards the type
and we want to make precise comparisons for tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>The given name of the class.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A string or tuple of strings, with the names of the
attributes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new namedtuple-derived type that compares False with other
tuples with same contents.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def cmptuple(name, attributes):
    """Manufacture a comparable namedtuple class, similar to collections.namedtuple.

    A comparable named tuple is a tuple which compares to False if contents are
    equal but the data types are different. We define this to supplement
    collections.namedtuple because by default a namedtuple disregards the type
    and we want to make precise comparisons for tests.

    Args:
      name: The given name of the class.
      attributes: A string or tuple of strings, with the names of the
        attributes.
    Returns:
      A new namedtuple-derived type that compares False with other
      tuples with same contents.
    """
    base = collections.namedtuple('_{}'.format(name), attributes)
    return type(name, (TypeComparable, base,), {})
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.compute_unique_clean_ids">
<code class="highlight language-python">
compute_unique_clean_ids
(strings)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.compute_unique_clean_ids" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of strings, reduce them to corresponding ids without any
funny characters and insure that the list of ids is unique. Yields pairs
of (id, string) for the result.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strings</code></td>
<td><code></code></td>
<td>
<p>A list of strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of (id, string) pairs.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def compute_unique_clean_ids(strings):
    """Given a sequence of strings, reduce them to corresponding ids without any
    funny characters and insure that the list of ids is unique. Yields pairs
    of (id, string) for the result.

    Args:
      strings: A list of strings.
    Returns:
      A list of (id, string) pairs.
    """
    string_set = set(strings)

    # Try multiple methods until we get one that has no collisions.
    for regexp, replacement in [(r'[^A-Za-z0-9.-]', '_'),
                                (r'[^A-Za-z0-9_]', ''),]:
        seen = set()
        idmap = {}
        mre = re.compile(regexp)
        for string in string_set:
            id_ = mre.sub(replacement, string)
            if id_ in seen:
                break  # Collision.
            seen.add(id_)
            idmap[id_] = string
        else:
            break
    else:
        return None # Could not find a unique mapping.

    return idmap
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.deprecated">
<code class="highlight language-python">
deprecated
(message)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.deprecated" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator generator to mark functions as deprecated and log a warning.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def deprecated(message):
    """A decorator generator to mark functions as deprecated and log a warning."""
    def decorator(func):
        @functools.wraps(func)
        def new_func(*args, **kwargs):
            warnings.warn("Call to deprecated function {}: {}".format(func.__name__,
                                                                      message),
                          category=DeprecationWarning,
                          stacklevel=2)
            return func(*args, **kwargs)
        return new_func
    return decorator
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.dictmap">
<code class="highlight language-python">
dictmap
(mdict, keyfun=None, valfun=None)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.dictmap" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Map a dictionary's value.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mdict</code></td>
<td><code></code></td>
<td>
<p>A dict.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the keys.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the values.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def dictmap(mdict, keyfun=None, valfun=None):
    """Map a dictionary's value.

    Args:
      mdict: A dict.
      key: A callable to apply to the keys.
      value: A callable to apply to the values.
    """
    if keyfun is None:
        keyfun = lambda x: x
    if valfun is None:
        valfun = lambda x: x
    return {keyfun(key): valfun(val) for key, val in mdict.items()}
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.escape_string">
<code class="highlight language-python">
escape_string
(string)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.escape_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Escape quotes and backslashes in payee and narration.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>Any string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Returns.
  The input string, with offending characters replaced.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def escape_string(string):
    """Escape quotes and backslashes in payee and narration.

    Args:
      string: Any string.
    Returns.
      The input string, with offending characters replaced.
    """
    return string.replace('\\', r'\\')\
                 .replace('"', r'\"')
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.filter_type">
<code class="highlight language-python">
filter_type
(elist, types)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.filter_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter the given list to yield only instances of the given types.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>elist</code></td>
<td><code></code></td>
<td>
<p>A sequence of elements.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>types</code></td>
<td><code></code></td>
<td>
<p>A sequence of types to include in the output list.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Each element, if it is an instance of 'types'.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def filter_type(elist, types):
    """Filter the given list to yield only instances of the given types.

    Args:
      elist: A sequence of elements.
      types: A sequence of types to include in the output list.
    Yields:
      Each element, if it is an instance of 'types'.
    """
    for element in elist:
        if not isinstance(element, types):
            continue
        yield element
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.first_paragraph">
<code class="highlight language-python">
first_paragraph
(docstring)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.first_paragraph" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the first sentence of a docstring.
The sentence has to be delimited by an empty line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docstring</code></td>
<td><code></code></td>
<td>
<p>A doc string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string with just the first sentence on a single line.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def first_paragraph(docstring):
    """Return the first sentence of a docstring.
    The sentence has to be delimited by an empty line.

    Args:
      docstring: A doc string.
    Returns:
      A string with just the first sentence on a single line.
    """
    lines = []
    for line in docstring.strip().splitlines():
        if not line:
            break
        lines.append(line.rstrip())
    return ' '.join(lines)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_screen_height">
<code class="highlight language-python">
get_screen_height
()

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_screen_height" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the height of the terminal that runs this program.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An integer, the number of characters the screen is high.
Return 0 if the terminal cannot be initialized.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def get_screen_height():
    """Return the height of the terminal that runs this program.

    Returns:
      An integer, the number of characters the screen is high.
      Return 0 if the terminal cannot be initialized.
    """
    return _get_screen_value('lines', 0)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_screen_width">
<code class="highlight language-python">
get_screen_width
()

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_screen_width" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the width of the terminal that runs this program.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An integer, the number of characters the screen is wide.
Return 0 if the terminal cannot be initialized.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def get_screen_width():
    """Return the width of the terminal that runs this program.

    Returns:
      An integer, the number of characters the screen is wide.
      Return 0 if the terminal cannot be initialized.
    """
    return _get_screen_value('cols', 0)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_tuple_values">
<code class="highlight language-python">
get_tuple_values
(ntuple, predicate, memo=None)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_tuple_values" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return all members referred to by this namedtuple instance that satisfy the
given predicate. This function also works recursively on its members which
are lists or typles, and so it can be used for Transaction instances.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ntuple</code></td>
<td><code></code></td>
<td>
<p>A tuple or namedtuple.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td><code></code></td>
<td>
<p>A predicate function that returns true if an attribute is to be
output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>memo</code></td>
<td><code></code></td>
<td>
<p>An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def get_tuple_values(ntuple, predicate, memo=None):
    """Return all members referred to by this namedtuple instance that satisfy the
    given predicate. This function also works recursively on its members which
    are lists or typles, and so it can be used for Transaction instances.

    Args:
      ntuple: A tuple or namedtuple.
      predicate: A predicate function that returns true if an attribute is to be
        output.
      memo: An optional memoizing dictionary. If a tuple has already been seen, the
        recursion will be avoided.
    Yields:
      Attributes of the tuple and its sub-elements if the predicate is true.
    """
    if memo is None:
        memo = set()
    id_ntuple = id(ntuple)
    if id_ntuple in memo:
        return
    memo.add(id_ntuple)

    if predicate(ntuple):
        yield
    for attribute in ntuple:
        if predicate(attribute):
            yield attribute
        if isinstance(attribute, (list, tuple)):
            for value in get_tuple_values(attribute, predicate, memo):
                yield value
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.groupby">
<code class="highlight language-python">
groupby
(keyfun, elements)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.groupby" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Group the elements as a dict of lists, where the key is computed using the
function 'keyfun'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keyfun</code></td>
<td><code></code></td>
<td>
<p>A callable, used to obtain the group key from each element.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>elements</code></td>
<td><code></code></td>
<td>
<p>An iterable of the elements to group.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of key to list of sequences.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def groupby(keyfun, elements):
    """Group the elements as a dict of lists, where the key is computed using the
    function 'keyfun'.

    Args:
      keyfun: A callable, used to obtain the group key from each element.
      elements: An iterable of the elements to group.
    Returns:
      A dict of key to list of sequences.
    """
    # Note: We could allow a custom aggregation function. Another option is
    # provide another method to reduce the list values of a dict, but that can
    # be accomplished using a dict comprehension.
    grouped = defaultdict(list)
    for element in elements:
        grouped[keyfun(element)].append(element)
    return grouped
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.idify">
<code class="highlight language-python">
idify
(string)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.idify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace characters objectionable for a filename with underscores.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>Any string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The input string, with offending characters replaced.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def idify(string):
    """Replace characters objectionable for a filename with underscores.

    Args:
      string: Any string.
    Returns:
      The input string, with offending characters replaced.
    """
    for sfrom, sto in [(r'[ \(\)]+', '_'),
                      (r'_*\._*', '.')]:
        string = re.sub(sfrom, sto, string)
    string = string.strip('_')
    return string
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.import_curses">
<code class="highlight language-python">
import_curses
()

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.import_curses" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Try to import the 'curses' module.
(This is used here in order to override for tests.)</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The curses module, if it was possible to import it.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ImportError</code></td>
<td>
<p>If the module could not be imported.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def import_curses():
    """Try to import the 'curses' module.
    (This is used here in order to override for tests.)

    Returns:
      The curses module, if it was possible to import it.
    Raises:
      ImportError: If the module could not be imported.
    """
    # Note: There's a recipe for getting terminal size on Windows here, without
    # curses, I should probably implement that at some point:
    # https://stackoverflow.com/questions/263890/how-do-i-find-the-width-height-of-a-terminal-window
    # Also, consider just using 'blessings' instead, which provides this across
    # multiple platforms.
    import curses
    return curses
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.is_sorted">
<code class="highlight language-python">
is_sorted
(iterable, key=&lt;function &lt;lambda&gt; at 0x7fdf0a6f7820&gt;, cmp=&lt;function &lt;lambda&gt; at 0x7fdf0a6f78b0&gt;)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.is_sorted" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the sequence is sorted.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A function to extract the quantity by which to sort.</p>
</td>
<td><code>&lt;function &lt;lambda&gt; at 0x7fdf0a6f7820&gt;</code></td>
</tr>
<tr>
<td><code>cmp</code></td>
<td><code></code></td>
<td>
<p>A function that compares two elements of a sequence.</p>
</td>
<td><code>&lt;function &lt;lambda&gt; at 0x7fdf0a6f78b0&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the sequence is sorted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def is_sorted(iterable, key=lambda x: x, cmp=lambda x, y: x &lt;= y):
    """Return true if the sequence is sorted.

    Args:
      iterable: An iterable sequence.
      key: A function to extract the quantity by which to sort.
      cmp: A function that compares two elements of a sequence.
    Returns:
      A boolean, true if the sequence is sorted.
    """
    iterator = map(key, iterable)
    prev = next(iterator)
    for element in iterator:
        if not cmp(prev, element):
            return False
        prev = element
    return True
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.log_time">
<code class="highlight language-python">
log_time
(operation_name, log_timings, indent=0)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.log_time" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that times the block and logs it to info level.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operation_name</code></td>
<td><code></code></td>
<td>
<p>A string, a label for the name of the operation.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>log_timings</code></td>
<td><code></code></td>
<td>
<p>A function to write log messages to. If left to None,
no timings are written (this becomes a no-op).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>indent</code></td>
<td><code></code></td>
<td>
<p>An integer, the indentation level for the format of the timing
line. This is useful if you're logging timing to a hierarchy of
operations.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  The start time of the operation.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def log_time(operation_name, log_timings, indent=0):
    """A context manager that times the block and logs it to info level.

    Args:
      operation_name: A string, a label for the name of the operation.
      log_timings: A function to write log messages to. If left to None,
        no timings are written (this becomes a no-op).
      indent: An integer, the indentation level for the format of the timing
        line. This is useful if you're logging timing to a hierarchy of
        operations.
    Yields:
      The start time of the operation.
    """
    time1 = time()
    yield time1
    time2 = time()
    if log_timings:
        log_timings("Operation: {:48} Time: {}{:6.0f} ms".format(
            "'{}'".format(operation_name), '      '*indent, (time2 - time1) * 1000))
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.longest">
<code class="highlight language-python">
longest
(seq)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.longest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the longest of the given subsequences.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>seq</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence of lists.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The longest list from the sequence.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def longest(seq):
    """Return the longest of the given subsequences.

    Args:
      seq: An iterable sequence of lists.
    Returns:
      The longest list from the sequence.
    """
    longest, length = None, -1
    for element in seq:
        len_element = len(element)
        if len_element &gt; length:
            longest, length = element, len_element
    return longest
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.map_namedtuple_attributes">
<code class="highlight language-python">
map_namedtuple_attributes
(attributes, mapper, object_)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.map_namedtuple_attributes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Map the value of the named attributes of object by mapper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A sequence of string, the attribute names to map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mapper</code></td>
<td><code></code></td>
<td>
<p>A callable that accepts the value of a field and returns
the new value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>object_</code></td>
<td><code></code></td>
<td>
<p>Some namedtuple object with attributes on it.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of the same namedtuple with the named fields mapped by
mapper.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def map_namedtuple_attributes(attributes, mapper, object_):
    """Map the value of the named attributes of object by mapper.

    Args:
      attributes: A sequence of string, the attribute names to map.
      mapper: A callable that accepts the value of a field and returns
        the new value.
      object_: Some namedtuple object with attributes on it.
    Returns:
      A new instance of the same namedtuple with the named fields mapped by
      mapper.
    """
    return object_._replace(**{attribute: mapper(getattr(object_, attribute))
                               for attribute in attributes})
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.replace_namedtuple_values">
<code class="highlight language-python">
replace_namedtuple_values
(ntuple, predicate, mapper, memo=None)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.replace_namedtuple_values" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Recurse through all the members of namedtuples and lists, and for
members that match the given predicate, run them through the given mapper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ntuple</code></td>
<td><code></code></td>
<td>
<p>A namedtuple instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td><code></code></td>
<td>
<p>A predicate function that returns true if an attribute is to be
output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mapper</code></td>
<td><code></code></td>
<td>
<p>A callable, that will accept a single argument and return its
replacement value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>memo</code></td>
<td><code></code></td>
<td>
<p>An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def replace_namedtuple_values(ntuple, predicate, mapper, memo=None):
    """Recurse through all the members of namedtuples and lists, and for
    members that match the given predicate, run them through the given mapper.

    Args:
      ntuple: A namedtuple instance.
      predicate: A predicate function that returns true if an attribute is to be
        output.
      mapper: A callable, that will accept a single argument and return its
        replacement value.
      memo: An optional memoizing dictionary. If a tuple has already been seen, the
        recursion will be avoided.
    Yields:
      Attributes of the tuple and its sub-elements if the predicate is true.
    """
    if memo is None:
        memo = set()
    id_ntuple = id(ntuple)
    if id_ntuple in memo:
        return None
    memo.add(id_ntuple)

    # pylint: disable=unidiomatic-typecheck
    if not (type(ntuple) is not tuple and isinstance(ntuple, tuple)):
        return ntuple
    replacements = {}
    for attribute_name, attribute in zip(ntuple._fields, ntuple):
        if predicate(attribute):
            replacements[attribute_name] = mapper(attribute)
        elif type(attribute) is not tuple and isinstance(attribute, tuple):
            replacements[attribute_name] = replace_namedtuple_values(
                attribute, predicate, mapper, memo)
        elif type(attribute) in (list, tuple):
            replacements[attribute_name] = [
                replace_namedtuple_values(member, predicate, mapper, memo)
                for member in attribute]
    return ntuple._replace(**replacements)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.skipiter">
<code class="highlight language-python">
skipiter
(iterable, num_skip)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.skipiter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Skip some elements from an iterator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>num_skip</code></td>
<td><code></code></td>
<td>
<p>The number of elements in the period.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elemnets from the iterable, with num_skip elements skipped.
  For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def skipiter(iterable, num_skip):
    """Skip some elements from an iterator.

    Args:
      iterable: An iterator.
      num_skip: The number of elements in the period.
    Yields:
      Elemnets from the iterable, with num_skip elements skipped.
      For example, skipiter(range(10), 3) yields [0, 3, 6, 9].
    """
    assert num_skip &gt; 0
    sit = iter(iterable)
    while 1:
        try:
            value = next(sit)
        except StopIteration:
            return
        yield value
        for _ in range(num_skip-1):
            try:
                next(sit)
            except StopIteration:
                return
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.sorted_uniquify">
<code class="highlight language-python">
sorted_uniquify
(iterable, keyfunc=None, last=False)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.sorted_uniquify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of elements, sort and remove duplicates of the given key.
Keep either the first or the last (by key) element of a sequence of
key-identical elements. This does <em>not</em> maintain the ordering of the
original elements, they are returned sorted (by key) instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>keyfunc</code></td>
<td><code></code></td>
<td>
<p>A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>last</code></td>
<td><code></code></td>
<td>
<p>A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elements from the iterable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def sorted_uniquify(iterable, keyfunc=None, last=False):
    """Given a sequence of elements, sort and remove duplicates of the given key.
    Keep either the first or the last (by key) element of a sequence of
    key-identical elements. This does _not_ maintain the ordering of the
    original elements, they are returned sorted (by key) instead.

    Args:
      iterable: An iterable sequence.
      keyfunc: A function that extracts from the elements the sort key
        to use and uniquify on. If left unspecified, the identify function
        is used and the uniquification occurs on the elements themselves.
      last: A boolean, True if we should keep the last item of the same keys.
        Otherwise keep the first.
    Yields:
      Elements from the iterable.
    """
    if keyfunc is None:
        keyfunc = lambda x: x
    if last:
        prev_obj = UNSET
        prev_key = UNSET
        for obj in sorted(iterable, key=keyfunc):
            key = keyfunc(obj)
            if key != prev_key and prev_obj is not UNSET:
                yield prev_obj
            prev_obj = obj
            prev_key = key
        if prev_obj is not UNSET:
            yield prev_obj
    else:
        prev_key = UNSET
        for obj in sorted(iterable, key=keyfunc):
            key = keyfunc(obj)
            if key != prev_key:
                yield obj
                prev_key = key
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.staticvar">
<code class="highlight language-python">
staticvar
(varname, initial_value)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.staticvar" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Returns a decorator that defines a Python function attribute.</p>
<p>This is used to simulate a static function variable in Python.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>varname</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the variable to define.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>initial_value</code></td>
<td><code></code></td>
<td>
<p>The value to initialize the variable to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A function decorator.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def staticvar(varname, initial_value):
    """Returns a decorator that defines a Python function attribute.

    This is used to simulate a static function variable in Python.

    Args:
      varname: A string, the name of the variable to define.
      initial_value: The value to initialize the variable to.
    Returns:
      A function decorator.
    """
    def deco(fun):
        setattr(fun, varname, initial_value)
        return fun
    return deco
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.swallow">
<code class="highlight language-python">
swallow
    (*
exception_types)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.swallow" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Catch and ignore certain exceptions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exception_types</code></td>
<td><code></code></td>
<td>
<p>A tuple of exception classes to ignore.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  None.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def swallow(*exception_types):
    """Catch and ignore certain exceptions.

    Args:
      exception_types: A tuple of exception classes to ignore.
    Yields:
      None.
    """
    try:
        yield
    except Exception as exc:
        if not isinstance(exc, exception_types):
            raise
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.uniquify">
<code class="highlight language-python">
uniquify
(iterable, keyfunc=None, last=False)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils.uniquify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of elements, remove duplicates of the given key. Keep either
the first or the last element of a sequence of key-identical elements. Order
is maintained as much as possible. This does maintain the ordering of the
original elements, they are returned in the same order as the original
elements.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>keyfunc</code></td>
<td><code></code></td>
<td>
<p>A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>last</code></td>
<td><code></code></td>
<td>
<p>A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elements from the iterable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def uniquify(iterable, keyfunc=None, last=False):
    """Given a sequence of elements, remove duplicates of the given key. Keep either
    the first or the last element of a sequence of key-identical elements. Order
    is maintained as much as possible. This does maintain the ordering of the
    original elements, they are returned in the same order as the original
    elements.

    Args:
      iterable: An iterable sequence.
      keyfunc: A function that extracts from the elements the sort key
        to use and uniquify on. If left unspecified, the identify function
        is used and the uniquification occurs on the elements themselves.
      last: A boolean, True if we should keep the last item of the same keys.
        Otherwise keep the first.
    Yields:
      Elements from the iterable.
    """
    if keyfunc is None:
        keyfunc = lambda x: x
    seen = set()
    if last:
        unique_reversed_list = []
        for obj in reversed(iterable):
            key = keyfunc(obj)
            if key not in seen:
                seen.add(key)
                unique_reversed_list.append(obj)
        yield from reversed(unique_reversed_list)
    else:
        for obj in iterable:
            key = keyfunc(obj)
            if key not in seen:
                seen.add(key)
                yield obj
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.misc_utils_test">
<code>misc_utils_test</code>
<a class="headerlink" href="#beancount.utils.misc_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for general utils.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils_test.raise_import_error">
<code class="highlight language-python">
raise_import_error
    (*
args, **
kw)

        </code>
<a class="headerlink" href="#beancount.utils.misc_utils_test.raise_import_error" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Raises an ImportError. This is patched in a test.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def raise_import_error(*args, **kw):
    """Raises an ImportError. This is patched in a test.

    Raises:
      ImportError, unconditionally.
    """
    raise ImportError("Could not import module")
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.net_utils">
<code>net_utils</code>
<a class="headerlink" href="#beancount.utils.net_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Network utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.net_utils.retrying_urlopen">
<code class="highlight language-python">
retrying_urlopen
(url, timeout=5, max_retry=5)

        </code>
<a class="headerlink" href="#beancount.utils.net_utils.retrying_urlopen" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Open and download the given URL, retrying if it times out.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td><code></code></td>
<td>
<p>A string, the URL to fetch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code></code></td>
<td>
<p>A timeout after which to stop waiting for a response and return an
error.</p>
</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>max_retry</code></td>
<td><code></code></td>
<td>
<p>The maximum number of times to retry.</p>
</td>
<td><code>5</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The contents of the fetched URL.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/net_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def retrying_urlopen(url, timeout=5, max_retry=5):
    """Open and download the given URL, retrying if it times out.

    Args:
      url: A string, the URL to fetch.
      timeout: A timeout after which to stop waiting for a response and return an
        error.
      max_retry: The maximum number of times to retry.
    Returns:
      The contents of the fetched URL.
    """
    for _ in range(max_retry):
        logging.debug("Reading %s", url)
        try:
            response = request.urlopen(url, timeout=timeout)
            if response:
                break
        except error.URLError:
            return None
    if response and response.getcode() != 200:
        return None
    return response
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.pager">
<code>pager</code>
<a class="headerlink" href="#beancount.utils.pager" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code to write output to a pager.</p>
<p>This module contains an object accumulates lines up to a minimum and then
decides whether to flush them to the original output directly if under the
threshold (no pager) or creates a pager and flushes the lines to it if above the
threshold and then forwards all future lines to it. The purpose of this object
is to pipe output to a pager only if the number of lines to be printed exceeds a
minimum number of lines.</p>
<p>The contextmanager is intended to be used to pipe output to a pager and wait on
the pager to complete before continuing. Simply write to the file object and
upon exit we close the file object. This also silences broken pipe errors
triggered by the user exiting the sub-process, and recovers from a failing pager
command by just using stdout.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager">
<code>ConditionalPager</code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A proxy file for a pager that only creates a pager after a minimum number of
    lines has been printed to it.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__enter__">
<code class="highlight language-python">
__enter__
(self)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__enter__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize the context manager and return this instance as it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __enter__(self):
    """Initialize the context manager and return this instance as it."""

    # The file and pipe object we're writing to. This gets set after the
    # number of accumulated lines reaches the threshold.
    if self.minlines:
        self.file = None
        self.pipe = None
    else:
        self.file, self.pipe = create_pager(self.command, self.default_file)

    # Lines accumulated before the threshold.
    self.accumulated_data = []
    self.accumulated_lines = 0

    # Return this object to be used as the context manager itself.
    return self
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__exit__">
<code class="highlight language-python">
__exit__
(self, type, value, unused_traceback)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__exit__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Context manager exit. This flushes the output to our output file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td><code></code></td>
<td>
<p>Optional exception type, as per context managers.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>Optional exception value, as per context managers.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unused_traceback</code></td>
<td><code></code></td>
<td>
<p>Optional trace.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __exit__(self, type, value, unused_traceback):
    """Context manager exit. This flushes the output to our output file.

    Args:
      type: Optional exception type, as per context managers.
      value: Optional exception value, as per context managers.
      unused_traceback: Optional trace.
    """
    try:
        if self.file:
            # Flush the output file and close it.
            self.file.flush()
        else:
            # Oops... we never reached the threshold. Flush the accumulated
            # output to the file.
            self.flush_accumulated(self.default_file)

        # Wait for the subprocess (if we have one).
        if self.pipe:
            self.file.close()
            self.pipe.wait()

    # Absorb broken pipes that may occur on flush or close above.
    except BrokenPipeError:
        return True

    # Absorb broken pipes.
    if isinstance(value, BrokenPipeError):
        return True
    elif value:
        raise
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__init__">
<code class="highlight language-python">
__init__
(self, command, minlines=None)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a conditional pager.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code></code></td>
<td>
<p>A string, the shell command to run as a pager.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>minlines</code></td>
<td><code></code></td>
<td>
<p>If set, the number of lines under which you should not bother starting
a pager. This avoids kicking off a pager if the screen is high enough to
render the contents. If the value is unset, always starts a pager (which is
fine behavior too).</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __init__(self, command, minlines=None):
    """Create a conditional pager.

    Args:
      command: A string, the shell command to run as a pager.
      minlines: If set, the number of lines under which you should not bother starting
        a pager. This avoids kicking off a pager if the screen is high enough to
        render the contents. If the value is unset, always starts a pager (which is
        fine behavior too).
    """
    self.command = command
    self.minlines = minlines
    self.default_file = (codecs.getwriter("utf-8")(sys.stdout.buffer)
                         if hasattr(sys.stdout, 'buffer') else
                         sys.stdout)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.flush_accumulated">
<code class="highlight language-python">
flush_accumulated
(self, file)

        </code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.flush_accumulated" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Flush the existing lines to the newly created pager.
This also disabled the accumulator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object to flush the accumulated data to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def flush_accumulated(self, file):
    """Flush the existing lines to the newly created pager.
    This also disabled the accumulator.

    Args:
      file: A file object to flush the accumulated data to.
    """
    if self.accumulated_data:
        write = file.write
        for data in self.accumulated_data:
            write(data)
    self.accumulated_data = None
    self.accumulated_lines = None
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.write">
<code class="highlight language-python">
write
(self, data)

        </code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.write" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Write the data out. Overridden from the file object interface.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code></code></td>
<td>
<p>A string, data to write to the output.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def write(self, data):
    """Write the data out. Overridden from the file object interface.

    Args:
      data: A string, data to write to the output.
    """
    if self.file is None:
        # Accumulate the new lines.
        self.accumulated_lines += data.count('\n')
        self.accumulated_data.append(data)

        # If we've reached the threshold, create a file.
        if self.accumulated_lines &gt; self.minlines:
            self.file, self.pipe = create_pager(self.command, self.default_file)
            self.flush_accumulated(self.file)
    else:
        # We've already created a pager subprocess... flush the lines to it.
        self.file.write(data)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.pager.create_pager">
<code class="highlight language-python">
create_pager
(command, file)

        </code>
<a class="headerlink" href="#beancount.utils.pager.create_pager" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Try to create and return a pager subprocess.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code></code></td>
<td>
<p>A string, the shell command to run as a pager.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>The file object for the pager write to. This is also used as a
default if we failed to create the pager subprocess.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (file, pipe), a file object and an optional subprocess.Popen instance
to wait on. The pipe instance may be set to None if we failed to create a subprocess.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def create_pager(command, file):
    """Try to create and return a pager subprocess.

    Args:
      command: A string, the shell command to run as a pager.
      file: The file object for the pager write to. This is also used as a
        default if we failed to create the pager subprocess.
    Returns:
      A pair of (file, pipe), a file object and an optional subprocess.Popen instance
      to wait on. The pipe instance may be set to None if we failed to create a subprocess.
    """

    if command is None:
        command = os.environ.get('PAGER', DEFAULT_PAGER)
    if not command:
        command = DEFAULT_PAGER

    pipe = None

    # In case of using 'less', make sure the charset is set properly. In theory
    # you could override this by setting PAGER to "LESSCHARSET=utf-8 less" but
    # this shouldn't affect other programs and is unlikely to cause problems, so
    # we set it here to make default behavior work for most people (we always
    # write UTF-8).
    env = os.environ.copy()
    env['LESSCHARSET'] = "utf-8"

    try:
        pipe = subprocess.Popen(command, shell=True,
                                stdin=subprocess.PIPE,
                                stdout=file,
                                env=env)
    except OSError as exc:
        logging.error("Invalid pager: {}".format(exc))
        file = file
    else:
        stdin_wrapper = io.TextIOWrapper(pipe.stdin, 'utf-8')
        file = stdin_wrapper
    return file, pipe
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.pager.flush_only">
<code class="highlight language-python">
flush_only
(fileobj)

        </code>
<a class="headerlink" href="#beancount.utils.pager.flush_only" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A contextmanager around a file object that does not close the file.</p>
<p>This is used to return a context manager on a file object but not close it.
We flush it instead. This is useful in order to provide an alternative to a
pager class as above.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object, to remain open after running the context manager.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  A context manager that yields this object.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def flush_only(fileobj):
    """A contextmanager around a file object that does not close the file.

    This is used to return a context manager on a file object but not close it.
    We flush it instead. This is useful in order to provide an alternative to a
    pager class as above.

    Args:
      fileobj: A file object, to remain open after running the context manager.
    Yields:
      A context manager that yields this object.
    """
    try:
        yield fileobj
    finally:
        fileobj.flush()
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.pager_test">
<code>pager_test</code>
<a class="headerlink" href="#beancount.utils.pager_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for pager code.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.regexp_utils">
<code>regexp_utils</code>
<a class="headerlink" href="#beancount.utils.regexp_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Regular expression helpers.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.regexp_utils.re_replace_unicode">
<code class="highlight language-python">
re_replace_unicode
(regexp)

        </code>
<a class="headerlink" href="#beancount.utils.regexp_utils.re_replace_unicode" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Substitute Unicode Properties in regular expressions with their
corresponding expanded ranges.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>regexp</code></td>
<td><code></code></td>
<td>
<p>A regular expression string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Return the regular expression with Unicode Properties substituted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/regexp_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def re_replace_unicode(regexp):
    """Substitute Unicode Properties in regular expressions with their
    corresponding expanded ranges.

    Args:
      regexp: A regular expression string.
    Returns:
      Return the regular expression with Unicode Properties substituted.
    """
    for category, rangestr in UNICODE_RANGES.items():
        regexp = regexp.replace(r'\p{' + category + '}', rangestr)
    return regexp
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.snoop">
<code>snoop</code>
<a class="headerlink" href="#beancount.utils.snoop" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Text manipulation utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.snoop.Snoop">
<code>Snoop</code>
<a class="headerlink" href="#beancount.utils.snoop.Snoop" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A snooper callable that just saves the returned values of a
    function. This is particularly useful for re.match and re.search in
    conditionals, e.g.::</p>
<pre><code>  snoop = Snoop()
  ...
  if snoop(re.match(r"(\d+)-(\d+)-(\d+)", text)):
    year, month, date = snoop.value.group(1, 2, 3)

Attributes:
  value: The last value snooped from a function call.
  history: If 'maxlen' was specified, the last few values
    that were snooped.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__call__">
<code class="highlight language-python">
__call__
(self, value)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Save a value to the snooper. This is meant to wrap
a function call.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value to push/save.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Value itself.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __call__(self, value):
    """Save a value to the snooper. This is meant to wrap
    a function call.

    Args:
      value: The value to push/save.
    Returns:
      Value itself.
    """
    self.value = value
    if self.history is not None:
        self.history.append(value)
    return value
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__getattr__">
<code class="highlight language-python">
__getattr__
(self, attr)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__getattr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Forward the attribute to the value.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attr</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the attribute.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The value of the attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __getattr__(self, attr):
    """Forward the attribute to the value.

    Args:
      attr: A string, the name of the attribute.
    Returns:
      The value of the attribute.
    """
    return getattr(self.value, attr)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__init__">
<code class="highlight language-python">
__init__
(self, maxlen=None)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new snooper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>maxlen</code></td>
<td><code></code></td>
<td>
<p>If specified, an integer, which enables the saving of that</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __init__(self, maxlen=None):
    """Create a new snooper.

    Args:
      maxlen: If specified, an integer, which enables the saving of that
      number of last values in the history attribute.
    """
    self.value = None
    self.history = (collections.deque(maxlen=maxlen)
                    if maxlen
                    else None)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.snoop.snoopify">
<code class="highlight language-python">
snoopify
(function)

        </code>
<a class="headerlink" href="#beancount.utils.snoop.snoopify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorate a function as snoopable.</p>
<p>This is meant to reassign existing functions to a snoopable version of them.
For example, if you wanted 're.match' to be automatically snoopable, just
decorate it like this:</p>
<p>re.match = snoopify(re.match)</p>
<p>and then you can just call 're.match' in a conditional and then access
're.match.value' to get to the last returned value.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def snoopify(function):
    """Decorate a function as snoopable.

    This is meant to reassign existing functions to a snoopable version of them.
    For example, if you wanted 're.match' to be automatically snoopable, just
    decorate it like this:

      re.match = snoopify(re.match)

    and then you can just call 're.match' in a conditional and then access
    're.match.value' to get to the last returned value.
    """
    @functools.wraps(function)
    def wrapper(*args, **kw):
        value = function(*args, **kw)
        wrapper.value = value
        return value
    wrapper.value = None
    return wrapper
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.test_utils">
<code>test_utils</code>
<a class="headerlink" href="#beancount.utils.test_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Support utillities for testing scripts.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.RCall">
<code>RCall</code>
<a class="headerlink" href="#beancount.utils.test_utils.RCall" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>RCall(args, kwargs, return_value)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__getnewargs__">
<code class="highlight language-python">
__getnewargs__
(self)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __getnewargs__(self):
    'Return self as a plain tuple.  Used by copy and pickle.'
    return _tuple(self)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__new__">
<code class="highlight language-python">
__new__
(_cls, args, kwargs, return_value)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of RCall(args, kwargs, return_value)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__repr__">
<code class="highlight language-python">
__repr__
(self)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __repr__(self):
    'Return a nicely formatted representation string'
    return self.__class__.__name__ + repr_fmt % self
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.TestCase">
<code>TestCase</code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.TestCase.assertLines">
<code class="highlight language-python">
assertLines
(self, text1, text2, message=None)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase.assertLines" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Compare the lines of text1 and text2, ignoring whitespace.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text1</code></td>
<td><code></code></td>
<td>
<p>A string, the expected text.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>text2</code></td>
<td><code></code></td>
<td>
<p>A string, the actual text.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>message</code></td>
<td><code></code></td>
<td>
<p>An optional string message in case the assertion fails.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the exception fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def assertLines(self, text1, text2, message=None):
    """Compare the lines of text1 and text2, ignoring whitespace.

    Args:
      text1: A string, the expected text.
      text2: A string, the actual text.
      message: An optional string message in case the assertion fails.
    Raises:
      AssertionError: If the exception fails.
    """
    clean_text1 = textwrap.dedent(text1.strip())
    clean_text2 = textwrap.dedent(text2.strip())
    lines1 = [line.strip() for line in clean_text1.splitlines()]
    lines2 = [line.strip() for line in clean_text2.splitlines()]

    # Compress all space longer than 4 spaces to exactly 4.
    # This affords us to be even looser.
    lines1 = [re.sub('    [ \t]*', '    ', line) for line in lines1]
    lines2 = [re.sub('    [ \t]*', '    ', line) for line in lines2]
    self.assertEqual(lines1, lines2, message)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.TestCase.assertOutput">
<code class="highlight language-python">
assertOutput
(self, expected_text)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase.assertOutput" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Expect text printed to stdout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expected_text</code></td>
<td><code></code></td>
<td>
<p>A string, the text that should have been printed to stdout.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the text differs.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def assertOutput(self, expected_text):
    """Expect text printed to stdout.

    Args:
      expected_text: A string, the text that should have been printed to stdout.
    Raises:
      AssertionError: If the text differs.
    """
    with capture() as oss:
        yield oss
    self.assertLines(textwrap.dedent(expected_text), oss.getvalue())
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.call_command">
<code class="highlight language-python">
call_command
(command)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.call_command" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run the script with a subprocess.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>script_args</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the arguments to the subprocess,
including the script name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triplet of (return code integer, stdout ext, stderr text).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def call_command(command):
    """Run the script with a subprocess.

    Args:
      script_args: A list of strings, the arguments to the subprocess,
        including the script name.
    Returns:
      A triplet of (return code integer, stdout ext, stderr text).
    """
    assert isinstance(command, list), command
    p = subprocess.Popen(command,
                         stdout=subprocess.PIPE,
                         stderr=subprocess.PIPE)
    stdout, stderr = p.communicate()
    return p.returncode, stdout.decode(), stderr.decode()
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.capture">
<code class="highlight language-python">
capture
    (*
attributes)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.capture" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that captures what's printed to stdout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*attributes</code></td>
<td><code></code></td>
<td>
<p>A tuple of strings, the name of the sys attributes to override
with StringIO instances.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A StringIO string accumulator.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def capture(*attributes):
    """A context manager that captures what's printed to stdout.

    Args:
      *attributes: A tuple of strings, the name of the sys attributes to override
        with StringIO instances.
    Yields:
      A StringIO string accumulator.
    """
    if not attributes:
        attributes = 'stdout'
    elif len(attributes) == 1:
        attributes = attributes[0]
    return patch(sys, attributes, io.StringIO)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.create_temporary_files">
<code class="highlight language-python">
create_temporary_files
(root, contents_map)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.create_temporary_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a number of temporary files under 'root'.</p>
<p>This routine is used to initialize the contents of multiple files under a
temporary directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the directory under which to create the files.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>contents_map</code></td>
<td><code></code></td>
<td>
<p>A dict of relative filenames to their contents. The content
strings will be automatically dedented for convenience. In addition, the
string 'ROOT' in the contents will be automatically replaced by the root
directory name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def create_temporary_files(root, contents_map):
    """Create a number of temporary files under 'root'.

    This routine is used to initialize the contents of multiple files under a
    temporary directory.

    Args:
      root: A string, the name of the directory under which to create the files.
      contents_map: A dict of relative filenames to their contents. The content
        strings will be automatically dedented for convenience. In addition, the
        string 'ROOT' in the contents will be automatically replaced by the root
        directory name.
    """
    os.makedirs(root, exist_ok=True)
    for relative_filename, contents in contents_map.items():
        assert not path.isabs(relative_filename)
        filename = path.join(root, relative_filename)
        os.makedirs(path.dirname(filename), exist_ok=True)

        clean_contents = textwrap.dedent(contents.replace('{root}', root))
        with open(filename, 'w') as f:
            f.write(clean_contents)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.docfile">
<code class="highlight language-python">
docfile
    (function, **
kwargs)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.docfile" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator that write the function's docstring to a temporary file
and calls the decorated function with the temporary filename.  This is
useful for writing tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A function to decorate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The decorated function.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def docfile(function, **kwargs):
    """A decorator that write the function's docstring to a temporary file
    and calls the decorated function with the temporary filename.  This is
    useful for writing tests.

    Args:
      function: A function to decorate.
    Returns:
      The decorated function.
    """
    @functools.wraps(function)
    def new_function(self):
        allowed = ('buffering', 'encoding', 'newline', 'dir', 'prefix', 'suffix')
        if any([key not in allowed for key in kwargs]):
            raise ValueError("Invalid kwarg to docfile_extra")
        with tempfile.NamedTemporaryFile('w', **kwargs) as file:
            text = function.__doc__
            file.write(textwrap.dedent(text))
            file.flush()
            return function(self, file.name)
    new_function.__doc__ = None
    return new_function
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.docfile_extra">
<code class="highlight language-python">
docfile_extra
    (**
kwargs)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.docfile_extra" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator identical to @docfile,
but it also takes kwargs for the temporaryfile,
Kwargs:
  e.g. buffering, encoding, newline, dir, prefix, and suffix.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>docfile</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def docfile_extra(**kwargs):
    """
    A decorator identical to @docfile,
    but it also takes kwargs for the temporaryfile,
    Kwargs:
      e.g. buffering, encoding, newline, dir, prefix, and suffix.
    Returns:
      docfile
    """
    return functools.partial(docfile, **kwargs)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.environ">
<code class="highlight language-python">
environ
(varname, newvalue)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.environ" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager which pushes varname's value and restores it later.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>varname</code></td>
<td><code></code></td>
<td>
<p>A string, the environ variable name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>newvalue</code></td>
<td><code></code></td>
<td>
<p>A string, the desired value.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def environ(varname, newvalue):
    """A context manager which pushes varname's value and restores it later.

    Args:
      varname: A string, the environ variable name.
      newvalue: A string, the desired value.
    """
    oldvalue = os.environ.get(varname)
    os.environ[varname] = newvalue
    yield
    if oldvalue:
        os.environ[varname] = oldvalue
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.find_python_lib">
<code class="highlight language-python">
find_python_lib
()

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.find_python_lib" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the path to the root of the Python libraries.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def find_python_lib():
    """Return the path to the root of the Python libraries.

    Returns:
      A string, the root directory.
    """
    return path.dirname(path.dirname(path.dirname(__file__)))
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.find_repository_root">
<code class="highlight language-python">
find_repository_root
(filename=None)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.find_repository_root" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the path to the repository root.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of a file within the repository.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def find_repository_root(filename=None):
    """Return the path to the repository root.

    Args:
      filename: A string, the name of a file within the repository.
    Returns:
      A string, the root directory.
    """
    if filename is None:
        filename = __file__
    while not all(path.exists(path.join(filename, sigfile))
                  for sigfile in ('PKG-INFO', 'COPYING', 'README')):
        prev_filename = filename
        filename = path.dirname(filename)
        if prev_filename == filename:
            raise ValueError("Failed to find the root directory.")
    return filename
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.make_failing_importer">
<code class="highlight language-python">
make_failing_importer
    (*
removed_module_names)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.make_failing_importer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Make an importer that raise an ImportError for some modules.</p>
<p>Use it like this:</p>
<p>@mock.patch('builtins.<strong>import</strong>', make_failing_importer('setuptools'))
  def test_...</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>removed_module_name</code></td>
<td><code></code></td>
<td>
<p>The name of the module import that should raise an exception.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A decorated test decorator.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def make_failing_importer(*removed_module_names):
    """Make an importer that raise an ImportError for some modules.

    Use it like this:

      @mock.patch('builtins.__import__', make_failing_importer('setuptools'))
      def test_...

    Args:
      removed_module_name: The name of the module import that should raise an exception.
    Returns:
      A decorated test decorator.
    """
    def failing_import(name, *args, **kwargs):
        if name in removed_module_names:
            raise ImportError("Could not import {}".format(name))
        return builtins.__import__(name, *args, **kwargs)
    return failing_import
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.nottest">
<code class="highlight language-python">
nottest
(func)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.nottest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Make the given function not testable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def nottest(func):
    "Make the given function not testable."
    func.__test__ = False
    return func
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.patch">
<code class="highlight language-python">
patch
(obj, attributes, replacement_type)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.patch" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that temporarily patches an object's attributes.</p>
<p>All attributes in 'attributes' are saved and replaced by new instances
of type 'replacement_type'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td><code></code></td>
<td>
<p>The object to patch up.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A string or a sequence of strings, the names of attributes to replace.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>replacement_type</code></td>
<td><code></code></td>
<td>
<p>A callable to build replacment objects.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  An instance of a list of sequencs of 'replacement_type'.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def patch(obj, attributes, replacement_type):
    """A context manager that temporarily patches an object's attributes.

    All attributes in 'attributes' are saved and replaced by new instances
    of type 'replacement_type'.

    Args:
      obj: The object to patch up.
      attributes: A string or a sequence of strings, the names of attributes to replace.
      replacement_type: A callable to build replacment objects.
    Yields:
      An instance of a list of sequencs of 'replacement_type'.
    """
    single = isinstance(attributes, str)
    if single:
        attributes = [attributes]

    saved = []
    replacements = []
    for attribute in attributes:
        replacement = replacement_type()
        replacements.append(replacement)
        saved.append(getattr(obj, attribute))
        setattr(obj, attribute, replacement)

    yield replacements[0] if single else replacements

    for attribute, saved_attr in zip(attributes, saved):
        setattr(obj, attribute, saved_attr)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.record">
<code class="highlight language-python">
record
(fun)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.record" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorates the function to intercept and record all calls and return values.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fun</code></td>
<td><code></code></td>
<td>
<p>A callable to be decorated.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A wrapper function with a .calls attribute, a list of RCall instances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def record(fun):
    """Decorates the function to intercept and record all calls and return values.

    Args:
      fun: A callable to be decorated.
    Returns:
      A wrapper function with a .calls attribute, a list of RCall instances.
    """
    @functools.wraps(fun)
    def wrapped(*args, **kw):
        return_value = fun(*args, **kw)
        wrapped.calls.append(RCall(args, kw, return_value))
        return return_value
    wrapped.calls = []
    return wrapped
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.run_with_args">
<code class="highlight language-python">
run_with_args
(function, args)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.run_with_args" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run the given function with sys.argv set to argv. The first argument is
automatically inferred to be where the function object was defined. sys.argv
is restored after the function is called.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A function object to call with no arguments.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>argv</code></td>
<td><code></code></td>
<td>
<p>A list of arguments, excluding the script name, to be temporarily
set on sys.argv.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The return value of the function run.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def run_with_args(function, args):
    """Run the given function with sys.argv set to argv. The first argument is
    automatically inferred to be where the function object was defined. sys.argv
    is restored after the function is called.

    Args:
      function: A function object to call with no arguments.
      argv: A list of arguments, excluding the script name, to be temporarily
        set on sys.argv.
    Returns:
      The return value of the function run.
    """
    saved_argv = sys.argv
    saved_handlers = logging.root.handlers
    try:
        module = sys.modules[function.__module__]
        sys.argv = [module.__file__] + args
        logging.root.handlers = []
        return function()
    finally:
        sys.argv = saved_argv
        logging.root.handlers = saved_handlers
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.search_words">
<code class="highlight language-python">
search_words
(words, line)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.search_words" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Search for a sequence of words in a line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>words</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the words to look for, or a space-separated string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>line</code></td>
<td><code></code></td>
<td>
<p>A string, the line to search into.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A MatchObject, or None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def search_words(words, line):
    """Search for a sequence of words in a line.

    Args:
      words: A list of strings, the words to look for, or a space-separated string.
      line: A string, the line to search into.
    Returns:
      A MatchObject, or None.
    """
    if isinstance(words, str):
        words = words.split()
    return re.search('.*'.join(r'\b{}\b'.format(word) for word in words), line)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.skipIfRaises">
<code class="highlight language-python">
skipIfRaises
    (*
exc_types)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.skipIfRaises" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager (or decorator) that skips a test if an exception is raised.</p>
<p>Yields:
  Nothing, for you to execute the function code.</p>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SkipTest</code></td>
<td>
<p>if the test raised the expected exception.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def skipIfRaises(*exc_types):
    """A context manager (or decorator) that skips a test if an exception is raised.

    Args:
      exc_type
    Yields:
      Nothing, for you to execute the function code.
    Raises:
      SkipTest: if the test raised the expected exception.
    """
    try:
        yield
    except exc_types as exception:
        raise unittest.SkipTest(exception)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.subprocess_env">
<code class="highlight language-python">
subprocess_env
()

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.subprocess_env" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a dict to use as environment for running subprocesses.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def subprocess_env():
    """Return a dict to use as environment for running subprocesses.

    Returns:
      A string, the root directory.
    """
    # Ensure we have locations to invoke our Python executable and our
    # runnable binaries in the test environment to run subprocesses.
    binpath = ':'.join([
        path.dirname(sys.executable),
        path.join(find_repository_root(__file__), 'bin'),
        os.environ.get('PATH', '').strip(':')]).strip(':')
    return {'PATH': binpath,
            'PYTHONPATH': find_python_lib()}
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.tempdir">
<code class="highlight language-python">
tempdir
    (delete=True, **
kw)

        </code>
<a class="headerlink" href="#beancount.utils.test_utils.tempdir" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that creates a temporary directory and deletes its
contents unconditionally once done.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>delete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we want to delete the directory after running.</p>
</td>
<td><code>True</code></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Keyword arguments for mkdtemp.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A string, the name of the temporary directory created.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">@contextlib.contextmanager
def tempdir(delete=True, **kw):
    """A context manager that creates a temporary directory and deletes its
    contents unconditionally once done.

    Args:
      delete: A boolean, true if we want to delete the directory after running.
      **kw: Keyword arguments for mkdtemp.
    Yields:
      A string, the name of the temporary directory created.
    """
    tempdir = tempfile.mkdtemp(prefix="beancount-test-tmpdir.", **kw)
    try:
        yield tempdir
    finally:
        if delete:
            shutil.rmtree(tempdir, ignore_errors=True)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.text_utils">
<code>text_utils</code>
<a class="headerlink" href="#beancount.utils.text_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Text manipulation utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.entitize_ampersand">
<code class="highlight language-python">
entitize_ampersand
(filename)

        </code>
<a class="headerlink" href="#beancount.utils.text_utils.entitize_ampersand" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert unescaped ampersand characters (&amp;) to XML entities.</p>
<p>This is used to fix code that has been programmed by bad developers who
didn't think about escaping the entities in their strings.
file does not contain</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to convert.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A self-destructing NamedTemporaryFile object that has been flushed and
which you may read to obtain the fixed contents.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def entitize_ampersand(filename):
    """Convert unescaped ampersand characters (&amp;) to XML entities.

    This is used to fix code that has been programmed by bad developers who
    didn't think about escaping the entities in their strings.
    file does not contain
    Args:
      filename: A string, the name of the file to convert.
    Returns:
      A self-destructing NamedTemporaryFile object that has been flushed and
      which you may read to obtain the fixed contents.
    """
    tidy_file = tempfile.NamedTemporaryFile(suffix='.xls', mode='w', delete=False)
    contents = open(filename).read()
    new_contents = re.sub('&amp;([^;&amp;]{12})', '&amp;\\1', contents)
    tidy_file.write(new_contents)
    tidy_file.flush()
    return tidy_file
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.replace_number">
<code class="highlight language-python">
replace_number
(match)

        </code>
<a class="headerlink" href="#beancount.utils.text_utils.replace_number" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace a single number matched from text into X'es.
'match' is a MatchObject from a regular expressions match.
(Use this with re.sub()).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match</code></td>
<td><code></code></td>
<td>
<p>A MatchObject.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A replacement string, consisting only of X'es.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def replace_number(match):
    """Replace a single number matched from text into X'es.
    'match' is a MatchObject from a regular expressions match.
    (Use this with re.sub()).

    Args:
      match: A MatchObject.
    Returns:
      A replacement string, consisting only of X'es.
    """
    return re.sub('[0-9]', 'X', match.group(1)) + match.group(2)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.replace_numbers">
<code class="highlight language-python">
replace_numbers
(text)

        </code>
<a class="headerlink" href="#beancount.utils.text_utils.replace_numbers" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace all numbers found within text.</p>
<p>Note that this is a heuristic used to filter out private numbers from web
pages in incognito mode and thus may not be perfect. It should let through
numbers which are part of URLs.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text</code></td>
<td><code></code></td>
<td>
<p>An input string object.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, with relevant numbers hopefully replaced with X'es.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def replace_numbers(text):
    """Replace all numbers found within text.

    Note that this is a heuristic used to filter out private numbers from web
    pages in incognito mode and thus may not be perfect. It should let through
    numbers which are part of URLs.

    Args:
      text: An input string object.
    Returns:
      A string, with relevant numbers hopefully replaced with X'es.

    """
    return re.sub(r'\b([0-9,]+(?:\.[0-9]*)?)\b([ \t&lt;]+[^0-9,.]|$)', replace_number, text)
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.text_utils_test">
<code>text_utils_test</code>
<a class="headerlink" href="#beancount.utils.text_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for text_utils.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.version">
<code>version</code>
<a class="headerlink" href="#beancount.utils.version" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Implement common options across all programs.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.version.ArgumentParser">
<code class="highlight language-python">
ArgumentParser
    (*
args, **
kwargs)

        </code>
<a class="headerlink" href="#beancount.utils.version.ArgumentParser" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Add a standard --version option to an ArgumentParser.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*args</code></td>
<td><code></code></td>
<td>
<p>Arguments for the parser.</p>
</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>*kwargs</code></td>
<td><code></code></td>
<td>
<p>Keyword arguments for the parser.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of ArgumentParser, with our default options set.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/version.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def ArgumentParser(*args, **kwargs):
    """Add a standard --version option to an ArgumentParser.

    Args:
      *args: Arguments for the parser.
      *kwargs: Keyword arguments for the parser.
    Returns:
      An instance of ArgumentParser, with our default options set.
    """
    parser = argparse.ArgumentParser(*args, **kwargs)

    parser.add_argument('--version', '-V', action='version',
                        version=compute_version_string(
                            beancount.__version__,
                            _parser.__vc_changeset__,
                            _parser.__vc_timestamp__))

    return parser
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.version.compute_version_string">
<code class="highlight language-python">
compute_version_string
(version, changeset, timestamp)

        </code>
<a class="headerlink" href="#beancount.utils.version.compute_version_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute a version string from the changeset and timestamp baked in the parser.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td><code></code></td>
<td>
<p>A string, the version number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>changeset</code></td>
<td><code></code></td>
<td>
<p>A string, a version control string identifying the commit of the version.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><code></code></td>
<td>
<p>An integer, the UNIX epoch timestamp of the changeset.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A human-readable string for the version.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/version.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def compute_version_string(version, changeset, timestamp):
    """Compute a version string from the changeset and timestamp baked in the parser.

    Args:
      version: A string, the version number.
      changeset: A string, a version control string identifying the commit of the version.
      timestamp: An integer, the UNIX epoch timestamp of the changeset.
    Returns:
      A human-readable string for the version.
    """
    # Shorten changeset.
    if changeset:
        if re.match('hg:', changeset):
            changeset = changeset[:15]
        elif re.match('git:', changeset):
            changeset = changeset[:12]

    # Convert timestamp to a date.
    date = None
    if timestamp &gt; 0:
        date = datetime.datetime.utcfromtimestamp(timestamp).date()

    version = 'Beancount {}'.format(version)
    if changeset or date:
        version = '{} ({})'.format(
            version, '; '.join(map(str, filter(None, [changeset, date]))))

    return version
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.web.html" title="beancount.web">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="beancount.scripts.html" title="beancount.scripts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/beancount/docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.scripts.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.web.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="" src="../search/main.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
