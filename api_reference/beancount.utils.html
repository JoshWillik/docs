<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://xuhcc.github.io/beancount-docs/api_reference/beancount.utils.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.utils - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.utils";
    var mkdocs_page_input_path = "api_reference/beancount.utils.md";
    var mkdocs_page_url = "/beancount-docs/api_reference/beancount.utils.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.utils.html">beancount.utils</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils">beancount.utils</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.bisect_key">bisect_key</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_left_with_key">bisect_left_with_key()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.bisect_key.bisect_right_with_key">bisect_right_with_key()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.csv_utils">csv_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.as_rows">as_rows()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_clean_header">csv_clean_header()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_dict_reader">csv_dict_reader()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_split_sections">csv_split_sections()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_split_sections_with_titles">csv_split_sections_with_titles()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.csv_tuple_reader">csv_tuple_reader()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.iter_sections">iter_sections()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils.iter_until_empty">iter_until_empty()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.csv_utils_test">csv_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.csv_utils_test.linearize">linearize()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.date_utils">date_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.intimezone">intimezone()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.iter_dates">iter_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.next_month">next_month()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.parse_date_liberally">parse_date_liberally()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.date_utils.render_ofx_date">render_ofx_date()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.defdict">defdict</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.DefaultDictWithKey">DefaultDictWithKey</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault">ImmutableDictWithDefault</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">__setitem__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.defdict.ImmutableDictWithDefault.get">get()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption">encryption</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_encrypted_file">is_encrypted_file()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.is_gpg_installed">is_gpg_installed()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption.read_encrypted_file">read_encrypted_file()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.encryption_test">encryption_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase">TestEncryptedBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.encryption_test.TestEncryptedBase.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_type">file_type</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_type.guess_file_type">guess_file_type()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils">file_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.chdir">chdir()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.find_files">find_files()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.guess_file_format">guess_file_format()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.path_greedy_split">path_greedy_split()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils.touch_file">touch_file()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.file_utils_test">file_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.file_utils_test.TestFileUtilsFind">TestFileUtilsFind</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.file_utils_test.TestFileUtilsFind.setUp">setUp()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.import_utils">import_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.import_utils.import_symbol">import_symbol()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants">invariants</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.instrument_invariants">instrument_invariants()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.invariant_check">invariant_check()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants.uninstrument_invariants">uninstrument_invariants()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.invariants_test">invariants_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants_test.Dummy">Dummy</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants">TestInvariants</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.invariants_test.TestInvariants.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.memo">memo</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.memoize_recent_fileobj">memoize_recent_fileobj()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.memo.now">now()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils">misc_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy">LineFileProxy</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.close">close()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.flush">flush()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.misc_utils.LineFileProxy.write">write()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.TypeComparable">TypeComparable</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.box">box()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.cmptuple">cmptuple()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.compute_unique_clean_ids">compute_unique_clean_ids()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.deprecated">deprecated()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.dictmap">dictmap()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.escape_string">escape_string()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.filter_type">filter_type()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.first_paragraph">first_paragraph()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_height">get_screen_height()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_screen_width">get_screen_width()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.get_tuple_values">get_tuple_values()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.groupby">groupby()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.idify">idify()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.import_curses">import_curses()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.is_sorted">is_sorted()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.log_time">log_time()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.longest">longest()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.map_namedtuple_attributes">map_namedtuple_attributes()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.replace_namedtuple_values">replace_namedtuple_values()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.skipiter">skipiter()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.sorted_uniquify">sorted_uniquify()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.staticvar">staticvar()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.swallow">swallow()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils.uniquify">uniquify()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.misc_utils_test">misc_utils_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.misc_utils_test.raise_import_error">raise_import_error()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.net_utils">net_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.net_utils.retrying_urlopen">retrying_urlopen()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager">pager</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager">ConditionalPager</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__enter__">__enter__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__exit__">__exit__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.flush_accumulated">flush_accumulated()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.pager.ConditionalPager.write">write()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.create_pager">create_pager()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.pager.flush_only">flush_only()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.pager_test">pager_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.regexp_utils">regexp_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.regexp_utils.re_replace_unicode">re_replace_unicode()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.snoop">snoop</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.Snoop">Snoop</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__getattr__">__getattr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.snoop.Snoop.__init__">__init__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.snoop.snoopify">snoopify()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.test_utils">test_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.RCall">RCall</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.RCall.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.TestCase">TestCase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertLines">assertLines()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.utils.test_utils.TestCase.assertOutput">assertOutput()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.call_command">call_command()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.capture">capture()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.create_temporary_files">create_temporary_files()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile">docfile()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.docfile_extra">docfile_extra()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.environ">environ()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_python_lib">find_python_lib()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.find_repository_root">find_repository_root()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.make_failing_importer">make_failing_importer()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.nottest">nottest()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.patch">patch()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.record">record()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.run_with_args">run_with_args()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.search_words">search_words()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.skipIfRaises">skipIfRaises()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.subprocess_env">subprocess_env()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.test_utils.tempdir">tempdir()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.text_utils">text_utils</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.entitize_ampersand">entitize_ampersand()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.replace_number">replace_number()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.text_utils.replace_numbers">replace_numbers()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.text_utils_test">text_utils_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.utils.version">version</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.version.ArgumentParser">ArgumentParser()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.utils.version.compute_version_string">compute_version_string()</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.utils</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/xuhcc/beancount-docs/edit/master/docs/api_reference/beancount.utils.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountutils">beancount.utils<a class="headerlink" href="#beancountutils" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.utils" id="beancount.utils" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.utils" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Generic utility packages and functions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.bisect_key">
<code>bisect_key</code>
<a class="headerlink" href="#beancount.utils.bisect_key" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A version of bisect that accepts a custom key function, like the sorting ones do.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.bisect_key.bisect_left_with_key">
<code class="highlight language-python">
bisect_left_with_key<span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.bisect_key.bisect_left_with_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find the last element before the given value in a sorted list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sequence</code></td>
<td><code></code></td>
<td>
<p>A sorted sequence of elements.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value to search for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>An optional function used to extract the value from the elements of
sequence.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Return the index. May return None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">bisect_left_with_key</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Find the last element before the given value in a sorted list.</span>

<span class="sd">    Args:</span>
<span class="sd">      sequence: A sorted sequence of elements.</span>
<span class="sd">      value: The value to search for.</span>
<span class="sd">      key: An optional function used to extract the value from the elements of</span>
<span class="sd">        sequence.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Return the index. May return None.</span>
<span class="sd">    """</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>  <span class="c1"># Identity.</span>

    <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
    <span class="k">return</span> <span class="n">lo</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.bisect_key.bisect_right_with_key">
<code class="highlight language-python">
bisect_right_with_key<span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.bisect_key.bisect_right_with_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Like bisect.bisect_right, but with a key lookup parameter.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a</code></td>
<td><code></code></td>
<td>
<p>The list to search in.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>x</code></td>
<td><code></code></td>
<td>
<p>The element to search for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A function, to extract the value from the list.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lo</code></td>
<td><code></code></td>
<td>
<p>The smallest index to search.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>hi</code></td>
<td><code></code></td>
<td>
<p>The largest index to search.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>As in bisect.bisect_right, an element from list 'a'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/bisect_key.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">bisect_right_with_key</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Like bisect.bisect_right, but with a key lookup parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">      a: The list to search in.</span>
<span class="sd">      x: The element to search for.</span>
<span class="sd">      key: A function, to extract the value from the list.</span>
<span class="sd">      lo: The smallest index to search.</span>
<span class="sd">      hi: The largest index to search.</span>
<span class="sd">    Returns:</span>
<span class="sd">      As in bisect.bisect_right, an element from list 'a'.</span>
<span class="sd">    """</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="k">if</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'lo must be non-negative'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span><span class="o">+</span><span class="n">hi</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">key</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">mid</span><span class="p">]):</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">lo</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.csv_utils">
<code>csv_utils</code>
<a class="headerlink" href="#beancount.utils.csv_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Utilities for reading and writing CSV files.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.as_rows">
<code class="highlight language-python">
as_rows<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.as_rows" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Split a string as rows of a CSV file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string to be split, the contents of a CSV file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Lists of lists of strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>15
16
17
18
19
20
21
22
23</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">as_rows</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Split a string as rows of a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string to be split, the contents of a CSV file.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Lists of lists of strings.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_clean_header">
<code class="highlight language-python">
csv_clean_header<span class="p">(</span><span class="n">header_row</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_clean_header" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a new class for the following rows from the header line.
This both normalizes the header line and assign</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>header_row</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the row with header titles.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of strings, with possibly modified (cleaned) row titles, of the
same lengths.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">csv_clean_header</span><span class="p">(</span><span class="n">header_row</span><span class="p">):</span>
    <span class="sd">"""Create a new class for the following rows from the header line.</span>
<span class="sd">    This both normalizes the header line and assign</span>

<span class="sd">    Args:</span>
<span class="sd">      header_row: A list of strings, the row with header titles.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of strings, with possibly modified (cleaned) row titles, of the</span>
<span class="sd">      same lengths.</span>
<span class="sd">    """</span>
    <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_row</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\bp/l\b'</span><span class="p">,</span> <span class="s1">'pnl'</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[^a-z0-9]'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">' _'</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'__+'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="s1">'col</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">,</span> <span class="n">field</span>
        <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fieldnames</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_dict_reader">
<code class="highlight language-python">
csv_dict_reader<span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_dict_reader" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Read a CSV file yielding normalized dictionary fields.</p>
<p>This is basically an alternative constructor for csv.DictReader that
normalized the field names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to be read.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Optional arguments forwarded to csv.DictReader.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A csv.DictReader object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">csv_dict_reader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""Read a CSV file yielding normalized dictionary fields.</span>

<span class="sd">    This is basically an alternative constructor for csv.DictReader that</span>
<span class="sd">    normalized the field names.</span>

<span class="sd">    Args:</span>
<span class="sd">      fileobj: A file object to be read.</span>
<span class="sd">      **kw: Optional arguments forwarded to csv.DictReader.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A csv.DictReader object.</span>
<span class="sd">    """</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span> <span class="o">=</span> <span class="n">csv_clean_header</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reader</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_split_sections">
<code class="highlight language-python">
csv_split_sections<span class="p">(</span><span class="n">rows</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_split_sections" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given rows, split them in at empty lines.
This is useful for structured CSV files with multiple sections.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rows</code></td>
<td><code></code></td>
<td>
<p>A list of rows, which are themselves lists of strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of sections, which are lists of rows, which are lists of strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">csv_split_sections</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="sd">"""Given rows, split them in at empty lines.</span>
<span class="sd">    This is useful for structured CSV files with multiple sections.</span>

<span class="sd">    Args:</span>
<span class="sd">      rows: A list of rows, which are themselves lists of strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of sections, which are lists of rows, which are lists of strings.</span>
<span class="sd">    """</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_section</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">current_section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>
            <span class="n">current_section</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">current_section</span><span class="p">:</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sections</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_split_sections_with_titles">
<code class="highlight language-python">
csv_split_sections_with_titles<span class="p">(</span><span class="n">rows</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_split_sections_with_titles" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a list of rows, split their sections. If the sections have single
column titles, consume those lines as their names and return a mapping of
section names.</p>
<p>This is useful for CSV files with multiple sections, where the separator is
a title. We use this to separate the multiple tables within the CSV files.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rows</code></td>
<td><code></code></td>
<td>
<p>A list of rows (list-of-strings).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of lists of rows (list-of-strings).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">csv_split_sections_with_titles</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="sd">"""Given a list of rows, split their sections. If the sections have single</span>
<span class="sd">    column titles, consume those lines as their names and return a mapping of</span>
<span class="sd">    section names.</span>

<span class="sd">    This is useful for CSV files with multiple sections, where the separator is</span>
<span class="sd">    a title. We use this to separate the multiple tables within the CSV files.</span>

<span class="sd">    Args:</span>
<span class="sd">      rows: A list of rows (list-of-strings).</span>
<span class="sd">    Returns:</span>
<span class="sd">     A list of lists of rows (list-of-strings).</span>

<span class="sd">    """</span>
    <span class="n">sections_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv_split_sections</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
        <span class="c1"># Skip too short sections, cannot possibly be a title.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">'Section </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">sections_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>
    <span class="k">return</span> <span class="n">sections_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.csv_tuple_reader">
<code class="highlight language-python">
csv_tuple_reader<span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.csv_tuple_reader" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Read a CSV file yielding namedtuple instances. The CSV file must have a
header line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to be read.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Optional arguments forwarded to csv.DictReader.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Nametuple instances, one for each row.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">csv_tuple_reader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""Read a CSV file yielding namedtuple instances. The CSV file must have a</span>
<span class="sd">    header line.</span>

<span class="sd">    Args:</span>
<span class="sd">      fileobj: A file object to be read.</span>
<span class="sd">      **kw: Optional arguments forwarded to csv.DictReader.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Nametuple instances, one for each row.</span>
<span class="sd">    """</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">ireader</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
    <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">csv_clean_header</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ireader</span><span class="p">))</span>
    <span class="n">Tuple</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Row'</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ireader</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Tuple</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># If there's an error, it's usually from a line that has a 'END OF</span>
            <span class="c1"># LINE' marker at the end, or some comment line.</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.iter_sections">
<code class="highlight language-python">
iter_sections<span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">separating_predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.iter_sections" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>For a given file object, yield file-like objects for each of the sections
contained therein. A section is defined as a list of lines that don't match
the predicate. For example, if you want to split by empty lines, provide a
predicate that will be true given an empty line, which will cause a new
section to be begun.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object to read from.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>separating_predicate</code></td>
<td><code></code></td>
<td>
<p>A boolean predicate that is true on separating lines.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A list of lines that you can use to iterate.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_sections</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">separating_predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""For a given file object, yield file-like objects for each of the sections</span>
<span class="sd">    contained therein. A section is defined as a list of lines that don't match</span>
<span class="sd">    the predicate. For example, if you want to split by empty lines, provide a</span>
<span class="sd">    predicate that will be true given an empty line, which will cause a new</span>
<span class="sd">    section to be begun.</span>

<span class="sd">    Args:</span>
<span class="sd">      fileobj: A file object to read from.</span>
<span class="sd">      separating_predicate: A boolean predicate that is true on separating lines.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A list of lines that you can use to iterate.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">separating_predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">separating_predicate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">lineiter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lineiter</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">separating_predicate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">iterator</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">((</span><span class="n">line</span><span class="p">,),</span>
                                       <span class="n">iter_until_empty</span><span class="p">(</span><span class="n">lineiter</span><span class="p">,</span>
                                                        <span class="n">separating_predicate</span><span class="p">))</span>
            <span class="k">yield</span> <span class="n">iterator</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
                <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils.iter_until_empty">
<code class="highlight language-python">
iter_until_empty<span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">separating_predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils.iter_until_empty" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An iterator of lines that will stop at the first empty line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterator</code></td>
<td><code></code></td>
<td>
<p>An iterator of lines.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>separating_predicate</code></td>
<td><code></code></td>
<td>
<p>A boolean predicate that is true on separating lines.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Non-empty lines. EOF when we hit an empty line.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_until_empty</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">separating_predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""An iterator of lines that will stop at the first empty line.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterator: An iterator of lines.</span>
<span class="sd">      separating_predicate: A boolean predicate that is true on separating lines.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Non-empty lines. EOF when we hit an empty line.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">separating_predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">separating_predicate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">separating_predicate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="n">line</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.csv_utils_test">
<code>csv_utils_test</code>
<a class="headerlink" href="#beancount.utils.csv_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.csv_utils_test.linearize">
<code class="highlight language-python">
linearize<span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">joiner</span><span class="o">=&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">list</span><span class="s1">'&gt;)</span> </code>
<a class="headerlink" href="#beancount.utils.csv_utils_test.linearize" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Consume a section iterator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterator</code></td>
<td><code></code></td>
<td>
<p>An iterator of iterators.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>joiner</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the sub-iterators.</p>
</td>
<td><code>&lt;class 'list'&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of return values from joiner.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/csv_utils_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>147
148
149
150
151
152
153
154
155
156</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">joiner</span><span class="o">=</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">"""Consume a section iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterator: An iterator of iterators.</span>
<span class="sd">      joiner: A callable to apply to the sub-iterators.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of return values from joiner.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">iterator</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.date_utils">
<code>date_utils</code>
<a class="headerlink" href="#beancount.utils.date_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Parse the date from various formats.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.intimezone">
<code class="highlight language-python">
intimezone<span class="p">(</span><span class="n">tz_value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.date_utils.intimezone" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Temporarily reset the value of TZ.</p>
<p>This is used for testing.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tz_value</code></td>
<td><code>str</code></td>
<td>
<p>The value of TZ to set for the duration of this context.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A contextmanager in the given timezone locale.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">intimezone</span><span class="p">(</span><span class="n">tz_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""Temporarily reset the value of TZ.</span>

<span class="sd">    This is used for testing.</span>

<span class="sd">    Args:</span>
<span class="sd">      tz_value: The value of TZ to set for the duration of this context.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A contextmanager in the given timezone locale.</span>
<span class="sd">    """</span>
    <span class="n">tz_old</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'TZ'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TZ'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tz_value</span>
    <span class="n">time</span><span class="o">.</span><span class="n">tzset</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tz_old</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TZ'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TZ'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tz_old</span>
        <span class="n">time</span><span class="o">.</span><span class="n">tzset</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.iter_dates">
<code class="highlight language-python">
iter_dates<span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.date_utils.iter_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Yield all the dates between 'start_date' and 'end_date'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start_date</code></td>
<td><code></code></td>
<td>
<p>An instance of datetime.date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>end_date</code></td>
<td><code></code></td>
<td>
<p>An instance of datetime.date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of datetime.date.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_dates</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="sd">"""Yield all the dates between 'start_date' and 'end_date'.</span>

<span class="sd">    Args:</span>
<span class="sd">      start_date: An instance of datetime.date.</span>
<span class="sd">      end_date: An instance of datetime.date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    """</span>
    <span class="n">oneday</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">date</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">oneday</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.next_month">
<code class="highlight language-python">
next_month<span class="p">(</span><span class="n">date</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.date_utils.next_month" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the date at the beginning of the following month from the given date.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A datetime.date instance, the first day of the month following 'date'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">next_month</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="sd">"""Compute the date at the beginning of the following month from the given date.</span>

<span class="sd">    Args:</span>
<span class="sd">      date: A datetime.date instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A datetime.date instance, the first day of the month following 'date'.</span>
<span class="sd">    """</span>
    <span class="c1"># Compute the date at the beginning of the following month.</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.parse_date_liberally">
<code class="highlight language-python">
parse_date_liberally<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">parse_kwargs_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.date_utils.parse_date_liberally" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse arbitrary strings to dates.</p>
<p>This function is intended to support liberal inputs, so that we can use it
in accepting user-specified dates on command-line scripts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string to parse.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>parse_kwargs_dict</code></td>
<td><code></code></td>
<td>
<p>Dict of kwargs to pass to dateutil parser.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A datetime.date object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_date_liberally</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">parse_kwargs_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Parse arbitrary strings to dates.</span>

<span class="sd">    This function is intended to support liberal inputs, so that we can use it</span>
<span class="sd">    in accepting user-specified dates on command-line scripts.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string to parse.</span>
<span class="sd">      parse_kwargs_dict: Dict of kwargs to pass to dateutil parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A datetime.date object.</span>
<span class="sd">    """</span>
    <span class="c1"># At the moment, rely on the most excellent dateutil.</span>
    <span class="k">if</span> <span class="n">parse_kwargs_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parse_kwargs_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">parse_kwargs_dict</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.date_utils.render_ofx_date">
<code class="highlight language-python">
render_ofx_date<span class="p">(</span><span class="n">dtime</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.date_utils.render_ofx_date" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render a datetime to the OFX format.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dtime</code></td>
<td><code></code></td>
<td>
<p>A datetime.datetime instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, rendered to milliseconds.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/date_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>48
49
50
51
52
53
54
55
56
57</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">render_ofx_date</span><span class="p">(</span><span class="n">dtime</span><span class="p">):</span>
    <span class="sd">"""Render a datetime to the OFX format.</span>

<span class="sd">    Args:</span>
<span class="sd">      dtime: A datetime.datetime instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, rendered to milliseconds.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">.</span><span class="si">{:03d}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S'</span><span class="p">),</span>
                              <span class="nb">int</span><span class="p">(</span><span class="n">dtime</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.defdict">
<code>defdict</code>
<a class="headerlink" href="#beancount.utils.defdict" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>An instance of collections.defaultdict whose factory accepts a key.</p>
<p>Note: This really ought to be an enhancement to Python itself. I should bother
adding this in eventually.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.defdict.DefaultDictWithKey">
<code>DefaultDictWithKey</code>
<a class="headerlink" href="#beancount.utils.defdict.DefaultDictWithKey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A version of defaultdict whose factory accepts the key as an argument.
    Note: collections.defaultdict would be improved by supporting this directly,
    this is a common occurence.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault">
<code>ImmutableDictWithDefault</code>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An immutable dict which returns a default value for missing keys.</p>
<pre><code>This differs from a defualtdict in that it does not insert a missing default
value when one is materialized (from a missing fetch), and furtheremore, the
set method is make unavailable to prevent mutation beyond construction.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault.__setitem__">
<code class="highlight language-python">
__setitem__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault.__setitem__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Disallow mutating the dict in the usual way.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/defdict.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Disallow mutating the dict in the usual way."""</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.defdict.ImmutableDictWithDefault.get">
<code class="highlight language-python">
get<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.defdict.ImmutableDictWithDefault.get" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the value for key if key is in the dictionary, else default.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/defdict.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.encryption">
<code>encryption</code>
<a class="headerlink" href="#beancount.utils.encryption" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Support for encrypted tests.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.is_encrypted_file">
<code class="highlight language-python">
is_encrypted_file<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.encryption.is_encrypted_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given filename contains an encrypted file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A path string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the file contains an encrypted file.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Return true if the given filename contains an encrypted file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A path string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the file contains an encrypted file.</span>
<span class="sd">    """</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">'.gpg'</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">'.asc'</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">encfile</span><span class="p">:</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">encfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'--BEGIN PGP MESSAGE--'</span><span class="p">,</span> <span class="n">head</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.is_gpg_installed">
<code class="highlight language-python">
is_gpg_installed<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.encryption.is_gpg_installed" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if GPG 1.4.x or 2.x are installed, which is what we use and support.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>11
12
13
14
15
16
17
18
19
20</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_gpg_installed</span><span class="p">():</span>
    <span class="sd">"""Return true if GPG 1.4.x or 2.x are installed, which is what we use and support."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'gpg'</span><span class="p">,</span> <span class="s1">'--version'</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">version_text</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'gpg \(GnuPG\) (1\.4|2)\.'</span><span class="p">,</span> <span class="n">version_text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.encryption.read_encrypted_file">
<code class="highlight language-python">
read_encrypted_file<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.encryption.read_encrypted_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decrypt and read an encrypted file without temporary storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the path to the encrypted file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the contents of the file.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OSError</code></td>
<td>
<p>If we could not properly decrypt the file.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">read_encrypted_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Decrypt and read an encrypted file without temporary storage.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the path to the encrypted file.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the contents of the file.</span>
<span class="sd">    Raises:</span>
<span class="sd">      OSError: If we could not properly decrypt the file.</span>
<span class="sd">    """</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gpg'</span><span class="p">,</span> <span class="s1">'--batch'</span><span class="p">,</span> <span class="s1">'--decrypt'</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span>
                            <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">contents</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">"Could not decrypt file (</span><span class="si">{}</span><span class="s2">): </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span>
                                                               <span class="n">errors</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">contents</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.encryption_test">
<code>encryption_test</code>
<a class="headerlink" href="#beancount.utils.encryption_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase">
<code>TestEncryptedBase</code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'beancount.'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ringdir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">'keyring'</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringdir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringdir</span><span class="p">,</span> <span class="mo">0o700</span><span class="p">)</span>

    <span class="c1"># Import secret and public keys.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_gpg</span><span class="p">(</span><span class="s1">'--import'</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">TEST_PUBLIC_KEY</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_gpg</span><span class="p">(</span><span class="s1">'--import'</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">TEST_SECRET_KEY</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.encryption_test.TestEncryptedBase.tearDown">
<code class="highlight language-python">
tearDown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.encryption_test.TestEncryptedBase.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/encryption_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 99
100
101
102
103</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Ignore those, GPG agent sometimes causes this problem.</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_type">
<code>file_type</code>
<a class="headerlink" href="#beancount.utils.file_type" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code that can guess a MIME type for a filename.</p>
<p>This attempts to identify the mim-type of a file suing</p>
<ol>
<li>The built-in mimetypes library, then</li>
<li>python-magic (if available), and finally</li>
<li>some custom mappers for datatypes used in financial downloads, such as
   Quicken files.</li>
</ol>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_type.guess_file_type">
<code class="highlight language-python">
guess_file_type<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_type.guess_file_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Attempt to guess the type of the input file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to ugess the type for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A suitable mimetype string, or None if we could not guess.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_type.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">guess_file_type</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Attempt to guess the type of the input file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file to ugess the type for.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A suitable mimetype string, or None if we could not guess.</span>
<span class="sd">    """</span>

    <span class="c1"># Try the standard mimetypes association.</span>
    <span class="n">filetype</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filetype</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filetype</span>

    <span class="c1"># Try out some extra types that only we know about.</span>
    <span class="k">for</span> <span class="n">regexp</span><span class="p">,</span> <span class="n">mimetype</span> <span class="ow">in</span> <span class="n">EXTRA_FILE_TYPES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">mimetype</span>

    <span class="c1"># Try out libmagic, if it is installed.</span>
    <span class="k">if</span> <span class="n">magic</span><span class="p">:</span>
        <span class="n">filetype</span> <span class="o">=</span> <span class="n">magic</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filetype</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">filetype</span> <span class="o">=</span> <span class="n">filetype</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filetype</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">"Could not identify the type of file '</span><span class="si">{}</span><span class="s2">'; "</span>
                          <span class="s2">"try installing python-magic"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_utils">
<code>file_utils</code>
<a class="headerlink" href="#beancount.utils.file_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>File utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.chdir">
<code class="highlight language-python">
chdir<span class="p">(</span><span class="n">directory</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils.chdir" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Temporarily chdir to the given directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>directory</code></td>
<td><code></code></td>
<td>
<p>The directory to switch do.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A context manager which restores the cwd after running.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="sd">"""Temporarily chdir to the given directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      directory: The directory to switch do.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A context manager which restores the cwd after running.</span>
<span class="sd">    """</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">cwd</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.find_files">
<code class="highlight language-python">
find_files<span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="n">ignore_dirs</span><span class="o">=</span><span class="p">(</span><span class="s1">'.hg'</span><span class="p">,</span> <span class="s1">'.svn'</span><span class="p">,</span> <span class="s1">'.git'</span><span class="p">),</span> <span class="n">ignore_files</span><span class="o">=</span><span class="p">(</span><span class="s1">'.DS_Store'</span><span class="p">,))</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils.find_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Enumerate the files under the given directories, stably.</p>
<p>Invalid file or directory names will be logged to the error log.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fords</code></td>
<td><code></code></td>
<td>
<p>A list of strings, file or directory names.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>ignore_dirs</code></td>
<td><code></code></td>
<td>
<p>A list of strings, filenames or directories to be ignored.</p>
</td>
<td><code>('.hg', '.svn', '.git')</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Strings, full filenames from the given roots.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span>
               <span class="n">ignore_dirs</span><span class="o">=</span><span class="p">(</span><span class="s1">'.hg'</span><span class="p">,</span> <span class="s1">'.svn'</span><span class="p">,</span> <span class="s1">'.git'</span><span class="p">),</span>
               <span class="n">ignore_files</span><span class="o">=</span><span class="p">(</span><span class="s1">'.DS_Store'</span><span class="p">,)):</span>
    <span class="sd">"""Enumerate the files under the given directories, stably.</span>

<span class="sd">    Invalid file or directory names will be logged to the error log.</span>

<span class="sd">    Args:</span>
<span class="sd">      fords: A list of strings, file or directory names.</span>
<span class="sd">      ignore_dirs: A list of strings, filenames or directories to be ignored.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Strings, full filenames from the given roots.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fords</span> <span class="o">=</span> <span class="p">[</span><span class="n">fords</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fords</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ford</span> <span class="ow">in</span> <span class="n">fords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
                <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dirname</span> <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">dirname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_dirs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ignore_files</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">yield</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ford</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ford</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ford</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"File or directory '</span><span class="si">{}</span><span class="s2">' does not exist."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ford</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.guess_file_format">
<code class="highlight language-python">
guess_file_format<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils.guess_file_format" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Guess the file format from the filename.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file. This can be None.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the extension of the format, without a leading period.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">guess_file_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Guess the file format from the filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file. This can be None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the extension of the format, without a leading period.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.txt'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.text'</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s1">'text'</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.csv'</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s1">'csv'</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.html'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.xhtml'</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s1">'html'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">return</span> <span class="nb">format</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.path_greedy_split">
<code class="highlight language-python">
path_greedy_split<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils.path_greedy_split" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Split a path, returning the longest possible extension.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the filename to split.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of basename, extension (which includes the leading period).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">path_greedy_split</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Split a path, returning the longest possible extension.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the filename to split.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of basename, extension (which includes the leading period).</span>
<span class="sd">    """</span>
    <span class="n">basename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">basename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">basename</span><span class="p">),</span> <span class="n">extension</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.file_utils.touch_file">
<code class="highlight language-python">
touch_file<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">otherfiles</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils.touch_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Touch a file and wait until its timestamp has been changed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string path, the name of the file to touch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>otherfiles</code></td>
<td><code></code></td>
<td>
<p>A list of other files to ensure the timestamp is beyond of.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">touch_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">otherfiles</span><span class="p">):</span>
    <span class="sd">"""Touch a file and wait until its timestamp has been changed.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string path, the name of the file to touch.</span>
<span class="sd">      otherfiles: A list of other files to ensure the timestamp is beyond of.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: You could set os.stat_float_times() but then the main function would</span>
    <span class="c1"># have to set that up as well. It doesn't help so much, however, since</span>
    <span class="c1"># filesystems tend to have low resolutions, e.g. one second.</span>
    <span class="n">orig_mtime_ns</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">minfile</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime_ns</span>
                        <span class="k">for</span> <span class="n">minfile</span> <span class="ow">in</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span> <span class="o">+</span> <span class="n">otherfiles</span><span class="p">)</span>
    <span class="n">delay_secs</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_secs</span><span class="p">)</span>
        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_stat</span><span class="o">.</span><span class="n">st_mtime_ns</span> <span class="o">&gt;</span> <span class="n">orig_mtime_ns</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.file_utils_test">
<code>file_utils_test</code>
<a class="headerlink" href="#beancount.utils.file_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for file utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.file_utils_test.TestFileUtilsFind">
<code>TestFileUtilsFind</code>
<a class="headerlink" href="#beancount.utils.file_utils_test.TestFileUtilsFind" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.file_utils_test.TestFileUtilsFind.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.file_utils_test.TestFileUtilsFind.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/file_utils_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s1">'alice/'</span><span class="p">,</span>
            <span class="s1">'alice/bottle.txt'</span><span class="p">,</span>
            <span class="s1">'rabbit/'</span><span class="p">,</span>
            <span class="s1">'rabbit/suit/'</span><span class="p">,</span>
            <span class="s1">'rabbit/suit/glasses.txt'</span><span class="p">,</span>
            <span class="s1">'caterpillar/'</span><span class="p">,</span>
            <span class="s1">'caterpillar/who-are-you.txt'</span><span class="p">,</span>
            <span class="p">]:</span>
        <span class="n">abs_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'/'</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.import_utils">
<code>import_utils</code>
<a class="headerlink" href="#beancount.utils.import_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Utilities for importing symbols programmatically.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.import_utils.import_symbol">
<code class="highlight language-python">
import_symbol<span class="p">(</span><span class="n">dotted_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.import_utils.import_symbol" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Import a symbol in an arbitrary module.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dotted_name</code></td>
<td><code></code></td>
<td>
<p>A dotted path to a symbol.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The object referenced by the given name.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ImportError</code></td>
<td>
<p>If the module not not be imported.</p>
</td>
</tr>
<tr>
<td><code>AttributeError</code></td>
<td>
<p>If the symbol could not be found in the module.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/import_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">import_symbol</span><span class="p">(</span><span class="n">dotted_name</span><span class="p">):</span>
    <span class="sd">"""Import a symbol in an arbitrary module.</span>

<span class="sd">    Args:</span>
<span class="sd">      dotted_name: A dotted path to a symbol.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The object referenced by the given name.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ImportError: If the module not not be imported.</span>
<span class="sd">      AttributeError: If the symbol could not be found in the module.</span>
<span class="sd">    """</span>
    <span class="n">comps</span> <span class="o">=</span> <span class="n">dotted_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">comps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.invariants">
<code>invariants</code>
<a class="headerlink" href="#beancount.utils.invariants" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Functions to register auxiliary functions on a class' methods to check for invariants.</p>
<p>This is intended to be used in a test, whereby your test will setup a class to
automatically run invariant verification functions before and after each
function call, to ensure some extra sanity checks that wouldn't be used in
non-tests.</p>
<p>Example: Instrument the Inventory class with the check_inventory_invariants()
function.</p>
<p>def setUp(module):
      instrument_invariants(Inventory,
                            check_inventory_invariants,
                            check_inventory_invariants)</p>
<p>def tearDown(module):
      uninstrument_invariants(Inventory)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.instrument_invariants">
<code class="highlight language-python">
instrument_invariants<span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.invariants.instrument_invariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Instrument the class 'klass' with pre/post invariant
checker functions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>klass</code></td>
<td><code></code></td>
<td>
<p>A class object, whose methods to be instrumented.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postfun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">instrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">):</span>
    <span class="sd">"""Instrument the class 'klass' with pre/post invariant</span>
<span class="sd">    checker functions.</span>

<span class="sd">    Args:</span>
<span class="sd">      klass: A class object, whose methods to be instrumented.</span>
<span class="sd">      prefun: A function that checks invariants pre-call.</span>
<span class="sd">      postfun: A function that checks invariants pre-call.</span>
<span class="sd">    """</span>
    <span class="n">instrumented</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">attrname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">instrumented</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span>
                <span class="n">invariant_check</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">))</span>
    <span class="n">klass</span><span class="o">.</span><span class="n">__instrumented</span> <span class="o">=</span> <span class="n">instrumented</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.invariant_check">
<code class="highlight language-python">
invariant_check<span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.invariants.invariant_check" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorate a method with the pre/post invariant checkers.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>method</code></td>
<td><code></code></td>
<td>
<p>An unbound method to instrument.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants pre-call.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postfun</code></td>
<td><code></code></td>
<td>
<p>A function that checks invariants post-call.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An unbound method, decorated.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">invariant_check</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">prefun</span><span class="p">,</span> <span class="n">postfun</span><span class="p">):</span>
    <span class="sd">"""Decorate a method with the pre/post invariant checkers.</span>

<span class="sd">    Args:</span>
<span class="sd">      method: An unbound method to instrument.</span>
<span class="sd">      prefun: A function that checks invariants pre-call.</span>
<span class="sd">      postfun: A function that checks invariants post-call.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An unbound method, decorated.</span>
<span class="sd">    """</span>
    <span class="n">reentrant</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">reentrant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reentrant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prefun</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reentrant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">postfun</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">reentrant</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">new_method</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.invariants.uninstrument_invariants">
<code class="highlight language-python">
uninstrument_invariants<span class="p">(</span><span class="n">klass</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.invariants.uninstrument_invariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Undo the instrumentation for invariants.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>klass</code></td>
<td><code></code></td>
<td>
<p>A class object, whose methods to be uninstrumented.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>70
71
72
73
74
75
76
77
78
79
80</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">uninstrument_invariants</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
    <span class="sd">"""Undo the instrumentation for invariants.</span>

<span class="sd">    Args:</span>
<span class="sd">      klass: A class object, whose methods to be uninstrumented.</span>
<span class="sd">    """</span>
    <span class="n">instrumented</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="s1">'__instrumented'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instrumented</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span> <span class="ow">in</span> <span class="n">instrumented</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">klass</span><span class="o">.</span><span class="n">__instrumented</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.invariants_test">
<code>invariants_test</code>
<a class="headerlink" href="#beancount.utils.invariants_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.invariants_test.Dummy">
<code>Dummy</code>
<a class="headerlink" href="#beancount.utils.invariants_test.Dummy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Just a dummy class as a target to instrument.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants">
<code>TestInvariants</code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>18
19
20</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">incr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'counter'</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">invariants</span><span class="o">.</span><span class="n">instrument_invariants</span><span class="p">(</span><span class="n">Dummy</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">incr</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.invariants_test.TestInvariants.tearDown">
<code class="highlight language-python">
tearDown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.invariants_test.TestInvariants.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/invariants_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>22
23</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">invariants</span><span class="o">.</span><span class="n">uninstrument_invariants</span><span class="p">(</span><span class="n">Dummy</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.memo">
<code>memo</code>
<a class="headerlink" href="#beancount.utils.memo" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Memoization utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.memo.memoize_recent_fileobj">
<code class="highlight language-python">
memoize_recent_fileobj<span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.memo.memoize_recent_fileobj" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Memoize recent calls to the given function which returns a file object.</p>
<p>The results of the cache expire after some time.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A callable object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cache_filename</code></td>
<td><code></code></td>
<td>
<p>A string, the path to the database file to cache to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expiration</code></td>
<td><code></code></td>
<td>
<p>The time during which the results will be kept valid. Use
'None' to never expire the cache (this is the default).</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A memoized version of the function.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/memo.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">memoize_recent_fileobj</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cache_filename</span><span class="p">,</span> <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Memoize recent calls to the given function which returns a file object.</span>

<span class="sd">    The results of the cache expire after some time.</span>

<span class="sd">    Args:</span>
<span class="sd">      function: A callable object.</span>
<span class="sd">      cache_filename: A string, the path to the database file to cache to.</span>
<span class="sd">      expiration: The time during which the results will be kept valid. Use</span>
<span class="sd">        'None' to never expire the cache (this is the default).</span>
<span class="sd">    Returns:</span>
<span class="sd">      A memoized version of the function.</span>
<span class="sd">    """</span>
    <span class="n">urlcache</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">)</span>
    <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># Note: 'shelve' is not thread-safe.</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">memoized</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># Encode the arguments, including a date string in order to invalidate</span>
        <span class="c1"># results over some time.</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>

        <span class="n">hash_</span> <span class="o">=</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">time_now</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="n">time_orig</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">urlcache</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">expiration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time_now</span> <span class="o">-</span> <span class="n">time_orig</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">expiration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">fileobj</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fileobj</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">urlcache</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                    <span class="n">urlcache</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_now</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="k">if</span> <span class="n">contents</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">memoized</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.memo.now">
<code class="highlight language-python">
now<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.memo.now" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Indirection on datetime.datetime.now() for testing.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/memo.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>14
15
16</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">now</span><span class="p">():</span>
    <span class="s2">"Indirection on datetime.datetime.now() for testing."</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.misc_utils">
<code>misc_utils</code>
<a class="headerlink" href="#beancount.utils.misc_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Generic utility packages and functions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy">
<code>LineFileProxy</code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A file object that will delegate writing full lines to another logging function.
    This may be used for writing data to a logging level without having to worry about
    lines.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_writer</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Construct a new line delegator file object proxy.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>line_writer</code></td>
<td><code></code></td>
<td>
<p>A callable function, used to write to the delegated output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefix</code></td>
<td><code></code></td>
<td>
<p>An optional string, the prefix to insert before every line.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>write_newlines</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should output the newline characters.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>545
546
547
548
549
550
551
552
553
554
555
556</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_writer</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Construct a new line delegator file object proxy.</span>

<span class="sd">    Args:</span>
<span class="sd">      line_writer: A callable function, used to write to the delegated output.</span>
<span class="sd">      prefix: An optional string, the prefix to insert before every line.</span>
<span class="sd">      write_newlines: A boolean, true if we should output the newline characters.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">line_writer</span> <span class="o">=</span> <span class="n">line_writer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_newlines</span> <span class="o">=</span> <span class="n">write_newlines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.close">
<code class="highlight language-python">
close<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.close" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Close the line delegator.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>583
584
585</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Close the line delegator."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.flush">
<code class="highlight language-python">
flush<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.flush" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Flush the data to the line writer.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>570
571
572
573
574
575
576
577
578
579
580
581</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Flush the data to the line writer."""</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_newlines</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_writer</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.misc_utils.LineFileProxy.write">
<code class="highlight language-python">
write<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.LineFileProxy.write" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Write some string data to the output.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code></code></td>
<td>
<p>A string, with or without newlines.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>558
559
560
561
562
563
564
565
566
567
568</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">"""Write some string data to the output.</span>

<span class="sd">    Args:</span>
<span class="sd">      data: A string, with or without newlines.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.TypeComparable">
<code>TypeComparable</code>
<a class="headerlink" href="#beancount.utils.misc_utils.TypeComparable" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A base class whose equality comparison includes comparing the
    type of the instance itself.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.box">
<code class="highlight language-python">
box<span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.box" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that prints out a box around a block.
This is useful for printing out stuff from tests in a way that is readable.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the box to use.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>The file object to print to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  None.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""A context manager that prints out a box around a block.</span>
<span class="sd">    This is useful for printing out stuff from tests in a way that is readable.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the name of the box to use.</span>
<span class="sd">      file: The file object to print to.</span>
<span class="sd">    Yields:</span>
<span class="sd">      None.</span>
<span class="sd">    """</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">',--------(</span><span class="si">{}</span><span class="s1">)--------</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s1">'`</span><span class="si">{}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'-'</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">',----------------</span><span class="se">\n</span><span class="s1">'</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="s1">'`----------------</span><span class="se">\n</span><span class="s1">'</span>

    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.cmptuple">
<code class="highlight language-python">
cmptuple<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.cmptuple" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Manufacture a comparable namedtuple class, similar to collections.namedtuple.</p>
<p>A comparable named tuple is a tuple which compares to False if contents are
equal but the data types are different. We define this to supplement
collections.namedtuple because by default a namedtuple disregards the type
and we want to make precise comparisons for tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>The given name of the class.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A string or tuple of strings, with the names of the
attributes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new namedtuple-derived type that compares False with other
tuples with same contents.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cmptuple</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
    <span class="sd">"""Manufacture a comparable namedtuple class, similar to collections.namedtuple.</span>

<span class="sd">    A comparable named tuple is a tuple which compares to False if contents are</span>
<span class="sd">    equal but the data types are different. We define this to supplement</span>
<span class="sd">    collections.namedtuple because by default a namedtuple disregards the type</span>
<span class="sd">    and we want to make precise comparisons for tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: The given name of the class.</span>
<span class="sd">      attributes: A string or tuple of strings, with the names of the</span>
<span class="sd">        attributes.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new namedtuple-derived type that compares False with other</span>
<span class="sd">      tuples with same contents.</span>
<span class="sd">    """</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">attributes</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">TypeComparable</span><span class="p">,</span> <span class="n">base</span><span class="p">,),</span> <span class="p">{})</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.compute_unique_clean_ids">
<code class="highlight language-python">
compute_unique_clean_ids<span class="p">(</span><span class="n">strings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.compute_unique_clean_ids" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of strings, reduce them to corresponding ids without any
funny characters and insure that the list of ids is unique. Yields pairs
of (id, string) for the result.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strings</code></td>
<td><code></code></td>
<td>
<p>A list of strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of (id, string) pairs.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_unique_clean_ids</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="sd">"""Given a sequence of strings, reduce them to corresponding ids without any</span>
<span class="sd">    funny characters and insure that the list of ids is unique. Yields pairs</span>
<span class="sd">    of (id, string) for the result.</span>

<span class="sd">    Args:</span>
<span class="sd">      strings: A list of strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of (id, string) pairs.</span>
<span class="sd">    """</span>
    <span class="n">string_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

    <span class="c1"># Try multiple methods until we get one that has no collisions.</span>
    <span class="k">for</span> <span class="n">regexp</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">'[^A-Za-z0-9.-]'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">),</span>
                                <span class="p">(</span><span class="sa">r</span><span class="s1">'[^A-Za-z0-9_]'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),]:</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">idmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">mre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_set</span><span class="p">:</span>
            <span class="n">id_</span> <span class="o">=</span> <span class="n">mre</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Collision.</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">idmap</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="c1"># Could not find a unique mapping.</span>

    <span class="k">return</span> <span class="n">idmap</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.deprecated">
<code class="highlight language-python">
deprecated<span class="p">(</span><span class="n">message</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.deprecated" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator generator to mark functions as deprecated and log a warning.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>18
19
20
21
22
23
24
25
26
27
28
29</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">deprecated</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="sd">"""A decorator generator to mark functions as deprecated and log a warning."""</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"Call to deprecated function </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                                      <span class="n">message</span><span class="p">),</span>
                          <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                          <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_func</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.dictmap">
<code class="highlight language-python">
dictmap<span class="p">(</span><span class="n">mdict</span><span class="p">,</span> <span class="n">keyfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valfun</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.dictmap" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Map a dictionary's value.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mdict</code></td>
<td><code></code></td>
<td>
<p>A dict.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the keys.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A callable to apply to the values.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>300
301
302
303
304
305
306
307
308
309
310
311
312</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dictmap</span><span class="p">(</span><span class="n">mdict</span><span class="p">,</span> <span class="n">keyfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Map a dictionary's value.</span>

<span class="sd">    Args:</span>
<span class="sd">      mdict: A dict.</span>
<span class="sd">      key: A callable to apply to the keys.</span>
<span class="sd">      value: A callable to apply to the values.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">keyfun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">valfun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">valfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">keyfun</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">valfun</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mdict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.escape_string">
<code class="highlight language-python">
escape_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.escape_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Escape quotes and backslashes in payee and narration.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>Any string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Returns.
  The input string, with offending characters replaced.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>273
274
275
276
277
278
279
280
281
282</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">escape_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Escape quotes and backslashes in payee and narration.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Any string.</span>
<span class="sd">    Returns.</span>
<span class="sd">      The input string, with offending characters replaced.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">)</span>\
                 <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'"'</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'\"'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.filter_type">
<code class="highlight language-python">
filter_type<span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.filter_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter the given list to yield only instances of the given types.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>elist</code></td>
<td><code></code></td>
<td>
<p>A sequence of elements.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>types</code></td>
<td><code></code></td>
<td>
<p>A sequence of types to include in the output list.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Each element, if it is an instance of 'types'.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>115
116
117
118
119
120
121
122
123
124
125
126
127</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter_type</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
    <span class="sd">"""Filter the given list to yield only instances of the given types.</span>

<span class="sd">    Args:</span>
<span class="sd">      elist: A sequence of elements.</span>
<span class="sd">      types: A sequence of types to include in the output list.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Each element, if it is an instance of 'types'.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">element</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.first_paragraph">
<code class="highlight language-python">
first_paragraph<span class="p">(</span><span class="n">docstring</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.first_paragraph" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the first sentence of a docstring.
The sentence has to be delimited by an empty line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docstring</code></td>
<td><code></code></td>
<td>
<p>A doc string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string with just the first sentence on a single line.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>348
349
350
351
352
353
354
355
356
357
358
359
360
361
362</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">first_paragraph</span><span class="p">(</span><span class="n">docstring</span><span class="p">):</span>
    <span class="sd">"""Return the first sentence of a docstring.</span>
<span class="sd">    The sentence has to be delimited by an empty line.</span>

<span class="sd">    Args:</span>
<span class="sd">      docstring: A doc string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string with just the first sentence on a single line.</span>
<span class="sd">    """</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">docstring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">return</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_screen_height">
<code class="highlight language-python">
get_screen_height<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_screen_height" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the height of the terminal that runs this program.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An integer, the number of characters the screen is high.
Return 0 if the terminal cannot be initialized.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>408
409
410
411
412
413
414
415</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_screen_height</span><span class="p">():</span>
    <span class="sd">"""Return the height of the terminal that runs this program.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An integer, the number of characters the screen is high.</span>
<span class="sd">      Return 0 if the terminal cannot be initialized.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">_get_screen_value</span><span class="p">(</span><span class="s1">'lines'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_screen_width">
<code class="highlight language-python">
get_screen_width<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_screen_width" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the width of the terminal that runs this program.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An integer, the number of characters the screen is wide.
Return 0 if the terminal cannot be initialized.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>398
399
400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_screen_width</span><span class="p">():</span>
    <span class="sd">"""Return the width of the terminal that runs this program.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An integer, the number of characters the screen is wide.</span>
<span class="sd">      Return 0 if the terminal cannot be initialized.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">_get_screen_value</span><span class="p">(</span><span class="s1">'cols'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.get_tuple_values">
<code class="highlight language-python">
get_tuple_values<span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.get_tuple_values" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return all members referred to by this namedtuple instance that satisfy the
given predicate. This function also works recursively on its members which
are lists or typles, and so it can be used for Transaction instances.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ntuple</code></td>
<td><code></code></td>
<td>
<p>A tuple or namedtuple.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td><code></code></td>
<td>
<p>A predicate function that returns true if an attribute is to be
output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>memo</code></td>
<td><code></code></td>
<td>
<p>An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_tuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return all members referred to by this namedtuple instance that satisfy the</span>
<span class="sd">    given predicate. This function also works recursively on its members which</span>
<span class="sd">    are lists or typles, and so it can be used for Transaction instances.</span>

<span class="sd">    Args:</span>
<span class="sd">      ntuple: A tuple or namedtuple.</span>
<span class="sd">      predicate: A predicate function that returns true if an attribute is to be</span>
<span class="sd">        output.</span>
<span class="sd">      memo: An optional memoizing dictionary. If a tuple has already been seen, the</span>
<span class="sd">        recursion will be avoided.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Attributes of the tuple and its sub-elements if the predicate is true.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">id_ntuple</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">id_ntuple</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">memo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_ntuple</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">ntuple</span><span class="p">):</span>
        <span class="k">yield</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">ntuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">attribute</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">get_tuple_values</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.groupby">
<code class="highlight language-python">
groupby<span class="p">(</span><span class="n">keyfun</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.groupby" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Group the elements as a dict of lists, where the key is computed using the
function 'keyfun'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keyfun</code></td>
<td><code></code></td>
<td>
<p>A callable, used to obtain the group key from each element.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>elements</code></td>
<td><code></code></td>
<td>
<p>An iterable of the elements to group.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of key to list of sequences.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="n">keyfun</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
    <span class="sd">"""Group the elements as a dict of lists, where the key is computed using the</span>
<span class="sd">    function 'keyfun'.</span>

<span class="sd">    Args:</span>
<span class="sd">      keyfun: A callable, used to obtain the group key from each element.</span>
<span class="sd">      elements: An iterable of the elements to group.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of key to list of sequences.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We could allow a custom aggregation function. Another option is</span>
    <span class="c1"># provide another method to reduce the list values of a dict, but that can</span>
    <span class="c1"># be accomplished using a dict comprehension.</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">grouped</span><span class="p">[</span><span class="n">keyfun</span><span class="p">(</span><span class="n">element</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grouped</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.idify">
<code class="highlight language-python">
idify<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.idify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace characters objectionable for a filename with underscores.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>Any string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The input string, with offending characters replaced.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>285
286
287
288
289
290
291
292
293
294
295
296
297</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">idify</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Replace characters objectionable for a filename with underscores.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Any string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The input string, with offending characters replaced.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">sfrom</span><span class="p">,</span> <span class="n">sto</span> <span class="ow">in</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">'[ \(\)]+'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">),</span>
                      <span class="p">(</span><span class="sa">r</span><span class="s1">'_*\._*'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">)]:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">sfrom</span><span class="p">,</span> <span class="n">sto</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'_'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.import_curses">
<code class="highlight language-python">
import_curses<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.import_curses" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Try to import the 'curses' module.
(This is used here in order to override for tests.)</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The curses module, if it was possible to import it.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ImportError</code></td>
<td>
<p>If the module could not be imported.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">import_curses</span><span class="p">():</span>
    <span class="sd">"""Try to import the 'curses' module.</span>
<span class="sd">    (This is used here in order to override for tests.)</span>

<span class="sd">    Returns:</span>
<span class="sd">      The curses module, if it was possible to import it.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ImportError: If the module could not be imported.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: There's a recipe for getting terminal size on Windows here, without</span>
    <span class="c1"># curses, I should probably implement that at some point:</span>
    <span class="c1"># https://stackoverflow.com/questions/263890/how-do-i-find-the-width-height-of-a-terminal-window</span>
    <span class="c1"># Also, consider just using 'blessings' instead, which provides this across</span>
    <span class="c1"># multiple platforms.</span>
    <span class="kn">import</span> <span class="nn">curses</span>
    <span class="k">return</span> <span class="n">curses</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.is_sorted">
<code class="highlight language-python">
is_sorted<span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=&lt;</span><span class="n">function</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x7ff9349b48b0</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x7ff9349b4940</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.is_sorted" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the sequence is sorted.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A function to extract the quantity by which to sort.</p>
</td>
<td><code>&lt;function &lt;lambda&gt; at 0x7ff9349b48b0&gt;</code></td>
</tr>
<tr>
<td><code>cmp</code></td>
<td><code></code></td>
<td>
<p>A function that compares two elements of a sequence.</p>
</td>
<td><code>&lt;function &lt;lambda&gt; at 0x7ff9349b4940&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the sequence is sorted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">"""Return true if the sequence is sorted.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      key: A function to extract the quantity by which to sort.</span>
<span class="sd">      cmp: A function that compares two elements of a sequence.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the sequence is sorted.</span>
<span class="sd">    """</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">element</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.log_time">
<code class="highlight language-python">
log_time<span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.log_time" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that times the block and logs it to info level.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operation_name</code></td>
<td><code></code></td>
<td>
<p>A string, a label for the name of the operation.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>log_timings</code></td>
<td><code></code></td>
<td>
<p>A function to write log messages to. If left to None,
no timings are written (this becomes a no-op).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>indent</code></td>
<td><code></code></td>
<td>
<p>An integer, the indentation level for the format of the timing
line. This is useful if you're logging timing to a hierarchy of
operations.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  The start time of the operation.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">log_timings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""A context manager that times the block and logs it to info level.</span>

<span class="sd">    Args:</span>
<span class="sd">      operation_name: A string, a label for the name of the operation.</span>
<span class="sd">      log_timings: A function to write log messages to. If left to None,</span>
<span class="sd">        no timings are written (this becomes a no-op).</span>
<span class="sd">      indent: An integer, the indentation level for the format of the timing</span>
<span class="sd">        line. This is useful if you're logging timing to a hierarchy of</span>
<span class="sd">        operations.</span>
<span class="sd">    Yields:</span>
<span class="sd">      The start time of the operation.</span>
<span class="sd">    """</span>
    <span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">time1</span>
    <span class="n">time2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">log_timings</span><span class="p">:</span>
        <span class="n">log_timings</span><span class="p">(</span><span class="s2">"Operation: </span><span class="si">{:48}</span><span class="s2"> Time: </span><span class="si">{}{:6.0f}</span><span class="s2"> ms"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">"'</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operation_name</span><span class="p">),</span> <span class="s1">'      '</span><span class="o">*</span><span class="n">indent</span><span class="p">,</span> <span class="p">(</span><span class="n">time2</span> <span class="o">-</span> <span class="n">time1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.longest">
<code class="highlight language-python">
longest<span class="p">(</span><span class="n">seq</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.longest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the longest of the given subsequences.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>seq</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence of lists.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The longest list from the sequence.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">longest</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="sd">"""Return the longest of the given subsequences.</span>

<span class="sd">    Args:</span>
<span class="sd">      seq: An iterable sequence of lists.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The longest list from the sequence.</span>
<span class="sd">    """</span>
    <span class="n">longest</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="n">len_element</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_element</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">longest</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">element</span><span class="p">,</span> <span class="n">len_element</span>
    <span class="k">return</span> <span class="n">longest</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.map_namedtuple_attributes">
<code class="highlight language-python">
map_namedtuple_attributes<span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.map_namedtuple_attributes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Map the value of the named attributes of object by mapper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A sequence of string, the attribute names to map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mapper</code></td>
<td><code></code></td>
<td>
<p>A callable that accepts the value of a field and returns
the new value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>object_</code></td>
<td><code></code></td>
<td>
<p>Some namedtuple object with attributes on it.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of the same namedtuple with the named fields mapped by
mapper.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>315
316
317
318
319
320
321
322
323
324
325
326
327
328</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">map_namedtuple_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
    <span class="sd">"""Map the value of the named attributes of object by mapper.</span>

<span class="sd">    Args:</span>
<span class="sd">      attributes: A sequence of string, the attribute names to map.</span>
<span class="sd">      mapper: A callable that accepts the value of a field and returns</span>
<span class="sd">        the new value.</span>
<span class="sd">      object_: Some namedtuple object with attributes on it.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of the same namedtuple with the named fields mapped by</span>
<span class="sd">      mapper.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">object_</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">attribute</span><span class="p">:</span> <span class="n">mapper</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
                               <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">})</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.replace_namedtuple_values">
<code class="highlight language-python">
replace_namedtuple_values<span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.replace_namedtuple_values" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Recurse through all the members of namedtuples and lists, and for
members that match the given predicate, run them through the given mapper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ntuple</code></td>
<td><code></code></td>
<td>
<p>A namedtuple instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td><code></code></td>
<td>
<p>A predicate function that returns true if an attribute is to be
output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mapper</code></td>
<td><code></code></td>
<td>
<p>A callable, that will accept a single argument and return its
replacement value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>memo</code></td>
<td><code></code></td>
<td>
<p>An optional memoizing dictionary. If a tuple has already been seen, the
recursion will be avoided.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Attributes of the tuple and its sub-elements if the predicate is true.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">replace_namedtuple_values</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Recurse through all the members of namedtuples and lists, and for</span>
<span class="sd">    members that match the given predicate, run them through the given mapper.</span>

<span class="sd">    Args:</span>
<span class="sd">      ntuple: A namedtuple instance.</span>
<span class="sd">      predicate: A predicate function that returns true if an attribute is to be</span>
<span class="sd">        output.</span>
<span class="sd">      mapper: A callable, that will accept a single argument and return its</span>
<span class="sd">        replacement value.</span>
<span class="sd">      memo: An optional memoizing dictionary. If a tuple has already been seen, the</span>
<span class="sd">        recursion will be avoided.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Attributes of the tuple and its sub-elements if the predicate is true.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">id_ntuple</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">id_ntuple</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">memo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_ntuple</span><span class="p">)</span>

    <span class="c1"># pylint: disable=unidiomatic-typecheck</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ntuple</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ntuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">ntuple</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">ntuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_namedtuple_values</span><span class="p">(</span>
                <span class="n">attribute</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">replacements</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">replace_namedtuple_values</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">attribute</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ntuple</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="n">replacements</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.skipiter">
<code class="highlight language-python">
skipiter<span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">num_skip</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.skipiter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Skip some elements from an iterator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>num_skip</code></td>
<td><code></code></td>
<td>
<p>The number of elements in the period.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elemnets from the iterable, with num_skip elements skipped.
  For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">skipiter</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">num_skip</span><span class="p">):</span>
    <span class="sd">"""Skip some elements from an iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterator.</span>
<span class="sd">      num_skip: The number of elements in the period.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elemnets from the iterable, with num_skip elements skipped.</span>
<span class="sd">      For example, skipiter(range(10), 3) yields [0, 3, 6, 9].</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">num_skip</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">sit</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">sit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">yield</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_skip</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">sit</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">return</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.sorted_uniquify">
<code class="highlight language-python">
sorted_uniquify<span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.sorted_uniquify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of elements, sort and remove duplicates of the given key.
Keep either the first or the last (by key) element of a sequence of
key-identical elements. This does <em>not</em> maintain the ordering of the
original elements, they are returned sorted (by key) instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>keyfunc</code></td>
<td><code></code></td>
<td>
<p>A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>last</code></td>
<td><code></code></td>
<td>
<p>A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elements from the iterable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sorted_uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Given a sequence of elements, sort and remove duplicates of the given key.</span>
<span class="sd">    Keep either the first or the last (by key) element of a sequence of</span>
<span class="sd">    key-identical elements. This does _not_ maintain the ordering of the</span>
<span class="sd">    original elements, they are returned sorted (by key) instead.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      keyfunc: A function that extracts from the elements the sort key</span>
<span class="sd">        to use and uniquify on. If left unspecified, the identify function</span>
<span class="sd">        is used and the uniquification occurs on the elements themselves.</span>
<span class="sd">      last: A boolean, True if we should keep the last item of the same keys.</span>
<span class="sd">        Otherwise keep the first.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elements from the iterable.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">keyfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
        <span class="n">prev_obj</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="n">prev_key</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">prev_key</span> <span class="ow">and</span> <span class="n">prev_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">prev_obj</span>
            <span class="n">prev_obj</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">prev_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">prev_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">prev_obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prev_key</span> <span class="o">=</span> <span class="n">UNSET</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">prev_key</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">obj</span>
                <span class="n">prev_key</span> <span class="o">=</span> <span class="n">key</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.staticvar">
<code class="highlight language-python">
staticvar<span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.staticvar" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Returns a decorator that defines a Python function attribute.</p>
<p>This is used to simulate a static function variable in Python.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>varname</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the variable to define.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>initial_value</code></td>
<td><code></code></td>
<td>
<p>The value to initialize the variable to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A function decorator.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">staticvar</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">):</span>
    <span class="sd">"""Returns a decorator that defines a Python function attribute.</span>

<span class="sd">    This is used to simulate a static function variable in Python.</span>

<span class="sd">    Args:</span>
<span class="sd">      varname: A string, the name of the variable to define.</span>
<span class="sd">      initial_value: The value to initialize the variable to.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A function decorator.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fun</span>
    <span class="k">return</span> <span class="n">deco</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.swallow">
<code class="highlight language-python">
swallow<span class="p">(</span><span class="o">*</span><span class="n">exception_types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.swallow" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Catch and ignore certain exceptions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exception_types</code></td>
<td><code></code></td>
<td>
<p>A tuple of exception classes to ignore.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  None.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">swallow</span><span class="p">(</span><span class="o">*</span><span class="n">exception_types</span><span class="p">):</span>
    <span class="sd">"""Catch and ignore certain exceptions.</span>

<span class="sd">    Args:</span>
<span class="sd">      exception_types: A tuple of exception classes to ignore.</span>
<span class="sd">    Yields:</span>
<span class="sd">      None.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">exception_types</span><span class="p">):</span>
            <span class="k">raise</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils.uniquify">
<code class="highlight language-python">
uniquify<span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils.uniquify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a sequence of elements, remove duplicates of the given key. Keep either
the first or the last element of a sequence of key-identical elements. Order
is maintained as much as possible. This does maintain the ordering of the
original elements, they are returned in the same order as the original
elements.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>An iterable sequence.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>keyfunc</code></td>
<td><code></code></td>
<td>
<p>A function that extracts from the elements the sort key
to use and uniquify on. If left unspecified, the identify function
is used and the uniquification occurs on the elements themselves.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>last</code></td>
<td><code></code></td>
<td>
<p>A boolean, True if we should keep the last item of the same keys.
Otherwise keep the first.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Elements from the iterable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">uniquify</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">keyfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Given a sequence of elements, remove duplicates of the given key. Keep either</span>
<span class="sd">    the first or the last element of a sequence of key-identical elements. Order</span>
<span class="sd">    is maintained as much as possible. This does maintain the ordering of the</span>
<span class="sd">    original elements, they are returned in the same order as the original</span>
<span class="sd">    elements.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: An iterable sequence.</span>
<span class="sd">      keyfunc: A function that extracts from the elements the sort key</span>
<span class="sd">        to use and uniquify on. If left unspecified, the identify function</span>
<span class="sd">        is used and the uniquification occurs on the elements themselves.</span>
<span class="sd">      last: A boolean, True if we should keep the last item of the same keys.</span>
<span class="sd">        Otherwise keep the first.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Elements from the iterable.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">keyfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
        <span class="n">unique_reversed_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">unique_reversed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">unique_reversed_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keyfunc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">obj</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.misc_utils_test">
<code>misc_utils_test</code>
<a class="headerlink" href="#beancount.utils.misc_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for general utils.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.misc_utils_test.raise_import_error">
<code class="highlight language-python">
raise_import_error<span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.misc_utils_test.raise_import_error" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Raises an ImportError. This is patched in a test.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/misc_utils_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>19
20
21
22
23
24
25</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">raise_import_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""Raises an ImportError. This is patched in a test.</span>

<span class="sd">    Raises:</span>
<span class="sd">      ImportError, unconditionally.</span>
<span class="sd">    """</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">"Could not import module"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.net_utils">
<code>net_utils</code>
<a class="headerlink" href="#beancount.utils.net_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Network utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.net_utils.retrying_urlopen">
<code class="highlight language-python">
retrying_urlopen<span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_retry</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.net_utils.retrying_urlopen" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Open and download the given URL, retrying if it times out.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td><code></code></td>
<td>
<p>A string, the URL to fetch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>timeout</code></td>
<td><code></code></td>
<td>
<p>A timeout after which to stop waiting for a response and return an
error.</p>
</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>max_retry</code></td>
<td><code></code></td>
<td>
<p>The maximum number of times to retry.</p>
</td>
<td><code>5</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The contents of the fetched URL.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/net_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">retrying_urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_retry</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">"""Open and download the given URL, retrying if it times out.</span>

<span class="sd">    Args:</span>
<span class="sd">      url: A string, the URL to fetch.</span>
<span class="sd">      timeout: A timeout after which to stop waiting for a response and return an</span>
<span class="sd">        error.</span>
<span class="sd">      max_retry: The maximum number of times to retry.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The contents of the fetched URL.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retry</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Reading </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">getcode</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.pager">
<code>pager</code>
<a class="headerlink" href="#beancount.utils.pager" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code to write output to a pager.</p>
<p>This module contains an object accumulates lines up to a minimum and then
decides whether to flush them to the original output directly if under the
threshold (no pager) or creates a pager and flushes the lines to it if above the
threshold and then forwards all future lines to it. The purpose of this object
is to pipe output to a pager only if the number of lines to be printed exceeds a
minimum number of lines.</p>
<p>The contextmanager is intended to be used to pipe output to a pager and wait on
the pager to complete before continuing. Simply write to the file object and
upon exit we close the file object. This also silences broken pipe errors
triggered by the user exiting the sub-process, and recovers from a failing pager
command by just using stdout.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager">
<code>ConditionalPager</code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A proxy file for a pager that only creates a pager after a minimum number of
    lines has been printed to it.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__enter__">
<code class="highlight language-python">
__enter__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__enter__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize the context manager and return this instance as it.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Initialize the context manager and return this instance as it."""</span>

    <span class="c1"># The file and pipe object we're writing to. This gets set after the</span>
    <span class="c1"># number of accumulated lines reaches the threshold.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="n">create_pager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>

    <span class="c1"># Lines accumulated before the threshold.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Return this object to be used as the context manager itself.</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__exit__">
<code class="highlight language-python">
__exit__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unused_traceback</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__exit__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Context manager exit. This flushes the output to our output file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td><code></code></td>
<td>
<p>Optional exception type, as per context managers.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>Optional exception value, as per context managers.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unused_traceback</code></td>
<td><code></code></td>
<td>
<p>Optional trace.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unused_traceback</span><span class="p">):</span>
    <span class="sd">"""Context manager exit. This flushes the output to our output file.</span>

<span class="sd">    Args:</span>
<span class="sd">      type: Optional exception type, as per context managers.</span>
<span class="sd">      value: Optional exception value, as per context managers.</span>
<span class="sd">      unused_traceback: Optional trace.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="c1"># Flush the output file and close it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Oops... we never reached the threshold. Flush the accumulated</span>
            <span class="c1"># output to the file.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>

        <span class="c1"># Wait for the subprocess (if we have one).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="c1"># Absorb broken pipes that may occur on flush or close above.</span>
    <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Absorb broken pipes.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="ne">BrokenPipeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">minlines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a conditional pager.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code></code></td>
<td>
<p>A string, the shell command to run as a pager.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>minlines</code></td>
<td><code></code></td>
<td>
<p>If set, the number of lines under which you should not bother starting
a pager. This avoids kicking off a pager if the screen is high enough to
render the contents. If the value is unset, always starts a pager (which is
fine behavior too).</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">minlines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a conditional pager.</span>

<span class="sd">    Args:</span>
<span class="sd">      command: A string, the shell command to run as a pager.</span>
<span class="sd">      minlines: If set, the number of lines under which you should not bother starting</span>
<span class="sd">        a pager. This avoids kicking off a pager if the screen is high enough to</span>
<span class="sd">        render the contents. If the value is unset, always starts a pager (which is</span>
<span class="sd">        fine behavior too).</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span> <span class="o">=</span> <span class="n">minlines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
                         <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">'buffer'</span><span class="p">)</span> <span class="k">else</span>
                         <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.flush_accumulated">
<code class="highlight language-python">
flush_accumulated<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.flush_accumulated" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Flush the existing lines to the newly created pager.
This also disabled the accumulator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object to flush the accumulated data to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="sd">"""Flush the existing lines to the newly created pager.</span>
<span class="sd">    This also disabled the accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A file object to flush the accumulated data to.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="p">:</span>
        <span class="n">write</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.pager.ConditionalPager.write">
<code class="highlight language-python">
write<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.pager.ConditionalPager.write" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Write the data out. Overridden from the file object interface.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code></code></td>
<td>
<p>A string, data to write to the output.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">"""Write the data out. Overridden from the file object interface.</span>

<span class="sd">    Args:</span>
<span class="sd">      data: A string, data to write to the output.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Accumulate the new lines.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># If we've reached the threshold, create a file.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulated_lines</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span> <span class="o">=</span> <span class="n">create_pager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_accumulated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We've already created a pager subprocess... flush the lines to it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.pager.create_pager">
<code class="highlight language-python">
create_pager<span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.pager.create_pager" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Try to create and return a pager subprocess.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code></code></td>
<td>
<p>A string, the shell command to run as a pager.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>The file object for the pager write to. This is also used as a
default if we failed to create the pager subprocess.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (file, pipe), a file object and an optional subprocess.Popen instance
to wait on. The pipe instance may be set to None if we failed to create a subprocess.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_pager</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="sd">"""Try to create and return a pager subprocess.</span>

<span class="sd">    Args:</span>
<span class="sd">      command: A string, the shell command to run as a pager.</span>
<span class="sd">      file: The file object for the pager write to. This is also used as a</span>
<span class="sd">        default if we failed to create the pager subprocess.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (file, pipe), a file object and an optional subprocess.Popen instance</span>
<span class="sd">      to wait on. The pipe instance may be set to None if we failed to create a subprocess.</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'PAGER'</span><span class="p">,</span> <span class="n">DEFAULT_PAGER</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">DEFAULT_PAGER</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># In case of using 'less', make sure the charset is set properly. In theory</span>
    <span class="c1"># you could override this by setting PAGER to "LESSCHARSET=utf-8 less" but</span>
    <span class="c1"># this shouldn't affect other programs and is unlikely to cause problems, so</span>
    <span class="c1"># we set it here to make default behavior work for most people (we always</span>
    <span class="c1"># write UTF-8).</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">'LESSCHARSET'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"utf-8"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                                <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Invalid pager: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stdin_wrapper</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">stdin_wrapper</span>
    <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">pipe</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.pager.flush_only">
<code class="highlight language-python">
flush_only<span class="p">(</span><span class="n">fileobj</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.pager.flush_only" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A contextmanager around a file object that does not close the file.</p>
<p>This is used to return a context manager on a file object but not close it.
We flush it instead. This is useful in order to provide an alternative to a
pager class as above.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fileobj</code></td>
<td><code></code></td>
<td>
<p>A file object, to remain open after running the context manager.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  A context manager that yields this object.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/pager.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">flush_only</span><span class="p">(</span><span class="n">fileobj</span><span class="p">):</span>
    <span class="sd">"""A contextmanager around a file object that does not close the file.</span>

<span class="sd">    This is used to return a context manager on a file object but not close it.</span>
<span class="sd">    We flush it instead. This is useful in order to provide an alternative to a</span>
<span class="sd">    pager class as above.</span>

<span class="sd">    Args:</span>
<span class="sd">      fileobj: A file object, to remain open after running the context manager.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A context manager that yields this object.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">fileobj</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">fileobj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.pager_test">
<code>pager_test</code>
<a class="headerlink" href="#beancount.utils.pager_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for pager code.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.regexp_utils">
<code>regexp_utils</code>
<a class="headerlink" href="#beancount.utils.regexp_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Regular expression helpers.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.regexp_utils.re_replace_unicode">
<code class="highlight language-python">
re_replace_unicode<span class="p">(</span><span class="n">regexp</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.regexp_utils.re_replace_unicode" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Substitute Unicode Properties in regular expressions with their
corresponding expanded ranges.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>regexp</code></td>
<td><code></code></td>
<td>
<p>A regular expression string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Return the regular expression with Unicode Properties substituted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/regexp_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>851
852
853
854
855
856
857
858
859
860
861
862</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">re_replace_unicode</span><span class="p">(</span><span class="n">regexp</span><span class="p">):</span>
    <span class="sd">"""Substitute Unicode Properties in regular expressions with their</span>
<span class="sd">    corresponding expanded ranges.</span>

<span class="sd">    Args:</span>
<span class="sd">      regexp: A regular expression string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Return the regular expression with Unicode Properties substituted.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">rangestr</span> <span class="ow">in</span> <span class="n">UNICODE_RANGES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">regexp</span> <span class="o">=</span> <span class="n">regexp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\p{'</span> <span class="o">+</span> <span class="n">category</span> <span class="o">+</span> <span class="s1">'}'</span><span class="p">,</span> <span class="n">rangestr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regexp</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.snoop">
<code>snoop</code>
<a class="headerlink" href="#beancount.utils.snoop" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Text manipulation utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.snoop.Snoop">
<code>Snoop</code>
<a class="headerlink" href="#beancount.utils.snoop.Snoop" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A snooper callable that just saves the returned values of a
    function. This is particularly useful for re.match and re.search in
    conditionals, e.g.::</p>
<pre><code>  snoop = Snoop()
  ...
  if snoop(re.match(r"(\d+)-(\d+)-(\d+)", text)):
    year, month, date = snoop.value.group(1, 2, 3)

Attributes:
  value: The last value snooped from a function call.
  history: If 'maxlen' was specified, the last few values
    that were snooped.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__call__">
<code class="highlight language-python">
__call__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Save a value to the snooper. This is meant to wrap
a function call.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value to push/save.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Value itself.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Save a value to the snooper. This is meant to wrap</span>
<span class="sd">    a function call.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: The value to push/save.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Value itself.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__getattr__">
<code class="highlight language-python">
__getattr__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__getattr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Forward the attribute to the value.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attr</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the attribute.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The value of the attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>53
54
55
56
57
58
59
60
61</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="sd">"""Forward the attribute to the value.</span>

<span class="sd">    Args:</span>
<span class="sd">      attr: A string, the name of the attribute.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The value of the attribute.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.snoop.Snoop.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.snoop.Snoop.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new snooper.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>maxlen</code></td>
<td><code></code></td>
<td>
<p>If specified, an integer, which enables the saving of that</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31
32
33
34
35
36
37</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a new snooper.</span>

<span class="sd">    Args:</span>
<span class="sd">      maxlen: If specified, an integer, which enables the saving of that</span>
<span class="sd">      number of last values in the history attribute.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">maxlen</span>
                    <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.snoop.snoopify">
<code class="highlight language-python">
snoopify<span class="p">(</span><span class="n">function</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.snoop.snoopify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorate a function as snoopable.</p>
<p>This is meant to reassign existing functions to a snoopable version of them.
For example, if you wanted 're.match' to be automatically snoopable, just
decorate it like this:</p>
<p>re.match = snoopify(re.match)</p>
<p>and then you can just call 're.match' in a conditional and then access
're.match.value' to get to the last returned value.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/snoop.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">snoopify</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="sd">"""Decorate a function as snoopable.</span>

<span class="sd">    This is meant to reassign existing functions to a snoopable version of them.</span>
<span class="sd">    For example, if you wanted 're.match' to be automatically snoopable, just</span>
<span class="sd">    decorate it like this:</span>

<span class="sd">      re.match = snoopify(re.match)</span>

<span class="sd">    and then you can just call 're.match' in a conditional and then access</span>
<span class="sd">    're.match.value' to get to the last returned value.</span>
<span class="sd">    """</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.test_utils">
<code>test_utils</code>
<a class="headerlink" href="#beancount.utils.test_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Support utillities for testing scripts.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.RCall">
<code>RCall</code>
<a class="headerlink" href="#beancount.utils.test_utils.RCall" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>RCall(args, kwargs, return_value)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">return_value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of RCall(args, kwargs, return_value)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.RCall.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.utils.test_utils.RCall.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.TestCase">
<code>TestCase</code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.TestCase.assertLines">
<code class="highlight language-python">
assertLines<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase.assertLines" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Compare the lines of text1 and text2, ignoring whitespace.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text1</code></td>
<td><code></code></td>
<td>
<p>A string, the expected text.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>text2</code></td>
<td><code></code></td>
<td>
<p>A string, the actual text.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>message</code></td>
<td><code></code></td>
<td>
<p>An optional string message in case the assertion fails.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the exception fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Compare the lines of text1 and text2, ignoring whitespace.</span>

<span class="sd">    Args:</span>
<span class="sd">      text1: A string, the expected text.</span>
<span class="sd">      text2: A string, the actual text.</span>
<span class="sd">      message: An optional string message in case the assertion fails.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>
<span class="sd">    """</span>
    <span class="n">clean_text1</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text1</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">clean_text2</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text2</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">clean_text1</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">clean_text2</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>

    <span class="c1"># Compress all space longer than 4 spaces to exactly 4.</span>
    <span class="c1"># This affords us to be even looser.</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'    [ </span><span class="se">\t</span><span class="s1">]*'</span><span class="p">,</span> <span class="s1">'    '</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines1</span><span class="p">]</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'    [ </span><span class="se">\t</span><span class="s1">]*'</span><span class="p">,</span> <span class="s1">'    '</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.utils.test_utils.TestCase.assertOutput">
<code class="highlight language-python">
assertOutput<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_text</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.TestCase.assertOutput" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Expect text printed to stdout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expected_text</code></td>
<td><code></code></td>
<td>
<p>A string, the text that should have been printed to stdout.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the text differs.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>299
300
301
302
303
304
305
306
307
308
309
310</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">assertOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_text</span><span class="p">):</span>
    <span class="sd">"""Expect text printed to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected_text: A string, the text that should have been printed to stdout.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the text differs.</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">capture</span><span class="p">()</span> <span class="k">as</span> <span class="n">oss</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">oss</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertLines</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">expected_text</span><span class="p">),</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.call_command">
<code class="highlight language-python">
call_command<span class="p">(</span><span class="n">command</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.call_command" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run the script with a subprocess.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>script_args</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the arguments to the subprocess,
including the script name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triplet of (return code integer, stdout ext, stderr text).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">call_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">"""Run the script with a subprocess.</span>

<span class="sd">    Args:</span>
<span class="sd">      script_args: A list of strings, the arguments to the subprocess,</span>
<span class="sd">        including the script name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triplet of (return code integer, stdout ext, stderr text).</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">command</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span>
                         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.capture">
<code class="highlight language-python">
capture<span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.capture" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that captures what's printed to stdout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*attributes</code></td>
<td><code></code></td>
<td>
<p>A tuple of strings, the name of the sys attributes to override
with StringIO instances.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A StringIO string accumulator.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">):</span>
    <span class="sd">"""A context manager that captures what's printed to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">      *attributes: A tuple of strings, the name of the sys attributes to override</span>
<span class="sd">        with StringIO instances.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A StringIO string accumulator.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="s1">'stdout'</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">patch</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.create_temporary_files">
<code class="highlight language-python">
create_temporary_files<span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">contents_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.create_temporary_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a number of temporary files under 'root'.</p>
<p>This routine is used to initialize the contents of multiple files under a
temporary directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the directory under which to create the files.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>contents_map</code></td>
<td><code></code></td>
<td>
<p>A dict of relative filenames to their contents. The content
strings will be automatically dedented for convenience. In addition, the
string 'ROOT' in the contents will be automatically replaced by the root
directory name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_temporary_files</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">contents_map</span><span class="p">):</span>
    <span class="sd">"""Create a number of temporary files under 'root'.</span>

<span class="sd">    This routine is used to initialize the contents of multiple files under a</span>
<span class="sd">    temporary directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      root: A string, the name of the directory under which to create the files.</span>
<span class="sd">      contents_map: A dict of relative filenames to their contents. The content</span>
<span class="sd">        strings will be automatically dedented for convenience. In addition, the</span>
<span class="sd">        string 'ROOT' in the contents will be automatically replaced by the root</span>
<span class="sd">        directory name.</span>
<span class="sd">    """</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">relative_filename</span><span class="p">,</span> <span class="n">contents</span> <span class="ow">in</span> <span class="n">contents_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">relative_filename</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">relative_filename</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">clean_contents</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="si">{root}</span><span class="s1">'</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">clean_contents</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.docfile">
<code class="highlight language-python">
docfile<span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.docfile" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator that write the function's docstring to a temporary file
and calls the decorated function with the temporary filename.  This is
useful for writing tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A function to decorate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The decorated function.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">docfile</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""A decorator that write the function's docstring to a temporary file</span>
<span class="sd">    and calls the decorated function with the temporary filename.  This is</span>
<span class="sd">    useful for writing tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      function: A function to decorate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The decorated function.</span>
<span class="sd">    """</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'buffering'</span><span class="p">,</span> <span class="s1">'encoding'</span><span class="p">,</span> <span class="s1">'newline'</span><span class="p">,</span> <span class="s1">'dir'</span><span class="p">,</span> <span class="s1">'prefix'</span><span class="p">,</span> <span class="s1">'suffix'</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid kwarg to docfile_extra"</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">'w'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">new_function</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">new_function</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.docfile_extra">
<code class="highlight language-python">
docfile_extra<span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.docfile_extra" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator identical to @docfile,
but it also takes kwargs for the temporaryfile,
Kwargs:
  e.g. buffering, encoding, newline, dir, prefix, and suffix.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>docfile</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>236
237
238
239
240
241
242
243
244
245</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">docfile_extra</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A decorator identical to @docfile,</span>
<span class="sd">    but it also takes kwargs for the temporaryfile,</span>
<span class="sd">    Kwargs:</span>
<span class="sd">      e.g. buffering, encoding, newline, dir, prefix, and suffix.</span>
<span class="sd">    Returns:</span>
<span class="sd">      docfile</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">docfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.environ">
<code class="highlight language-python">
environ<span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.environ" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager which pushes varname's value and restores it later.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>varname</code></td>
<td><code></code></td>
<td>
<p>A string, the environ variable name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>newvalue</code></td>
<td><code></code></td>
<td>
<p>A string, the desired value.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>350
351
352
353
354
355
356
357
358
359
360
361
362</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">environ</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
    <span class="sd">"""A context manager which pushes varname's value and restores it later.</span>

<span class="sd">    Args:</span>
<span class="sd">      varname: A string, the environ variable name.</span>
<span class="sd">      newvalue: A string, the desired value.</span>
<span class="sd">    """</span>
    <span class="n">oldvalue</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvalue</span>
    <span class="k">yield</span>
    <span class="k">if</span> <span class="n">oldvalue</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldvalue</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.find_python_lib">
<code class="highlight language-python">
find_python_lib<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.find_python_lib" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the path to the root of the Python libraries.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>55
56
57
58
59
60
61</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_python_lib</span><span class="p">():</span>
    <span class="sd">"""Return the path to the root of the Python libraries.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.find_repository_root">
<code class="highlight language-python">
find_repository_root<span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.find_repository_root" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the path to the repository root.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of a file within the repository.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_repository_root</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the path to the repository root.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of a file within the repository.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="vm">__file__</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sigfile</span><span class="p">))</span>
                  <span class="k">for</span> <span class="n">sigfile</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'PKG-INFO'</span><span class="p">,</span> <span class="s1">'COPYING'</span><span class="p">,</span> <span class="s1">'README'</span><span class="p">)):</span>
        <span class="n">prev_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev_filename</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Failed to find the root directory."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.make_failing_importer">
<code class="highlight language-python">
make_failing_importer<span class="p">(</span><span class="o">*</span><span class="n">removed_module_names</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.make_failing_importer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Make an importer that raise an ImportError for some modules.</p>
<p>Use it like this:</p>
<p>@mock.patch('builtins.<strong>import</strong>', make_failing_importer('setuptools'))
  def test_...</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>removed_module_name</code></td>
<td><code></code></td>
<td>
<p>The name of the module import that should raise an exception.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A decorated test decorator.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">make_failing_importer</span><span class="p">(</span><span class="o">*</span><span class="n">removed_module_names</span><span class="p">):</span>
    <span class="sd">"""Make an importer that raise an ImportError for some modules.</span>

<span class="sd">    Use it like this:</span>

<span class="sd">      @mock.patch('builtins.__import__', make_failing_importer('setuptools'))</span>
<span class="sd">      def test_...</span>

<span class="sd">    Args:</span>
<span class="sd">      removed_module_name: The name of the module import that should raise an exception.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorated test decorator.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">failing_import</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">removed_module_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">"Could not import </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">failing_import</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.nottest">
<code class="highlight language-python">
nottest<span class="p">(</span><span class="n">func</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.nottest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Make the given function not testable.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>30
31
32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">nottest</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="s2">"Make the given function not testable."</span>
    <span class="n">func</span><span class="o">.</span><span class="n">__test__</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">func</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.patch">
<code class="highlight language-python">
patch<span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">replacement_type</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.patch" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that temporarily patches an object's attributes.</p>
<p>All attributes in 'attributes' are saved and replaced by new instances
of type 'replacement_type'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td><code></code></td>
<td>
<p>The object to patch up.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>attributes</code></td>
<td><code></code></td>
<td>
<p>A string or a sequence of strings, the names of attributes to replace.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>replacement_type</code></td>
<td><code></code></td>
<td>
<p>A callable to build replacment objects.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  An instance of a list of sequencs of 'replacement_type'.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">replacement_type</span><span class="p">):</span>
    <span class="sd">"""A context manager that temporarily patches an object's attributes.</span>

<span class="sd">    All attributes in 'attributes' are saved and replaced by new instances</span>
<span class="sd">    of type 'replacement_type'.</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: The object to patch up.</span>
<span class="sd">      attributes: A string or a sequence of strings, the names of attributes to replace.</span>
<span class="sd">      replacement_type: A callable to build replacment objects.</span>
<span class="sd">    Yields:</span>
<span class="sd">      An instance of a list of sequencs of 'replacement_type'.</span>
<span class="sd">    """</span>
    <span class="n">single</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">attributes</span><span class="p">]</span>

    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">replacement</span> <span class="o">=</span> <span class="n">replacement_type</span><span class="p">()</span>
        <span class="n">replacements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
        <span class="n">saved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">replacements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">replacements</span>

    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">saved_attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">saved</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">saved_attr</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.record">
<code class="highlight language-python">
record<span class="p">(</span><span class="n">fun</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.record" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorates the function to intercept and record all calls and return values.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fun</code></td>
<td><code></code></td>
<td>
<p>A callable to be decorated.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A wrapper function with a .calls attribute, a list of RCall instances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>371
372
373
374
375
376
377
378
379
380
381
382
383
384
385</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="sd">"""Decorates the function to intercept and record all calls and return values.</span>

<span class="sd">    Args:</span>
<span class="sd">      fun: A callable to be decorated.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A wrapper function with a .calls attribute, a list of RCall instances.</span>
<span class="sd">    """</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">wrapped</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RCall</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">return_value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">return_value</span>
    <span class="n">wrapped</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.run_with_args">
<code class="highlight language-python">
run_with_args<span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.run_with_args" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run the given function with sys.argv set to argv. The first argument is
automatically inferred to be where the function object was defined. sys.argv
is restored after the function is called.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td><code></code></td>
<td>
<p>A function object to call with no arguments.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>argv</code></td>
<td><code></code></td>
<td>
<p>A list of arguments, excluding the script name, to be temporarily
set on sys.argv.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The return value of the function run.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_with_args</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Run the given function with sys.argv set to argv. The first argument is</span>
<span class="sd">    automatically inferred to be where the function object was defined. sys.argv</span>
<span class="sd">    is restored after the function is called.</span>

<span class="sd">    Args:</span>
<span class="sd">      function: A function object to call with no arguments.</span>
<span class="sd">      argv: A list of arguments, excluding the script name, to be temporarily</span>
<span class="sd">        set on sys.argv.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The return value of the function run.</span>
<span class="sd">    """</span>
    <span class="n">saved_argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="n">saved_handlers</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">function</span><span class="o">.</span><span class="vm">__module__</span><span class="p">]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">module</span><span class="o">.</span><span class="vm">__file__</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">saved_argv</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="n">saved_handlers</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.search_words">
<code class="highlight language-python">
search_words<span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.search_words" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Search for a sequence of words in a line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>words</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the words to look for, or a space-separated string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>line</code></td>
<td><code></code></td>
<td>
<p>A string, the line to search into.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A MatchObject, or None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>248
249
250
251
252
253
254
255
256
257
258
259</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">search_words</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">"""Search for a sequence of words in a line.</span>

<span class="sd">    Args:</span>
<span class="sd">      words: A list of strings, the words to look for, or a space-separated string.</span>
<span class="sd">      line: A string, the line to search into.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A MatchObject, or None.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'.*'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\b</span><span class="si">{}</span><span class="s1">\b'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.skipIfRaises">
<code class="highlight language-python">
skipIfRaises<span class="p">(</span><span class="o">*</span><span class="n">exc_types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.skipIfRaises" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager (or decorator) that skips a test if an exception is raised.</p>
<p>Yields:
  Nothing, for you to execute the function code.</p>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SkipTest</code></td>
<td>
<p>if the test raised the expected exception.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>313
314
315
316
317
318
319
320
321
322
323
324
325
326
327</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">skipIfRaises</span><span class="p">(</span><span class="o">*</span><span class="n">exc_types</span><span class="p">):</span>
    <span class="sd">"""A context manager (or decorator) that skips a test if an exception is raised.</span>

<span class="sd">    Args:</span>
<span class="sd">      exc_type</span>
<span class="sd">    Yields:</span>
<span class="sd">      Nothing, for you to execute the function code.</span>
<span class="sd">    Raises:</span>
<span class="sd">      SkipTest: if the test raised the expected exception.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="n">exc_types</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">unittest</span><span class="o">.</span><span class="n">SkipTest</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.subprocess_env">
<code class="highlight language-python">
subprocess_env<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.subprocess_env" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a dict to use as environment for running subprocesses.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the root directory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">subprocess_env</span><span class="p">():</span>
    <span class="sd">"""Return a dict to use as environment for running subprocesses.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the root directory.</span>
<span class="sd">    """</span>
    <span class="c1"># Ensure we have locations to invoke our Python executable and our</span>
    <span class="c1"># runnable binaries in the test environment to run subprocesses.</span>
    <span class="n">binpath</span> <span class="o">=</span> <span class="s1">':'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">),</span>
        <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">find_repository_root</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">'bin'</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'PATH'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">':'</span><span class="p">)])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">'PATH'</span><span class="p">:</span> <span class="n">binpath</span><span class="p">,</span>
            <span class="s1">'PYTHONPATH'</span><span class="p">:</span> <span class="n">find_python_lib</span><span class="p">()}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.test_utils.tempdir">
<code class="highlight language-python">
tempdir<span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.test_utils.tempdir" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A context manager that creates a temporary directory and deletes its
contents unconditionally once done.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>delete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we want to delete the directory after running.</p>
</td>
<td><code>True</code></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>Keyword arguments for mkdtemp.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  A string, the name of the temporary directory created.</p>
<details class="quote">
<summary>Source code in <code>beancount/utils/test_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">tempdir</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""A context manager that creates a temporary directory and deletes its</span>
<span class="sd">    contents unconditionally once done.</span>

<span class="sd">    Args:</span>
<span class="sd">      delete: A boolean, true if we want to delete the directory after running.</span>
<span class="sd">      **kw: Keyword arguments for mkdtemp.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A string, the name of the temporary directory created.</span>
<span class="sd">    """</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"beancount-test-tmpdir."</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">tempdir</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.text_utils">
<code>text_utils</code>
<a class="headerlink" href="#beancount.utils.text_utils" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Text manipulation utilities.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.entitize_ampersand">
<code class="highlight language-python">
entitize_ampersand<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.text_utils.entitize_ampersand" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert unescaped ampersand characters (&amp;) to XML entities.</p>
<p>This is used to fix code that has been programmed by bad developers who
didn't think about escaping the entities in their strings.
file does not contain</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to convert.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A self-destructing NamedTemporaryFile object that has been flushed and
which you may read to obtain the fixed contents.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">entitize_ampersand</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Convert unescaped ampersand characters (&amp;) to XML entities.</span>

<span class="sd">    This is used to fix code that has been programmed by bad developers who</span>
<span class="sd">    didn't think about escaping the entities in their strings.</span>
<span class="sd">    file does not contain</span>
<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file to convert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A self-destructing NamedTemporaryFile object that has been flushed and</span>
<span class="sd">      which you may read to obtain the fixed contents.</span>
<span class="sd">    """</span>
    <span class="n">tidy_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">'.xls'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">new_contents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'&amp;([^;&amp;]</span><span class="si">{12}</span><span class="s1">)'</span><span class="p">,</span> <span class="s1">'&amp;</span><span class="se">\\</span><span class="s1">1'</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
    <span class="n">tidy_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_contents</span><span class="p">)</span>
    <span class="n">tidy_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tidy_file</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.replace_number">
<code class="highlight language-python">
replace_number<span class="p">(</span><span class="n">match</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.text_utils.replace_number" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace a single number matched from text into X'es.
'match' is a MatchObject from a regular expressions match.
(Use this with re.sub()).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match</code></td>
<td><code></code></td>
<td>
<p>A MatchObject.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A replacement string, consisting only of X'es.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>10
11
12
13
14
15
16
17
18
19
20</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">replace_number</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
    <span class="sd">"""Replace a single number matched from text into X'es.</span>
<span class="sd">    'match' is a MatchObject from a regular expressions match.</span>
<span class="sd">    (Use this with re.sub()).</span>

<span class="sd">    Args:</span>
<span class="sd">      match: A MatchObject.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A replacement string, consisting only of X'es.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[0-9]'</span><span class="p">,</span> <span class="s1">'X'</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.text_utils.replace_numbers">
<code class="highlight language-python">
replace_numbers<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.text_utils.replace_numbers" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace all numbers found within text.</p>
<p>Note that this is a heuristic used to filter out private numbers from web
pages in incognito mode and thus may not be perfect. It should let through
numbers which are part of URLs.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text</code></td>
<td><code></code></td>
<td>
<p>An input string object.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, with relevant numbers hopefully replaced with X'es.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/text_utils.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">replace_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Replace all numbers found within text.</span>

<span class="sd">    Note that this is a heuristic used to filter out private numbers from web</span>
<span class="sd">    pages in incognito mode and thus may not be perfect. It should let through</span>
<span class="sd">    numbers which are part of URLs.</span>

<span class="sd">    Args:</span>
<span class="sd">      text: An input string object.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, with relevant numbers hopefully replaced with X'es.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\b([0-9,]+(?:\.[0-9]*)?)\b([ \t&lt;]+[^0-9,.]|$)'</span><span class="p">,</span> <span class="n">replace_number</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.text_utils_test">
<code>text_utils_test</code>
<a class="headerlink" href="#beancount.utils.text_utils_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for text_utils.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.utils.version">
<code>version</code>
<a class="headerlink" href="#beancount.utils.version" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Implement common options across all programs.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.version.ArgumentParser">
<code class="highlight language-python">
ArgumentParser<span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.version.ArgumentParser" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Add a standard --version option to an ArgumentParser.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*args</code></td>
<td><code></code></td>
<td>
<p>Arguments for the parser.</p>
</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>*kwargs</code></td>
<td><code></code></td>
<td>
<p>Keyword arguments for the parser.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of ArgumentParser, with our default options set.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/version.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">ArgumentParser</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""Add a standard --version option to an ArgumentParser.</span>

<span class="sd">    Args:</span>
<span class="sd">      *args: Arguments for the parser.</span>
<span class="sd">      *kwargs: Keyword arguments for the parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of ArgumentParser, with our default options set.</span>
<span class="sd">    """</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--version'</span><span class="p">,</span> <span class="s1">'-V'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'version'</span><span class="p">,</span>
                        <span class="n">version</span><span class="o">=</span><span class="n">compute_version_string</span><span class="p">(</span>
                            <span class="n">beancount</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                            <span class="n">_parser</span><span class="o">.</span><span class="n">__vc_changeset__</span><span class="p">,</span>
                            <span class="n">_parser</span><span class="o">.</span><span class="n">__vc_timestamp__</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">parser</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.utils.version.compute_version_string">
<code class="highlight language-python">
compute_version_string<span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">changeset</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.utils.version.compute_version_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute a version string from the changeset and timestamp baked in the parser.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td><code></code></td>
<td>
<p>A string, the version number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>changeset</code></td>
<td><code></code></td>
<td>
<p>A string, a version control string identifying the commit of the version.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><code></code></td>
<td>
<p>An integer, the UNIX epoch timestamp of the changeset.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A human-readable string for the version.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/utils/version.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_version_string</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">changeset</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
    <span class="sd">"""Compute a version string from the changeset and timestamp baked in the parser.</span>

<span class="sd">    Args:</span>
<span class="sd">      version: A string, the version number.</span>
<span class="sd">      changeset: A string, a version control string identifying the commit of the version.</span>
<span class="sd">      timestamp: An integer, the UNIX epoch timestamp of the changeset.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A human-readable string for the version.</span>
<span class="sd">    """</span>
    <span class="c1"># Shorten changeset.</span>
    <span class="k">if</span> <span class="n">changeset</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'hg:'</span><span class="p">,</span> <span class="n">changeset</span><span class="p">):</span>
            <span class="n">changeset</span> <span class="o">=</span> <span class="n">changeset</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'git:'</span><span class="p">,</span> <span class="n">changeset</span><span class="p">):</span>
            <span class="n">changeset</span> <span class="o">=</span> <span class="n">changeset</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>

    <span class="c1"># Convert timestamp to a date.</span>
    <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="n">version</span> <span class="o">=</span> <span class="s1">'Beancount </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">changeset</span> <span class="ow">or</span> <span class="n">date</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">version</span><span class="p">,</span> <span class="s1">'; '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">changeset</span><span class="p">,</span> <span class="n">date</span><span class="p">]))))</span>

    <span class="k">return</span> <span class="n">version</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral" href="beancount.scripts.html" title="beancount.scripts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/xuhcc/beancount-docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.scripts.html" style="color: #fcfcfc;">« Previous</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
