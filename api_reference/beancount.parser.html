<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://xuhcc.github.io/beancount-docs/api_reference/beancount.parser.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.parser - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.parser";
    var mkdocs_page_input_path = "api_reference/beancount.parser.md";
    var mkdocs_page_url = "/beancount-docs/api_reference/beancount.parser.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.parser.html">beancount.parser</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser">beancount.parser</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking">booking</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.BookingError">BookingError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking.BookingError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.book">book()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.validate_inventory_booking">validate_inventory_booking()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking.validate_missing_eliminated">validate_missing_eliminated()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_full">booking_full</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError">CategorizationError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.CategorizationError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError">InterpolationError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.InterpolationError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.MissingType">MissingType</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError">ReductionError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.ReductionError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.Refer">Refer</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.Refer.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError">SelfReduxError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_full.SelfReduxError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.book">book()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.book_reductions">book_reductions()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.categorize_by_currency">categorize_by_currency()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.compute_cost_number">compute_cost_number()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.convert_costspec_to_cost">convert_costspec_to_cost()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.get_bucket_currency">get_bucket_currency()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.has_self_reduction">has_self_reduction()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.interpolate_group">interpolate_group()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.replace_currencies">replace_currencies()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full.unique_label">unique_label()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_full_test">booking_full_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.TestBookAugmentations">TestBookAugmentations</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.TestCategorizeCurrencyGroup">TestCategorizeCurrencyGroup</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.TestInterpolateCurrencyGroup">TestInterpolateCurrencyGroup</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.TestReplaceCurrenciesInGroup">TestReplaceCurrenciesInGroup</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.book_test">book_test()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.find_first_with_tag">find_first_with_tag()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.indexes">indexes()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_full_test.normalize_postings">normalize_postings()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_method">booking_method</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError">AmbiguousMatchError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_method.AmbiguousMatchError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_AVERAGE">booking_method_AVERAGE()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_FIFO">booking_method_FIFO()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_LIFO">booking_method_LIFO()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_NONE">booking_method_NONE()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.booking_method_STRICT">booking_method_STRICT()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_method.handle_ambiguous_matches">handle_ambiguous_matches()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_method_test">booking_method_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.booking_test">booking_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_test.BookingTestError">BookingTestError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_test.BookingTestError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_test.BookingTestError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_test.BookingTestError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_test.TestBookingValidation">TestBookingValidation</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.booking_test.TestBookingValidation.setUp">setUp()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_test.convert_lot_specs_to_lots">convert_lot_specs_to_lots()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.booking_test.convert_spec_to_cost">convert_spec_to_cost()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.cmptest">cmptest</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.TestError">TestError</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.assertEqualEntries">assertEqualEntries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.assertExcludesEntries">assertExcludesEntries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.assertIncludesEntries">assertIncludesEntries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest.read_string_or_entries">read_string_or_entries()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.cmptest_test">cmptest_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.cmptest_test.TestTestCase">TestTestCase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.cmptest_test.TestTestCase.setUp">setUp()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.grammar">grammar</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.Builder">Builder</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.amount">amount()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.balance">balance()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.build_grammar_error">build_grammar_error()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.close">close()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.commodity">commodity()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.compound_amount">compound_amount()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.cost_merge">cost_merge()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.cost_spec">cost_spec()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.custom">custom()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.custom_value">custom_value()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.dcupdate">dcupdate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.document">document()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.event">event()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.finalize">finalize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.finalize_tags_links">finalize_tags_links()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_entries">get_entries()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_invalid_account">get_invalid_account()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_long_string_maxlines">get_long_string_maxlines()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.get_options">get_options()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.handle_list">handle_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.include">include()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.key_value">key_value()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.note">note()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.open">open()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.option">option()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pad">pad()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pipe_deprecated_error">pipe_deprecated_error()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.plugin">plugin()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.popmeta">popmeta()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.poptag">poptag()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.posting">posting()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.price">price()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pushmeta">pushmeta()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.pushtag">pushtag()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.query">query()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.store_result">store_result()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_LINK">tag_link_LINK()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_new">tag_link_new()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_STRING">tag_link_STRING()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.tag_link_TAG">tag_link_TAG()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.transaction">transaction()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.Builder.unpack_txn_strings">unpack_txn_strings()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount">CompoundAmount</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.CompoundAmount.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError">DeprecatedError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.DeprecatedError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.KeyValue">KeyValue</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.KeyValue.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ParserError">ParserError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError">ParserSyntaxError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ParserSyntaxError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks">TagsLinks</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.TagsLinks.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.ValueType">ValueType</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar.ValueType.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar.valid_account_regexp">valid_account_regexp()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.grammar_test">grammar_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestLexerAndParserErrors">TestLexerAndParserErrors</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestLineNumbers">TestLineNumbers</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestMetaData">TestMetaData</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.grammar_test.TestMetaData.strip_meta">strip_meta()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestParserComplete">TestParserComplete</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestParserEntryTypes">TestParserEntryTypes</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestSyntaxErrors">TestSyntaxErrors</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.TestUglyBugs">TestUglyBugs</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.check_list">check_list()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.grammar_test.raise_exception">raise_exception()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.hashsrc">hashsrc</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.hashsrc.check_parser_source_files">check_parser_source_files()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.hashsrc.hash_parser_source_files">hash_parser_source_files()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.lexer">lexer</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder">LexBuilder</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.ACCOUNT">ACCOUNT()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.build_lexer_error">build_lexer_error()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.CURRENCY">CURRENCY()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.DATE">DATE()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.get_invalid_account">get_invalid_account()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.KEY">KEY()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.LINK">LINK()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.NUMBER">NUMBER()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.STRING">STRING()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexBuilder.TAG">TAG()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.LexerError">LexerError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.lexer.LexerError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.lex_iter">lex_iter()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer.lex_iter_string">lex_iter_string()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.lexer_test">lexer_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer_test.TestLexer">TestLexer</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer_test.TestLexerErrors">TestLexerErrors</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer_test.lex_tokens">lex_tokens()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.lexer_test.print_tokens">print_tokens()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.options">options</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.OptDesc">OptDesc</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptDesc.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.OptGroup">OptGroup</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.options.OptGroup.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_account_types">get_account_types()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_current_accounts">get_current_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.get_previous_accounts">get_previous_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.list_options">list_options()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.Opt">Opt()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_booking_method">options_validate_booking_method()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_boolean">options_validate_boolean()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_plugin">options_validate_plugin()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_processing_mode">options_validate_processing_mode()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_tolerance">options_validate_tolerance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.options.options_validate_tolerance_map">options_validate_tolerance_map()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.options_test">options_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.parser">parser</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.is_entry_incomplete">is_entry_incomplete()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.is_posting_incomplete">is_posting_incomplete()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_doc">parse_doc()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_file">parse_file()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_many">parse_many()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_one">parse_one()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser.parse_string">parse_string()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.parser_test">parser_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.parser_test.TestParserInputs">TestParserInputs</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.printer">printer</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter">EntryPrinter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.render_posting_strings">render_posting_strings()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.parser.printer.EntryPrinter.write_metadata">write_metadata()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.align_position_strings">align_position_strings()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.format_entry">format_entry()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.format_error">format_error()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_entries">print_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_entry">print_entry()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_error">print_error()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.print_errors">print_errors()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer.render_source">render_source()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.parser.printer_test">printer_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.parser.printer_test.characterize_spaces">characterize_spaces()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.parser</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/xuhcc/beancount-docs/edit/master/docs/api_reference/beancount.parser.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountparser">beancount.parser<a class="headerlink" href="#beancountparser" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.parser" id="beancount.parser" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.parser" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Parser module for beancount input files.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking">
<code>booking</code>
<a class="headerlink" href="#beancount.parser.booking" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Algorithms for 'booking' inventory, that is, the process of finding a
matching lot when reducing the content of an inventory.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking.BookingError">
<code>BookingError</code>
<a class="headerlink" href="#beancount.parser.booking.BookingError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>BookingError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking.BookingError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking.BookingError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking.BookingError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking.BookingError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of BookingError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking.BookingError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking.BookingError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking.book">
<code class="highlight language-python">
book<span class="p">(</span><span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking.book" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Book inventory lots and complete all positions with incomplete numbers.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>incomplete_entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives, with some postings possibly left
with incomplete amounts as produced by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>An options dict as produced by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A pair of
  entries</code></td>
<td>
<p>A list of completed entries with all their postings completed.
  errors: New errors produced during interpolation.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">book</span><span class="p">(</span><span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
    <span class="sd">"""Book inventory lots and complete all positions with incomplete numbers.</span>

<span class="sd">    Args:</span>
<span class="sd">      incomplete_entries: A list of directives, with some postings possibly left</span>
<span class="sd">        with incomplete amounts as produced by the parser.</span>
<span class="sd">      options_map: An options dict as produced by the parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of</span>
<span class="sd">        entries: A list of completed entries with all their postings completed.</span>
<span class="sd">        errors: New errors produced during interpolation.</span>
<span class="sd">    """</span>
    <span class="c1"># Get the list of booking methods for each account.</span>
    <span class="n">booking_methods</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">"booking_method"</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">incomplete_entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">booking</span><span class="p">:</span>
            <span class="n">booking_methods</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">booking</span>

    <span class="c1"># Do the booking here!</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">booking_errors</span> <span class="o">=</span> <span class="n">booking_full</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">incomplete_entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span>
                                                <span class="n">booking_methods</span><span class="p">)</span>

    <span class="c1"># Check for MISSING elements remaining.</span>
    <span class="n">missing_errors</span> <span class="o">=</span> <span class="n">validate_missing_eliminated</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="p">(</span><span class="n">booking_errors</span> <span class="o">+</span> <span class="n">missing_errors</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking.validate_inventory_booking">
<code class="highlight language-python">
validate_inventory_booking<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">booking_methods</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking.validate_inventory_booking" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate that no position at cost is allowed to go negative.</p>
<p>This routine checks that when a posting reduces a position, existing or not,
that the subsequent inventory does not result in a position with a negative
number of units. A negative number of units would only be required for short
trades of trading spreads on futures, and right now this is not supported.
It would not be difficult to support this, however, but we want to be strict
about it, because being pedantic about this is otherwise a great way to
detect user data entry mistakes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unused_options_map</code></td>
<td><code></code></td>
<td>
<p>An options map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>booking_methods</code></td>
<td><code></code></td>
<td>
<p>A mapping of account name to booking method, accumulated
in the main loop.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of errors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">validate_inventory_booking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">,</span> <span class="n">booking_methods</span><span class="p">):</span>
    <span class="sd">"""Validate that no position at cost is allowed to go negative.</span>

<span class="sd">    This routine checks that when a posting reduces a position, existing or not,</span>
<span class="sd">    that the subsequent inventory does not result in a position with a negative</span>
<span class="sd">    number of units. A negative number of units would only be required for short</span>
<span class="sd">    trades of trading spreads on futures, and right now this is not supported.</span>
<span class="sd">    It would not be difficult to support this, however, but we want to be strict</span>
<span class="sd">    about it, because being pedantic about this is otherwise a great way to</span>
<span class="sd">    detect user data entry mistakes.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">      booking_methods: A mapping of account name to booking method, accumulated</span>
<span class="sd">        in the main loop.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of errors.</span>

<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="c1"># Update the balance of each posting on its respective account</span>
                <span class="c1"># without allowing booking to a negative position, and if an error</span>
                <span class="c1"># is encountered, catch it and return it.</span>
                <span class="n">running_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span>
                <span class="n">position_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">running_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

                <span class="c1"># Skip this check if the booking method is set to ignore it.</span>
                <span class="k">if</span> <span class="n">booking_methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check if the resulting inventory is mixed, which is not</span>
                <span class="c1"># allowed under the STRICT method.</span>
                <span class="k">if</span> <span class="n">running_balance</span><span class="o">.</span><span class="n">is_mixed</span><span class="p">():</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="p">(</span><span class="s2">"Reducing position results in inventory with positive "</span>
                             <span class="s2">"and negative lots: </span><span class="si">{}</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position_</span><span class="p">),</span>
                            <span class="n">entry</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking.validate_missing_eliminated">
<code class="highlight language-python">
validate_missing_eliminated<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking.validate_missing_eliminated" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate that all the missing bits of postings have been eliminated.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unused_options_map</code></td>
<td><code></code></td>
<td>
<p>An options map.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of errors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">validate_missing_eliminated</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">unused_options_map</span><span class="p">):</span>
    <span class="sd">"""Validate that all the missing bits of postings have been eliminated.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      unused_options_map: An options map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of errors.</span>
<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                                                     <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">)):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                     <span class="s2">"Transaction has incomplete elements"</span><span class="p">,</span>
                                     <span class="n">entry</span><span class="p">))</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking_full">
<code>booking_full</code>
<a class="headerlink" href="#beancount.parser.booking_full" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Full (new) booking implementation.</p>
<p>Problem description:</p>
<p>Interpolation and booking feed on each other, that is, numbers filled in from
interpolation might affect the booking process, and numbers derived from the
booking process may help carry out interpolation that would otherwise be
under-defined. Here's an example of interpolation helping the booking process:</p>
<p>Assume the ante-inventory of Assets:Investments contains two lots of shares of
HOOL, one at 100.00 USD and the other at 101.00 USD and apply this transaction:</p>
<pre><code>2015-09-30 *
  Assets:Investments   -10 HOOL {USD}
  Assets:Cash               1000 USD
  Income:Gains              -200 USD
</code></pre>
<p>Interpolation is unambiguously able to back out a cost of 100 USD / HOOL, which
would then result in an unambiguous booking result.</p>
<p>On the other hand, consider this transaction:</p>
<pre><code>2015-09-30 *
  Assets:Investments    -10 HOOL {USD}
  Assets:Cash               1000 USD
  Income:Gains
</code></pre>
<p>Now the interpolation cannot succeed. If the Assets:Investments account is
configured to use the FIFO method, the 10 oldest shares would be selected for
the cost, and we could then interpolate the capital gains correctly.</p>
<p>First observation: The second case is much more frequent than the first, and the
first is easily resolved manually by requiring a particular cost be specified.
Moreover, in many cases there isn't just a single lot of shares to be reduced
from and figuring out the correct set of shares given a target cost is an
underspecified problem.</p>
<p>Second observation: Booking can only be achieved for inventory reductions, not
for augmentations. Therefore, we should carry out booking on inventory
reductions and fail early if reduction is undefined there, and leave inventory
augmentations with missing numbers undefined, so that interpolation can fill
them in at a later stage.</p>
<p>Note that one case we'd like to but may not be able to handle is of a reduction
with interpolated price, like this:</p>
<pre><code>2015-09-30 *
  Assets:Investments        -10 HOOL {100.00 # USD}
  Expenses:Commission      9.95 USD
  Assets:Cash            990.05 USD
</code></pre>
<p>Therefore we choose to</p>
<p>1) Carry out booking first, on inventory reductions only, and leave inventory
   augmentations as they are, possibly undefined. The 'cost' attributed of
   booked postings are converted from CostSpec to Cost. Augmented postings with
   missing amounts are left as CostSpec instances in order to allow for
   interpolation of total vs. per-unit amount.</p>
<p>2) Compute interpolations on the resulting postings. Undefined costs for
   inventory augmentations may be filled in by interpolations at this stage (if
   possible).</p>
<p>3) Finally, convert the interpolated CostSpec instances to Cost instances.</p>
<p>Improving on this algorithm would require running a loop over the booking and
interpolation steps until all numbers are resolved or no more inference can
occur. We may consider that for later, as an experimental feature. My hunch is
that there are so few cases for which this would be useful that we won't bother
improving on the algorithm above.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.CategorizationError">
<code>CategorizationError</code>
<a class="headerlink" href="#beancount.parser.booking_full.CategorizationError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>CategorizationError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.CategorizationError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.CategorizationError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.CategorizationError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.CategorizationError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of CategorizationError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.CategorizationError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.CategorizationError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.InterpolationError">
<code>InterpolationError</code>
<a class="headerlink" href="#beancount.parser.booking_full.InterpolationError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>InterpolationError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.InterpolationError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.InterpolationError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.InterpolationError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.InterpolationError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of InterpolationError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.InterpolationError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.InterpolationError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.MissingType">
<code>MissingType</code>
<a class="headerlink" href="#beancount.parser.booking_full.MissingType" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The type of missing number.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.ReductionError">
<code>ReductionError</code>
<a class="headerlink" href="#beancount.parser.booking_full.ReductionError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>ReductionError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.ReductionError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.ReductionError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.ReductionError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.ReductionError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of ReductionError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.ReductionError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.ReductionError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.Refer">
<code>Refer</code>
<a class="headerlink" href="#beancount.parser.booking_full.Refer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Refer(index, units_currency, cost_currency, price_currency)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.Refer.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.Refer.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.Refer.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.Refer.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Refer(index, units_currency, cost_currency, price_currency)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.Refer.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.Refer.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.SelfReduxError">
<code>SelfReduxError</code>
<a class="headerlink" href="#beancount.parser.booking_full.SelfReduxError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>SelfReduxError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.SelfReduxError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.SelfReduxError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.SelfReduxError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.SelfReduxError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of SelfReduxError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_full.SelfReduxError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_full.SelfReduxError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.book">
<code class="highlight language-python">
book<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.book" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Interpolate missing data from the entries using the full historical algorithm.
See the internal implementation _book() for details.
This method only stripes some of the return values.</p>
<p>See _book() for arguments and return values.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
    <span class="sd">"""Interpolate missing data from the entries using the full historical algorithm.</span>
<span class="sd">    See the internal implementation _book() for details.</span>
<span class="sd">    This method only stripes some of the return values.</span>

<span class="sd">    See _book() for arguments and return values.</span>
<span class="sd">    """</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.book_reductions">
<code class="highlight language-python">
book_reductions<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">group_postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.book_reductions" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Book inventory reductions against the ante-balances.</p>
<p>This function accepts a dict of (account, Inventory balance) and for each
posting that is a reduction against its inventory, attempts to find a
corresponding lot or list of lots to reduce the balance with.</p>
<ul>
<li>
<p>For reducing lots, the CostSpec instance of the posting is replaced by a
  Cost instance.</p>
</li>
<li>
<p>For augmenting lots, the CostSpec instance of the posting is left alone,
  except for its date, which is inherited from the parent Transaction.</p>
</li>
</ul>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of Transaction. This is only used to refer to when
logging errors.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>group_postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances for the group.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>balances</code></td>
<td><code></code></td>
<td>
<p>A dict of account name to inventory contents.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>methods</code></td>
<td><code></code></td>
<td>
<p>A mapping of account name to their corresponding booking
method enum.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A pair of
  booked_postings</code></td>
<td>
<p>A list of booked postings, with reducing lots resolved
    against specific position in the corresponding accounts'
    ante-inventory balances. Note single reducing posting in the input may
    result in multiple postings in the output. Also note that augmenting
    postings held-at-cost will still refer to 'cost' instances of
    CostSpec, left to be interpolated later.
  errors: A list of errors, if there were any.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">book_reductions</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">group_postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span>
                    <span class="n">methods</span><span class="p">):</span>
    <span class="sd">"""Book inventory reductions against the ante-balances.</span>

<span class="sd">    This function accepts a dict of (account, Inventory balance) and for each</span>
<span class="sd">    posting that is a reduction against its inventory, attempts to find a</span>
<span class="sd">    corresponding lot or list of lots to reduce the balance with.</span>

<span class="sd">    * For reducing lots, the CostSpec instance of the posting is replaced by a</span>
<span class="sd">      Cost instance.</span>

<span class="sd">    * For augmenting lots, the CostSpec instance of the posting is left alone,</span>
<span class="sd">      except for its date, which is inherited from the parent Transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of Transaction. This is only used to refer to when</span>
<span class="sd">        logging errors.</span>
<span class="sd">      group_postings: A list of Posting instances for the group.</span>
<span class="sd">      balances: A dict of account name to inventory contents.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method enum.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of</span>
<span class="sd">        booked_postings: A list of booked postings, with reducing lots resolved</span>
<span class="sd">          against specific position in the corresponding accounts'</span>
<span class="sd">          ante-inventory balances. Note single reducing posting in the input may</span>
<span class="sd">          result in multiple postings in the output. Also note that augmenting</span>
<span class="sd">          postings held-at-cost will still refer to 'cost' instances of</span>
<span class="sd">          CostSpec, left to be interpolated later.</span>
<span class="sd">        errors: A list of errors, if there were any.</span>
<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># A local copy of the balances dictionary which is updated just for the</span>
    <span class="c1"># duration of this function's updates, in order to take into account the</span>
    <span class="c1"># cumulative effect of all the postings inferred here</span>
    <span class="n">local_balances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">empty</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="n">booked_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">group_postings</span><span class="p">:</span>
        <span class="c1"># Process a single posting.</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">costspec</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>

        <span class="c1"># Note: We ensure there is no mutation on 'balances' to keep this</span>
        <span class="c1"># function without side-effects. Note that we may be able to optimize</span>
        <span class="c1"># performance later on by giving up this property.</span>
        <span class="c1">#</span>
        <span class="c1"># Also note that if there is no existing balance, then won't be any lot</span>
        <span class="c1"># reduction because none of the postings will be able to match against</span>
        <span class="c1"># any currencies of the balance.</span>
        <span class="n">previous_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">local_balances</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">previous_balance</span><span class="p">))</span>

        <span class="c1"># Check if this is a lot held at cost.</span>
        <span class="k">if</span> <span class="n">costspec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="c1"># This posting is not held at cost; we do nothing.</span>
            <span class="n">booked_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This posting is held at cost; figure out if it's a reduction or an</span>
            <span class="c1"># augmentation.</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span> <span class="ow">and</span>
                <span class="n">balance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="n">balance</span><span class="o">.</span><span class="n">is_reduced_by</span><span class="p">(</span><span class="n">units</span><span class="p">)):</span>
                <span class="c1"># This posting is a reduction.</span>

                <span class="c1"># Match the positions.</span>
                <span class="n">cost_number</span> <span class="o">=</span> <span class="n">compute_cost_number</span><span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">balance</span><span class="p">:</span>
                    <span class="c1"># Skip inventory contents of a different currency.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">and</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="c1"># Skip balance positions not held at cost.</span>
                    <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cost_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">cost_number</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">costspec</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">currency</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">costspec</span><span class="o">.</span><span class="n">date</span> <span class="ow">and</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">costspec</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span>
                        <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">label</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

                <span class="c1"># Check for ambiguous matches.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ReductionError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                       <span class="s1">'No position matches "</span><span class="si">{}</span><span class="s1">" against balance </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                           <span class="n">posting</span><span class="p">,</span> <span class="n">balance</span><span class="p">),</span>
                                       <span class="n">entry</span><span class="p">))</span>
                    <span class="k">return</span> <span class="p">[],</span> <span class="n">errors</span>  <span class="c1"># This is irreconcilable, remove these postings.</span>

                <span class="n">reduction_postings</span><span class="p">,</span> <span class="n">matched_postings</span><span class="p">,</span> <span class="n">ambi_errors</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">booking_method</span><span class="o">.</span><span class="n">handle_ambiguous_matches</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ambi_errors</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ambi_errors</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[],</span> <span class="n">errors</span>

                <span class="c1"># Add the reductions to the resulting list of booked postings.</span>
                <span class="n">booked_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reduction_postings</span><span class="p">)</span>

                <span class="c1"># Update the local balance in order to avoid matching against</span>
                <span class="c1"># the same postings twice when processing multiple postings in</span>
                <span class="c1"># the same transaction. Note that we only do this for postings</span>
                <span class="c1"># held at cost because the other postings may need interpolation</span>
                <span class="c1"># in order to be resolved properly.</span>
                <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">reduction_postings</span><span class="p">:</span>
                    <span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This posting is an augmentation.</span>
                <span class="c1">#</span>
                <span class="c1"># Note that we do not convert the CostSpec instances to Cost</span>
                <span class="c1"># instances, because we want to let the subsequent interpolation</span>
                <span class="c1"># process able to interpolate either the cost per-unit or the</span>
                <span class="c1"># total cost, separately.</span>

                <span class="c1"># Put in the date of the parent Transaction if there is no</span>
                <span class="c1"># explicit date specified on the spec.</span>
                <span class="k">if</span> <span class="n">costspec</span><span class="o">.</span><span class="n">date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dated_costspec</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">dated_costspec</span><span class="p">)</span>

                <span class="c1"># FIXME: Insert unique ids for trade tracking; right now this</span>
                <span class="c1"># creates ambiguous matches errors (and it shouldn't).</span>
                <span class="c1"># # Insert a unique label if there isn't one.</span>
                <span class="c1"># if posting.cost is not None and posting.cost.label is None:</span>
                <span class="c1">#     posting = posting._replace(</span>
                <span class="c1">#         cost=posting.cost._replace(label=unique_label()))</span>

                <span class="n">booked_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">booked_postings</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.categorize_by_currency">
<code class="highlight language-python">
categorize_by_currency<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">balances</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.categorize_by_currency" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Group the postings by the currency they declare.</p>
<p>This is used to prepare the postings for the next stages: Interpolation and
booking will then be carried out separately on each currency group. At the
outset of this routine, we should have distinct groups of currencies without
any ambiguities regarding which currency they need to balance against.</p>
<p>Here's how this works.</p>
<ul>
<li>
<p>First we apply the constraint that cost-currency and price-currency must
  match, if there is both a cost and a price. This reduces the space of
  possibilities somewahte.</p>
</li>
<li>
<p>If the currency is explicitly specified, we put the posting in that
  currency's bucket.</p>
</li>
<li>
<p>If not, we have a few methods left to disambiguate the currency:</p>
</li>
<li>
<p>We look at the remaining postings... if they are all of a single
     currency, the posting must be in that currency too.</p>
</li>
<li>
<p>If we cannot do that, we inspect the contents of the inventory of the
     account for the posting. If all the contents are of a single currency,
     we use that one.</p>
</li>
</ul>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of incomplete postings to categorize.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>balances</code></td>
<td><code></code></td>
<td>
<p>A dict of currency to inventory contents before the transaction is
applied.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A list of (currency string, list of tuples) items describing each postings
and its interpolated currencies, and a list of generated errors for
currency interpolation. The entry's original postings are left unmodified.
Each tuple in the value-list contains</code></td>
<td>
<p>index: The posting index in the original entry.
  units_currency: The interpolated currency for units.
  cost_currency: The interpolated currency for cost.
  price_currency: The interpolated currency for price.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">categorize_by_currency</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">balances</span><span class="p">):</span>
    <span class="sd">"""Group the postings by the currency they declare.</span>

<span class="sd">    This is used to prepare the postings for the next stages: Interpolation and</span>
<span class="sd">    booking will then be carried out separately on each currency group. At the</span>
<span class="sd">    outset of this routine, we should have distinct groups of currencies without</span>
<span class="sd">    any ambiguities regarding which currency they need to balance against.</span>

<span class="sd">    Here's how this works.</span>

<span class="sd">    - First we apply the constraint that cost-currency and price-currency must</span>
<span class="sd">      match, if there is both a cost and a price. This reduces the space of</span>
<span class="sd">      possibilities somewahte.</span>

<span class="sd">    - If the currency is explicitly specified, we put the posting in that</span>
<span class="sd">      currency's bucket.</span>

<span class="sd">    - If not, we have a few methods left to disambiguate the currency:</span>

<span class="sd">      1. We look at the remaining postings... if they are all of a single</span>
<span class="sd">         currency, the posting must be in that currency too.</span>

<span class="sd">      2. If we cannot do that, we inspect the contents of the inventory of the</span>
<span class="sd">         account for the posting. If all the contents are of a single currency,</span>
<span class="sd">         we use that one.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of incomplete postings to categorize.</span>
<span class="sd">      balances: A dict of currency to inventory contents before the transaction is</span>
<span class="sd">        applied.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of (currency string, list of tuples) items describing each postings</span>
<span class="sd">      and its interpolated currencies, and a list of generated errors for</span>
<span class="sd">      currency interpolation. The entry's original postings are left unmodified.</span>
<span class="sd">      Each tuple in the value-list contains:</span>
<span class="sd">        index: The posting index in the original entry.</span>
<span class="sd">        units_currency: The interpolated currency for units.</span>
<span class="sd">        cost_currency: The interpolated currency for cost.</span>
<span class="sd">        price_currency: The interpolated currency for price.</span>
<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">sortdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">auto_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unknown</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>

        <span class="c1"># Extract and override the currencies locally.</span>
        <span class="n">units_currency</span> <span class="o">=</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
                          <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                          <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cost_currency</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span>
                         <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                         <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">price_currency</span> <span class="o">=</span> <span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span>
                          <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                          <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># First we apply the constraint that cost-currency and price-currency</span>
        <span class="c1"># must match, if there is both a cost and a price. This reduces the</span>
        <span class="c1"># space of possibilities somewhat.</span>
        <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">price_currency</span>
        <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">price_currency</span> <span class="o">=</span> <span class="n">cost_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">and</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Bucket auto-postings separately from unknown.</span>
            <span class="n">auto_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Bucket with what we know so far.</span>
            <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If we need to infer the currency, store in unknown.</span>
                <span class="n">unknown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>

    <span class="c1"># We look at the remaining postings... if they are all of a single currency,</span>
    <span class="c1"># the posting must be in that currency too.</span>
    <span class="k">if</span> <span class="n">unknown</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unknown</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span> <span class="o">=</span> <span class="n">unknown</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">other_currency</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Infer to the units currency.</span>
            <span class="n">units_currency</span> <span class="o">=</span> <span class="n">other_currency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Infer to the cost and price currencies.</span>
            <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">price_currency</span> <span class="o">=</span> <span class="n">other_currency</span>
            <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">other_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>

    <span class="c1"># Finally, try to resolve all the unknown legs using the inventory contents</span>
    <span class="c1"># of each account.</span>
    <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">unknown</span><span class="p">:</span>
        <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span> <span class="o">=</span> <span class="n">refer</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">balance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">units_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">balance_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">currencies</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">units_currency</span> <span class="o">=</span> <span class="n">balance_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">balance_cost_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">cost_currencies</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_cost_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">balance_cost_currency</span> <span class="o">=</span> <span class="n">balance_cost_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">price_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">price_currency</span> <span class="o">=</span> <span class="n">balance_cost_currency</span>
                <span class="k">if</span> <span class="n">cost_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">balance_cost_currency</span>

        <span class="n">refer</span> <span class="o">=</span> <span class="n">Refer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">units_currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">price_currency</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">CategorizationError</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                    <span class="s2">"Failed to categorize posting </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                    <span class="n">entry</span><span class="p">))</span>

    <span class="c1"># Fill in missing units currencies if some remain as missing. This may occur</span>
    <span class="c1"># if we used the cost or price to bucket the currency but the units currency</span>
    <span class="c1"># was missing.</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">rindex</span><span class="p">,</span> <span class="n">refer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">refers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">balance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">balance_currencies</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">currencies</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_currencies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">refers</span><span class="p">[</span><span class="n">rindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units_currency</span><span class="o">=</span><span class="n">balance_currencies</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

    <span class="c1"># Deal with auto-postings.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">auto_postings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">refer</span> <span class="o">=</span> <span class="n">auto_postings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">CategorizationError</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                <span class="s2">"You may not have more than one auto-posting per currency"</span><span class="p">,</span>
                                <span class="n">entry</span><span class="p">))</span>
        <span class="n">auto_postings</span> <span class="o">=</span> <span class="n">auto_postings</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">auto_postings</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sortdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Refer</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Issue error for all currencies which we could not resolve.</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">refers</span><span class="p">:</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">,</span> <span class="s1">'units'</span><span class="p">),</span>
                                   <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">,</span> <span class="s1">'cost'</span><span class="p">),</span>
                                   <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CategorizationError</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Could not resolve </span><span class="si">{}</span><span class="s2"> currency"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                        <span class="n">entry</span><span class="p">))</span>

    <span class="n">sorted_groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">sortdict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sorted_groups</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.compute_cost_number">
<code class="highlight language-python">
compute_cost_number<span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.compute_cost_number" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a CostSpec, return the cost number, if possible to compute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>costspec</code></td>
<td><code></code></td>
<td>
<p>A parsed instance of CostSpec.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>units</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount for the units of the position.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>If it is not possible to calculate the cost, return None.
Otherwise, returns a Decimal instance, the per-unit cost.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_cost_number</span><span class="p">(</span><span class="n">costspec</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
    <span class="sd">"""Given a CostSpec, return the cost number, if possible to compute.</span>

<span class="sd">    Args:</span>
<span class="sd">      costspec: A parsed instance of CostSpec.</span>
<span class="sd">      units: An instance of Amount for the units of the position.</span>
<span class="sd">    Returns:</span>
<span class="sd">      If it is not possible to calculate the cost, return None.</span>
<span class="sd">      Otherwise, returns a Decimal instance, the per-unit cost.</span>
<span class="sd">    """</span>
    <span class="n">number_per</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">number_per</span>
    <span class="n">number_total</span> <span class="o">=</span> <span class="n">costspec</span><span class="o">.</span><span class="n">number_total</span>
    <span class="k">if</span> <span class="n">MISSING</span> <span class="ow">in</span> <span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Compute the per-unit cost if there is some total cost</span>
        <span class="c1"># component involved.</span>
        <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
        <span class="n">units_number</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_number</span>
        <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units_number</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
    <span class="k">return</span> <span class="n">unit_cost</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.convert_costspec_to_cost">
<code class="highlight language-python">
convert_costspec_to_cost<span class="p">(</span><span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.convert_costspec_to_cost" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert an instance of CostSpec to Cost, if present on the posting.</p>
<p>If the posting has no cost, it itself is just returned.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>An instance of Posting.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Posting with a possibly replaced 'cost' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""Convert an instance of CostSpec to Cost, if present on the posting.</span>

<span class="sd">    If the posting has no cost, it itself is just returned.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: An instance of Posting.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Posting with a possibly replaced 'cost' attribute.</span>
<span class="sd">    """</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">CostSpec</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">units_number</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
            <span class="n">number_per</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span>
            <span class="n">number_total</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span>
            <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Compute the per-unit cost if there is some total cost</span>
                <span class="c1"># component involved.</span>
                <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
                <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_number</span>
                <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units_number</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
            <span class="n">new_cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">new_cost</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posting</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.get_bucket_currency">
<code class="highlight language-python">
get_bucket_currency<span class="p">(</span><span class="n">refer</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.get_bucket_currency" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given currency references for a posting, return the bucket currency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>refer</code></td>
<td><code></code></td>
<td>
<p>An instance of Refer.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A currency string.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_bucket_currency</span><span class="p">(</span><span class="n">refer</span><span class="p">):</span>
    <span class="sd">"""Given currency references for a posting, return the bucket currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      refer: An instance of Refer.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A currency string.</span>
<span class="sd">    """</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
          <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span>
    <span class="k">return</span> <span class="n">currency</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.has_self_reduction">
<code class="highlight language-python">
has_self_reduction<span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.has_self_reduction" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the postings potentially reduce each other at cost.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of postings with uninterpolated CostSpec cost instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>methods</code></td>
<td><code></code></td>
<td>
<p>A mapping of account name to their corresponding booking
method.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if there's a potential for self-reduction.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">has_self_reduction</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
    <span class="sd">"""Return true if the postings potentially reduce each other at cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of postings with uninterpolated CostSpec cost instances.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there's a potential for self-reduction.</span>
<span class="sd">    """</span>
    <span class="c1"># A mapping of (currency, cost-currency) and sign.</span>
    <span class="n">cost_changes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">methods</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span> <span class="ow">is</span> <span class="n">Booking</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">cost_changes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sign</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.interpolate_group">
<code class="highlight language-python">
interpolate_group<span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.interpolate_group" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Interpolate missing numbers in the set of postings.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>balances</code></td>
<td><code></code></td>
<td>
<p>A dict of account to its ante-inventory.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>The weight currency of this group, used for reporting errors.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tolerances</code></td>
<td><code></code></td>
<td>
<p>A dict of currency to tolerance values.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of
  postings</code></td>
<td>
<p>A lit of new posting instances.
  errors: A list of errors generated during interpolation.
  interpolated: A boolean, true if we did have to interpolate.</p>
<p>In the case of an error, this returns the original list of postings, which
is still incomplete. If an error is returned, you should probably skip the
transaction altogether, or just not include the postings in it. (An
alternative behaviour would be to return only the list of valid postings,
but that would likely result in an unbalanced transaction. We do it this
way by choice.)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_group</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">balances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">):</span>
    <span class="sd">"""Interpolate missing numbers in the set of postings.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances.</span>
<span class="sd">      balances: A dict of account to its ante-inventory.</span>
<span class="sd">      currency: The weight currency of this group, used for reporting errors.</span>
<span class="sd">      tolerances: A dict of currency to tolerance values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">        postings: A lit of new posting instances.</span>
<span class="sd">        errors: A list of errors generated during interpolation.</span>
<span class="sd">        interpolated: A boolean, true if we did have to interpolate.</span>

<span class="sd">      In the case of an error, this returns the original list of postings, which</span>
<span class="sd">      is still incomplete. If an error is returned, you should probably skip the</span>
<span class="sd">      transaction altogether, or just not include the postings in it. (An</span>
<span class="sd">      alternative behaviour would be to return only the list of valid postings,</span>
<span class="sd">      but that would likely result in an unbalanced transaction. We do it this</span>
<span class="sd">      way by choice.)</span>
<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Figure out which type of amount is missing, by creating a list of</span>
    <span class="c1"># incomplete postings and which type of units is missing.</span>
    <span class="n">incomplete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">postings</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>

        <span class="c1"># Identify incomplete parts of the Posting components.</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">COST_PER</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">COST_TOTAL</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check that a resolved instance of Cost never needs interpolation.</span>
            <span class="c1">#</span>
            <span class="c1"># Note that in theory we could support the interpolation of regular</span>
            <span class="c1"># per-unit costs in these if we wanted to; but because they're all</span>
            <span class="c1"># reducing postings that have been booked earlier, those never need</span>
            <span class="c1"># to be interpolated.</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
                    <span class="s2">"Internal error: cost has no number: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
            <span class="n">incomplete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">MissingType</span><span class="o">.</span><span class="n">PRICE</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

    <span class="c1"># The replacement posting for the incomplete posting of this group.</span>
    <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">incomplete</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># If there are no missing numbers, just convert the CostSpec to Cost and</span>
        <span class="c1"># return that.</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">incomplete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># If there is more than a single value to be interpolated, generate an</span>
        <span class="c1"># error and return no postings.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">posting_index</span> <span class="o">=</span> <span class="n">incomplete</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterpolationError</span><span class="p">(</span>
            <span class="n">postings</span><span class="p">[</span><span class="n">posting_index</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="s2">"Too many missing numbers for currency group '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">))</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If there is a single missing number, calculate it and fill it in here.</span>
        <span class="n">missing</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">incomplete</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">incomplete_posting</span> <span class="o">=</span> <span class="n">postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># Convert augmenting postings' costs from CostSpec to corresponding Cost</span>
        <span class="c1"># instances, except for the incomplete posting.</span>
        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[(</span><span class="n">posting</span>
                         <span class="k">if</span> <span class="n">posting</span> <span class="ow">is</span> <span class="n">incomplete_posting</span>
                         <span class="k">else</span> <span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">]</span>

        <span class="c1"># Compute the balance of the other postings.</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">compute_residual</span><span class="p">(</span><span class="n">posting</span>
                                                <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">new_postings</span>
                                                <span class="k">if</span> <span class="n">posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">incomplete_posting</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"Internal error in grouping postings by currencies."</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">residual</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="n">respos</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">residual</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">respos</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Internal error; cost appears in weight calculation."</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">currency</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Internal error; residual different than currency group."</span><span class="p">)</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span><span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
            <span class="n">weight_currency</span> <span class="o">=</span> <span class="n">respos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">ZERO</span>
            <span class="n">weight_currency</span> <span class="o">=</span> <span class="n">currency</span>

        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">UNITS</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                <span class="c1"># Handle the special case where we only have total cost.</span>
                <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterpolationError</span><span class="p">(</span>
                        <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Cannot infer per-unit cost only from total"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">True</span>

                <span class="k">assert</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
                <span class="n">cost_total</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">or</span> <span class="n">ZERO</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="n">cost_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span>

            <span class="k">elif</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">number</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
                <span class="n">units_number</span> <span class="o">=</span> <span class="n">weight</span>

            <span class="c1"># Quantize the interpolated units if necessary.</span>
            <span class="n">units_number</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">quantize_with_tolerance</span><span class="p">(</span><span class="n">tolerances</span><span class="p">,</span>
                                                               <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                                                               <span class="n">units_number</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">weight</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">units_number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span> <span class="n">cost</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                                          <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">COST_PER</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">assert</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">or</span> <span class="n">ZERO</span><span class="p">))</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
                <span class="n">new_cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">number_per</span><span class="o">=</span><span class="n">number_per</span><span class="p">)</span>
                <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">new_cost</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                                          <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">COST_TOTAL</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">assert</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
            <span class="n">number_total</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
            <span class="n">new_cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">number_total</span><span class="o">=</span><span class="n">number_total</span><span class="p">)</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">new_cost</span><span class="p">)</span>
            <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                                      <span class="n">cost</span><span class="o">=</span><span class="n">new_pos</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="n">MissingType</span><span class="o">.</span><span class="n">PRICE</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">units</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterpolationError</span><span class="p">(</span>
                    <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                    <span class="s2">"Cannot infer price for postings with units held at cost"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">assert</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">weight_currency</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">"Internal error; residual currency different than missing currency."</span><span class="p">)</span>
                <span class="n">new_price_number</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">weight</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">incomplete_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">Amount</span><span class="p">(</span><span class="n">new_price_number</span><span class="p">,</span>
                                                                       <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"Internal error; Invalid missing type."</span>

        <span class="c1"># Replace the number in the posting.</span>
        <span class="k">if</span> <span class="n">new_posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set meta-data on the new posting to indicate it was interpolated.</span>
            <span class="k">if</span> <span class="n">new_posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_posting</span> <span class="o">=</span> <span class="n">new_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{})</span>
            <span class="n">new_posting</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">interpolate</span><span class="o">.</span><span class="n">AUTOMATIC_META</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Convert augmenting posting costs from CostSpec to a corresponding</span>
            <span class="c1"># Cost instance.</span>
            <span class="n">new_postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_costspec_to_cost</span><span class="p">(</span><span class="n">new_posting</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_postings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">out_postings</span> <span class="o">=</span> <span class="n">new_postings</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">out_postings</span><span class="p">)</span>

    <span class="c1"># Check that units are non-zero and that no cost remains negative; issue an</span>
    <span class="c1"># error if this is the case.</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">out_postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># If there is a cost, we don't allow either a cost value of zero,</span>
        <span class="c1"># nor a zero number of units. Note that we allow a price of zero as</span>
        <span class="c1"># the only special case allowed (for conversion entries), but never</span>
        <span class="c1"># for costs.</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterpolationError</span><span class="p">(</span>
                <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s1">'Amount is zero: "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InterpolationError</span><span class="p">(</span>
                <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                <span class="s1">'Cost is negative: "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out_postings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="p">(</span><span class="n">new_posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.replace_currencies">
<code class="highlight language-python">
replace_currencies<span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">refer_groups</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.replace_currencies" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace resolved currencies in the entry's Postings.</p>
<p>This essentially applies the findings of categorize_by_currency() to produce
new postings with all currencies resolved.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances to replace.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>refer_groups</code></td>
<td><code></code></td>
<td>
<p>A list of (currency, list of posting references) items as
returned by categorize_by_currency().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new list of items of (currency, list of Postings), postings for which the
currencies have been replaced by their interpolated currency values.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">replace_currencies</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">refer_groups</span><span class="p">):</span>
    <span class="sd">"""Replace resolved currencies in the entry's Postings.</span>

<span class="sd">    This essentially applies the findings of categorize_by_currency() to produce</span>
<span class="sd">    new postings with all currencies resolved.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances to replace.</span>
<span class="sd">      refer_groups: A list of (currency, list of posting references) items as</span>
<span class="sd">        returned by categorize_by_currency().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new list of items of (currency, list of Postings), postings for which the</span>
<span class="sd">      currencies have been replaced by their interpolated currency values.</span>
<span class="sd">    """</span>
    <span class="n">new_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">refer_groups</span><span class="p">:</span>
        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">refers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">postings</span><span class="p">[</span><span class="n">refer</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
            <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">Amount</span><span class="p">(</span><span class="n">MISSING</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">units_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">refer</span><span class="o">.</span><span class="n">cost_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">refer</span><span class="o">.</span><span class="n">price_currency</span><span class="p">)</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
                    <span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">)</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="n">new_groups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">currency</span><span class="p">,</span> <span class="n">new_postings</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_groups</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full.unique_label">
<code class="highlight language-python">
unique_label<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full.unique_label" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a globally unique label for cost entries.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>96
97
98</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">unique_label</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Text</span><span class="p">:</span>
    <span class="s2">"Return a globally unique label for cost entries."</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking_full_test">
<code>booking_full_test</code>
<a class="headerlink" href="#beancount.parser.booking_full_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.TestBookAugmentations">
<code>TestBookAugmentations</code>
<a class="headerlink" href="#beancount.parser.booking_full_test.TestBookAugmentations" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test that the augmentations are left alone by the book_reductions() function.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.TestCategorizeCurrencyGroup">
<code>TestCategorizeCurrencyGroup</code>
<a class="headerlink" href="#beancount.parser.booking_full_test.TestCategorizeCurrencyGroup" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Tests of per-currency categorization of postings.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.TestInterpolateCurrencyGroup">
<code>TestInterpolateCurrencyGroup</code>
<a class="headerlink" href="#beancount.parser.booking_full_test.TestInterpolateCurrencyGroup" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Tests the replacement of currencies inferred in the categorization step.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.TestReplaceCurrenciesInGroup">
<code>TestReplaceCurrenciesInGroup</code>
<a class="headerlink" href="#beancount.parser.booking_full_test.TestReplaceCurrenciesInGroup" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Tests the replacement of currencies inferred in the categorization step.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.book_test">
<code class="highlight language-python">
book_test<span class="p">(</span><span class="n">method</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full_test.book_test" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A decorator factory for all booking tests. This calls _book() below.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@test_utils</span><span class="o">.</span><span class="n">nottest</span>
<span class="k">def</span> <span class="nf">book_test</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="s2">"A decorator factory for all booking tests. This calls _book() below."</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@parser</span><span class="o">.</span><span class="n">parse_doc</span><span class="p">(</span><span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">unused_errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.find_first_with_tag">
<code class="highlight language-python">
find_first_with_tag<span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">default</span><span class="o">=&lt;</span><span class="nb">object</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f0314c77ef0</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full_test.find_first_with_tag" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the first entry matching the given tag.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_first_with_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_UNSET</span><span class="p">):</span>
    <span class="sd">"""Return the first entry matching the given tag."""</span>
    <span class="n">found_entry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">found_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Multiple entries with tag #</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
            <span class="n">found_entry</span> <span class="o">=</span> <span class="n">entry</span>
    <span class="k">if</span> <span class="n">found_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">found_entry</span>
    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">_UNSET</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Entry with tag #</span><span class="si">{}</span><span class="s2"> is missing"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">default</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.indexes">
<code class="highlight language-python">
indexes<span class="p">(</span><span class="n">groups</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full_test.indexes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return only the index sets from currency categorized groups.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">indexes</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
    <span class="sd">"""Return only the index sets from currency categorized groups."""</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">currency</span><span class="p">:</span> <span class="p">{</span><span class="n">refer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">refer</span> <span class="ow">in</span> <span class="n">refers</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">refers</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_full_test.normalize_postings">
<code class="highlight language-python">
normalize_postings<span class="p">(</span><span class="n">postings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_full_test.normalize_postings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Normalize a list of postings ready for direct comparison, for testing.</p>
<p>This sorts them by line order and removes metadata.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new reordered and normalized Posting instances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_full_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>512
513
514
515
516
517
518
519
520
521
522
523
524</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_postings</span><span class="p">(</span><span class="n">postings</span><span class="p">):</span>
    <span class="sd">"""Normalize a list of postings ready for direct comparison, for testing.</span>

<span class="sd">    This sorts them by line order and removes metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new reordered and normalized Posting instances.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span>
                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">posting</span><span class="p">:</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">'lineno'</span><span class="p">])]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking_method">
<code>booking_method</code>
<a class="headerlink" href="#beancount.parser.booking_method" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Implementations of all the particular booking methods.
This code is used by the full booking algorithm.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.AmbiguousMatchError">
<code>AmbiguousMatchError</code>
<a class="headerlink" href="#beancount.parser.booking_method.AmbiguousMatchError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>AmbiguousMatchError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_method.AmbiguousMatchError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_method.AmbiguousMatchError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_method.AmbiguousMatchError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of AmbiguousMatchError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_method.AmbiguousMatchError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_method.AmbiguousMatchError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.booking_method_AVERAGE">
<code class="highlight language-python">
booking_method_AVERAGE<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.booking_method_AVERAGE" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>AVERAGE booking method implementation.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_AVERAGE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
    <span class="sd">"""AVERAGE booking method implementation."""</span>
    <span class="n">booked_reductions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">booked_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">AmbiguousMatchError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"AVERAGE method is not supported"</span><span class="p">,</span> <span class="n">entry</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="kc">False</span>

    <span class="c1"># FIXME: Future implementation here.</span>
    <span class="c1"># pylint: disable=unreachable</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># pylint: disable=using-constant-test</span>
        <span class="c1"># DISABLED - This is the code for AVERAGE, which is currently disabled.</span>

        <span class="c1"># If there is more than a single match we need to ultimately merge the</span>
        <span class="c1"># postings. Also, if the reducing posting provides a specific cost, we</span>
        <span class="c1"># need to update the cost basis as well. Both of these cases are carried</span>
        <span class="c1"># out by removing all the matches and readding them later on.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
            <span class="c1"># There is no cost. Just reduce the one leg. This should be the</span>
            <span class="c1"># normal case if we always merge augmentations and the user lets</span>
            <span class="c1"># Beancount deal with the cost.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
            <span class="n">match_units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">sign</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">match_units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
            <span class="n">insufficient</span> <span class="o">=</span> <span class="p">(</span><span class="n">match_units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Merge the matching postings to a single one.</span>
            <span class="n">merged_units</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="n">merged_cost</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">merged_units</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="n">merged_cost</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">merged_units</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">merged_cost</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s1">'Cannot merge positions in multiple currencies: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)),</span> <span class="n">entry</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">AmbiguousMatchError</span><span class="p">(</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                            <span class="s2">"Explicit cost reductions aren't supported yet: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">)),</span> <span class="n">entry</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Insert postings to remove all the matches.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=-</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
                                         <span class="n">flag</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">FLAG_MERGING</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">merged_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span>  <span class="c1">## FIXME: Select which one,</span>
                                                 <span class="c1">## oldest or latest.</span>
                    <span class="n">cost_units</span> <span class="o">=</span> <span class="n">merged_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">cost_units</span><span class="o">.</span><span class="n">number</span><span class="o">/</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost_units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                                <span class="n">date</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="c1"># Insert a posting to refill those with a replacement match.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">FLAG_MERGING</span><span class="p">))</span>

                    <span class="c1"># Now, match the reducing request against this lot.</span>
                    <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">))</span>
                    <span class="n">insufficient</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.booking_method_FIFO">
<code class="highlight language-python">
booking_method_FIFO<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.booking_method_FIFO" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>FIFO booking method implementation.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>112
113
114</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_FIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
    <span class="sd">"""FIFO booking method implementation."""</span>
    <span class="k">return</span> <span class="n">_booking_method_xifo</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.booking_method_LIFO">
<code class="highlight language-python">
booking_method_LIFO<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.booking_method_LIFO" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>LIFO booking method implementation.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>117
118
119</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_LIFO</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
    <span class="sd">"""LIFO booking method implementation."""</span>
    <span class="k">return</span> <span class="n">_booking_method_xifo</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.booking_method_NONE">
<code class="highlight language-python">
booking_method_NONE<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.booking_method_NONE" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>NONE booking method implementation.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_NONE</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
    <span class="sd">"""NONE booking method implementation."""</span>

    <span class="c1"># This never needs to match against any existing positions... we</span>
    <span class="c1"># disregard the matches, there's never any error. Note that this never</span>
    <span class="c1"># gets called in practice, we want to treat NONE postings as</span>
    <span class="c1"># augmentations. Default behaviour is to return them with their original</span>
    <span class="c1"># CostSpec, and the augmentation code will handle signaling an error if</span>
    <span class="c1"># there is insufficient detail to carry out the conversion to an</span>
    <span class="c1"># instance of Cost.</span>

    <span class="c1"># Note that it's an interesting question whether a reduction on an</span>
    <span class="c1"># account with NONE method which happens to match a single position</span>
    <span class="c1"># ought to be matched against it. We don't allow it for now.</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">posting</span><span class="p">],</span> <span class="p">[],</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.booking_method_STRICT">
<code class="highlight language-python">
booking_method_STRICT<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.booking_method_STRICT" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Strict booking method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>The parent Transaction instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>An instance of Posting, the reducing posting which we're
attempting to match.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>matches</code></td>
<td><code></code></td>
<td>
<p>A list of matching Position instances from the ante-inventory.
Those positions are known to already match the 'posting' spec.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A triple of
  booked_reductions</code></td>
<td>
<p>A list of matched Posting instances, whose 'cost'
    attributes are ensured to be of type Cost.
  errors: A list of errors to be generated.
  insufficient: A boolean, true if we could not find enough matches
    to fulfill the reduction.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">booking_method_STRICT</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">):</span>
    <span class="sd">"""Strict booking method.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: The parent Transaction instance.</span>
<span class="sd">      posting: An instance of Posting, the reducing posting which we're</span>
<span class="sd">        attempting to match.</span>
<span class="sd">      matches: A list of matching Position instances from the ante-inventory.</span>
<span class="sd">        Those positions are known to already match the 'posting' spec.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of</span>
<span class="sd">        booked_reductions: A list of matched Posting instances, whose 'cost'</span>
<span class="sd">          attributes are ensured to be of type Cost.</span>
<span class="sd">        errors: A list of errors to be generated.</span>
<span class="sd">        insufficient: A boolean, true if we could not find enough matches</span>
<span class="sd">          to fulfill the reduction.</span>
<span class="sd">    """</span>
    <span class="n">booked_reductions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">booked_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">insufficient</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># In strict mode, we require at most a single matching posting.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># If the total requested to reduce matches the sum of all the</span>
        <span class="c1"># ambiguous postings, match against all of them.</span>
        <span class="n">sum_matches</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_matches</span> <span class="o">==</span> <span class="o">-</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="n">booked_reductions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=-</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AmbiguousMatchError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                    <span class="s1">'Ambiguous matches for "</span><span class="si">{}</span><span class="s1">": </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">),</span>
                                        <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span>
                                                  <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)),</span>
                                    <span class="n">entry</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Replace the posting's units and cost values.</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
        <span class="n">match_units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">sign</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">booked_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">match_units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
        <span class="n">booked_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="n">insufficient</span> <span class="o">=</span> <span class="p">(</span><span class="n">match_units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_method.handle_ambiguous_matches">
<code class="highlight language-python">
handle_ambiguous_matches<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_method.handle_ambiguous_matches" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Handle ambiguous matches by dispatching to a particular method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>The parent Transaction instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>An instance of Posting, the reducing posting which we're
attempting to match.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>matches</code></td>
<td><code></code></td>
<td>
<p>A list of matching Position instances from the ante-inventory.
Those positions are known to already match the 'posting' spec.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>methods</code></td>
<td><code></code></td>
<td>
<p>A mapping of account name to their corresponding booking
method.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A pair of
  booked_reductions</code></td>
<td>
<p>A list of matched Posting instances, whose 'cost'
    attributes are ensured to be of type Cost.
  errors: A list of errors to be generated.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_method.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">handle_ambiguous_matches</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="sd">"""Handle ambiguous matches by dispatching to a particular method.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: The parent Transaction instance.</span>
<span class="sd">      posting: An instance of Posting, the reducing posting which we're</span>
<span class="sd">        attempting to match.</span>
<span class="sd">      matches: A list of matching Position instances from the ante-inventory.</span>
<span class="sd">        Those positions are known to already match the 'posting' spec.</span>
<span class="sd">      methods: A mapping of account name to their corresponding booking</span>
<span class="sd">        method.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of</span>
<span class="sd">        booked_reductions: A list of matched Posting instances, whose 'cost'</span>
<span class="sd">          attributes are ensured to be of type Cost.</span>
<span class="sd">        errors: A list of errors to be generated.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">Booking</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Invalid type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">matches</span><span class="p">,</span> <span class="s2">"Internal error: Invalid call with no matches"</span>

    <span class="c1">#method = globals()['booking_method_{}'.format(method.name)]</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">_BOOKING_METHODS</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
    <span class="p">(</span><span class="n">booked_reductions</span><span class="p">,</span>
     <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">insufficient</span><span class="p">)</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">insufficient</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">AmbiguousMatchError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                           <span class="s1">'Not enough lots to reduce "</span><span class="si">{}</span><span class="s1">": </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                               <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">),</span>
                               <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">match_posting</span><span class="p">)</span>
                                         <span class="k">for</span> <span class="n">match_posting</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">)),</span>
                           <span class="n">entry</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">booked_reductions</span><span class="p">,</span> <span class="n">booked_matches</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking_method_test">
<code>booking_method_test</code>
<a class="headerlink" href="#beancount.parser.booking_method_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for individual booking methods.</p>
<p>Note that these should be already covered by the tests in booking_full_test, but
we may want to add more tests here, just calling each method directly and
covering all the possible branches.</p>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.booking_test">
<code>booking_test</code>
<a class="headerlink" href="#beancount.parser.booking_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_test.BookingTestError">
<code>BookingTestError</code>
<a class="headerlink" href="#beancount.parser.booking_test.BookingTestError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>BookingTestError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_test.BookingTestError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_test.BookingTestError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_test.BookingTestError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_test.BookingTestError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of BookingTestError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_test.BookingTestError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.booking_test.BookingTestError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.booking_test.TestBookingValidation">
<code>TestBookingValidation</code>
<a class="headerlink" href="#beancount.parser.booking_test.TestBookingValidation" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.booking_test.TestBookingValidation.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_test.TestBookingValidation.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">    2014-01-01 open Assets:Investments:Cash</span>
<span class="s2">    2014-01-01 open Assets:Investments:Stock</span>

<span class="s2">    2014-06-22 * "Add some positive units"</span>
<span class="s2">      Assets:Investments:Stock    1 HOOL {500 USD}</span>
<span class="s2">      Assets:Investments:Cash  -500 USD</span>

<span class="s2">    2014-06-23 * "Down to zero"</span>
<span class="s2">      Assets:Investments:Stock   -1 HOOL {500 USD}</span>
<span class="s2">      Assets:Investments:Cash   500 USD</span>

<span class="s2">    2014-06-24 * "Go negative from zero"</span>
<span class="s2">      Assets:Investments:Stock   -1 HOOL {500 USD}</span>
<span class="s2">      Assets:Investments:Cash   500 USD</span>

<span class="s2">    2014-06-25 * "Go positive much"</span>
<span class="s2">      Assets:Investments:Stock    11 HOOL {500 USD}</span>
<span class="s2">      Assets:Investments:Cash  -5500 USD</span>

<span class="s2">    2014-06-26 * "Cross to negative from above zero"</span>
<span class="s2">      Assets:Investments:Stock  -15 HOOL {500 USD}</span>
<span class="s2">      Assets:Investments:Cash  7500 USD</span>

<span class="s2">    """</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_test.convert_lot_specs_to_lots">
<code class="highlight language-python">
convert_lot_specs_to_lots<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_test.convert_lot_specs_to_lots" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>For all the entries, convert the posting's position's CostSpec to Cost
instances. In the simple method, the data provided in the CostSpec must
unambiguously provide a way to compute the cost amount.</p>
<p>This essentially replicates the way the old parser used to work, but
allowing positions to have the fuzzy lot specifications instead of the
resolved ones. We used to simply compute the costs locally, and this gets
rid of the CostSpec to produce the Cost without fuzzy matching. This is only
there for the sake of transition to the new matching logic.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of incomplete directives as per the parser.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of entries whose postings's position costs have been converted to
Cost instances but that may still be incomplete.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If there's a unacceptable number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_lot_specs_to_lots</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""For all the entries, convert the posting's position's CostSpec to Cost</span>
<span class="sd">    instances. In the simple method, the data provided in the CostSpec must</span>
<span class="sd">    unambiguously provide a way to compute the cost amount.</span>

<span class="sd">    This essentially replicates the way the old parser used to work, but</span>
<span class="sd">    allowing positions to have the fuzzy lot specifications instead of the</span>
<span class="sd">    resolved ones. We used to simply compute the costs locally, and this gets</span>
<span class="sd">    rid of the CostSpec to produce the Cost without fuzzy matching. This is only</span>
<span class="sd">    there for the sake of transition to the new matching logic.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of incomplete directives as per the parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries whose postings's position costs have been converted to</span>
<span class="sd">      Cost instances but that may still be incomplete.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If there's a unacceptable number.</span>
<span class="sd">    """</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">new_postings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost_spec</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">convert_spec_to_cost</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cost_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">BookingTestError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                         <span class="s2">"Cost syntax not supported; cost spec ignored"</span><span class="p">,</span>
                                         <span class="kc">None</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">cost</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Amount</span><span class="p">):</span>
                    <span class="c1"># If there is a cost, we don't allow either a cost value of</span>
                    <span class="c1"># zero, nor a zero number of units. Note that we allow a price</span>
                    <span class="c1"># of zero as the only special case (for conversion entries), but</span>
                    <span class="c1"># never for costs.</span>
                    <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Amount is zero: "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Cost is negative: "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BookingTestError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">new_postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">))</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">postings</span><span class="o">=</span><span class="n">new_postings</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_entries</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.booking_test.convert_spec_to_cost">
<code class="highlight language-python">
convert_spec_to_cost<span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.booking_test.convert_spec_to_cost" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a posting's CostSpec instance to a Cost.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>units</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_spec</code></td>
<td><code></code></td>
<td>
<p>An instance of CostSpec.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Cost.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/booking_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_spec_to_cost</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_spec</span><span class="p">):</span>
    <span class="sd">"""Convert a posting's CostSpec instance to a Cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      units: An instance of Amount.</span>
<span class="sd">      cost_spec: An instance of CostSpec.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Cost.</span>
<span class="sd">    """</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">cost_spec</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Amount</span><span class="p">):</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="k">if</span> <span class="n">cost_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">merge</span> <span class="o">=</span> <span class="n">cost_spec</span>

            <span class="c1"># Compute the cost.</span>
            <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Compute the per-unit cost if there is some total cost</span>
                    <span class="c1"># component involved.</span>
                    <span class="n">units_num</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
                    <span class="n">cost_total</span> <span class="o">=</span> <span class="n">number_total</span>
                    <span class="k">if</span> <span class="n">number_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
                        <span class="n">cost_total</span> <span class="o">+=</span> <span class="n">number_per</span> <span class="o">*</span> <span class="n">units_num</span>
                    <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">units_num</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit_cost</span> <span class="o">=</span> <span class="n">number_per</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">cost</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.cmptest">
<code>cmptest</code>
<a class="headerlink" href="#beancount.parser.cmptest" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Support utillities for testing scripts.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.cmptest.TestError">
<code>TestError</code>
<a class="headerlink" href="#beancount.parser.cmptest.TestError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Errors within the test implementation itself. These should never occur.</p>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.cmptest.assertEqualEntries">
<code class="highlight language-python">
assertEqualEntries<span class="p">(</span><span class="n">expected_entries</span><span class="p">,</span> <span class="n">actual_entries</span><span class="p">,</span> <span class="n">failfunc</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">fail</span> <span class="n">at</span> <span class="mh">0x7f0314da40d0</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.cmptest.assertEqualEntries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compare two lists of entries exactly and print missing entries verbosely if
they occur.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expected_entries</code></td>
<td><code></code></td>
<td>
<p>Either a list of directives or a string, in which case the
string is run through beancount.parser.parse_string() and the resulting
list is used.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>actual_entries</code></td>
<td><code></code></td>
<td>
<p>Same treatment as expected_entries, the other list of
directives to compare to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>failfunc</code></td>
<td><code></code></td>
<td>
<p>A function to call on failure.</p>
</td>
<td><code>&lt;function fail at 0x7f0314da40d0&gt;</code></td>
</tr>
<tr>
<td><code>allow_incomplete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we allow incomplete inputs and perform
light-weight booking.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the exception fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertEqualEntries</span><span class="p">(</span><span class="n">expected_entries</span><span class="p">,</span> <span class="n">actual_entries</span><span class="p">,</span>
                       <span class="n">failfunc</span><span class="o">=</span><span class="n">DEFAULT_FAILFUNC</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Compare two lists of entries exactly and print missing entries verbosely if</span>
<span class="sd">    they occur.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected_entries: Either a list of directives or a string, in which case the</span>
<span class="sd">        string is run through beancount.parser.parse_string() and the resulting</span>
<span class="sd">        list is used.</span>
<span class="sd">      actual_entries: Same treatment as expected_entries, the other list of</span>
<span class="sd">        directives to compare to.</span>
<span class="sd">      failfunc: A function to call on failure.</span>
<span class="sd">      allow_incomplete: A boolean, true if we allow incomplete inputs and perform</span>
<span class="sd">        light-weight booking.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>
<span class="sd">    """</span>
    <span class="n">expected_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">expected_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">actual_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">actual_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>

    <span class="n">same</span><span class="p">,</span> <span class="n">expected_missing</span><span class="p">,</span> <span class="n">actual_missing</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">compare_entries</span><span class="p">(</span><span class="n">expected_entries</span><span class="p">,</span>
                                                                     <span class="n">actual_entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">same</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">expected_missing</span> <span class="ow">or</span> <span class="n">actual_missing</span><span class="p">,</span> <span class="s2">"Missing is missing: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">expected_missing</span><span class="p">,</span> <span class="n">actual_missing</span><span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">expected_missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Present in expected set and not in actual set:</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">expected_missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual_missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Present in actual set and not in expected set:</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">actual_missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">failfunc</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.cmptest.assertExcludesEntries">
<code class="highlight language-python">
assertExcludesEntries<span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">failfunc</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">fail</span> <span class="n">at</span> <span class="mh">0x7f0314da40d0</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.cmptest.assertExcludesEntries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that subset_entries is not included in entries and print extra entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>subset_entries</code></td>
<td><code></code></td>
<td>
<p>Either a list of directives or a string, in which case the
string is run through beancount.parser.parse_string() and the resulting
list is used.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>Same treatment as subset_entries, the other list of
directives to compare to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>failfunc</code></td>
<td><code></code></td>
<td>
<p>A function to call on failure.</p>
</td>
<td><code>&lt;function fail at 0x7f0314da40d0&gt;</code></td>
</tr>
<tr>
<td><code>allow_incomplete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we allow incomplete inputs and perform
light-weight booking.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the exception fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertExcludesEntries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span>
                          <span class="n">failfunc</span><span class="o">=</span><span class="n">DEFAULT_FAILFUNC</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Check that subset_entries is not included in entries and print extra entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: Either a list of directives or a string, in which case the</span>
<span class="sd">        string is run through beancount.parser.parse_string() and the resulting</span>
<span class="sd">        list is used.</span>
<span class="sd">      entries: Same treatment as subset_entries, the other list of</span>
<span class="sd">        directives to compare to.</span>
<span class="sd">      failfunc: A function to call on failure.</span>
<span class="sd">      allow_incomplete: A boolean, true if we allow incomplete inputs and perform</span>
<span class="sd">        light-weight booking.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>
<span class="sd">    """</span>
    <span class="n">subset_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="n">excludes</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">excludes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">excludes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">extra</span><span class="p">,</span> <span class="s2">"Extra is empty: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Extra from from first/excluded set:</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">failfunc</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.cmptest.assertIncludesEntries">
<code class="highlight language-python">
assertIncludesEntries<span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">failfunc</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">fail</span> <span class="n">at</span> <span class="mh">0x7f0314da40d0</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.cmptest.assertIncludesEntries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that subset_entries is included in entries and print missing entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>subset_entries</code></td>
<td><code></code></td>
<td>
<p>Either a list of directives or a string, in which case the
string is run through beancount.parser.parse_string() and the resulting
list is used.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>Same treatment as subset_entries, the other list of
directives to compare to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>failfunc</code></td>
<td><code></code></td>
<td>
<p>A function to call on failure.</p>
</td>
<td><code>&lt;function fail at 0x7f0314da40d0&gt;</code></td>
</tr>
<tr>
<td><code>allow_incomplete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we allow incomplete inputs and perform
light-weight booking.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the exception fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertIncludesEntries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span>
                          <span class="n">failfunc</span><span class="o">=</span><span class="n">DEFAULT_FAILFUNC</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Check that subset_entries is included in entries and print missing entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: Either a list of directives or a string, in which case the</span>
<span class="sd">        string is run through beancount.parser.parse_string() and the resulting</span>
<span class="sd">        list is used.</span>
<span class="sd">      entries: Same treatment as subset_entries, the other list of</span>
<span class="sd">        directives to compare to.</span>
<span class="sd">      failfunc: A function to call on failure.</span>
<span class="sd">      allow_incomplete: A boolean, true if we allow incomplete inputs and perform</span>
<span class="sd">        light-weight booking.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the exception fails.</span>
<span class="sd">    """</span>
    <span class="n">subset_entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">read_string_or_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="n">includes</span><span class="p">,</span> <span class="n">missing</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">includes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">includes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">missing</span><span class="p">,</span> <span class="s2">"Missing is empty: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Missing from from expected set:</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">failfunc</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.cmptest.read_string_or_entries">
<code class="highlight language-python">
read_string_or_entries<span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.cmptest.read_string_or_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Read a string of entries or just entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries_or_str</code></td>
<td><code></code></td>
<td>
<p>Either a list of directives, or a string containing directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>allow_incomplete</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we allow incomplete inputs and perform
light-weight booking.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/cmptest.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">read_string_or_entries</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Read a string of entries or just entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries_or_str: Either a list of directives, or a string containing directives.</span>
<span class="sd">      allow_incomplete: A boolean, true if we allow incomplete inputs and perform</span>
<span class="sd">        light-weight booking.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span>
            <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">allow_incomplete</span><span class="p">:</span>
            <span class="c1"># Do a simplistic local conversion in order to call the comparison.</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">_local_booking</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Don't accept incomplete entries either.</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">"Entries in assertions may not use interpolation."</span><span class="p">)</span>

            <span class="n">entries</span><span class="p">,</span> <span class="n">booking_errors</span> <span class="o">=</span> <span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span> <span class="o">+</span> <span class="n">booking_errors</span>

        <span class="c1"># Don't tolerate errors.</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TestError</span><span class="p">(</span><span class="s2">"Unexpected errors in expected: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Expecting list: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entries_or_str</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entries_or_str</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.cmptest_test">
<code>cmptest_test</code>
<a class="headerlink" href="#beancount.parser.cmptest_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for cmptest base test class.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.cmptest_test.TestTestCase">
<code>TestTestCase</code>
<a class="headerlink" href="#beancount.parser.cmptest_test.TestTestCase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.cmptest_test.TestTestCase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.cmptest_test.TestTestCase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/cmptest_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>101
102
103
104
105</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">parse_errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ledger_text</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="n">booking_errors</span> <span class="o">=</span> <span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">parse_errors</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">booking_errors</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.grammar">
<code>grammar</code>
<a class="headerlink" href="#beancount.parser.grammar" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Builder for Beancount grammar.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.Builder">
<code>Builder</code>
<a class="headerlink" href="#beancount.parser.grammar.Builder" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A builder used by the lexer and grammar parser as callbacks to create
    the data objects corresponding to rules parsed from the input file.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.amount">
<code class="highlight language-python">
amount<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.amount" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an amount grammar rule.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>a Decimal instance, the number of the amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>a currency object (a str, really, see CURRENCY above)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>412
413
414
415
416
417
418
419
420
421
422
423
424</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Process an amount grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: a Decimal instance, the number of the amount.</span>
<span class="sd">      currency: a currency object (a str, really, see CURRENCY above)</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount.</span>
<span class="sd">    """</span>
    <span class="c1"># Update the mapping that stores the parsed precisions.</span>
    <span class="c1"># Note: This is relatively slow, adds about 70ms because of number.as_tuple().</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dcupdate</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.balance">
<code class="highlight language-python">
balance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.balance" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an assertion directive.</p>
<p>We produce no errors here by default. We replace the failing ones in the
routine that does the verification later one, that these have succeeded
or failed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to balance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>The expected amount, to be checked.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tolerance</code></td>
<td><code></code></td>
<td>
<p>The tolerance number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Balance object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process an assertion directive.</span>

<span class="sd">    We produce no errors here by default. We replace the failing ones in the</span>
<span class="sd">    routine that does the verification later one, that these have succeeded</span>
<span class="sd">    or failed.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to balance.</span>
<span class="sd">      amount: The expected amount, to be checked.</span>
<span class="sd">      tolerance: The tolerance number.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Balance object.</span>
<span class="sd">    """</span>
    <span class="n">diff_amount</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Balance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">diff_amount</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.build_grammar_error">
<code class="highlight language-python">
build_grammar_error<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.build_grammar_error" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Build a grammar error and appends it to the list of pending errors.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>excvalue</code></td>
<td><code></code></td>
<td>
<p>The exception value, or a str, the message of the error.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>exc_type</code></td>
<td><code></code></td>
<td>
<p>An exception type, if an exception occurred.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>exc_traceback</code></td>
<td><code></code></td>
<td>
<p>A traceback object.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build_grammar_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span>
                        <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Build a grammar error and appends it to the list of pending errors.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename</span>
<span class="sd">      lineno: The current line number</span>
<span class="sd">      excvalue: The exception value, or a str, the message of the error.</span>
<span class="sd">      exc_type: An exception type, if an exception occurred.</span>
<span class="sd">      exc_traceback: A traceback object.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="n">tblist</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">exc_traceback</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">tblist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_value</span><span class="p">)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">ParserSyntaxError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.close">
<code class="highlight language-python">
close<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.close" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a close directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Close object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>587
588
589
590
591
592
593
594
595
596
597
598
599
600</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a close directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the name of the account.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Close object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Close</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.commodity">
<code class="highlight language-python">
commodity<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.commodity" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a close directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the commodity being declared.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Close object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>602
603
604
605
606
607
608
609
610
611
612
613
614
615</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a close directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      currency: A string, the commodity being declared.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Close object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Commodity</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.compound_amount">
<code class="highlight language-python">
compound_amount<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.compound_amount" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an amount grammar rule.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number_per</code></td>
<td><code></code></td>
<td>
<p>a Decimal instance, the number of the cost per share.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number_total</code></td>
<td><code></code></td>
<td>
<p>a Decimal instance, the number of the cost over all shares.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>a currency object (a str, really, see CURRENCY above)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triple of (Decimal, Decimal, currency string) to be processed further when
creating the final per-unit cost number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compound_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Process an amount grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      number_per: a Decimal instance, the number of the cost per share.</span>
<span class="sd">      number_total: a Decimal instance, the number of the cost over all shares.</span>
<span class="sd">      currency: a currency object (a str, really, see CURRENCY above)</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (Decimal, Decimal, currency string) to be processed further when</span>
<span class="sd">      creating the final per-unit cost number.</span>
<span class="sd">    """</span>
    <span class="c1"># Update the mapping that stores the parsed precisions.</span>
    <span class="c1"># Note: This is relatively slow, adds about 70ms because of number.as_tuple().</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dcupdate</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dcupdate</span><span class="p">(</span><span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

    <span class="c1"># Note that we are not able to reduce the value to a number per-share</span>
    <span class="c1"># here because we only get the number of units in the full lot spec.</span>
    <span class="k">return</span> <span class="n">CompoundAmount</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.cost_merge">
<code class="highlight language-python">
cost_merge<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.cost_merge" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a 'merge cost' token.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>446
447
448</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cost_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Create a 'merge cost' token."""</span>
    <span class="k">return</span> <span class="n">MERGE_COST</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.cost_spec">
<code class="highlight language-python">
cost_spec<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost_comp_list</span><span class="p">,</span> <span class="n">is_total</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.cost_spec" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a cost_spec grammar rule.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cost_comp_list</code></td>
<td><code></code></td>
<td>
<p>A list of CompoundAmount, a datetime.date, or
label ID strings.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>is_total</code></td>
<td><code></code></td>
<td>
<p>Assume only the total cost is specified; reject the &lt;number&gt; # &lt;number&gt;
  syntax, that is, no compound amounts may be specified. This is used to support
  the {{...}} syntax.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A cost-info tuple of CompoundAmount, lot date and label string. Any of these
may be set to a sentinel indicating "unset".</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cost_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost_comp_list</span><span class="p">,</span> <span class="n">is_total</span><span class="p">):</span>
    <span class="sd">"""Process a cost_spec grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      cost_comp_list: A list of CompoundAmount, a datetime.date, or</span>
<span class="sd">        label ID strings.</span>
<span class="sd">      is_total: Assume only the total cost is specified; reject the &lt;number&gt; # &lt;number&gt;</span>
<span class="sd">          syntax, that is, no compound amounts may be specified. This is used to support</span>
<span class="sd">          the {{...}} syntax.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A cost-info tuple of CompoundAmount, lot date and label string. Any of these</span>
<span class="sd">      may be set to a sentinel indicating "unset".</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cost_comp_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CostSpec</span><span class="p">(</span><span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_comp_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Internal error in parser: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_comp_list</span><span class="p">))</span>

    <span class="n">compound_cost</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">cost_comp_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">CompoundAmount</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">compound_cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compound_cost</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                                <span class="s2">"Duplicate cost: '</span><span class="si">{}</span><span class="s2">'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">date_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">date_</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                                <span class="s2">"Duplicate date: '</span><span class="si">{}</span><span class="s2">'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">comp</span> <span class="ow">is</span> <span class="n">MERGE_COST</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">merge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">merge</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                                <span class="s2">"Cost merging is not supported yet"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                                <span class="s2">"Duplicate merge-cost spec"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">"Currency component is not string: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                                <span class="s2">"Duplicate label: '</span><span class="si">{}</span><span class="s2">'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># If there was a cost_comp_list, thus a "{...}" cost basis spec, you must</span>
    <span class="c1"># indicate that by creating a CompoundAmount(), always.</span>

    <span class="k">if</span> <span class="n">compound_cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MISSING</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">compound_cost</span>
        <span class="k">if</span> <span class="n">is_total</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                        <span class="p">(</span><span class="s2">"Per-unit cost may not be specified using total cost "</span>
                         <span class="s2">"syntax: '</span><span class="si">{}</span><span class="s2">'; ignoring per-unit cost"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compound_cost</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">))</span>
                <span class="c1"># Ignore per-unit number.</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="n">ZERO</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># There's a single number specified; interpret it as a total cost.</span>
                <span class="n">number_total</span> <span class="o">=</span> <span class="n">number_per</span>
                <span class="n">number_per</span> <span class="o">=</span> <span class="n">ZERO</span>

    <span class="k">if</span> <span class="n">merge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">merge</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">CostSpec</span><span class="p">(</span><span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">date_</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">merge</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.custom">
<code class="highlight language-python">
custom<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.custom" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a custom directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dir_type</code></td>
<td><code></code></td>
<td>
<p>A string, a type for the custom directive being parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>custom_values</code></td>
<td><code></code></td>
<td>
<p>A list of the various tokens seen on the same line.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Custom object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>741
742
743
744
745
746
747
748
749
750
751
752
753
754
755</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a custom directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      dir_type: A string, a type for the custom directive being parsed.</span>
<span class="sd">      custom_values: A list of the various tokens seen on the same line.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Custom object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Custom</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dir_type</span><span class="p">,</span> <span class="n">custom_values</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.custom_value">
<code class="highlight language-python">
custom_value<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.custom_value" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a custom value object, along with its type.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>One of the accepted custom values.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (value, dtype) where 'dtype' is the datatype is that of the
value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>757
758
759
760
761
762
763
764
765
766
767
768</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">custom_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a custom value object, along with its type.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: One of the accepted custom values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (value, dtype) where 'dtype' is the datatype is that of the</span>
<span class="sd">      value.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ValueType</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.dcupdate">
<code class="highlight language-python">
dcupdate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.dcupdate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Update the display context.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>141
142
143
144</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dcupdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Update the display context."""</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">and</span> <span class="n">currency</span> <span class="ow">and</span> <span class="n">currency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dcupdate</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.document">
<code class="highlight language-python">
document<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.document" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a document directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>an Account instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>document_filename</code></td>
<td><code></code></td>
<td>
<p>a str, the name of the document file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tags_links</code></td>
<td><code></code></td>
<td>
<p>The current TagsLinks accumulator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Document object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span>
             <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      account: an Account instance.</span>
<span class="sd">      document_filename: a str, the name of the document file.</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Document object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">document_filename</span><span class="p">):</span>
        <span class="n">document_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                                                   <span class="n">document_filename</span><span class="p">))</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_tags_links</span><span class="p">(</span><span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">document_filename</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.event">
<code class="highlight language-python">
event<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.event" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an event directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>event_type</code></td>
<td><code></code></td>
<td>
<p>a str, the name of the event type.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>description</code></td>
<td><code></code></td>
<td>
<p>a str, the event value, the contents.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Event object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>655
656
657
658
659
660
661
662
663
664
665
666
667
668
669</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process an event directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      event_type: a str, the name of the event type.</span>
<span class="sd">      description: a str, the event value, the contents.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Event object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Event</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.finalize">
<code class="highlight language-python">
finalize<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.finalize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Finalize the parser, check for final errors and return the triple.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A triple of
  entries</code></td>
<td>
<p>A list of parsed directives, which may need completion.
  errors: A list of errors, hopefully empty.
  options_map: A dict of options.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Finalize the parser, check for final errors and return the triple.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of</span>
<span class="sd">        entries: A list of parsed directives, which may need completion.</span>
<span class="sd">        errors: A list of errors, hopefully empty.</span>
<span class="sd">        options_map: A dict of options.</span>
<span class="sd">    """</span>
    <span class="c1"># If the user left some tags unbalanced, issue an error.</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Unbalanced pushed tag: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># If the user left some metadata unpopped, issue an error.</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Unbalanced metadata key '</span><span class="si">{}</span><span class="s2">'; leftover metadata '</span><span class="si">{}</span><span class="s2">'"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value_list</span><span class="p">)),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Weave the commas option in the DisplayContext itself, so it propagates</span>
    <span class="c1"># everywhere it is used automatically.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span><span class="o">.</span><span class="n">set_commas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'render_commas'</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.finalize_tags_links">
<code class="highlight language-python">
finalize_tags_links<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.finalize_tags_links" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Finally amend tags and links and return final objects to be inserted.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tags</code></td>
<td><code></code></td>
<td>
<p>A set of tag strings (warning: this gets mutated in-place).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>links</code></td>
<td><code></code></td>
<td>
<p>A set of link strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A sanitized pair of (tags, links).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>912
913
914
915
916
917
918
919
920
921
922
923
924</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">finalize_tags_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">):</span>
    <span class="sd">"""Finally amend tags and links and return final objects to be inserted.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags: A set of tag strings (warning: this gets mutated in-place).</span>
<span class="sd">      links: A set of link strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A sanitized pair of (tags, links).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="n">tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="k">if</span> <span class="n">tags</span> <span class="k">else</span> <span class="n">EMPTY_SET</span><span class="p">,</span>
            <span class="nb">frozenset</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="k">if</span> <span class="n">links</span> <span class="k">else</span> <span class="n">EMPTY_SET</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.get_entries">
<code class="highlight language-python">
get_entries<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.get_entries" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the accumulated entries.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of sorted directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>175
176
177
178
179
180
181</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the accumulated entries.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of sorted directives.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">entry_sortkey</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.get_invalid_account">
<code class="highlight language-python">
get_invalid_account<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.get_invalid_account" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>See base class.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>206
207
208</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_invalid_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""See base class."""</span>
    <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'name_equity'</span><span class="p">],</span> <span class="s1">'InvalidAccountName'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.get_long_string_maxlines">
<code class="highlight language-python">
get_long_string_maxlines<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.get_long_string_maxlines" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>See base class.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>210
211
212</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_long_string_maxlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""See base class."""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'long_string_maxlines'</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.get_options">
<code class="highlight language-python">
get_options<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.get_options" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the final options map.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of option names to options.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the final options map.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A dict of option names to options.</span>
<span class="sd">    """</span>
    <span class="c1"># Build and store the inferred DisplayContext instance.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span>

    <span class="c1"># Add the full list of seen commodities.</span>
    <span class="c1">#</span>
    <span class="c1"># IMPORTANT: This is currently where the list of all commodities seen</span>
    <span class="c1"># from the parser lives. The</span>
    <span class="c1"># beancount.core.getters.get_commodities_map() routine uses this to</span>
    <span class="c1"># automatically generate a full list of directives. An alternative would</span>
    <span class="c1"># be to implement a plugin that enforces the generate of these</span>
    <span class="c1"># post-parsing so that they are always guaranteed to live within the</span>
    <span class="c1"># flow of entries. This would allow us to keep all the data in that list</span>
    <span class="c1"># of entries and to avoid depending on the options to store that output.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'commodities'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commodities</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.handle_list">
<code class="highlight language-python">
handle_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="n">new_object</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.handle_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handle a recursive list grammar rule, generically.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>object_list</code></td>
<td><code></code></td>
<td>
<p>the current list of objects.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>new_object</code></td>
<td><code></code></td>
<td>
<p>the new object to be added.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new, updated list of objects.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>537
538
539
540
541
542
543
544
545
546
547
548
549
550</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">handle_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="n">new_object</span><span class="p">):</span>
    <span class="sd">"""Handle a recursive list grammar rule, generically.</span>

<span class="sd">    Args:</span>
<span class="sd">      object_list: the current list of objects.</span>
<span class="sd">      new_object: the new object to be added.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new, updated list of objects.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">object_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">new_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_object</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">object_list</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.include">
<code class="highlight language-python">
include<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">include_filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.include" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an include directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>include_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to include.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>390
391
392
393
394
395
396
397
398</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">include_filename</span><span class="p">):</span>
    <span class="sd">"""Process an include directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      include_name: A string, the name of the file to include.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'include'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">include_filename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.key_value">
<code class="highlight language-python">
key_value<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.key_value" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a document directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account the document relates to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>document_filename</code></td>
<td><code></code></td>
<td>
<p>A str, the name of the document file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new KeyValue object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>770
771
772
773
774
775
776
777
778
779
780
781
782</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">key_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account the document relates to.</span>
<span class="sd">      document_filename: A str, the name of the document file.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new KeyValue object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">KeyValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.note">
<code class="highlight language-python">
note<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.note" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a note directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to attach the note to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>comment</code></td>
<td><code></code></td>
<td>
<p>A str, the note's comments contents.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Note object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>703
704
705
706
707
708
709
710
711
712
713
714
715
716
717</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">note</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a note directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to attach the note to.</span>
<span class="sd">      comment: A str, the note's comments contents.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Note object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Note</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.open">
<code class="highlight language-python">
open<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking_str</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.open" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an open directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currencies</code></td>
<td><code></code></td>
<td>
<p>A list of constraint currencies.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>booking_str</code></td>
<td><code></code></td>
<td>
<p>A string, the booking method, or None if none was specified.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Open object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking_str</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process an open directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the name of the account.</span>
<span class="sd">      currencies: A list of constraint currencies.</span>
<span class="sd">      booking_str: A string, the booking method, or None if none was specified.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Open object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">booking_str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Note: Somehow the 'in' membership operator is not defined on Enum.</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="p">[</span><span class="n">booking_str</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If the per-account method is invalid, set it to the global</span>
            <span class="c1"># default method and continue.</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'booking_method'</span><span class="p">]</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">booking</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">entry</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span>
                                       <span class="s2">"Invalid booking method: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">booking_str</span><span class="p">),</span>
                                       <span class="n">entry</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">entry</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.option">
<code class="highlight language-python">
option<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.option" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an option directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>option's key (str)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>option's value</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Process an option directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      key: option's key (str)</span>
<span class="sd">      value: option's value</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Invalid option: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">READ_ONLY_OPTIONS</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Option '</span><span class="si">{}</span><span class="s2">' may not be set"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">option_descriptor</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Issue a warning if the option is deprecated.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Internal error."</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">DeprecatedError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Rename the option if it has an alias.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">alias</span>
            <span class="n">option_descriptor</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Convert the value, if necessary.</span>
        <span class="k">if</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">converter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">option_descriptor</span><span class="o">.</span><span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span>
                                <span class="s2">"Error for option '</span><span class="si">{}</span><span class="s2">': </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">exc</span><span class="p">),</span>
                                <span class="kc">None</span><span class="p">))</span>
                <span class="k">return</span>

        <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># Append to a list of values.</span>
            <span class="n">option</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Set to a dict of values.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span> <span class="s2">"Error for option '</span><span class="si">{}</span><span class="s2">': </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="n">dict_key</span><span class="p">,</span> <span class="n">dict_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">option</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_value</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="c1"># Convert to a boolean.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'true'</span><span class="p">,</span> <span class="s1">'on'</span><span class="p">})</span> <span class="ow">or</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set the value.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Refresh the list of valid account regexps as we go along.</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'name_'</span><span class="p">):</span>
            <span class="c1"># Update the set of valid account types.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account_regexp</span> <span class="o">=</span> <span class="n">valid_account_regexp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'insert_pythonpath'</span><span class="p">:</span>
            <span class="c1"># Insert the PYTHONPATH to this file when and only if you</span>
            <span class="c1"># encounter this option.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.pad">
<code class="highlight language-python">
pad<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.pad" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a pad directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to be padded.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>source_account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to pad from.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Pad object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>617
618
619
620
621
622
623
624
625
626
627
628
629
630
631</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a pad directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename.</span>
<span class="sd">      lineno: The current line number.</span>
<span class="sd">      date: A datetime object.</span>
<span class="sd">      account: A string, the account to be padded.</span>
<span class="sd">      source_account: A string, the account to pad from.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Pad object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pad</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.pipe_deprecated_error">
<code class="highlight language-python">
pipe_deprecated_error<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.pipe_deprecated_error" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Issue a 'Pipe deprecated' error.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>The current filename</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>The current line number</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>246
247
248
249
250
251
252
253
254
255
256
257</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pipe_deprecated_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
    <span class="sd">"""Issue a 'Pipe deprecated' error.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: The current filename</span>
<span class="sd">      lineno: The current line number</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'allow_pipe_separator'</span><span class="p">]:</span>
        <span class="k">return</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">ParserSyntaxError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Pipe symbol is deprecated."</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.plugin">
<code class="highlight language-python">
plugin<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.plugin" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a plugin directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>plugin_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the plugin module to import.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>plugin_config</code></td>
<td><code></code></td>
<td>
<p>A string or None, an optional configuration string to
pass in to the plugin module.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405
406
407
408
409
410</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">):</span>
    <span class="sd">"""Process a plugin directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: current filename.</span>
<span class="sd">      lineno: current line number.</span>
<span class="sd">      plugin_name: A string, the name of the plugin module to import.</span>
<span class="sd">      plugin_config: A string or None, an optional configuration string to</span>
<span class="sd">        pass in to the plugin module.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'plugin'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.popmeta">
<code class="highlight language-python">
popmeta<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.popmeta" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Removed a key off the current set of stacks.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A string, a key to be removed from the meta dict.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">popmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""Removed a key off the current set of stacks.</span>

<span class="sd">    Args:</span>
<span class="sd">      key: A string, a key to be removed from the meta dict.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>
        <span class="n">value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">value_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Attempting to pop absent metadata key: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                        <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.poptag">
<code class="highlight language-python">
poptag<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.poptag" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Pop a tag off the current set of stacks.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tag</code></td>
<td><code></code></td>
<td>
<p>A string, a tag to be removed from the current set of tags.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>269
270
271
272
273
274
275
276
277
278
279
280</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">poptag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">"""Pop a tag off the current set of stacks.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag: A string, a tag to be removed from the current set of tags.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Attempting to pop absent tag: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.posting">
<code class="highlight language-python">
posting<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">istotal</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.posting" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a posting grammar rule.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account of the posting.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>units</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount for the units.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost</code></td>
<td><code></code></td>
<td>
<p>An instance of CostSpec for the cost.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price</code></td>
<td><code></code></td>
<td>
<p>Either None, or an instance of Amount that is the cost of the position.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>istotal</code></td>
<td><code></code></td>
<td>
<p>A bool, True if the price is for the total amount being parsed, or
       False if the price is for each lot of the position.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>flag</code></td>
<td><code></code></td>
<td>
<p>A string, one-character, the flag associated with this posting.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Posting object, with no parent entry.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">posting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">istotal</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
    <span class="sd">"""Process a posting grammar rule.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      account: A string, the account of the posting.</span>
<span class="sd">      units: An instance of Amount for the units.</span>
<span class="sd">      cost: An instance of CostSpec for the cost.</span>
<span class="sd">      price: Either None, or an instance of Amount that is the cost of the position.</span>
<span class="sd">      istotal: A bool, True if the price is for the total amount being parsed, or</span>
<span class="sd">               False if the price is for each lot of the position.</span>
<span class="sd">      flag: A string, one-character, the flag associated with this posting.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Posting object, with no parent entry.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>

    <span class="c1"># Prices may not be negative.</span>
    <span class="k">if</span> <span class="n">price</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">and</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Negative prices are not allowed: </span><span class="si">{}</span><span class="s2"> "</span>
                <span class="s2">"(see http://furius.ca/beancount/doc/bug-negative-prices "</span>
                <span class="s2">"for workaround)"</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># Fix it and continue.</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="c1"># If the price is specified for the entire amount, compute the effective</span>
    <span class="c1"># price here and forget about that detail of the input syntax.</span>
    <span class="k">if</span> <span class="n">istotal</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">ZERO</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="c1"># Note: Allow zero prices because we need them for round-trips for</span>
    <span class="c1"># conversion entries.</span>
    <span class="c1">#</span>
    <span class="c1"># if price is not None and price.number == ZERO:</span>
    <span class="c1">#     self.errors.append(</span>
    <span class="c1">#         ParserError(meta, "Price is zero: {}".format(price), None))</span>

    <span class="c1"># If both cost and price are specified, the currencies must match, or</span>
    <span class="c1"># that is an error.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
        <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Cost and price currencies must match: </span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">Posting</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.price">
<code class="highlight language-python">
price<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.price" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a price directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>the currency to be priced.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>an instance of Amount, that is the price of the currency.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Price object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>687
688
689
690
691
692
693
694
695
696
697
698
699
700
701</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a price directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      currency: the currency to be priced.</span>
<span class="sd">      amount: an instance of Amount, that is the price of the currency.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Price object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Price</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.pushmeta">
<code class="highlight language-python">
pushmeta<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.pushmeta" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Set a metadata field on the current key-value pairs to be added to transactions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key_value</code></td>
<td><code></code></td>
<td>
<p>A KeyValue instance, to be added to the dict of metadata.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>282
283
284
285
286
287
288</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pushmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Set a metadata field on the current key-value pairs to be added to transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      key_value: A KeyValue instance, to be added to the dict of metadata.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.pushtag">
<code class="highlight language-python">
pushtag<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.pushtag" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Push a tag on the current set of tags.</p>
<p>Note that this does not need to be stack ordered.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tag</code></td>
<td><code></code></td>
<td>
<p>A string, a tag to be added.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>259
260
261
262
263
264
265
266
267</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pushtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">"""Push a tag on the current set of tags.</span>

<span class="sd">    Note that this does not need to be stack ordered.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag: A string, a tag to be added.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.query">
<code class="highlight language-python">
query<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.query" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a document directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>query_name</code></td>
<td><code></code></td>
<td>
<p>a str, the name of the query.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>query_string</code></td>
<td><code></code></td>
<td>
<p>a str, the SQL query itself.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>a list of KeyValue instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Query object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>671
672
673
674
675
676
677
678
679
680
681
682
683
684
685</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">):</span>
    <span class="sd">"""Process a document directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      query_name: a str, the name of the query.</span>
<span class="sd">      query_string: a str, the SQL query itself.</span>
<span class="sd">      kvlist: a list of KeyValue instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Query object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Query</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.store_result">
<code class="highlight language-python">
store_result<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.store_result" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Start rule stores the final result here.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries to store.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>214
215
216
217
218
219
220
221</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">store_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Start rule stores the final result here.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries to store.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.tag_link_LINK">
<code class="highlight language-python">
tag_link_LINK<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.tag_link_LINK" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add a link to the TagsLinks accumulator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tags_links</code></td>
<td><code></code></td>
<td>
<p>The current TagsLinks accumulator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>link</code></td>
<td><code></code></td>
<td>
<p>A string, the new link to insert.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An updated TagsLinks instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>863
864
865
866
867
868
869
870
871
872
873</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_LINK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">link</span><span class="p">):</span>
    <span class="sd">"""Add a link to the TagsLinks accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      link: A string, the new link to insert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An updated TagsLinks instance.</span>
<span class="sd">    """</span>
    <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tags_links</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.tag_link_new">
<code class="highlight language-python">
tag_link_new<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.tag_link_new" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new TagsLinks instance.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of TagsLinks, initialized with expected attributes.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>843
844
845
846
847
848
849</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Create a new TagsLinks instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of TagsLinks, initialized with expected attributes.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">TagsLinks</span><span class="p">(</span><span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.tag_link_STRING">
<code class="highlight language-python">
tag_link_STRING<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.tag_link_STRING" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add a string to the TagsLinks accumulator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tags_links</code></td>
<td><code></code></td>
<td>
<p>The current TagsLinks accumulator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string, the new string to insert in the list.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An updated TagsLinks instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>875
876
877
878
879
880
881
882
883
884
885</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_STRING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Add a string to the TagsLinks accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      string: A string, the new string to insert in the list.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An updated TagsLinks instance.</span>
<span class="sd">    """</span>
    <span class="n">tags_links</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tags_links</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.tag_link_TAG">
<code class="highlight language-python">
tag_link_TAG<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.tag_link_TAG" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add a tag to the TagsLinks accumulator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tags_links</code></td>
<td><code></code></td>
<td>
<p>The current TagsLinks accumulator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tag</code></td>
<td><code></code></td>
<td>
<p>A string, the new tag to insert.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An updated TagsLinks instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>851
852
853
854
855
856
857
858
859
860
861</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tag_link_TAG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">"""Add a tag to the TagsLinks accumulator.</span>

<span class="sd">    Args:</span>
<span class="sd">      tags_links: The current TagsLinks accumulator.</span>
<span class="sd">      tag: A string, the new tag to insert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An updated TagsLinks instance.</span>
<span class="sd">    """</span>
    <span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tags_links</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.transaction">
<code class="highlight language-python">
transaction<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span> <span class="n">posting_or_kv_list</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.transaction" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a transaction directive.</p>
<p>All the postings of the transaction are available at this point, and so the
the transaction is balanced here, incomplete postings are completed with the
appropriate position, and errors are being accumulated on the builder to be
reported later on.</p>
<p>This is the main routine that takes up most of the parsing time; be very
careful with modifications here, they have an impact on performance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the current filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>the current line number.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>a datetime object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>flag</code></td>
<td><code></code></td>
<td>
<p>a str, one-character, the flag associated with this transaction.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>txn_strings</code></td>
<td><code></code></td>
<td>
<p>A list of strings, possibly empty, possibly longer.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tags_links</code></td>
<td><code></code></td>
<td>
<p>A TagsLinks namedtuple of tags, and/or links.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>posting_or_kv_list</code></td>
<td><code></code></td>
<td>
<p>a list of Posting or KeyValue instances, to be inserted in
this transaction, or None, if no postings have been declared.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new Transaction object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 926
 927
 928
 929
 930
 931
 932
 933
 934
 935
 936
 937
 938
 939
 940
 941
 942
 943
 944
 945
 946
 947
 948
 949
 950
 951
 952
 953
 954
 955
 956
 957
 958
 959
 960
 961
 962
 963
 964
 965
 966
 967
 968
 969
 970
 971
 972
 973
 974
 975
 976
 977
 978
 979
 980
 981
 982
 983
 984
 985
 986
 987
 988
 989
 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">tags_links</span><span class="p">,</span>
                <span class="n">posting_or_kv_list</span><span class="p">):</span>
    <span class="sd">"""Process a transaction directive.</span>

<span class="sd">    All the postings of the transaction are available at this point, and so the</span>
<span class="sd">    the transaction is balanced here, incomplete postings are completed with the</span>
<span class="sd">    appropriate position, and errors are being accumulated on the builder to be</span>
<span class="sd">    reported later on.</span>

<span class="sd">    This is the main routine that takes up most of the parsing time; be very</span>
<span class="sd">    careful with modifications here, they have an impact on performance.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the current filename.</span>
<span class="sd">      lineno: the current line number.</span>
<span class="sd">      date: a datetime object.</span>
<span class="sd">      flag: a str, one-character, the flag associated with this transaction.</span>
<span class="sd">      txn_strings: A list of strings, possibly empty, possibly longer.</span>
<span class="sd">      tags_links: A TagsLinks namedtuple of tags, and/or links.</span>
<span class="sd">      posting_or_kv_list: a list of Posting or KeyValue instances, to be inserted in</span>
<span class="sd">        this transaction, or None, if no postings have been declared.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new Transaction object.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>

    <span class="c1"># Separate postings and key-values.</span>
    <span class="n">explicit_meta</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">tags_links</span><span class="o">.</span><span class="n">links</span>
    <span class="k">if</span> <span class="n">posting_or_kv_list</span><span class="p">:</span>
        <span class="n">last_posting</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">posting_or_kv</span> <span class="ow">in</span> <span class="n">posting_or_kv_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">,</span> <span class="n">Posting</span><span class="p">):</span>
                <span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">)</span>
                <span class="n">last_posting</span> <span class="o">=</span> <span class="n">posting_or_kv</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">,</span> <span class="n">TagsLinks</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">postings</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserError</span><span class="p">(</span>
                        <span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Tags or links not allowed after first "</span> <span class="o">+</span>
                        <span class="s2">"Posting: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
                    <span class="n">links</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last_posting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">explicit_meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                                                     <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserError</span><span class="p">(</span>
                            <span class="n">meta</span><span class="p">,</span> <span class="s2">"Duplicate metadata field on entry: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">posting_or_kv</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">last_posting</span> <span class="o">=</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{})</span>
                        <span class="n">postings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_posting</span><span class="p">)</span>

                    <span class="n">value</span> <span class="o">=</span> <span class="n">last_posting</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">posting_or_kv</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                                                         <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">posting_or_kv</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParserError</span><span class="p">(</span>
                            <span class="n">meta</span><span class="p">,</span> <span class="s2">"Duplicate posting metadata field: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">posting_or_kv</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Freeze the tags &amp; links or set to default empty values.</span>
    <span class="n">tags</span><span class="p">,</span> <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_tags_links</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>

    <span class="c1"># Initialize the metadata fields from the set of active values.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Add on explicitly defined values.</span>
    <span class="k">if</span> <span class="n">explicit_meta</span><span class="p">:</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">explicit_meta</span><span class="p">)</span>

    <span class="c1"># Unpack the transaction fields.</span>
    <span class="n">payee_narration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_txn_strings</span><span class="p">(</span><span class="n">txn_strings</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payee_narration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span> <span class="o">=</span> <span class="n">payee_narration</span>

    <span class="c1"># We now allow a single posting when its balance is zero, so we</span>
    <span class="c1"># commented out the check below. If a transaction has a single posting</span>
    <span class="c1"># with a non-zero balance, it'll get caught below in the booking code.</span>
    <span class="c1">#</span>
    <span class="c1"># # Detect when a transaction does not have at least two legs.</span>
    <span class="c1"># if postings is None or len(postings) &lt; 2:</span>
    <span class="c1">#     self.errors.append(</span>
    <span class="c1">#         ParserError(meta,</span>
    <span class="c1">#                     "Transaction with only one posting: {}".format(postings),</span>
    <span class="c1">#                     None))</span>
    <span class="c1">#     return None</span>

    <span class="c1"># If there are no postings, make sure we insert a list object.</span>
    <span class="k">if</span> <span class="n">postings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">postings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create the transaction.</span>
    <span class="k">return</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span>
                       <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">postings</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.Builder.unpack_txn_strings">
<code class="highlight language-python">
unpack_txn_strings<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.Builder.unpack_txn_strings" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Unpack a tags_links accumulator to its payee and narration fields.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>txn_strings</code></td>
<td><code></code></td>
<td>
<p>A list of strings.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>meta</code></td>
<td><code></code></td>
<td>
<p>A metadata dict for errors generated in this routine.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (payee, narration) strings or None objects, or None, if
there was an error.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">unpack_txn_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
    <span class="sd">"""Unpack a tags_links accumulator to its payee and narration fields.</span>

<span class="sd">    Args:</span>
<span class="sd">      txn_strings: A list of strings.</span>
<span class="sd">      meta: A metadata dict for errors generated in this routine.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (payee, narration) strings or None objects, or None, if</span>
<span class="sd">      there was an error.</span>
<span class="sd">    """</span>
    <span class="n">num_strings</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">txn_strings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">txn_strings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_strings</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">txn_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">num_strings</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span> <span class="o">=</span> <span class="n">txn_strings</span>
    <span class="k">elif</span> <span class="n">num_strings</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">""</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ParserError</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span>
                        <span class="s2">"Too many strings on transaction description: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">txn_strings</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.CompoundAmount">
<code>CompoundAmount</code>
<a class="headerlink" href="#beancount.parser.grammar.CompoundAmount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>CompoundAmount(number_per, number_total, currency)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.CompoundAmount.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.CompoundAmount.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.CompoundAmount.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.CompoundAmount.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of CompoundAmount(number_per, number_total, currency)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.CompoundAmount.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.CompoundAmount.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.DeprecatedError">
<code>DeprecatedError</code>
<a class="headerlink" href="#beancount.parser.grammar.DeprecatedError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>DeprecatedError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.DeprecatedError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.DeprecatedError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.DeprecatedError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.DeprecatedError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of DeprecatedError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.DeprecatedError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.DeprecatedError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.KeyValue">
<code>KeyValue</code>
<a class="headerlink" href="#beancount.parser.grammar.KeyValue" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>KeyValue(key, value)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.KeyValue.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.KeyValue.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.KeyValue.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.KeyValue.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of KeyValue(key, value)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.KeyValue.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.KeyValue.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.ParserError">
<code>ParserError</code>
<a class="headerlink" href="#beancount.parser.grammar.ParserError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>ParserError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of ParserError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.ParserSyntaxError">
<code>ParserSyntaxError</code>
<a class="headerlink" href="#beancount.parser.grammar.ParserSyntaxError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>ParserSyntaxError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserSyntaxError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserSyntaxError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserSyntaxError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserSyntaxError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of ParserSyntaxError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ParserSyntaxError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ParserSyntaxError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.TagsLinks">
<code>TagsLinks</code>
<a class="headerlink" href="#beancount.parser.grammar.TagsLinks" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>TagsLinks(tags, links)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.TagsLinks.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.TagsLinks.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.TagsLinks.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.TagsLinks.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of TagsLinks(tags, links)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.TagsLinks.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.TagsLinks.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar.ValueType">
<code>ValueType</code>
<a class="headerlink" href="#beancount.parser.grammar.ValueType" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>ValueType(value, dtype)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ValueType.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ValueType.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ValueType.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ValueType.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of ValueType(value, dtype)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar.ValueType.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar.ValueType.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.grammar.valid_account_regexp">
<code class="highlight language-python">
valid_account_regexp<span class="p">(</span><span class="n">options</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar.valid_account_regexp" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build a regexp to validate account names from the options.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>A dict of options, as per beancount.parser.options.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, a regular expression that will match all account names.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">valid_account_regexp</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">"""Build a regexp to validate account names from the options.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: A dict of options, as per beancount.parser.options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, a regular expression that will match all account names.</span>
<span class="sd">    """</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span> <span class="p">(</span><span class="s1">'name_assets'</span><span class="p">,</span>
                                      <span class="s1">'name_liabilities'</span><span class="p">,</span>
                                      <span class="s1">'name_equity'</span><span class="p">,</span>
                                      <span class="s1">'name_income'</span><span class="p">,</span>
                                      <span class="s1">'name_expenses'</span><span class="p">))</span>

    <span class="c1"># Replace the first term of the account regular expression with the specific</span>
    <span class="c1"># names allowed under the options configuration. This code is kept in sync</span>
    <span class="c1"># with {5672c7270e1e}.</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"(?:</span><span class="si">{}</span><span class="s2">)(?:</span><span class="si">{}{}</span><span class="s2">)+"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">),</span>
                                               <span class="n">account</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
                                               <span class="n">account</span><span class="o">.</span><span class="n">ACC_COMP_NAME_RE</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.grammar_test">
<code>grammar_test</code>
<a class="headerlink" href="#beancount.parser.grammar_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for grammar parser.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestLexerAndParserErrors">
<code>TestLexerAndParserErrors</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestLexerAndParserErrors" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>There are a number of different paths where errors may occur. This test case
    intends to exercise them all. This docstring explains how it all works (it's
    a bit complicated).</p>
<pre><code>Expectations: The parser.parse_*() functions never raise exceptions, they
always produce a list of error messages on the builder objects. This is by
design: we have a single way to produce and report errors.

The lexer may fail in two different ways:

* Invalid Token: yylex() is invoked by the parser... the lexer rules are
  processed and all fail and the default rule of the lexer gets called at
  {bf253a29a820}. The lexer immediately switches to its INVALID subparser to
  chomp the rest of the invalid token's unrecognized characters until it
  hits some whitespace (see {bba169a1d35a}). A new LexerError is created and
  accumulated by calling the build_lexer_error() method on the builder
  object using this text (see {0e31aeca3363}). The lexer then returns a
  LEX_ERROR token to the parser, which fails as below.

* Lexer Builder Exception: The lexer recognizes a valid token and invokes a
  callback on the builder using BUILD_LEX(). However, an exception is raised
  in that Python code ({3cfb2739349a}). The exception's error text is saved
  and this is used to build an error on the lexer builder at
  build_lexer_error().

For both the errors above, when the parser receives the LEX_ERROR token, it
is an unexpected token (because none of the rules handle it), so it calls
yyerror() {ca6aab8b9748}. Because the lexer has already registered an error
in the error list, in yyerror() we simply ignore it and do nothing (see
{ca6aab8b9748}).

Error recovery then proceeds by successive reductions of the "error" grammar
rules which discards all tokens until a valid rule can be reduced again
({3d95e55b654e}). Note that Bison issues a single call to yyerror() and
keeps reducing invalid "error" rules silently until another one succeeds. We
ignore the directive and restart parsing from that point on. If the error
occurred on a posting in progress of being parsed, because the "error" rule
is not a valid posting of a transaction, that transaction will not be
produced and thus is ignore, which is what we want.

The parser may itself also encounter two similar types of errors:

* Syntax Error: There is an error in the grammar of the input. yyparse() is
  called automatically by the generated code and we call
  build_grammar_error() to register the error. Error recovery proceeds
  similarly to what was described previously.

* Grammar Builder Exception: A grammar rule is reduced successfully, a
  builder method is invoked and raises a Python exception. A macro in the
  code that invokes this method is used to catch this error and calls
  build_grammar_error_from_exception() to register an error and makes the
  parser issue an error wth YYERROR (see {05bb0fb60e86}).

We never call YYABORT anywhere so the yyparse() function should never return
anything else than 0. If it does, we translate that into a Python
RuntimeError exception, or a MemoryError exception (if yyparse() ran out of
memory), see {459018e2905c}.
</code></pre>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestLineNumbers">
<code>TestLineNumbers</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestLineNumbers" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that the line numbers line up correctly.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestMetaData">
<code>TestMetaData</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestMetaData" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.grammar_test.TestMetaData.strip_meta">
<code class="highlight language-python">
strip_meta<span class="p">(</span><span class="n">meta</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.grammar_test.TestMetaData.strip_meta" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Removes the filename, lineno from the postings metadata.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1400
1401
1402
1403
1404
1405
1406</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">strip_meta</span><span class="p">(</span><span class="n">meta</span><span class="p">):</span>
    <span class="sd">"""Removes the filename, lineno from the postings metadata."""</span>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'filename'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'lineno'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copy</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestParserComplete">
<code>TestParserComplete</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestParserComplete" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Tests of completion of balance.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestParserEntryTypes">
<code>TestParserEntryTypes</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestParserEntryTypes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Basic smoke test one entry of each kind.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestSyntaxErrors">
<code>TestSyntaxErrors</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestSyntaxErrors" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test syntax errors that occur within the parser.
    One of our goals is to recover and report without ever
    bailing out with an exception.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.TestUglyBugs">
<code>TestUglyBugs</code>
<a class="headerlink" href="#beancount.parser.grammar_test.TestUglyBugs" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test all kinds of stupid sh*t that will inevitably occur in practice.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.check_list">
<code class="highlight language-python">
check_list<span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">objlist</span><span class="p">,</span> <span class="n">explist</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar_test.check_list" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Assert the list of objects against the expected specification.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test</code></td>
<td><code></code></td>
<td>
<p>the instance of the test object, used for generating assertions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>objlist</code></td>
<td><code></code></td>
<td>
<p>the list of objects returned.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>explist</code></td>
<td><code></code></td>
<td>
<p>the list of objects expected. 'explist' can be an integer, to
       check the length of the list; if it is a list of types, the types
       are checked against the types of the objects in the list. This is
       meant to be a convenient method.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_list</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">objlist</span><span class="p">,</span> <span class="n">explist</span><span class="p">):</span>
    <span class="sd">"""Assert the list of objects against the expected specification.</span>

<span class="sd">    Args:</span>
<span class="sd">      test: the instance of the test object, used for generating assertions.</span>
<span class="sd">      objlist: the list of objects returned.</span>

<span class="sd">      explist: the list of objects expected. 'explist' can be an integer, to</span>
<span class="sd">               check the length of the list; if it is a list of types, the types</span>
<span class="sd">               are checked against the types of the objects in the list. This is</span>
<span class="sd">               meant to be a convenient method.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">explist</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">explist</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">objlist</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">explist</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">explist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">objlist</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objlist</span><span class="p">,</span> <span class="n">explist</span><span class="p">):</span>
            <span class="n">test</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.grammar_test.raise_exception">
<code class="highlight language-python">
raise_exception<span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.grammar_test.raise_exception" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Raises a ValueError exception.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*args</code></td>
<td><code></code></td>
<td>
<p>Callback arguments.</p>
</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>*kwargs</code></td>
<td><code></code></td>
<td>
<p>Callback keyword arguments.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>Unconditionally.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/grammar_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50
51
52
53
54
55
56
57
58</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">raise_exception</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""Raises a ValueError exception.</span>

<span class="sd">    Args:</span>
<span class="sd">      *args: Callback arguments.</span>
<span class="sd">      *kwargs: Callback keyword arguments.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: Unconditionally.</span>
<span class="sd">    """</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Patched exception in parser"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.hashsrc">
<code>hashsrc</code>
<a class="headerlink" href="#beancount.parser.hashsrc" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Compute a hash of the source files in order to warn when the source goes out of date.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.hashsrc.check_parser_source_files">
<code class="highlight language-python">
check_parser_source_files<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.parser.hashsrc.check_parser_source_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check the extension module's source hash and issue a warning if the
current source differs from that of the module.</p>
<p>If the source files aren't located in the Python source directory, ignore
the warning, we're probably running this from an installed based, in which
case we don't need to check anything (this check is useful only for people
running directly from source).</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/hashsrc.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_parser_source_files</span><span class="p">():</span>
    <span class="sd">"""Check the extension module's source hash and issue a warning if the</span>
<span class="sd">    current source differs from that of the module.</span>

<span class="sd">    If the source files aren't located in the Python source directory, ignore</span>
<span class="sd">    the warning, we're probably running this from an installed based, in which</span>
<span class="sd">    case we don't need to check anything (this check is useful only for people</span>
<span class="sd">    running directly from source).</span>
<span class="sd">    """</span>
    <span class="n">parser_source_hash</span> <span class="o">=</span> <span class="n">hash_parser_source_files</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parser_source_hash</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_parser</span>
    <span class="k">if</span> <span class="n">_parser</span><span class="o">.</span><span class="n">SOURCE_HASH</span> <span class="o">!=</span> <span class="n">parser_source_hash</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"The Beancount parser C extension module is out-of-date. "</span>
                      <span class="s2">"You need to rebuild."</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.hashsrc.hash_parser_source_files">
<code class="highlight language-python">
hash_parser_source_files<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.parser.hashsrc.hash_parser_source_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute a unique hash of the parser's Python code in order to bake that into
the extension module. This is used at load-time to verify that the extension
module and the corresponding Python codes match each other. If not, it
issues a warning that you should rebuild your extension module.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the hexadecimal unique hash of relevant source code that should
trigger a recompilation.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/hashsrc.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">hash_parser_source_files</span><span class="p">():</span>
    <span class="sd">"""Compute a unique hash of the parser's Python code in order to bake that into</span>
<span class="sd">    the extension module. This is used at load-time to verify that the extension</span>
<span class="sd">    module and the corresponding Python codes match each other. If not, it</span>
<span class="sd">    issues a warning that you should rebuild your extension module.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the hexadecimal unique hash of relevant source code that should</span>
<span class="sd">      trigger a recompilation.</span>
<span class="sd">    """</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">PARSER_SOURCE_FILES</span><span class="p">:</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullname</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="c1"># Note: Prepend a character in front of the hash because under Windows MSDEV</span>
    <span class="c1"># removes escapes, and if the hash starts with a number it fails to</span>
    <span class="c1"># recognize this is a string. A small compromise for portability.</span>
    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.lexer">
<code>lexer</code>
<a class="headerlink" href="#beancount.parser.lexer" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Beancount syntax lexer.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder">
<code>LexBuilder</code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A builder used only for building lexer objects.</p>
<pre><code>Attributes:
  !!! long_string_maxlines_default "Number of lines for a string to trigger a"
      warning. This is meant to help users detecting dangling quotes in
      their source.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.ACCOUNT">
<code class="highlight language-python">
ACCOUNT<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.ACCOUNT" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an ACCOUNT token.</p>
<p>This function attempts to reuse an existing account if one exists,
otherwise creates one on-demand.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>a str, the valid name of an account.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the name of the account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">ACCOUNT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Process an ACCOUNT token.</span>

<span class="sd">    This function attempts to reuse an existing account if one exists,</span>
<span class="sd">    otherwise creates one on-demand.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: a str, the valid name of an account.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the name of the account.</span>
<span class="sd">    """</span>
    <span class="c1"># Check account name validity.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid account name: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">))</span>

    <span class="c1"># Reuse (intern) account strings as much as possible. This potentially</span>
    <span class="c1"># reduces memory usage a fair bit, because these strings are repeated</span>
    <span class="c1"># liberally.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.build_lexer_error">
<code class="highlight language-python">
build_lexer_error<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.build_lexer_error" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Build a lexer error and appends it to the list of pending errors.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>message</code></td>
<td><code></code></td>
<td>
<p>The message of the error.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>exc_type</code></td>
<td><code></code></td>
<td>
<p>An exception type, if an exception occurred.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build_lexer_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># {0e31aeca3363}</span>
    <span class="sd">"""Build a lexer error and appends it to the list of pending errors.</span>

<span class="sd">    Args:</span>
<span class="sd">      message: The message of the error.</span>
<span class="sd">      exc_type: An exception type, if an exception occurred.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">LexerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span> <span class="n">message</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.CURRENCY">
<code class="highlight language-python">
CURRENCY<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.CURRENCY" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a CURRENCY token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>currency_name</code></td>
<td><code></code></td>
<td>
<p>the name of the currency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new currency object; for now, these are simply represented
as the currency name.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>110
111
112
113
114
115
116
117
118
119
120</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">CURRENCY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency_name</span><span class="p">):</span>
    <span class="sd">"""Process a CURRENCY token.</span>

<span class="sd">    Args:</span>
<span class="sd">      currency_name: the name of the currency.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new currency object; for now, these are simply represented</span>
<span class="sd">      as the currency name.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">commodities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">currency_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">currency_name</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.DATE">
<code class="highlight language-python">
DATE<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.DATE" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a DATE token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>year</code></td>
<td><code></code></td>
<td>
<p>integer year.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>month</code></td>
<td><code></code></td>
<td>
<p>integer month.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>day</code></td>
<td><code></code></td>
<td>
<p>integer day</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new datetime object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>78
79
80
81
82
83
84
85
86
87
88</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">DATE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="sd">"""Process a DATE token.</span>

<span class="sd">    Args:</span>
<span class="sd">      year: integer year.</span>
<span class="sd">      month: integer month.</span>
<span class="sd">      day: integer day</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new datetime object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.get_invalid_account">
<code class="highlight language-python">
get_invalid_account<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.get_invalid_account" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the name of an invalid account placeholder.</p>
<p>When an account name is not deemed a valid one, replace it by
this account name. This can be overridden by the parser to
take into account the options.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the name of the root/type for invalid account names.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47
48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_invalid_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the name of an invalid account placeholder.</span>

<span class="sd">    When an account name is not deemed a valid one, replace it by</span>
<span class="sd">    this account name. This can be overridden by the parser to</span>
<span class="sd">    take into account the options.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, the name of the root/type for invalid account names.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="s1">'Equity:InvalidAccountName'</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.KEY">
<code class="highlight language-python">
KEY<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.KEY" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process an identifier token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ident</code></td>
<td><code></code></td>
<td>
<p>a str, the name of the key string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The link string itself. For now we don't need to represent this by
an object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>197
198
199
200
201
202
203
204
205
206</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    <span class="sd">"""Process an identifier token.</span>

<span class="sd">    Args:</span>
<span class="sd">      ident: a str, the name of the key string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The link string itself. For now we don't need to represent this by</span>
<span class="sd">      an object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">ident</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.LINK">
<code class="highlight language-python">
LINK<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.LINK" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a LINK token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>link</code></td>
<td><code></code></td>
<td>
<p>a str, the name of the string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The link string itself. For now we don't need to represent this by
an object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>186
187
188
189
190
191
192
193
194
195</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">LINK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">):</span>
    <span class="sd">"""Process a LINK token.</span>

<span class="sd">    Args:</span>
<span class="sd">      link: a str, the name of the string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The link string itself. For now we don't need to represent this by</span>
<span class="sd">      an object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">link</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.NUMBER">
<code class="highlight language-python">
NUMBER<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.NUMBER" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a NUMBER token. Convert into Decimal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>a str, the number to be converted.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal instance built of the number string.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">NUMBER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">"""Process a NUMBER token. Convert into Decimal.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: a str, the number to be converted.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal instance built of the number string.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We don't use D() for efficiency here.</span>
    <span class="c1"># The lexer will only yield valid number strings.</span>
    <span class="k">if</span> <span class="s1">','</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
        <span class="c1"># Extract the integer part and check the commas match the</span>
        <span class="c1"># locale-aware formatted version. This</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">"([\d,]*)(\.\d*)?$"</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="c1"># This path is never taken because the lexer will parse a comma</span>
            <span class="c1"># in the fractional part as two NUMBERs with a COMMA token in</span>
            <span class="c1"># between.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">LexerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                           <span class="s2">"Invalid number format: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">int_string</span><span class="p">,</span> <span class="n">float_string</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">reformatted_number</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"</span><span class="si">{:,.0f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">int_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">""</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">int_string</span> <span class="o">!=</span> <span class="n">reformatted_number</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">LexerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                               <span class="s2">"Invalid commas: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.STRING">
<code class="highlight language-python">
STRING<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.STRING" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a STRING token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>the string to process.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The string. Nothing to be done or cleaned up. Eventually we might
do some decoding here.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">STRING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Process a STRING token.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: the string to process.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The string. Nothing to be done or cleaned up. Eventually we might</span>
<span class="sd">      do some decoding here.</span>
<span class="sd">    """</span>
    <span class="c1"># If a multiline string, warm over a certain number of lines.</span>
    <span class="k">if</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="n">num_lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">num_lines</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_string_maxlines_default</span><span class="p">:</span>
            <span class="c1"># This is just a warning; accept the string anyhow.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">LexerError</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_lexer_location</span><span class="p">(),</span>
                    <span class="s2">"String too long (</span><span class="si">{}</span><span class="s2"> lines); possible error"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_lines</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">string</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexBuilder.TAG">
<code class="highlight language-python">
TAG<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.LexBuilder.TAG" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a TAG token.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tag</code></td>
<td><code></code></td>
<td>
<p>a str, the tag to be processed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The tag string itself. For now we don't need an object to represent
those; keeping it simple.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>175
176
177
178
179
180
181
182
183
184</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">TAG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">"""Process a TAG token.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag: a str, the tag to be processed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The tag string itself. For now we don't need an object to represent</span>
<span class="sd">      those; keeping it simple.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">tag</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.lexer.LexerError">
<code>LexerError</code>
<a class="headerlink" href="#beancount.parser.lexer.LexerError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>LexerError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexerError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.lexer.LexerError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexerError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.lexer.LexerError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of LexerError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.lexer.LexerError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.lexer.LexerError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.lexer.lex_iter">
<code class="highlight language-python">
lex_iter<span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.lex_iter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An iterator that yields all the tokens in the given file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A string, the filename to run the lexer on, or a file object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>builder</code></td>
<td><code></code></td>
<td>
<p>A builder of your choice. If not specified, a LexBuilder is
used and discarded (along with its errors).</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>encoding</code></td>
<td><code></code></td>
<td>
<p>A string (or None), the default encoding to use for strings.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Tuples of the token (a string), the matched text (a string), and the line
  no (an integer).</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">lex_iter</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""An iterator that yields all the tokens in the given file.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A string, the filename to run the lexer on, or a file object.</span>
<span class="sd">      builder: A builder of your choice. If not specified, a LexBuilder is</span>
<span class="sd">        used and discarded (along with its errors).</span>
<span class="sd">      encoding: A string (or None), the default encoding to use for strings.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Tuples of the token (a string), the matched text (a string), and the line</span>
<span class="sd">      no (an integer).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">LexBuilder</span><span class="p">()</span>
    <span class="n">_parser</span><span class="o">.</span><span class="n">lexer_initialize</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">token_tuple</span> <span class="o">=</span> <span class="n">_parser</span><span class="o">.</span><span class="n">lexer_next</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">token_tuple</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">yield</span> <span class="n">token_tuple</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">_parser</span><span class="o">.</span><span class="n">lexer_finalize</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.lexer.lex_iter_string">
<code class="highlight language-python">
lex_iter_string<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer.lex_iter_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse an input string and print the tokens to an output file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_string</code></td>
<td><code></code></td>
<td>
<p>a str or bytes, the contents of the ledger to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>builder</code></td>
<td><code></code></td>
<td>
<p>A builder of your choice. If not specified, a LexBuilder is
used and discarded (along with its errors).</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>encoding</code></td>
<td><code></code></td>
<td>
<p>A string (or None), the default encoding to use for strings.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A iterator on the string. See lex_iter() for details.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">lex_iter_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Parse an input string and print the tokens to an output file.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_string: a str or bytes, the contents of the ledger to be parsed.</span>
<span class="sd">      builder: A builder of your choice. If not specified, a LexBuilder is</span>
<span class="sd">        used and discarded (along with its errors).</span>
<span class="sd">      encoding: A string (or None), the default encoding to use for strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A iterator on the string. See lex_iter() for details.</span>
<span class="sd">    """</span>
    <span class="n">tmp_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">'w'</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s1">'wb'</span><span class="p">)</span>
    <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">tmp_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="c1"># Note: We pass in the file object in order to keep it alive during parsing.</span>
    <span class="k">return</span> <span class="n">lex_iter</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.lexer_test">
<code>lexer_test</code>
<a class="headerlink" href="#beancount.parser.lexer_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for lexer.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.lexer_test.TestLexer">
<code>TestLexer</code>
<a class="headerlink" href="#beancount.parser.lexer_test.TestLexer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test output of the lexer.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.lexer_test.TestLexerErrors">
<code>TestLexerErrors</code>
<a class="headerlink" href="#beancount.parser.lexer_test.TestLexerErrors" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test lexer error handling.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.lexer_test.lex_tokens">
<code class="highlight language-python">
lex_tokens<span class="p">(</span><span class="n">fun</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer_test.lex_tokens" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorator for test functions that will invokve a lexer on them.</p>
<p>The lexer passes the list of tokens and errors to the test function.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fun</code></td>
<td><code></code></td>
<td>
<p>A test function to be decorated.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The decorated function.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">lex_tokens</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="sd">"""Decorator for test functions that will invokve a lexer on them.</span>

<span class="sd">    The lexer passes the list of tokens and errors to the test function.</span>

<span class="sd">    Args:</span>
<span class="sd">      fun: A test function to be decorated.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The decorated function.</span>
<span class="sd">    """</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">LexBuilder</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">lex_iter_string</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">),</span>
                                            <span class="n">builder</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
    <span class="n">wrapped</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.lexer_test.print_tokens">
<code class="highlight language-python">
print_tokens<span class="p">(</span><span class="n">tokens</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.lexer_test.print_tokens" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A function for printing a list of tokens, for testing.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tokens</code></td>
<td><code></code></td>
<td>
<p>A list of token tuples.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/lexer_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>17
18
19
20
21
22
23
24
25
26
27</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">"""A function for printing a list of tokens, for testing.</span>

<span class="sd">    Args:</span>
<span class="sd">      tokens: A list of token tuples.</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">',--------------------------------'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">,'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'`--------------------------------'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.options">
<code>options</code>
<a class="headerlink" href="#beancount.parser.options" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Declaration of options and their default values.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.options.OptDesc">
<code>OptDesc</code>
<a class="headerlink" href="#beancount.parser.options.OptDesc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>OptDesc(name, default_value, example_value, converter, deprecated, alias)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptDesc.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptDesc.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptDesc.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptDesc.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of OptDesc(name, default_value, example_value, converter, deprecated, alias)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptDesc.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptDesc.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.options.OptGroup">
<code>OptGroup</code>
<a class="headerlink" href="#beancount.parser.options.OptGroup" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>OptGroup(description, options)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptGroup.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptGroup.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptGroup.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptGroup.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of OptGroup(description, options)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.options.OptGroup.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.options.OptGroup.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.get_account_types">
<code class="highlight language-python">
get_account_types<span class="p">(</span><span class="n">options</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.get_account_types" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the account type names from the parser's options.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>a dict of ledger options.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of AccountTypes, that contains all the prefixes.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>473
474
475
476
477
478
479
480
481
482
483
484
485
486
487</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_types</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">"""Extract the account type names from the parser's options.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of AccountTypes, that contains all the prefixes.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">account_types</span><span class="o">.</span><span class="n">AccountTypes</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"name_assets"</span><span class="p">,</span>
                      <span class="s2">"name_liabilities"</span><span class="p">,</span>
                      <span class="s2">"name_equity"</span><span class="p">,</span>
                      <span class="s2">"name_income"</span><span class="p">,</span>
                      <span class="s2">"name_expenses"</span><span class="p">)])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.get_current_accounts">
<code class="highlight language-python">
get_current_accounts<span class="p">(</span><span class="n">options</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.get_current_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return account names for the current earnings and conversion accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>a dict of ledger options.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of 2 account objects, one for booking current earnings, and one
for current conversions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_current_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">"""Return account names for the current earnings and conversion accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of 2 account objects, one for booking current earnings, and one</span>
<span class="sd">      for current conversions.</span>
<span class="sd">    """</span>
    <span class="n">equity</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">'name_equity'</span><span class="p">]</span>
    <span class="n">account_current_earnings</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span>
                                            <span class="n">options</span><span class="p">[</span><span class="s1">'account_current_earnings'</span><span class="p">])</span>
    <span class="n">account_current_conversions</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span>
                                               <span class="n">options</span><span class="p">[</span><span class="s1">'account_current_conversions'</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">account_current_earnings</span><span class="p">,</span>
            <span class="n">account_current_conversions</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.get_previous_accounts">
<code class="highlight language-python">
get_previous_accounts<span class="p">(</span><span class="n">options</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.get_previous_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return account names for the previous earnings, balances and conversion accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>a dict of ledger options.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of 3 account objects, for booking previous earnings,
previous balances, and previous conversions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_previous_accounts</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">"""Return account names for the previous earnings, balances and conversion accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      options: a dict of ledger options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of 3 account objects, for booking previous earnings,</span>
<span class="sd">      previous balances, and previous conversions.</span>
<span class="sd">    """</span>
    <span class="n">equity</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s1">'name_equity'</span><span class="p">]</span>
    <span class="n">account_previous_earnings</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span>
                                             <span class="n">options</span><span class="p">[</span><span class="s1">'account_previous_earnings'</span><span class="p">])</span>
    <span class="n">account_previous_balances</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span>
                                             <span class="n">options</span><span class="p">[</span><span class="s1">'account_previous_balances'</span><span class="p">])</span>
    <span class="n">account_previous_conversions</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span>
                                                <span class="n">options</span><span class="p">[</span><span class="s1">'account_previous_conversions'</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">account_previous_earnings</span><span class="p">,</span>
            <span class="n">account_previous_balances</span><span class="p">,</span>
            <span class="n">account_previous_conversions</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.list_options">
<code class="highlight language-python">
list_options<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.parser.options.list_options" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Produce a formatted text of the available options and their description.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, formatted nicely to be printed in 80 columns.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">list_options</span><span class="p">():</span>
    <span class="sd">"""Produce a formatted text of the available options and their description.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, formatted nicely to be printed in 80 columns.</span>
<span class="sd">    """</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">PUBLIC_OPTION_GROUPS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'option "</span><span class="si">{}</span><span class="s1">" "</span><span class="si">{}</span><span class="s1">"</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">example_value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">desc</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                    <span class="s2">"THIS OPTION IS DEPRECATED: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">deprecated</span><span class="p">),</span>
                    <span class="n">initial_indent</span><span class="o">=</span><span class="s2">"  "</span><span class="p">,</span>
                    <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">"  "</span><span class="p">))</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                               <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description</span><span class="p">,</span>
                                <span class="n">initial_indent</span><span class="o">=</span><span class="s1">'  '</span><span class="p">,</span>
                                <span class="n">subsequent_indent</span><span class="o">=</span><span class="s1">'  '</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">default_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'  (This option may be supplied multiple times.)</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.Opt">
<code class="highlight language-python">
Opt<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="o">=&lt;</span><span class="nb">object</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f0315bf4940</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.Opt" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Alternative constructor for OptDesc, with default values.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>default_value</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>example_value</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><code>&lt;object object at 0x7f0315bf4940&gt;</code></td>
</tr>
<tr>
<td><code>converter</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>deprecated</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>alias</code></td>
<td><code></code></td>
<td>
<p>See OptDesc.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of OptDesc.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">Opt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span>
        <span class="n">example_value</span><span class="o">=</span><span class="n">UNSET</span><span class="p">,</span>
        <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">deprecated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Alternative constructor for OptDesc, with default values.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: See OptDesc.</span>
<span class="sd">      default_value: See OptDesc.</span>
<span class="sd">      example_value: See OptDesc.</span>
<span class="sd">      converter: See OptDesc.</span>
<span class="sd">      deprecated: See OptDesc.</span>
<span class="sd">      alias: See OptDesc.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of OptDesc.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">example_value</span> <span class="ow">is</span> <span class="n">UNSET</span><span class="p">:</span>
        <span class="n">example_value</span> <span class="o">=</span> <span class="n">default_value</span>
    <span class="k">return</span> <span class="n">OptDesc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">example_value</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_booking_method">
<code class="highlight language-python">
options_validate_booking_method<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_booking_method" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate a booking method name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_booking_method</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate a booking method name.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">Booking</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_boolean">
<code class="highlight language-python">
options_validate_boolean<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_boolean" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate a boolean option.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>87
88
89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_boolean</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate a boolean option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'true'</span><span class="p">,</span> <span class="s1">'yes'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_plugin">
<code class="highlight language-python">
options_validate_plugin<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_plugin" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate the plugin option.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_plugin</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate the plugin option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="c1"># Process the 'plugin' option specially: accept an optional</span>
    <span class="c1"># argument from it. NOTE: We will eventually phase this out and</span>
    <span class="c1"># replace it by a dedicated 'plugin' directive.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'(.*):(.*)'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">plugin_name</span><span class="p">,</span> <span class="n">plugin_config</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_processing_mode">
<code class="highlight language-python">
options_validate_processing_mode<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_processing_mode" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate the options processing mode.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_processing_mode</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate the options processing mode.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'raw'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid value '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_tolerance">
<code class="highlight language-python">
options_validate_tolerance<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_tolerance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate the tolerance option.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>55
56
57
58
59
60
61
62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_tolerance</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate the tolerance option.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">D</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.options.options_validate_tolerance_map">
<code class="highlight language-python">
options_validate_tolerance_map<span class="p">(</span><span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.options.options_validate_tolerance_map" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate an option with a map of currency/tolerance pairs in a string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A string, the value provided as option.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The new value, converted, if the conversion is successful.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is invalid.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/options.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">options_validate_tolerance_map</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Validate an option with a map of currency/tolerance pairs in a string.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A string, the value provided as option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The new value, converted, if the conversion is successful.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the value is invalid.</span>
<span class="sd">    """</span>
    <span class="c1"># Process the setting of a key-value, whereby the value is a Decimal</span>
    <span class="c1"># representation.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'(.*):(.*)'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid value '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">currency</span><span class="p">,</span> <span class="n">tolerance_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">D</span><span class="p">(</span><span class="n">tolerance_str</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.options_test">
<code>options_test</code>
<a class="headerlink" href="#beancount.parser.options_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Test various options.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.parser">
<code>parser</code>
<a class="headerlink" href="#beancount.parser.parser" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Beancount syntax parser.</p>
<p>IMPORTANT: The parser (and its grammar builder) produces "incomplete"
Transaction objects. This means that some of the data can be found missing from
the output of the parser and some of the data types vary slightly. Missing
components are replaced not by None, but by a special constant 'NA' which helps
diagnose problems if a user inadvertently attempts to work on an incomplete
posting instead of a complete one. Those incomplete entries are then run through
the "booking" routines which do two things simultaneously:</p>
<ol>
<li>They find matching lots for reducing inventory positions, and</li>
<li>They interpolate missing numbers.</li>
</ol>
<p>In doing so they normalize the entries to "complete" entries by converting a
position/lot's "cost" attribute from a CostSpec to a Cost. A Cost is similar to
an Amount in that it shares "number" and "currency" attributes, but also has a
label and a lot date. A CostSpec is similar to a Cost, but has all optional
data; it consists in a specification for matching against a particular inventory
lot.</p>
<p>Other parts of a posting may also be missing, not just parts of the cost.
Leaving out some parts of the input is used to invoke interpolation, to tell
Beancount to automatically compute the missing numbers (if possible).</p>
<p>Missing components will be set to the special value
"beancount.core.number.MISSING" until inventory booking and number interpolation
has been completed. The "MISSING" value should never appear in completed, loaded
transaction postings.</p>
<p>For instance, all of the units may be missing:</p>
<p>INPUT: Assets:Account
  posting.units = MISSING</p>
<p>Or just the number of the units:</p>
<p>INPUT: Assets:Account                    USD
  posting.units = Amount(MISSING, "USD")</p>
<p>You must always specify the currency.</p>
<p>If a price annotation is simply absent, it appears as None:</p>
<p>INPUT: Assets:Account                 2 MXN
  posting.price = None</p>
<p>However, you may indicate that there is a price but have Beancount compute it
automatically:</p>
<p>INPUT: Assets:Account                 2 MXN @
  posting.price = Amount(MISSING, MISSING)</p>
<p>Indicating the conversion currency is also possible (and recommended):</p>
<p>INPUT: Assets:Account                 2 MXN @ USD
  posting.price = Amount(MISSING, "USD")</p>
<p>If a cost specification is provided, a "cost" attribute it set but it does not
refer to a Cost instance (as in complete entries) but rather to a CostSpec
instance. Some of the fields of a CostSpec may be MISSING if they were not
specified in the input. For exammple:</p>
<p>INPUT: Assets:Account  1 HOOL {100 # 5 USD}
  posting.cost = CostSpec(Decimal("100"), Decimal("5"), "USD", None, None, False))</p>
<p>Note how we never consider the label of date override to be MISSING; this is
because those inputs are optional: A missing label is simply left unset in the
computed Cost, and a missing date override uses the date of the transaction
that contains the posting.</p>
<p>You can indicate that there is a total number to be filled in like this:</p>
<p>INPUT: Assets:Account  1 HOOL {100 # USD}
  posting.cost = CostSpec(Decimal("100"), MISSING, "USD", None, None, False))</p>
<p>This is in contrast to the total value simple not being used:</p>
<p>INPUT: Assets:Account  1 HOOL {100 USD}
  posting.cost = CostSpec(Decimal("100"), None, "USD", None, None, False))</p>
<p>Both per-unit and total numbers may be omitted as well, in which case, only the
number-per-unit portion of the CostSpec will appear as MISSING:</p>
<p>INPUT: Assets:Account  1 HOOL {USD}
  posting.cost = CostSpec(MISSING, None, "USD", None, None, False))</p>
<p>And furthermore, all the cost basis may be missing:</p>
<p>INPUT: Assets:Account  1 HOOL {}
  posting.cost = CostSpec(MISSING, None, MISSING, None, None, False))</p>
<p>If you ask for the lots to be merged, you get this:</p>
<p>INPUT: Assets:Account  1 HOOL {*}
  posting.cost = CostSpec(MISSING, None, MISSING, None, None, True))</p>
<p>The numbers have to be computed by Beancount, so we output this with MISSING
values.</p>
<p>Of course, you can provide only the non-basis informations, like just the date
or label:</p>
<p>INPUT: Assets:Account  1 HOOL {2015-09-21}
  posting.cost = CostSpec(MISSING, None, MISSING, date(2015, 9, 21), None, True)</p>
<p>See the test beancount.parser.grammar_test.TestIncompleteInputs for examples and
corresponding expected values.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.is_entry_incomplete">
<code class="highlight language-python">
is_entry_incomplete<span class="p">(</span><span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.is_entry_incomplete" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Detect the presence of elided amounts in Transactions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if there are some missing portions of any postings found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>168
169
170
171
172
173
174
175
176
177
178
179</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Detect the presence of elided amounts in Transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there are some missing portions of any postings found.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_posting_incomplete</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.is_posting_incomplete">
<code class="highlight language-python">
is_posting_incomplete<span class="p">(</span><span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.is_posting_incomplete" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Detect the presence of any elided amounts in a Posting.</p>
<p>If any of the possible amounts are missing, this returns True.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if there are some missing portions of any postings found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_posting_incomplete</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""Detect the presence of any elided amounts in a Posting.</span>

<span class="sd">    If any of the possible amounts are missing, this returns True.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if there are some missing portions of any postings found.</span>
<span class="sd">    """</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">units</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
        <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
        <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">price</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
        <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
                               <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
    <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
                             <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span>
                             <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.parse_doc">
<code class="highlight language-python">
parse_doc<span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.parse_doc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Factory of decorators that parse the function's docstring as an argument.</p>
<p>Note that the decorators thus generated only run the parser on the tests,
not the loader, so is no validation, balance checks, nor plugins applied to
the parsed text.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expect_errors</code></td>
<td><code></code></td>
<td>
<p>A boolean or None, with the following semantics,
True: Expect errors and fail if there are none.
False: Expect no errors and fail if there are some.
None: Do nothing, no check.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>allow_incomplete</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, allow incomplete input. Otherwise
barf if the input would require interpolation. The default value is set
not to allow it because we want to minimize the features tests depend on.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A decorator for test functions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_doc</span><span class="p">(</span><span class="n">expect_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Factory of decorators that parse the function's docstring as an argument.</span>

<span class="sd">    Note that the decorators thus generated only run the parser on the tests,</span>
<span class="sd">    not the loader, so is no validation, balance checks, nor plugins applied to</span>
<span class="sd">    the parsed text.</span>

<span class="sd">    Args:</span>
<span class="sd">      expect_errors: A boolean or None, with the following semantics,</span>
<span class="sd">        True: Expect errors and fail if there are none.</span>
<span class="sd">        False: Expect no errors and fail if there are some.</span>
<span class="sd">        None: Do nothing, no check.</span>
<span class="sd">      allow_incomplete: A boolean, if true, allow incomplete input. Otherwise</span>
<span class="sd">        barf if the input would require interpolation. The default value is set</span>
<span class="sd">        not to allow it because we want to minimize the features tests depend on.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A decorator for test functions.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
        <span class="sd">"""A decorator that parses the function's docstring as an argument.</span>

<span class="sd">        Args:</span>
<span class="sd">          fun: the function object to be decorated.</span>
<span class="sd">        Returns:</span>
<span class="sd">          A decorated test function.</span>
<span class="sd">        """</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>

        <span class="c1"># decorator line + function definition line (I realize this is largely</span>
        <span class="c1"># imperfect, but it's only for reporting in our tests) - empty first line</span>
        <span class="c1"># stripped away.</span>
        <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"You need to insert a docstring on </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parse_string</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span>
                                                        <span class="n">report_filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                                                        <span class="n">report_firstline</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
                                                        <span class="n">dedent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_incomplete</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_entry_incomplete</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                                            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">"parse_doc() may not use interpolation."</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                    <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">oss</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">"Unexpected errors found:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>
                <span class="k">elif</span> <span class="n">expect_errors</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">"Expected errors, none found:"</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

        <span class="n">wrapper</span><span class="o">.</span><span class="n">__input__</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.parse_file">
<code class="highlight language-python">
parse_file<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.parse_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse a beancount input file and return Ledger with the list of
transactions and tree of accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>the name of the file to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kw</code></td>
<td><code></code></td>
<td>
<p>a dict of keywords to be applied to the C parser.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of (
  list of entries parsed in the file,
  list of errors that were encountered during parsing, and
  a dict of the option values that were parsed from the file.)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""Parse a beancount input file and return Ledger with the list of</span>
<span class="sd">    transactions and tree of accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: the name of the file to be parsed.</span>
<span class="sd">      kw: a dict of keywords to be applied to the C parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of (</span>
<span class="sd">        list of entries parsed in the file,</span>
<span class="sd">        list of errors that were encountered during parsing, and</span>
<span class="sd">        a dict of the option values that were parsed from the file.)</span>
<span class="sd">    """</span>
    <span class="n">abs_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">filename</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
    <span class="n">_parser</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.parse_many">
<code class="highlight language-python">
parse_many<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.parse_many" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse a string with a snippet of Beancount input and replace vars from caller.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string with some Beancount input.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>level</code></td>
<td><code></code></td>
<td>
<p>The number of extra stacks to ignore.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of entries.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If there are any errors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_many</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Parse a string with a snippet of Beancount input and replace vars from caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string with some Beancount input.</span>
<span class="sd">      level: The number of extra stacks to ignore.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If there are any errors.</span>
<span class="sd">    """</span>
    <span class="c1"># Get the locals in the stack for the callers and produce the final text.</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">varkwds</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="n">input_string</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">varkwds</span><span class="p">))</span>

    <span class="c1"># Parse entries and check there are no errors.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">parse_string</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">errors</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.parse_one">
<code class="highlight language-python">
parse_one<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.parse_one" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse a string with single Beancount directive and replace vars from caller.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string with some Beancount input.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>level</code></td>
<td><code></code></td>
<td>
<p>The number of extra stacks to ignore.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of entries.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If there are any errors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>309
310
311
312
313
314
315
316
317
318
319
320
321
322</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_one</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Parse a string with single Beancount directive and replace vars from caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string with some Beancount input.</span>
<span class="sd">      level: The number of extra stacks to ignore.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If there are any errors.</span>
<span class="sd">    """</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">parse_many</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.parser.parse_string">
<code class="highlight language-python">
parse_string<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.parser.parse_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse a beancount input file and return Ledger with the list of
transactions and tree of accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string, the contents to be parsed instead of a file's.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>report_filename</code></td>
<td><code></code></td>
<td>
<p>A string, the source filename from which this string
has been extracted, if any. This is stored in the metadata of the
parsed entries.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>**kw</code></td>
<td><code></code></td>
<td>
<p>See parse.c. This function parses out 'dedent' which removes
whitespace from the front of the text (default is False).</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Same as the output of parse_file().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">"""Parse a beancount input file and return Ledger with the list of</span>
<span class="sd">    transactions and tree of accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string, the contents to be parsed instead of a file's.</span>
<span class="sd">      report_filename: A string, the source filename from which this string</span>
<span class="sd">        has been extracted, if any. This is stored in the metadata of the</span>
<span class="sd">        parsed entries.</span>
<span class="sd">      **kw: See parse.c. This function parses out 'dedent' which removes</span>
<span class="sd">        whitespace from the front of the text (default is False).</span>
<span class="sd">    Return:</span>
<span class="sd">      Same as the output of parse_file().</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'dedent'</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="n">report_filename</span> <span class="ow">or</span> <span class="s1">'&lt;string&gt;'</span><span class="p">)</span>
    <span class="n">_parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">report_filename</span><span class="o">=</span><span class="n">report_filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.parser_test">
<code>parser_test</code>
<a class="headerlink" href="#beancount.parser.parser_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for parser.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.parser_test.TestParserInputs">
<code>TestParserInputs</code>
<a class="headerlink" href="#beancount.parser.parser_test.TestParserInputs" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Try difference sources for the parser's input.</p>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.printer">
<code>printer</code>
<a class="headerlink" href="#beancount.parser.printer" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Conversion from internal data structures to text.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.parser.printer.EntryPrinter">
<code>EntryPrinter</code>
<a class="headerlink" href="#beancount.parser.printer.EntryPrinter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A multi-method interface for printing all directive types.</p>
<pre><code>Atributes:
  dcontext: An instance of DisplayContext with which to render all the numbers.
  render_weight: A boolean, true if we should render the weight of the postings
    as a comment, for debugging.
  min_width_account: An integer, the minimum width to leave for the account name.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.printer.EntryPrinter.__call__">
<code class="highlight language-python">
__call__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.parser.printer.EntryPrinter.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Render a directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td><code></code></td>
<td>
<p>The directive to be rendered.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the rendered directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>107
108
109
110
111
112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">"""Render a directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: The directive to be rendered.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered directive.</span>
<span class="sd">    """</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.printer.EntryPrinter.render_posting_strings">
<code class="highlight language-python">
render_posting_strings<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.EntryPrinter.render_posting_strings" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>This renders the three components of a posting: the account and its optional
posting flag, the position, and finally, the weight of the position. The
purpose is to align these in the caller.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>An instance of Posting, the posting to render.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of
  flag_account</code></td>
<td>
<p>A string, the account name including the flag.
  position_str: A string, the rendered position string.
  weight_str: A string, the rendered weight of the posting.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">render_posting_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""This renders the three components of a posting: the account and its optional</span>
<span class="sd">    posting flag, the position, and finally, the weight of the position. The</span>
<span class="sd">    purpose is to align these in the caller.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: An instance of Posting, the posting to render.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">        flag_account: A string, the account name including the flag.</span>
<span class="sd">        position_str: A string, the rendered position string.</span>
<span class="sd">        weight_str: A string, the rendered weight of the posting.</span>
<span class="sd">    """</span>
    <span class="c1"># Render a string of the flag and the account.</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> '</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">flag</span> <span class="k">else</span> <span class="s1">''</span>
    <span class="n">flag_account</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>

    <span class="c1"># Render a string with the amount and cost and optional price, if</span>
    <span class="c1"># present. Also render a string with the weight.</span>
    <span class="n">weight_str</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
        <span class="n">position_str</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dformat</span><span class="p">)</span>
        <span class="c1"># Note: we render weights at maximum precision, for debugging.</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span>
                                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
            <span class="n">weight_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">position_str</span> <span class="o">=</span> <span class="s1">''</span>

    <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">position_str</span> <span class="o">+=</span> <span class="s1">' @ </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dformat_max</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">flag_account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">,</span> <span class="n">weight_str</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.parser.printer.EntryPrinter.write_metadata">
<code class="highlight language-python">
write_metadata<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">'  '</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.EntryPrinter.write_metadata" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Write metadata to the file object, excluding filename and line number.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>meta</code></td>
<td><code></code></td>
<td>
<p>A dict that contains the metadata for this directive.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>oss</code></td>
<td><code></code></td>
<td>
<p>A file object to write to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">'  '</span><span class="p">):</span>
    <span class="sd">"""Write metadata to the file object, excluding filename and line number.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict that contains the metadata for this directive.</span>
<span class="sd">      oss: A file object to write to.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">META_IGNORE</span><span class="p">:</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s1">'"</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">)):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s1">'TRUE'</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s1">'FALSE'</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)):</span>
                <span class="k">pass</span> <span class="c1"># Ignore dicts, don't print them out.</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s1">''</span>  <span class="c1"># Render null metadata as empty, on purpose.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unexpected value: '</span><span class="si">{!r}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">value_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">{}{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_str</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.align_position_strings">
<code class="highlight language-python">
align_position_strings<span class="p">(</span><span class="n">strings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.align_position_strings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A helper used to align rendered amounts positions to their first currency
character (an uppercase letter). This class accepts a list of rendered
positions and calculates the necessary width to render them stacked in a
column so that the first currency word aligns. It does not go beyond that
(further currencies, e.g. for the price or cost, are not aligned).</p>
<p>This is perhaps best explained with an example. The following positions will
be aligned around the column marked with '^':</p>
<pre><code>      45 HOOL {504.30 USD}
       4 HOOL {504.30 USD, 2014-11-11}
    9.95 USD
</code></pre>
<p>-22473.32 CAD @ 1.10 USD
             ^</p>
<p>Strings without a currency character will be rendered flush left.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strings</code></td>
<td><code></code></td>
<td>
<p>A list of rendered position or amount strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of a list of aligned strings and the width of the aligned strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">align_position_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="sd">"""A helper used to align rendered amounts positions to their first currency</span>
<span class="sd">    character (an uppercase letter). This class accepts a list of rendered</span>
<span class="sd">    positions and calculates the necessary width to render them stacked in a</span>
<span class="sd">    column so that the first currency word aligns. It does not go beyond that</span>
<span class="sd">    (further currencies, e.g. for the price or cost, are not aligned).</span>

<span class="sd">    This is perhaps best explained with an example. The following positions will</span>
<span class="sd">    be aligned around the column marked with '^':</span>

<span class="sd">              45 HOOL {504.30 USD}</span>
<span class="sd">               4 HOOL {504.30 USD, 2014-11-11}</span>
<span class="sd">            9.95 USD</span>
<span class="sd">       -22473.32 CAD @ 1.10 USD</span>
<span class="sd">                 ^</span>

<span class="sd">    Strings without a currency character will be rendered flush left.</span>

<span class="sd">    Args:</span>
<span class="sd">      strings: A list of rendered position or amount strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of a list of aligned strings and the width of the aligned strings.</span>
<span class="sd">    """</span>
    <span class="c1"># Maximum length before the alignment character.</span>
    <span class="n">max_before</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length after the alignment character.</span>
    <span class="n">max_after</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length of unknown strings.</span>
    <span class="n">max_unknown</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">string_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'[A-Z]'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_before</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">max_before</span><span class="p">)</span>
                <span class="n">max_after</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">max_after</span><span class="p">)</span>
                <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>
                <span class="k">continue</span>
        <span class="c1"># else</span>
        <span class="n">max_unknown</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="n">max_unknown</span><span class="p">)</span>
        <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>

    <span class="c1"># Compute formatting string.</span>
    <span class="n">max_total</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_before</span> <span class="o">+</span> <span class="n">max_after</span><span class="p">,</span> <span class="n">max_unknown</span><span class="p">)</span>
    <span class="n">max_after_prime</span> <span class="o">=</span> <span class="n">max_total</span> <span class="o">-</span> <span class="n">max_before</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">"{{:&gt;</span><span class="si">{0}</span><span class="s2">}}{{:</span><span class="si">{1}</span><span class="s2">}}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_before</span><span class="p">,</span> <span class="n">max_after_prime</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>
    <span class="n">fmt_unknown</span> <span class="o">=</span> <span class="s2">"{{:&lt;</span><span class="si">{0}</span><span class="s2">}}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_total</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>

    <span class="c1"># Align the strings and return them.</span>
    <span class="n">aligned_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">string</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">string</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt_unknown</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">aligned_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">aligned_strings</span><span class="p">,</span> <span class="n">max_total</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.format_entry">
<code class="highlight language-python">
format_entry<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.format_entry" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Format an entry into a string in the same input syntax the parser accepts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An entry instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dcontext</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayContext used to format the numbers.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>render_weights</code></td>
<td><code></code></td>
<td>
<p>A boolean, true to render the weights for debugging.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the formatted entry.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>331
332
333
334
335
336
337
338
339
340
341</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Format an entry into a string in the same input syntax the parser accepts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An entry instance.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the formatted entry.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">)(</span><span class="n">entry</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.format_error">
<code class="highlight language-python">
format_error<span class="p">(</span><span class="n">error</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.format_error" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given an error objects, return a formatted string for it.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>error</code></td>
<td><code></code></td>
<td>
<p>a namedtuple objects representing an error. It has to have an
'entry' attribute that may be either a single directive object or a
list of directive objects.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the errors rendered.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">"""Given an error objects, return a formatted string for it.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: a namedtuple objects representing an error. It has to have an</span>
<span class="sd">        'entry' attribute that may be either a single directive object or a</span>
<span class="sd">        list of directive objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the errors rendered.</span>
<span class="sd">    """</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">render_source</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">source</span><span class="p">),</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">]</span>
        <span class="n">error_string</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">error_string</span><span class="p">,</span> <span class="s1">'   '</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.print_entries">
<code class="highlight language-python">
print_entries<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.print_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience function that prints a list of entries to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dcontext</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayContext used to format the numbers.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>render_weights</code></td>
<td><code></code></td>
<td>
<p>A boolean, true to render the weights for debugging.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>An optional file object to write the entries to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""A convenience function that prints a list of entries to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Entries is not a list: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
                      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">'buffer'</span><span class="p">)</span> <span class="k">else</span>
                      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">previous_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">entries</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">eprinter</span> <span class="o">=</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="c1"># Insert a newline between transactions and between blocks of directives</span>
        <span class="c1"># of the same type.</span>
        <span class="n">entry_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">entry_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Commodity</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">entry_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">previous_type</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">previous_type</span> <span class="o">=</span> <span class="n">entry_type</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">eprinter</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.print_entry">
<code class="highlight language-python">
print_entry<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.print_entry" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience function that prints a single entry to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A directive entry.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dcontext</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayContext used to format the numbers.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>render_weights</code></td>
<td><code></code></td>
<td>
<p>A boolean, true to render the weights for debugging.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>An optional file object to write the entries to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>344
345
346
347
348
349
350
351
352
353
354
355</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""A convenience function that prints a single entry to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A directive entry.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.print_error">
<code class="highlight language-python">
print_error<span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.print_error" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience function that prints a single error to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>error</code></td>
<td><code></code></td>
<td>
<p>An error object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>An optional file object to write the errors to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425
426
427
428
429
430
431
432</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""A convenience function that prints a single error to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: An error object.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.print_errors">
<code class="highlight language-python">
print_errors<span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.print_errors" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience function that prints a list of errors to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>errors</code></td>
<td><code></code></td>
<td>
<p>A list of errors.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>An optional file object to write the errors to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>435
436
437
438
439
440
441
442
443
444
445
446
447</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""A convenience function that prints a list of errors to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      errors: A list of errors.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer.render_source">
<code class="highlight language-python">
render_source<span class="p">(</span><span class="n">meta</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer.render_source" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render the source for errors in a way that it will be both detected by
Emacs and align and rendered nicely.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>meta</code></td>
<td><code></code></td>
<td>
<p>A dict with the metadata.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, rendered to be interpretable as a message location for Emacs or
other editors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>389
390
391
392
393
394
395
396
397
398
399</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">render_source</span><span class="p">(</span><span class="n">meta</span><span class="p">):</span>
    <span class="sd">"""Render the source for errors in a way that it will be both detected by</span>
<span class="sd">    Emacs and align and rendered nicely.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict with the metadata.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, rendered to be interpretable as a message location for Emacs or</span>
<span class="sd">      other editors.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">:</span><span class="si">{:8}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">'lineno'</span><span class="p">]))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.parser.printer_test">
<code>printer_test</code>
<a class="headerlink" href="#beancount.parser.printer_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.parser.printer_test.characterize_spaces">
<code class="highlight language-python">
characterize_spaces<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.parser.printer_test.characterize_spaces" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Classify each line to a particular type.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text</code></td>
<td><code></code></td>
<td>
<p>A string, the text to classify.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of line types, one for each line.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/parser/printer_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">characterize_spaces</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Classify each line to a particular type.</span>

<span class="sd">    Args:</span>
<span class="sd">      text: A string, the text to classify.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of line types, one for each line.</span>
<span class="sd">    """</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d\d\d\d-\d\d-\d\d open'</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">linecls</span> <span class="o">=</span> <span class="s1">'open'</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d\d\d\d-\d\d-\d\d price'</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">linecls</span> <span class="o">=</span> <span class="s1">'price'</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d\d\d\d-\d\d-\d\d'</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">linecls</span> <span class="o">=</span> <span class="s1">'txn'</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[ \t]$'</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">linecls</span> <span class="o">=</span> <span class="s1">'empty'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">linecls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linecls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lines</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.plugins.html" title="beancount.plugins">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="beancount.ops.html" title="beancount.ops"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/xuhcc/beancount-docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.ops.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.plugins.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
