<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://xuhcc.github.io/beancount-docs/api_reference/beancount.core.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.core - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.core";
    var mkdocs_page_input_path = "api_reference/beancount.core.md";
    var mkdocs_page_url = "/beancount-docs/api_reference/beancount.core.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.core.html">beancount.core</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.core">beancount.core</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.account">account</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.AccountTransformer">AccountTransformer</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account.AccountTransformer.parse">parse()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account.AccountTransformer.render">render()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.commonprefix">commonprefix()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.has_component">has_component()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.is_valid">is_valid()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.join">join()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.leaf">leaf()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.parent">parent()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.parent_matcher">parent_matcher()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.parents">parents()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.root">root()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.sans_root">sans_root()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.split">split()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account.walk">walk()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.account_test">account_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_test.TmpFilesTestBase">TmpFilesTestBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_test.TmpFilesTestBase.create_file_hierarchy">create_file_hierarchy()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_test.TmpFilesTestBase.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_test.TmpFilesTestBase.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.account_types">account_types</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.AccountTypes">AccountTypes</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_types.AccountTypes.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_types.AccountTypes.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.account_types.AccountTypes.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.get_account_sign">get_account_sign()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.get_account_sort_key">get_account_sort_key()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.get_account_type">get_account_type()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.is_account_type">is_account_type()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.is_balance_sheet_account">is_balance_sheet_account()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.is_equity_account">is_equity_account()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.is_income_statement_account">is_income_statement_account()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.account_types.is_root_account">is_root_account()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.amount">amount</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.Amount">Amount</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__bool__">__bool__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__eq__">__eq__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__hash__">__hash__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__lt__">__lt__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__neg__">__neg__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.__str__">__str__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.from_string">from_string()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.amount.Amount.to_string">to_string()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.A">A()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.abs">abs()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.add">add()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.div">div()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.from_string">from_string()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.mul">mul()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.sortkey">sortkey()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.amount.sub">sub()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.compare">compare</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.CompareError">CompareError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.compare.CompareError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.compare.CompareError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.compare.CompareError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.compare_entries">compare_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.excludes_entries">excludes_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.hash_entries">hash_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.hash_entry">hash_entry()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.includes_entries">includes_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.compare.stable_hash_namedtuple">stable_hash_namedtuple()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.convert">convert</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.convert_amount">convert_amount()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.convert_position">convert_position()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.get_cost">get_cost()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.get_units">get_units()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.get_value">get_value()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert.get_weight">get_weight()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.convert_test">convert_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert_test.TestMarketValue">TestMarketValue</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.convert_test.TestMarketValue.setUp">setUp()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert_test.TestPositionConversions">TestPositionConversions</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert_test.TestPostingConversions">TestPostingConversions</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.convert_test.build_price_map_util">build_price_map_util()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.data">data</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Balance">Balance</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Balance.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Balance.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Balance.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Booking">Booking</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Close">Close</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Close.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Close.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Close.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Commodity">Commodity</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Commodity.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Commodity.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Commodity.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Custom">Custom</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Custom.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Custom.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Custom.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Document">Document</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Document.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Document.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Document.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Event">Event</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Event.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Event.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Event.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Note">Note</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Note.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Note.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Note.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Open">Open</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Open.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Open.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Open.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Pad">Pad</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Pad.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Pad.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Pad.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Posting">Posting</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Posting.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Posting.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Posting.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Price">Price</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Price.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Price.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Price.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Query">Query</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Query.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Query.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Query.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.Transaction">Transaction</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Transaction.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Transaction.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.Transaction.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.TxnPosting">TxnPosting</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.TxnPosting.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.TxnPosting.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.data.TxnPosting.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.create_simple_posting">create_simple_posting()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.create_simple_posting_with_cost">create_simple_posting_with_cost()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.entry_sortkey">entry_sortkey()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.filter_txns">filter_txns()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.find_closest">find_closest()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.get_entry">get_entry()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.has_entry_account_component">has_entry_account_component()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.iter_entry_dates">iter_entry_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.new_directive">new_directive()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.new_metadata">new_metadata()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.posting_has_conversion">posting_has_conversion()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.posting_sortkey">posting_sortkey()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.remove_account_postings">remove_account_postings()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.sanity_check_types">sanity_check_types()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.sorted">sorted()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.data.transaction_has_conversion">transaction_has_conversion()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.display_context">display_context</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.display_context.Align">Align</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.display_context.DisplayContext">DisplayContext</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.display_context.DisplayContext.build">build()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.display_context.DisplayContext.quantize">quantize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.display_context.DisplayContext.set_commas">set_commas()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.display_context.DisplayContext.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.display_context.DisplayFormatter">DisplayFormatter</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.display_context.Precision">Precision</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.distribution">distribution</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.distribution.Distribution">Distribution</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.distribution.Distribution.empty">empty()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.distribution.Distribution.max">max()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.distribution.Distribution.min">min()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.distribution.Distribution.mode">mode()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.distribution.Distribution.update">update()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.distribution_test">distribution_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.flags">flags</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.getters">getters</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.GetAccounts">GetAccounts</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Balance">Balance()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Close">Close()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Commodity">Commodity()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Custom">Custom()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Document">Document()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Event">Event()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.get_accounts_use_map">get_accounts_use_map()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.get_entry_accounts">get_entry_accounts()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Note">Note()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Open">Open()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Pad">Pad()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Price">Price()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Query">Query()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.getters.GetAccounts.Transaction">Transaction()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_account_components">get_account_components()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_account_open_close">get_account_open_close()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_accounts">get_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_accounts_use_map">get_accounts_use_map()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_active_years">get_active_years()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_all_links">get_all_links()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_all_payees">get_all_payees()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_all_tags">get_all_tags()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_commodity_map">get_commodity_map()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_dict_accounts">get_dict_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_entry_accounts">get_entry_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_leveln_parent_accounts">get_leveln_parent_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_min_max_dates">get_min_max_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.getters.get_values_meta">get_values_meta()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.interpolate">interpolate</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.BalanceError">BalanceError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.interpolate.BalanceError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.interpolate.BalanceError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.interpolate.BalanceError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.compute_entries_balance">compute_entries_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.compute_entry_context">compute_entry_context()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.compute_residual">compute_residual()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.fill_residual_posting">fill_residual_posting()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.get_residual_postings">get_residual_postings()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.has_nontrivial_balance">has_nontrivial_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.infer_tolerances">infer_tolerances()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.is_tolerance_user_specified">is_tolerance_user_specified()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.interpolate.quantize_with_tolerance">quantize_with_tolerance()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.inventory">inventory</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.inventory.Booking">Booking</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.inventory.Inventory">Inventory</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__abs__">__abs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__add__">__add__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__copy__">__copy__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__iadd__">__iadd__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__iter__">__iter__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__lt__">__lt__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__mul__">__mul__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__neg__">__neg__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.__str__">__str__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.add_amount">add_amount()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.add_inventory">add_inventory()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.add_position">add_position()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.average">average()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.cost_currencies">cost_currencies()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.currencies">currencies()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.currency_pairs">currency_pairs()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.from_string">from_string()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.get_currency_units">get_currency_units()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.get_only_position">get_only_position()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.get_positions">get_positions()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.is_empty">is_empty()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.is_mixed">is_mixed()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.is_reduced_by">is_reduced_by()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.is_small">is_small()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.reduce">reduce()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.segregate_units">segregate_units()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.inventory.Inventory.to_string">to_string()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.inventory.check_invariants">check_invariants()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.inventory.from_string">from_string()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.inventory_test">inventory_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.number">number</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.number.D">D()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.number.is_fast_decimal">is_fast_decimal()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.number.round_to">round_to()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.number.same_sign">same_sign()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.position">position</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.Cost">Cost</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Cost.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Cost.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Cost.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.CostSpec">CostSpec</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.CostSpec.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.CostSpec.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.CostSpec.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.Position">Position</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__abs__">__abs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__copy__">__copy__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__eq__">__eq__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__hash__">__hash__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__lt__">__lt__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__mul__">__mul__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__neg__">__neg__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.__str__">__str__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.currency_pair">currency_pair()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.from_amounts">from_amounts()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.from_string">from_string()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.get_negative">get_negative()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.is_negative_at_cost">is_negative_at_cost()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.sortkey">sortkey()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.position.Position.to_string">to_string()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.cost_to_str">cost_to_str()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.from_amounts">from_amounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.from_string">from_string()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.get_position">get_position()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.position.to_string">to_string()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.position_test">position_test</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.prices">prices</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.PriceMap">PriceMap</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.build_price_map">build_price_map()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.get_all_prices">get_all_prices()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.get_last_price_entries">get_last_price_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.get_latest_price">get_latest_price()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.get_price">get_price()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.prices.normalize_base_quote">normalize_base_quote()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.realization">realization</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.RealAccount">RealAccount</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.realization.RealAccount.__eq__">__eq__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.realization.RealAccount.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.realization.RealAccount.__ne__">__ne__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.realization.RealAccount.__setitem__">__setitem__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.core.realization.RealAccount.copy">copy()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.compute_balance">compute_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.compute_postings_balance">compute_postings_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.contains">contains()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.dump">dump()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.dump_balances">dump_balances()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.filter">filter()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.find_last_active_posting">find_last_active_posting()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.get">get()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.get_or_create">get_or_create()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.get_postings">get_postings()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.index_key">index_key()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.iter_children">iter_children()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.iterate_with_balance">iterate_with_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.postings_by_account">postings_by_account()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.core.realization.realize">realize()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.core.realization_test">realization_test</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.core</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/xuhcc/beancount-docs/edit/master/docs/api_reference/beancount.core.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountcore">beancount.core<a class="headerlink" href="#beancountcore" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.core" id="beancount.core" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.core" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Core basic objects and data structures to represent a list of entries.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.account">
<code>account</code>
<a class="headerlink" href="#beancount.core.account" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Functions that operate on account strings.</p>
<p>These account objects are rather simple and dumb; they do not contain the list
of their associated postings. This is achieved by building a realization; see
realization.py for details.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.account.AccountTransformer">
<code>AccountTransformer</code>
<a class="headerlink" href="#beancount.core.account.AccountTransformer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Account name transformer.</p>
<pre><code>This is used to support Win... huh, filesystems and platforms which do not
support colon characters.

Attributes:
  rsep: A character string, the new separator to use in link names.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account.AccountTransformer.parse">
<code class="highlight language-python">
parse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformed_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.AccountTransformer.parse" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert the transform account name to an account name.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>223
224
225
226
227</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformed_name</span><span class="p">):</span>
    <span class="s2">"Convert the transform account name to an account name."</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">transformed_name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsep</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">transformed_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rsep</span><span class="p">,</span> <span class="n">sep</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account.AccountTransformer.render">
<code class="highlight language-python">
render<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.AccountTransformer.render" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert the account name to a transformed account name.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>217
218
219
220
221</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="s2">"Convert the account name to a transformed account name."</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">account_name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsep</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">account_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsep</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.commonprefix">
<code class="highlight language-python">
commonprefix<span class="p">(</span><span class="n">accounts</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.commonprefix" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the common prefix of a list of account names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>accounts</code></td>
<td><code></code></td>
<td>
<p>A sequence of account name strings.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the common parent account. If none, returns an empty string.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">commonprefix</span><span class="p">(</span><span class="n">accounts</span><span class="p">):</span>
    <span class="sd">"""Return the common prefix of a list of account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      accounts: A sequence of account name strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the common parent account. If none, returns an empty string.</span>
<span class="sd">    """</span>
    <span class="n">accounts_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">account_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">account_</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">]</span>
    <span class="c1"># Note: the os.path.commonprefix() function just happens to work here.</span>
    <span class="c1"># Inspect its code, and even the special case of no common prefix</span>
    <span class="c1"># works well with str.join() below.</span>
    <span class="n">common_list</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">(</span><span class="n">accounts_lists</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common_list</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.has_component">
<code class="highlight language-python">
has_component<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.has_component" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if one of the account contains a given component.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>component</code></td>
<td><code></code></td>
<td>
<p>A string, a component of an account name. For instance,
'Food' in 'Expenses:Food:Restaurant'. All components are considered.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A boolean, true if the component is in the account. Note that a component
name must be whole, that is 'NY' is not in Expenses</code></td>
<td>
<p>Taxes:StateNY'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>129
130
131
132
133
134
135
136
137
138
139
140</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">has_component</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
    <span class="sd">"""Return true if one of the account contains a given component.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">      component: A string, a component of an account name. For instance,</span>
<span class="sd">        'Food' in 'Expenses:Food:Restaurant'. All components are considered.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the component is in the account. Note that a component</span>
<span class="sd">      name must be whole, that is 'NY' is not in Expenses:Taxes:StateNY'.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'(^|:)</span><span class="si">{}</span><span class="s1">(:|$)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">component</span><span class="p">),</span> <span class="n">account_name</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.is_valid">
<code class="highlight language-python">
is_valid<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.is_valid" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given string is a valid account name.
This does not check for the root account types, just the general syntax.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string, to be checked for account name pattern.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the string has the form of an account's name.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40
41
42
43
44
45
46
47
48
49</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Return true if the given string is a valid account name.</span>
<span class="sd">    This does not check for the root account types, just the general syntax.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string, to be checked for account name pattern.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the string has the form of an account's name.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ACCOUNT_RE</span><span class="p">),</span> <span class="n">string</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.join">
<code class="highlight language-python">
join<span class="p">(</span><span class="o">*</span><span class="n">components</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.join" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Join the names with the account separator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*components</code></td>
<td><code></code></td>
<td>
<p>Strings, the components of an account name.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, joined in a single account name.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>52
53
54
55
56
57
58
59
60</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="o">*</span><span class="n">components</span><span class="p">):</span>
    <span class="sd">"""Join the names with the account separator.</span>

<span class="sd">    Args:</span>
<span class="sd">      *components: Strings, the components of an account name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, joined in a single account name.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.leaf">
<code class="highlight language-python">
leaf<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.leaf" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of the leaf of this account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose leaf name to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the name of the leaf of the account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>90
91
92
93
94
95
96
97
98
99</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">leaf</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Get the name of the leaf of this account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account whose leaf name to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the name of the leaf of the account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">account_name</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.parent">
<code class="highlight language-python">
parent<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.parent" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the name of the parent account of the given account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose parent to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the name of the parent account of this account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Return the name of the parent account of the given account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account whose parent to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the name of the parent account of this account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">account_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">account_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">account_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">components</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.parent_matcher">
<code class="highlight language-python">
parent_matcher<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.parent_matcher" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build a predicate that returns whether an account is under the given one.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>The name of the parent account we want to check for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A callable, which, when called, will return true if the given account is a
child of 'account_name'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>180
181
182
183
184
185
186
187
188
189</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parent_matcher</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Build a predicate that returns whether an account is under the given one.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: The name of the parent account we want to check for.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A callable, which, when called, will return true if the given account is a</span>
<span class="sd">      child of 'account_name'.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'</span><span class="si">{}</span><span class="s1">($|</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">account_name</span><span class="p">),</span> <span class="n">sep</span><span class="p">))</span><span class="o">.</span><span class="n">match</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.parents">
<code class="highlight language-python">
parents<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.parents" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A generator of the names of the parents of this account, including this account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>The name of the account we want to start iterating from.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A generator of account name strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>192
193
194
195
196
197
198
199
200
201
202</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""A generator of the names of the parents of this account, including this account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: The name of the account we want to start iterating from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A generator of account name strings.</span>
<span class="sd">    """</span>
    <span class="k">while</span> <span class="n">account_name</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">account_name</span>
        <span class="n">account_name</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.root">
<code class="highlight language-python">
root<span class="p">(</span><span class="n">num_components</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.root" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the first few components of an account's name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_components</code></td>
<td><code></code></td>
<td>
<p>An integer, the number of components to return.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the account root up to 'num_components' components.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>117
118
119
120
121
122
123
124
125
126</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="n">num_components</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Return the first few components of an account's name.</span>

<span class="sd">    Args:</span>
<span class="sd">      num_components: An integer, the number of components to return.</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the account root up to 'num_components' components.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">)[:</span><span class="n">num_components</span><span class="p">]))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.sans_root">
<code class="highlight language-python">
sans_root<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.sans_root" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of the account without the root.</p>
<p>For example, an input of 'Assets:BofA:Checking' will produce 'BofA:Checking'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose leaf name to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the name of the non-root portion of this account name.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>102
103
104
105
106
107
108
109
110
111
112
113
114</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sans_root</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Get the name of the account without the root.</span>

<span class="sd">    For example, an input of 'Assets:BofA:Checking' will produce 'BofA:Checking'.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account whose leaf name to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the name of the non-root portion of this account name.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">account_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">components</span><span class="p">)</span> <span class="k">if</span> <span class="n">account_name</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.split">
<code class="highlight language-python">
split<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.split" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Split an account's name into its components.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of strings, the components of the account name (without the separators).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>63
64
65
66
67
68
69
70
71</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Split an account's name into its components.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of strings, the components of the account name (without the separators).</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">account_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account.walk">
<code class="highlight language-python">
walk<span class="p">(</span><span class="n">root_directory</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account.walk" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A version of os.walk() which yields directories that are valid account names.</p>
<p>This only yields directories that are accounts... it skips the other ones.
For convenience, it also yields you the account's name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root_directory</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the root of the hierarchy to be walked.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Tuples of (root, account-name, dirs, files), similar to os.walk().</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">root_directory</span><span class="p">):</span>
    <span class="sd">"""A version of os.walk() which yields directories that are valid account names.</span>

<span class="sd">    This only yields directories that are accounts... it skips the other ones.</span>
<span class="sd">    For convenience, it also yields you the account's name.</span>

<span class="sd">    Args:</span>
<span class="sd">      root_directory: A string, the name of the root of the hierarchy to be walked.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Tuples of (root, account-name, dirs, files), similar to os.walk().</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root_directory</span><span class="p">):</span>
        <span class="n">dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">relroot</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">root_directory</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">account_name</span> <span class="o">=</span> <span class="n">relroot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_valid</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.account_test">
<code>account_test</code>
<a class="headerlink" href="#beancount.core.account_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.account_test.TmpFilesTestBase">
<code>TmpFilesTestBase</code>
<a class="headerlink" href="#beancount.core.account_test.TmpFilesTestBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A test utility base class that creates and cleans up a directory hierarchy.
    This convenience is useful for testing functions that work on files, such as the
    documents tests, or the accounts walk.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_test.TmpFilesTestBase.create_file_hierarchy">
<code class="highlight language-python">
create_file_hierarchy<span class="p">(</span><span class="n">test_files</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="s1">'root'</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.account_test.TmpFilesTestBase.create_file_hierarchy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A test utility that creates a hierarchy of files.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test_files</code></td>
<td><code></code></td>
<td>
<p>A list of strings, relative filenames to a temporary root
directory. If the filename ends with a '/', we create a directory;
otherwise, we create a regular file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>subdir</code></td>
<td><code></code></td>
<td>
<p>A string, the subdirectory name under the temporary directory
location, to create the hierarchy under.</p>
</td>
<td><code>'root'</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of strings, the temporary directory, and the subdirectory under
  that which hosts the root of the tree.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">create_file_hierarchy</span><span class="p">(</span><span class="n">test_files</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="s1">'root'</span><span class="p">):</span>
    <span class="sd">"""A test utility that creates a hierarchy of files.</span>

<span class="sd">    Args:</span>
<span class="sd">      test_files: A list of strings, relative filenames to a temporary root</span>
<span class="sd">        directory. If the filename ends with a '/', we create a directory;</span>
<span class="sd">        otherwise, we create a regular file.</span>
<span class="sd">      subdir: A string, the subdirectory name under the temporary directory</span>
<span class="sd">        location, to create the hierarchy under.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of strings, the temporary directory, and the subdirectory under</span>
<span class="sd">        that which hosts the root of the tree.</span>
<span class="sd">    """</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"beancount-test-tmpdir."</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">test_files</span><span class="p">:</span>
        <span class="n">abs_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'/'</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">abs_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">return</span> <span class="n">tempdir</span><span class="p">,</span> <span class="n">root</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_test.TmpFilesTestBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_test.TmpFilesTestBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>25
26</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_file_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEST_DOCUMENTS</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_test.TmpFilesTestBase.tearDown">
<code class="highlight language-python">
tearDown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_test.TmpFilesTestBase.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>28
29</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.account_types">
<code>account_types</code>
<a class="headerlink" href="#beancount.core.account_types" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Definition for global account types.</p>
<p>This is where we keep the global account types value and definition.</p>
<p>Note that it's unfortunate that we're using globals and side-effect here, but
this is the best solution in the short-term, the account types are used
in too many places to pass around that state everywhere. Maybe we change
this later on.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.account_types.AccountTypes">
<code>AccountTypes</code>
<a class="headerlink" href="#beancount.core.account_types.AccountTypes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>AccountTypes(assets, liabilities, equity, income, expenses)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_types.AccountTypes.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.account_types.AccountTypes.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_types.AccountTypes.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">liabilities</span><span class="p">,</span> <span class="n">equity</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">expenses</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.account_types.AccountTypes.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of AccountTypes(assets, liabilities, equity, income, expenses)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.account_types.AccountTypes.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.account_types.AccountTypes.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.get_account_sign">
<code class="highlight language-python">
get_account_sign<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.get_account_sign" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the sign of the normal balance of a particular account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose sign is to return.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An optional instance of the current account_types.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>+1 or -1, depending on the account's type.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_sign</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the sign of the normal balance of a particular account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account whose sign is to return.</span>
<span class="sd">      account_types: An optional instance of the current account_types.</span>
<span class="sd">    Returns:</span>
<span class="sd">      +1 or -1, depending on the account's type.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">account_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">account_types</span> <span class="o">=</span> <span class="n">DEFAULT_ACCOUNT_TYPES</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="n">account_type</span> <span class="o">=</span> <span class="n">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">account_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">account_types</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span>
                                <span class="n">account_types</span><span class="o">.</span><span class="n">expenses</span><span class="p">)</span>
            <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.get_account_sort_key">
<code class="highlight language-python">
get_account_sort_key<span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.get_account_sort_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a tuple that can be used to order/sort account names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An instance of AccountTypes, a tuple of account type names.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A function object to use as the optional 'key' argument to the sort
function. It accepts a single argument, the account name to sort and
produces a sortable key.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_sort_key</span><span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Return a tuple that can be used to order/sort account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_types: An instance of AccountTypes, a tuple of account type names.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A function object to use as the optional 'key' argument to the sort</span>
<span class="sd">      function. It accepts a single argument, the account name to sort and</span>
<span class="sd">      produces a sortable key.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">account_types</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">)),</span> <span class="n">account_name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.get_account_type">
<code class="highlight language-python">
get_account_type<span class="p">(</span><span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.get_account_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the type of this account's name.</p>
<p>Warning: No check is made on the validity of the account type. This merely
returns the root account of the corresponding account name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose type is to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the type of the account in 'account_name'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Return the type of this account's name.</span>

<span class="sd">    Warning: No check is made on the validity of the account type. This merely</span>
<span class="sd">    returns the root account of the corresponding account name.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account whose type is to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the type of the account in 'account_name'.</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.is_account_type">
<code class="highlight language-python">
is_account_type<span class="p">(</span><span class="n">account_type</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.is_account_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the type of this account's name.</p>
<p>Warning: No check is made on the validity of the account type. This merely
returns the root account of the corresponding account name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_type</code></td>
<td><code></code></td>
<td>
<p>A string, the prefix type of the account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account whose type is to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the account is of the given type.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_account_type</span><span class="p">(</span><span class="n">account_type</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Return the type of this account's name.</span>

<span class="sd">    Warning: No check is made on the validity of the account type. This merely</span>
<span class="sd">    returns the root account of the corresponding account name.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_type: A string, the prefix type of the account.</span>
<span class="sd">      account_name: A string, the name of the account whose type is to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the account is of the given type.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'^</span><span class="si">{}{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_type</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">sep</span><span class="p">),</span> <span class="n">account_name</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.is_balance_sheet_account">
<code class="highlight language-python">
is_balance_sheet_account<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.is_balance_sheet_account" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given account is a balance sheet account.
Assets, liabilities and equity accounts are balance sheet accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An instance of AccountTypes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the account is a balance sheet account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_balance_sheet_account</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">):</span>
    <span class="sd">"""Return true if the given account is a balance sheet account.</span>
<span class="sd">    Assets, liabilities and equity accounts are balance sheet accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">      account_types: An instance of AccountTypes.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the account is a balance sheet account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">AccountTypes</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Account types has invalid type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_types</span><span class="p">))</span>
    <span class="n">account_type</span> <span class="o">=</span> <span class="n">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">account_types</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span>
                            <span class="n">account_types</span><span class="o">.</span><span class="n">liabilities</span><span class="p">,</span>
                            <span class="n">account_types</span><span class="o">.</span><span class="n">equity</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.is_equity_account">
<code class="highlight language-python">
is_equity_account<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.is_equity_account" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given account is an equity account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An instance of AccountTypes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the account is an equity account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_equity_account</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">):</span>
    <span class="sd">"""Return true if the given account is an equity account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">      account_types: An instance of AccountTypes.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the account is an equity account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">AccountTypes</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Account types has invalid type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_types</span><span class="p">))</span>
    <span class="n">account_type</span> <span class="o">=</span> <span class="n">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account_type</span> <span class="o">==</span> <span class="n">account_types</span><span class="o">.</span><span class="n">equity</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.is_income_statement_account">
<code class="highlight language-python">
is_income_statement_account<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.is_income_statement_account" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given account is an income statement account.
Income and expense accounts are income statement accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, an account name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An instance of AccountTypes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the account is an income statement account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_income_statement_account</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="p">):</span>
    <span class="sd">"""Return true if the given account is an income statement account.</span>
<span class="sd">    Income and expense accounts are income statement accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, an account name.</span>
<span class="sd">      account_types: An instance of AccountTypes.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the account is an income statement account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">AccountTypes</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Account types has invalid type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_types</span><span class="p">))</span>
    <span class="n">account_type</span> <span class="o">=</span> <span class="n">get_account_type</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">account_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">account_types</span><span class="o">.</span><span class="n">income</span><span class="p">,</span>
                            <span class="n">account_types</span><span class="o">.</span><span class="n">expenses</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.account_types.is_root_account">
<code class="highlight language-python">
is_root_account<span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.account_types.is_root_account" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the account name is a root account.
This function does not verify whether the account root is a valid
one, just that it is a root account or not.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the account to check for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_types</code></td>
<td><code></code></td>
<td>
<p>An optional instance of the current account_types;
if provided, we check against these values. If not provided, we
merely check that name pattern is that of an account component with
no separator.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the account is root account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/account_types.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_root_account</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return true if the account name is a root account.</span>
<span class="sd">    This function does not verify whether the account root is a valid</span>
<span class="sd">    one, just that it is a root account or not.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of the account to check for.</span>
<span class="sd">      account_types: An optional instance of the current account_types;</span>
<span class="sd">        if provided, we check against these values. If not provided, we</span>
<span class="sd">        merely check that name pattern is that of an account component with</span>
<span class="sd">        no separator.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the account is root account.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Account is not a string: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">account_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_types</span><span class="p">,</span> <span class="n">AccountTypes</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">"Account types has invalid type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_types</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">account_types</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">account_name</span> <span class="ow">and</span>
                <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'([A-Z][A-Za-z0-9\-]+)$'</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.amount">
<code>amount</code>
<a class="headerlink" href="#beancount.core.amount" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Amount class.</p>
<p>This simple class is used to associate a number of units of a currency with its
currency:</p>
<p>(number, currency).</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.amount.Amount">
<code>Amount</code>
<a class="headerlink" href="#beancount.core.amount.Amount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An 'Amount' represents a number of a particular unit of something.</p>
<pre><code>It's essentially a typed number, with corresponding manipulation operations
defined on it.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__bool__">
<code class="highlight language-python">
__bool__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__bool__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Boolean predicate returns true if the number is non-zero.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if non-zero number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>76
77
78
79
80
81</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Boolean predicate returns true if the number is non-zero.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if non-zero number.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">ZERO</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__eq__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Equality predicate. Returns true if both number and currency are equal.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>83
84
85
86
87
88
89
90</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Equality predicate. Returns true if both number and currency are equal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__hash__">
<code class="highlight language-python">
__hash__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__hash__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A hashing function for amounts. The hash includes the currency.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An integer, the hash for this amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>101
102
103
104
105
106</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""A hashing function for amounts. The hash includes the currency.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An integer, the hash for this amount.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__lt__">
<code class="highlight language-python">
__lt__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__lt__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Ordering comparison. This is used in the sorting key of positions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>True if this is less than the other Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>92
93
94
95
96
97
98
99</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Ordering comparison. This is used in the sorting key of positions.</span>
<span class="sd">    Args:</span>
<span class="sd">      other: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      True if this is less than the other Amount.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">sortkey</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__neg__">
<code class="highlight language-python">
__neg__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__neg__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the negative of this amount.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Amount, with the negative number of units.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>108
109
110
111
112
113</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the negative of this amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Amount, with the negative number of units.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Constructor from a number and currency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A string or Decimal instance. Will get converted automatically.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency symbol to use.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>42
43
44
45
46
47
48
49
50
51</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Constructor from a number and currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: A string or Decimal instance. Will get converted automatically.</span>
<span class="sd">      currency: A string, the currency symbol to use.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Amount</span><span class="o">.</span><span class="n">valid_types_number</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">Amount</span><span class="o">.</span><span class="n">valid_types_currency</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_Amount</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert an Amount instance to a printable string with the defaults.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A formatted string of the quantized amount and symbol.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>66
67
68
69
70
71
72</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Convert an Amount instance to a printable string with the defaults.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A formatted string of the quantized amount and symbol.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.__str__">
<code class="highlight language-python">
__str__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.__str__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert an Amount instance to a printable string with the defaults.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A formatted string of the quantized amount and symbol.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>66
67
68
69
70
71
72</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Convert an Amount instance to a printable string with the defaults.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A formatted string of the quantized amount and symbol.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.amount.Amount.from_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create an amount from a string.</p>
<p>This is a miniature parser used for building tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string of &lt;number&gt; &lt;currency&gt;.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create an amount from a string.</span>

<span class="sd">    This is a miniature parser used for building tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string of &lt;number&gt; &lt;currency&gt;.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Amount.</span>
<span class="sd">    """</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\s*([-+]?[0-9.]+)\s+(</span><span class="si">{currency}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
                     <span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid string for amount: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="n">number</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.amount.Amount.to_string">
<code class="highlight language-python">
to_string<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=&lt;</span><span class="n">beancount</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display_context</span><span class="o">.</span><span class="n">DisplayFormatter</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fdddb06de80</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.Amount.to_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert an Amount instance to a printable string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayFormatter.</p>
</td>
<td><code>&lt;beancount.core.display_context.DisplayFormatter object at 0x7fdddb06de80&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A formatted string of the quantized amount and symbol.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>53
54
55
56
57
58
59
60
61
62
63
64</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="n">DEFAULT_FORMATTER</span><span class="p">):</span>
    <span class="sd">"""Convert an Amount instance to a printable string.</span>

<span class="sd">    Args:</span>
<span class="sd">      dformat: An instance of DisplayFormatter.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A formatted string of the quantized amount and symbol.</span>
<span class="sd">    """</span>
    <span class="n">number_fmt</span> <span class="o">=</span> <span class="p">(</span><span class="n">dformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span>
                  <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">"</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_fmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.A">
<code class="highlight language-python">
A<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.A" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create an amount from a string.</p>
<p>This is a miniature parser used for building tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string of &lt;number&gt; &lt;currency&gt;.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create an amount from a string.</span>

<span class="sd">    This is a miniature parser used for building tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string of &lt;number&gt; &lt;currency&gt;.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Amount.</span>
<span class="sd">    """</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\s*([-+]?[0-9.]+)\s+(</span><span class="si">{currency}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
                     <span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid string for amount: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="n">number</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.abs">
<code class="highlight language-python">
abs<span class="p">(</span><span class="n">amount</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.abs" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the absolute value of the given amount.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>219
220
221
222
223
224
225
226
227
228
229</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="sd">"""Return the absolute value of the given amount.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amount</span>
            <span class="k">if</span> <span class="n">amount</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="n">ZERO</span>
            <span class="k">else</span> <span class="n">Amount</span><span class="p">(</span><span class="o">-</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.add">
<code class="highlight language-python">
add<span class="p">(</span><span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.add" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Add the given amounts with the same currency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount1</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount2</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Amount, with the sum the two amount's numbers, in the same
currency.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">):</span>
    <span class="sd">"""Add the given amounts with the same currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount1: An instance of Amount.</span>
<span class="sd">      amount2: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount, with the sum the two amount's numbers, in the same</span>
<span class="sd">      currency.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount1's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount2's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">amount1</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">amount2</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"Unmatching currencies for operation on </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">amount1</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.div">
<code class="highlight language-python">
div<span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.div" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Divide the given amount by a number.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A decimal number.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount, with the same currency, but with amount units divided by 'number'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">"""Divide the given amount by a number.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An instance of Amount.</span>
<span class="sd">      number: A decimal number.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount, with the same currency, but with amount units divided by 'number'.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span> <span class="o">/</span> <span class="n">number</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.from_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create an amount from a string.</p>
<p>This is a miniature parser used for building tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string of &lt;number&gt; &lt;currency&gt;.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create an amount from a string.</span>

<span class="sd">    This is a miniature parser used for building tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string of &lt;number&gt; &lt;currency&gt;.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Amount.</span>
<span class="sd">    """</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\s*([-+]?[0-9.]+)\s+(</span><span class="si">{currency}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
                     <span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid string for amount: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="n">number</span><span class="p">,</span> <span class="n">currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.mul">
<code class="highlight language-python">
mul<span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.mul" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Multiply the given amount by a number.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A decimal number.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount, with the same currency, but with 'number' times units.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">"""Multiply the given amount by a number.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An instance of Amount.</span>
<span class="sd">      number: A decimal number.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount, with the same currency, but with 'number' times units.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">number</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.sortkey">
<code class="highlight language-python">
sortkey<span class="p">(</span><span class="n">amount</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.sortkey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A comparison function that sorts by currency first.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A sort key, composed of the currency first and then the number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>139
140
141
142
143
144
145
146
147</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sortkey</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="sd">"""A comparison function that sorts by currency first.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A sort key, composed of the currency first and then the number.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.amount.sub">
<code class="highlight language-python">
sub<span class="p">(</span><span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.amount.sub" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Subtract the given amounts with the same currency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount1</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount2</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Amount, with the difference between the two amount's
numbers, in the same currency.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/amount.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">):</span>
    <span class="sd">"""Subtract the given amounts with the same currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount1: An instance of Amount.</span>
<span class="sd">      amount2: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount, with the difference between the two amount's</span>
<span class="sd">      numbers, in the same currency.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount1's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Amount2's number is not a Decimal instance: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">amount1</span><span class="o">.</span><span class="n">currency</span> <span class="o">!=</span> <span class="n">amount2</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"Unmatching currencies for operation on </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">amount1</span><span class="p">,</span> <span class="n">amount2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amount1</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">amount2</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">amount1</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.compare">
<code>compare</code>
<a class="headerlink" href="#beancount.core.compare" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Comparison helpers for data objects.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.compare.CompareError">
<code>CompareError</code>
<a class="headerlink" href="#beancount.core.compare.CompareError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>CompareError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.compare.CompareError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.compare.CompareError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.compare.CompareError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.compare.CompareError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of CompareError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.compare.CompareError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.compare.CompareError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.compare_entries">
<code class="highlight language-python">
compare_entries<span class="p">(</span><span class="n">entries1</span><span class="p">,</span> <span class="n">entries2</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.compare.compare_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compare two lists of entries. This is used for testing.</p>
<p>The entries are compared with disregard for their file location.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries1</code></td>
<td><code></code></td>
<td>
<p>A list of directives of any type.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries2</code></td>
<td><code></code></td>
<td>
<p>Another list of directives of any type.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of (success, not_found1, not_found2), where the fields are</code></td>
<td>
<p>success: A boolean, true if all the values are equal.
  missing1: A list of directives from 'entries1' not found in
    'entries2'.
  missing2: A list of directives from 'entries2' not found in
    'entries1'.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If a duplicate entry is found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compare_entries</span><span class="p">(</span><span class="n">entries1</span><span class="p">,</span> <span class="n">entries2</span><span class="p">):</span>
    <span class="sd">"""Compare two lists of entries. This is used for testing.</span>

<span class="sd">    The entries are compared with disregard for their file location.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries1: A list of directives of any type.</span>
<span class="sd">      entries2: Another list of directives of any type.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of (success, not_found1, not_found2), where the fields are:</span>
<span class="sd">        success: A boolean, true if all the values are equal.</span>
<span class="sd">        missing1: A list of directives from 'entries1' not found in</span>
<span class="sd">          'entries2'.</span>
<span class="sd">        missing2: A list of directives from 'entries2' not found in</span>
<span class="sd">          'entries1'.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If a duplicate entry is found.</span>
<span class="sd">    """</span>
    <span class="n">hashes1</span><span class="p">,</span> <span class="n">errors1</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">entries1</span><span class="p">)</span>
    <span class="n">hashes2</span><span class="p">,</span> <span class="n">errors2</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">entries2</span><span class="p">)</span>
    <span class="n">keys1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hashes1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">keys2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hashes2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">errors1</span> <span class="ow">or</span> <span class="n">errors2</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">errors1</span> <span class="o">+</span> <span class="n">errors2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>

    <span class="n">same</span> <span class="o">=</span> <span class="n">keys1</span> <span class="o">==</span> <span class="n">keys2</span>
    <span class="n">missing1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">([</span><span class="n">hashes1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys1</span> <span class="o">-</span> <span class="n">keys2</span><span class="p">])</span>
    <span class="n">missing2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">([</span><span class="n">hashes2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys2</span> <span class="o">-</span> <span class="n">keys1</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">same</span><span class="p">,</span> <span class="n">missing1</span><span class="p">,</span> <span class="n">missing2</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.excludes_entries">
<code class="highlight language-python">
excludes_entries<span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.compare.excludes_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that a list of entries does not appear in another list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>subset_entries</code></td>
<td><code></code></td>
<td>
<p>The set of entries to look for in 'entries'.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>The larger list of entries that should not include 'subset_entries'.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean and a list of entries that are not supposed to appear.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If a duplicate entry is found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">excludes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Check that a list of entries does not appear in another list.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: The set of entries to look for in 'entries'.</span>
<span class="sd">      entries: The larger list of entries that should not include 'subset_entries'.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean and a list of entries that are not supposed to appear.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If a duplicate entry is found.</span>
<span class="sd">    """</span>
    <span class="n">subset_hashes</span><span class="p">,</span> <span class="n">subset_errors</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">)</span>
    <span class="n">subset_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subset_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">hashes</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">subset_errors</span> <span class="ow">or</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">subset_errors</span> <span class="o">+</span> <span class="n">errors</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>

    <span class="n">intersection</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">subset_keys</span><span class="p">)</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">([</span><span class="n">subset_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">intersection</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">excludes</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.hash_entries">
<code class="highlight language-python">
hash_entries<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.compare.hash_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute unique hashes of each of the entries and return a map of them.</p>
<p>This is used for comparisons between sets of entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of hash-value to entry (for all entries) and a list of errors.
Errors are created when duplicate entries are found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">hash_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Compute unique hashes of each of the entries and return a map of them.</span>

<span class="sd">    This is used for comparisons between sets of entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of hash-value to entry (for all entries) and a list of errors.</span>
<span class="sd">      Errors are created when duplicate entries are found.</span>
<span class="sd">    """</span>
    <span class="n">entry_hash_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num_legal_duplicates</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">hash_</span> <span class="o">=</span> <span class="n">hash_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hash_</span> <span class="ow">in</span> <span class="n">entry_hash_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Price</span><span class="p">):</span>
                <span class="c1"># Note: Allow duplicate Price entries, they should be common</span>
                <span class="c1"># because of the nature of stock markets (if they're closed, the</span>
                <span class="c1"># data source is likely to return an entry for the previously</span>
                <span class="c1"># available date, which may already have been fetched).</span>
                <span class="n">num_legal_duplicates</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_entry</span> <span class="o">=</span> <span class="n">entry_hash_dict</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">CompareError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
                                 <span class="s2">"Duplicate entry: </span><span class="si">{}</span><span class="s2"> == </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">other_entry</span><span class="p">),</span>
                                 <span class="n">entry</span><span class="p">))</span>
        <span class="n">entry_hash_dict</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry_hash_dict</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_legal_duplicates</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">entry_hash_dict</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="n">num_legal_duplicates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entry_hash_dict</span><span class="p">,</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.hash_entry">
<code class="highlight language-python">
hash_entry<span class="p">(</span><span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.compare.hash_entry" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the stable hash of a single entry.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A directive instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A stable hexadecimal hash of this entry.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>54
55
56
57
58
59
60
61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">hash_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Compute the stable hash of a single entry.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A directive instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A stable hexadecimal hash of this entry.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">stable_hash_namedtuple</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">IGNORED_FIELD_NAMES</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.includes_entries">
<code class="highlight language-python">
includes_entries<span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.compare.includes_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check if a list of entries is included in another list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>subset_entries</code></td>
<td><code></code></td>
<td>
<p>The set of entries to look for in 'entries'.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>The larger list of entries that could include 'subset_entries'.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean and a list of missing entries.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If a duplicate entry is found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">includes_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Check if a list of entries is included in another list.</span>

<span class="sd">    Args:</span>
<span class="sd">      subset_entries: The set of entries to look for in 'entries'.</span>
<span class="sd">      entries: The larger list of entries that could include 'subset_entries'.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean and a list of missing entries.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If a duplicate entry is found.</span>
<span class="sd">    """</span>
    <span class="n">subset_hashes</span><span class="p">,</span> <span class="n">subset_errors</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">subset_entries</span><span class="p">)</span>
    <span class="n">subset_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subset_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">hashes</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">hash_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">subset_errors</span> <span class="ow">or</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">subset_errors</span> <span class="o">+</span> <span class="n">errors</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>

    <span class="n">includes</span> <span class="o">=</span> <span class="n">subset_keys</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">([</span><span class="n">subset_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">subset_keys</span> <span class="o">-</span> <span class="n">keys</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">includes</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.compare.stable_hash_namedtuple">
<code class="highlight language-python">
stable_hash_namedtuple<span class="p">(</span><span class="n">objtuple</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">())</span> </code>
<a class="headerlink" href="#beancount.core.compare.stable_hash_namedtuple" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Hash the given namedtuple and its child fields.</p>
<p>This iterates over all the members of objtuple, skipping the attributes from
the 'ignore' set, and computes a unique hash string code. If the elements
are lists or sets, sorts them for stability.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>objtuple</code></td>
<td><code></code></td>
<td>
<p>A tuple object or other.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>ignore</code></td>
<td><code></code></td>
<td>
<p>A set of strings, attribute names to be skipped in
computing a stable hash. For instance, circular references to objects
or irrelevant data.</p>
</td>
<td><code>frozenset()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/compare.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">stable_hash_namedtuple</span><span class="p">(</span><span class="n">objtuple</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">()):</span>
    <span class="sd">"""Hash the given namedtuple and its child fields.</span>

<span class="sd">    This iterates over all the members of objtuple, skipping the attributes from</span>
<span class="sd">    the 'ignore' set, and computes a unique hash string code. If the elements</span>
<span class="sd">    are lists or sets, sorts them for stability.</span>

<span class="sd">    Args:</span>
<span class="sd">      objtuple: A tuple object or other.</span>
<span class="sd">      ignore: A set of strings, attribute names to be skipped in</span>
<span class="sd">        computing a stable hash. For instance, circular references to objects</span>
<span class="sd">        or irrelevant data.</span>

<span class="sd">    """</span>
    <span class="c1"># Note: this routine is slow and would stand to be implemented in C.</span>
    <span class="n">hashobj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objtuple</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">objtuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="n">subhashes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">subhashes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">stable_hash_namedtuple</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">ignore</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
                    <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                    <span class="n">subhashes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">subhash</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">subhashes</span><span class="p">):</span>
                <span class="n">hashobj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subhash</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hashobj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">hashobj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.convert">
<code>convert</code>
<a class="headerlink" href="#beancount.core.convert" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Conversions from Position (or Posting) to units, cost, weight, market value.</p>
<p>Units: Just the primary amount of the position.
  Cost: The cost basis of the position, if available.
  Weight: The cost basis or price of the position.
  Market Value: The units converted to a value via a price map.</p>
<p>To convert an inventory's contents, simply use these functions in conjunction
with Inventory.reduce(), like</p>
<p>cost_inv = inv.reduce(convert.get_cost)</p>
<p>This module equivalently converts Position and Posting instances. Note that
we're specifically avoiding to create an import dependency on
beancount.core.data in order to keep this module isolatable, but it works on
postings due to duck-typing.</p>
<p>Function named get_<em>() are used to compute values from postings to their price currency.
Functions named convert_</em>() are used to convert postings and amounts to any currency.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.convert_amount">
<code class="highlight language-python">
convert_amount<span class="p">(</span><span class="n">amt</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">via</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.convert_amount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the market value of an Amount in a particular currency.</p>
<p>In addition, if a conversion rate isn't available, you can provide a list of
currencies to attempt to synthesize a rate for via implied rates.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amt</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>target_currency</code></td>
<td><code></code></td>
<td>
<p>The target currency to convert to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A dict of prices, as built by prices.build_price_map().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance to evaluate the value at, or None.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>via</code></td>
<td><code></code></td>
<td>
<p>A list of currencies to attempt to synthesize an implied rate if the
direct conversion fails.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount, either with a successful value currency conversion, or if we
could not convert the value, the amount itself, unmodified.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_amount</span><span class="p">(</span><span class="n">amt</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">via</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the market value of an Amount in a particular currency.</span>

<span class="sd">    In addition, if a conversion rate isn't available, you can provide a list of</span>
<span class="sd">    currencies to attempt to synthesize a rate for via implied rates.</span>

<span class="sd">    Args:</span>
<span class="sd">      amt: An instance of Amount.</span>
<span class="sd">      target_currency: The target currency to convert to.</span>
<span class="sd">      price_map: A dict of prices, as built by prices.build_price_map().</span>
<span class="sd">      date: A datetime.date instance to evaluate the value at, or None.</span>
<span class="sd">      via: A list of currencies to attempt to synthesize an implied rate if the</span>
<span class="sd">        direct conversion fails.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount, either with a successful value currency conversion, or if we</span>
<span class="sd">      could not convert the value, the amount itself, unmodified.</span>

<span class="sd">    """</span>
    <span class="c1"># First, attempt to convert directly. This should be the most</span>
    <span class="c1"># straightforward conversion.</span>
    <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">amt</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># On success, just make the conversion directly.</span>
        <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amt</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">rate</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">via</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">via</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>

        <span class="c1"># A price is unavailable, attempt to convert via cost/price currency</span>
        <span class="c1"># hop, if the value currency isn't the target currency.</span>
        <span class="k">for</span> <span class="n">implied_currency</span> <span class="ow">in</span> <span class="n">via</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">implied_currency</span> <span class="o">==</span> <span class="n">target_currency</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">base_quote1</span> <span class="o">=</span> <span class="p">(</span><span class="n">amt</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">implied_currency</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">rate1</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote1</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rate1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">base_quote2</span> <span class="o">=</span> <span class="p">(</span><span class="n">implied_currency</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">rate2</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote2</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rate2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">amt</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">rate1</span> <span class="o">*</span> <span class="n">rate2</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">)</span>

    <span class="c1"># We failed to infer a conversion rate; return the amt.</span>
    <span class="k">return</span> <span class="n">amt</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.convert_position">
<code class="highlight language-python">
convert_position<span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.convert_position" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the market value of a Position or Posting in a particular currency.</p>
<p>In addition, if the rate from the position's currency to target_currency
isn't available, an attempt is made to convert from its cost currency, if
one is available.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting, equivalently.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>target_currency</code></td>
<td><code></code></td>
<td>
<p>The target currency to convert to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A dict of prices, as built by prices.build_price_map().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance to evaluate the value at, or None.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount, either with a successful value currency conversion, or if we
could not convert the value, just the units, unmodified. (See get_value()
above for details.)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_position</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the market value of a Position or Posting in a particular currency.</span>

<span class="sd">    In addition, if the rate from the position's currency to target_currency</span>
<span class="sd">    isn't available, an attempt is made to convert from its cost currency, if</span>
<span class="sd">    one is available.</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting, equivalently.</span>
<span class="sd">      target_currency: The target currency to convert to.</span>
<span class="sd">      price_map: A dict of prices, as built by prices.build_price_map().</span>
<span class="sd">      date: A datetime.date instance to evaluate the value at, or None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount, either with a successful value currency conversion, or if we</span>
<span class="sd">      could not convert the value, just the units, unmodified. (See get_value()</span>
<span class="sd">      above for details.)</span>
<span class="sd">    """</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span>
    <span class="n">value_currency</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="ow">or</span>
        <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span> <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="ow">or</span>
        <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">convert_amount</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">target_currency</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span>
                          <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">via</span><span class="o">=</span><span class="p">(</span><span class="n">value_currency</span><span class="p">,))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.get_cost">
<code class="highlight language-python">
get_cost<span class="p">(</span><span class="n">pos</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.get_cost" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the total cost of a Position or Posting.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting, equivalently.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_cost</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="sd">"""Return the total cost of a Position or Posting.</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting, equivalently.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">Position</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'Posting'</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">))</span>
            <span class="k">else</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.get_units">
<code class="highlight language-python">
get_units<span class="p">(</span><span class="n">pos</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.get_units" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the units of a Position or Posting.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting, equivalently.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33
34
35
36
37
38
39
40
41</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="sd">"""Return the units of a Position or Posting.</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting, equivalently.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">Position</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'Posting'</span>
    <span class="k">return</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.get_value">
<code class="highlight language-python">
get_value<span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.get_value" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the market value of a Position or Posting.</p>
<p>Note that if the position is not held at cost, this does not convert
anything, even if a price is available in the 'price_map'. We don't specify
a target currency here. If you're attempting to make such a conversion, see
convert_*() functions below.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting, equivalently.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A dict of prices, as built by prices.build_price_map().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance to evaluate the value at, or None.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount, either with a successful value currency conversion, or if we
could not convert the value, just the units, unmodified. This is designed
so that you could reduce an inventory with this and not lose any
information silently in case of failure to convert (possibly due to an
empty price map). Compare the returned currency to that of the input
position if you need to check for success.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the market value of a Position or Posting.</span>

<span class="sd">    Note that if the position is not held at cost, this does not convert</span>
<span class="sd">    anything, even if a price is available in the 'price_map'. We don't specify</span>
<span class="sd">    a target currency here. If you're attempting to make such a conversion, see</span>
<span class="sd">    convert_*() functions below.</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting, equivalently.</span>
<span class="sd">      price_map: A dict of prices, as built by prices.build_price_map().</span>
<span class="sd">      date: A datetime.date instance to evaluate the value at, or None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount, either with a successful value currency conversion, or if we</span>
<span class="sd">      could not convert the value, just the units, unmodified. This is designed</span>
<span class="sd">      so that you could reduce an inventory with this and not lose any</span>
<span class="sd">      information silently in case of failure to convert (possibly due to an</span>
<span class="sd">      empty price map). Compare the returned currency to that of the input</span>
<span class="sd">      position if you need to check for success.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">Position</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'Posting'</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span>

    <span class="c1"># Try to infer what the cost/price currency should be.</span>
    <span class="n">value_currency</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="ow">or</span>
        <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s1">'price'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span> <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span> <span class="ow">or</span>
        <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># We have a value currency; hit the price database.</span>
        <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">value_currency</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">price_number</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">price_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">price_number</span><span class="p">,</span> <span class="n">value_currency</span><span class="p">)</span>

    <span class="c1"># We failed to infer a conversion rate; return the units.</span>
    <span class="k">return</span> <span class="n">units</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert.get_weight">
<code class="highlight language-python">
get_weight<span class="p">(</span><span class="n">pos</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert.get_weight" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the weight of a Position or Posting.</p>
<p>This is the amount that will need to be balanced from a posting of a
transaction.</p>
<p>This is a <em>key</em> element of the semantics of transactions in this software. A
balance amount is the amount used to check the balance of a transaction.
Here are all relevant examples, with the amounts used to balance the
postings:</p>
<p>Assets:Account  5234.50 USD                             -&gt;  5234.50 USD
  Assets:Account  3877.41 EUR @ 1.35 USD                  -&gt;  5234.50 USD
  Assets:Account       10 HOOL {523.45 USD}               -&gt;  5234.50 USD
  Assets:Account       10 HOOL {523.45 USD} @ 545.60 CAD  -&gt;  5234.50 USD</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting, equivalently.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Amount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_weight</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="sd">"""Return the weight of a Position or Posting.</span>

<span class="sd">    This is the amount that will need to be balanced from a posting of a</span>
<span class="sd">    transaction.</span>

<span class="sd">    This is a *key* element of the semantics of transactions in this software. A</span>
<span class="sd">    balance amount is the amount used to check the balance of a transaction.</span>
<span class="sd">    Here are all relevant examples, with the amounts used to balance the</span>
<span class="sd">    postings:</span>

<span class="sd">      Assets:Account  5234.50 USD                             -&gt;  5234.50 USD</span>
<span class="sd">      Assets:Account  3877.41 EUR @ 1.35 USD                  -&gt;  5234.50 USD</span>
<span class="sd">      Assets:Account       10 HOOL {523.45 USD}               -&gt;  5234.50 USD</span>
<span class="sd">      Assets:Account       10 HOOL {523.45 USD} @ 545.60 CAD  -&gt;  5234.50 USD</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting, equivalently.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Amount.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">Position</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'Posting'</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span>

    <span class="c1"># It the object has a cost, use that as the weight, to balance.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise use the postings.</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">units</span>

        <span class="c1"># Unless there is a price available; use that if present.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">Position</span><span class="p">):</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Note: Here we could assert that price.currency == units.currency.</span>
                <span class="k">if</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span> <span class="ow">or</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="n">converted_number</span> <span class="o">=</span> <span class="n">MISSING</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">converted_number</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">converted_number</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weight</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.convert_test">
<code>convert_test</code>
<a class="headerlink" href="#beancount.core.convert_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Unit tests for conversion functions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.convert_test.TestMarketValue">
<code>TestMarketValue</code>
<a class="headerlink" href="#beancount.core.convert_test.TestMarketValue" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.convert_test.TestMarketValue.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert_test.TestMarketValue.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/convert_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@loader</span><span class="o">.</span><span class="n">load_doc</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    2013-06-01 price  USD  1.01 CAD</span>
<span class="sd">    2013-06-05 price  USD  1.05 CAD</span>
<span class="sd">    2013-06-06 price  USD  1.06 CAD</span>
<span class="sd">    2013-06-07 price  USD  1.07 CAD</span>
<span class="sd">    2013-06-10 price  USD  1.10 CAD</span>

<span class="sd">    2013-06-01 price  HOOL  101.00 USD</span>
<span class="sd">    2013-06-05 price  HOOL  105.00 USD</span>
<span class="sd">    2013-06-06 price  HOOL  106.00 USD</span>
<span class="sd">    2013-06-07 price  HOOL  107.00 USD</span>
<span class="sd">    2013-06-10 price  HOOL  110.00 USD</span>

<span class="sd">    2013-06-01 price  AAPL  91.00 USD</span>
<span class="sd">    2013-06-05 price  AAPL  95.00 USD</span>
<span class="sd">    2013-06-06 price  AAPL  96.00 USD</span>
<span class="sd">    2013-06-07 price  AAPL  97.00 USD</span>
<span class="sd">    2013-06-10 price  AAPL  90.00 USD</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price_map</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">build_price_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.convert_test.TestPositionConversions">
<code>TestPositionConversions</code>
<a class="headerlink" href="#beancount.core.convert_test.TestPositionConversions" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test conversions to units, cost, weight and market-value for Position objects.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.convert_test.TestPostingConversions">
<code>TestPostingConversions</code>
<a class="headerlink" href="#beancount.core.convert_test.TestPostingConversions" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Test conversions to units, cost, weight and market-value for Posting objects.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.convert_test.build_price_map_util">
<code class="highlight language-python">
build_price_map_util<span class="p">(</span><span class="n">date_currency_price_tuples</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.convert_test.build_price_map_util" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build a partial price-map just for testing.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_currency_price_tuples</code></td>
<td><code></code></td>
<td>
<p>A list of (datetime.date, currency-string,
price-Amount) tuples to fill in the database with.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A price_map, as per build_price_map().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/convert_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>24
25
26
27
28
29
30
31
32
33
34
35</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build_price_map_util</span><span class="p">(</span><span class="n">date_currency_price_tuples</span><span class="p">):</span>
    <span class="sd">"""Build a partial price-map just for testing.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_currency_price_tuples: A list of (datetime.date, currency-string,</span>
<span class="sd">        price-Amount) tuples to fill in the database with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A price_map, as per build_price_map().</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">prices</span><span class="o">.</span><span class="n">build_price_map</span><span class="p">(</span>
        <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">date_currency_price_tuples</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.data">
<code>data</code>
<a class="headerlink" href="#beancount.core.data" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Basic data structures used to represent the Ledger entries.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Balance">
<code>Balance</code>
<a class="headerlink" href="#beancount.core.data.Balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Balance(meta, date, account, amount, tolerance, diff_amount)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Balance.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Balance.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Balance.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">diff_amount</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Balance.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Balance(meta, date, account, amount, tolerance, diff_amount)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Balance.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Balance.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Booking">
<code>Booking</code>
<a class="headerlink" href="#beancount.core.data.Booking" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An enumeration.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Close">
<code>Close</code>
<a class="headerlink" href="#beancount.core.data.Close" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Close(meta, date, account)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Close.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Close.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Close.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Close.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Close(meta, date, account)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Close.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Close.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Commodity">
<code>Commodity</code>
<a class="headerlink" href="#beancount.core.data.Commodity" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Commodity(meta, date, currency)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Commodity.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Commodity.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Commodity.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Commodity.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Commodity(meta, date, currency)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Commodity.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Commodity.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Custom">
<code>Custom</code>
<a class="headerlink" href="#beancount.core.data.Custom" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Custom(meta, date, type, values)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Custom.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Custom.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Custom.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Custom.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Custom(meta, date, type, values)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Custom.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Custom.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Document">
<code>Document</code>
<a class="headerlink" href="#beancount.core.data.Document" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Document(meta, date, account, filename, tags, links)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Document.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Document.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Document.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Document.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Document(meta, date, account, filename, tags, links)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Document.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Document.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Event">
<code>Event</code>
<a class="headerlink" href="#beancount.core.data.Event" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Event(meta, date, type, description)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Event.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Event.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Event.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Event.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Event(meta, date, type, description)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Event.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Event.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Note">
<code>Note</code>
<a class="headerlink" href="#beancount.core.data.Note" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Note(meta, date, account, comment)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Note.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Note.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Note.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Note.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Note(meta, date, account, comment)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Note.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Note.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Open">
<code>Open</code>
<a class="headerlink" href="#beancount.core.data.Open" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Open(meta, date, account, currencies, booking)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Open.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Open.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Open.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Open.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Open(meta, date, account, currencies, booking)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Open.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Open.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Pad">
<code>Pad</code>
<a class="headerlink" href="#beancount.core.data.Pad" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Pad(meta, date, account, source_account)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Pad.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Pad.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Pad.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Pad.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Pad(meta, date, account, source_account)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Pad.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Pad.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Posting">
<code>Posting</code>
<a class="headerlink" href="#beancount.core.data.Posting" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Posting(account, units, cost, price, flag, meta)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Posting.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Posting.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Posting.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Posting.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Posting(account, units, cost, price, flag, meta)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Posting.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Posting.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Price">
<code>Price</code>
<a class="headerlink" href="#beancount.core.data.Price" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Price(meta, date, currency, amount)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Price.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Price.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Price.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Price.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Price(meta, date, currency, amount)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Price.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Price.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Query">
<code>Query</code>
<a class="headerlink" href="#beancount.core.data.Query" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Query(meta, date, name, query_string)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Query.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Query.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Query.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Query.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Query(meta, date, name, query_string)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Query.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Query.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.Transaction">
<code>Transaction</code>
<a class="headerlink" href="#beancount.core.data.Transaction" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Transaction(meta, date, flag, payee, narration, tags, links, postings)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Transaction.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Transaction.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Transaction.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">postings</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Transaction.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Transaction(meta, date, flag, payee, narration, tags, links, postings)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.Transaction.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.Transaction.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.data.TxnPosting">
<code>TxnPosting</code>
<a class="headerlink" href="#beancount.core.data.TxnPosting" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>TxnPosting(txn, posting)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.TxnPosting.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.TxnPosting.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.TxnPosting.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">txn</span><span class="p">,</span> <span class="n">posting</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.TxnPosting.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of TxnPosting(txn, posting)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.data.TxnPosting.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.data.TxnPosting.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.create_simple_posting">
<code class="highlight language-python">
create_simple_posting<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.create_simple_posting" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a simple posting on the entry, with just a number and currency (no cost).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>The entry instance to add the posting to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to use on the posting.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A Decimal number or string to use in the posting's Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency for the Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Posting, and as a side-effect the entry has had its list of
postings modified with the new Posting instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_simple_posting</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Create a simple posting on the entry, with just a number and currency (no cost).</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: The entry instance to add the posting to.</span>
<span class="sd">      account: A string, the account to use on the posting.</span>
<span class="sd">      number: A Decimal number or string to use in the posting's Amount.</span>
<span class="sd">      currency: A string, the currency for the Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Posting, and as a side-effect the entry has had its list of</span>
<span class="sd">      postings modified with the new Posting instance.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="n">posting</span> <span class="o">=</span> <span class="n">Posting</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posting</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.create_simple_posting_with_cost">
<code class="highlight language-python">
create_simple_posting_with_cost<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.create_simple_posting_with_cost" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a simple posting on the entry, with just a number and currency (no cost).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>The entry instance to add the posting to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account to use on the posting.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A Decimal number or string to use in the posting's Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency for the Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_number</code></td>
<td><code></code></td>
<td>
<p>A Decimal number or string to use for the posting's cost Amount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_currency</code></td>
<td><code></code></td>
<td>
<p>a string, the currency for the cost Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Posting, and as a side-effect the entry has had its list of
postings modified with the new Posting instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_simple_posting_with_cost</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span>
                                    <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span>
                                    <span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">):</span>
    <span class="sd">"""Create a simple posting on the entry, with just a number and currency (no cost).</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: The entry instance to add the posting to.</span>
<span class="sd">      account: A string, the account to use on the posting.</span>
<span class="sd">      number: A Decimal number or string to use in the posting's Amount.</span>
<span class="sd">      currency: A string, the currency for the Amount.</span>
<span class="sd">      cost_number: A Decimal number or string to use for the posting's cost Amount.</span>
<span class="sd">      cost_currency: a string, the currency for the cost Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Posting, and as a side-effect the entry has had its list of</span>
<span class="sd">      postings modified with the new Posting instance.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cost_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="n">cost_number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">cost_number</span><span class="p">)</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">posting</span> <span class="o">=</span> <span class="n">Posting</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posting</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.entry_sortkey">
<code class="highlight language-python">
entry_sortkey<span class="p">(</span><span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.entry_sortkey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Sort-key for entries. We sort by date, except that checks
should be placed in front of every list of entries of that same day,
in order to balance linearly.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An entry instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of (date, integer, integer), that forms the sort key for the
entry.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>581
582
583
584
585
586
587
588
589
590
591
592</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">entry_sortkey</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Sort-key for entries. We sort by date, except that checks</span>
<span class="sd">    should be placed in front of every list of entries of that same day,</span>
<span class="sd">    in order to balance linearly.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An entry instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of (date, integer, integer), that forms the sort key for the</span>
<span class="sd">      entry.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">SORT_ORDER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.filter_txns">
<code class="highlight language-python">
filter_txns<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.filter_txns" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A generator that yields only the Transaction instances.</p>
<p>This is such an incredibly common operation that it deserves a terse
filtering mechanism.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  A sorted list of only the Transaction directives.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>622
623
624
625
626
627
628
629
630
631
632
633
634
635</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter_txns</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""A generator that yields only the Transaction instances.</span>

<span class="sd">    This is such an incredibly common operation that it deserves a terse</span>
<span class="sd">    filtering mechanism.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A sorted list of only the Transaction directives.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">entry</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.find_closest">
<code class="highlight language-python">
find_closest<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.find_closest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find the closest entry from entries to (filename, lineno).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the ledger file to look for. Be careful
to provide the very same filename, and note that the parser stores the
absolute path of the filename here.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>An integer, the line number closest after the directive we're
looking for. This may be the exact/first line of the directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The closest entry found in the given file for the given filename, or
None, if none could be found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_closest</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
    <span class="sd">"""Find the closest entry from entries to (filename, lineno).</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      filename: A string, the name of the ledger file to look for. Be careful</span>
<span class="sd">        to provide the very same filename, and note that the parser stores the</span>
<span class="sd">        absolute path of the filename here.</span>
<span class="sd">      lineno: An integer, the line number closest after the directive we're</span>
<span class="sd">        looking for. This may be the exact/first line of the directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The closest entry found in the given file for the given filename, or</span>
<span class="sd">      None, if none could be found.</span>
<span class="sd">    """</span>
    <span class="n">min_diffline</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="n">closest_entry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">emeta</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span>
        <span class="k">if</span> <span class="n">emeta</span><span class="p">[</span><span class="s2">"filename"</span><span class="p">]</span> <span class="o">==</span> <span class="n">filename</span> <span class="ow">and</span> <span class="n">emeta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">diffline</span> <span class="o">=</span> <span class="n">lineno</span> <span class="o">-</span> <span class="n">emeta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">diffline</span> <span class="o">&lt;</span> <span class="n">min_diffline</span><span class="p">:</span>
                <span class="n">min_diffline</span> <span class="o">=</span> <span class="n">diffline</span>
                <span class="n">closest_entry</span> <span class="o">=</span> <span class="n">entry</span>
    <span class="k">return</span> <span class="n">closest_entry</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.get_entry">
<code class="highlight language-python">
get_entry<span class="p">(</span><span class="n">posting_or_entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.get_entry" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the entry associated with the posting or entry.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A TxnPosting or entry instance</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A datetime instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>555
556
557
558
559
560
561
562
563
564
565</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="n">posting_or_entry</span><span class="p">):</span>
    <span class="sd">"""Return the entry associated with the posting or entry.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A TxnPosting or entry instance</span>
<span class="sd">    Returns:</span>
<span class="sd">      A datetime instance.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">posting_or_entry</span><span class="o">.</span><span class="n">txn</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting_or_entry</span><span class="p">,</span> <span class="n">TxnPosting</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">posting_or_entry</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.has_entry_account_component">
<code class="highlight language-python">
has_entry_account_component<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.has_entry_account_component" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if one of the entry's postings has an account component.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A Transaction entry.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>component</code></td>
<td><code></code></td>
<td>
<p>A string, a component of an account name. For instance,
'Food' in 'Expenses:Food:Restaurant'. All components are considered.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A boolean, true if the component is in the account. Note that a component
name must be whole, that is 'NY' is not in Expenses</code></td>
<td>
<p>Taxes:StateNY'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>638
639
640
641
642
643
644
645
646
647
648
649
650
651</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">has_entry_account_component</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
    <span class="sd">"""Return true if one of the entry's postings has an account component.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A Transaction entry.</span>
<span class="sd">      component: A string, a component of an account name. For instance,</span>
<span class="sd">        'Food' in 'Expenses:Food:Restaurant'. All components are considered.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the component is in the account. Note that a component</span>
<span class="sd">      name must be whole, that is 'NY' is not in Expenses:Taxes:StateNY'.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">has_component</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.iter_entry_dates">
<code class="highlight language-python">
iter_entry_dates<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.iter_entry_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Iterate over the entries in a date window.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A date-sorted list of dated directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the first date to include.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, one day beyond the last date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of the dated directives, between the dates, and in the order in
  which they appear.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_entry_dates</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
    <span class="sd">"""Iterate over the entries in a date window.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A date-sorted list of dated directives.</span>
<span class="sd">      date_begin: A datetime.date instance, the first date to include.</span>
<span class="sd">      date_end: A datetime.date instance, one day beyond the last date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of the dated directives, between the dates, and in the order in</span>
<span class="sd">      which they appear.</span>
<span class="sd">    """</span>
    <span class="n">getdate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>
    <span class="n">index_begin</span> <span class="o">=</span> <span class="n">bisect_left_with_key</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">getdate</span><span class="p">)</span>
    <span class="n">index_end</span> <span class="o">=</span> <span class="n">bisect_left_with_key</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">getdate</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_begin</span><span class="p">,</span> <span class="n">index_end</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">entries</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.new_directive">
<code class="highlight language-python">
new_directive<span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.new_directive" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a directive class. Do not include default fields.
This should probably be carried out through inheritance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the capitalized name of the directive.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>fields</code></td>
<td><code>List[Tuple]</code></td>
<td>
<p>A string or the list of strings, names for the fields
to add to the base tuple.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NamedTuple</code></td>
<td>
<p>A type object for the new directive type.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">new_directive</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NamedTuple</span><span class="p">:</span>
    <span class="sd">"""Create a directive class. Do not include default fields.</span>
<span class="sd">    This should probably be carried out through inheritance.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the capitalized name of the directive.</span>
<span class="sd">      fields: A string or the list of strings, names for the fields</span>
<span class="sd">        to add to the base tuple.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A type object for the new directive type.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">NamedTuple</span><span class="p">(</span>
        <span class="n">clsname</span><span class="p">,</span>
        <span class="p">[(</span><span class="s1">'meta'</span><span class="p">,</span> <span class="n">Meta</span><span class="p">),</span> <span class="p">(</span><span class="s1">'date'</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)]</span> <span class="o">+</span> <span class="n">fields</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.new_metadata">
<code class="highlight language-python">
new_metadata<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.new_metadata" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a new metadata container from the filename and line number.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the filename for the creator of this directive.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>lineno</code></td>
<td><code></code></td>
<td>
<p>An integer, the line number where the directive has been created.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>kvlist</code></td>
<td><code></code></td>
<td>
<p>An optional container of key-values.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A metadata dict.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>409
410
411
412
413
414
415
416
417
418
419
420
421
422
423</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">kvlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a new metadata container from the filename and line number.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the filename for the creator of this directive.</span>
<span class="sd">      lineno: An integer, the line number where the directive has been created.</span>
<span class="sd">      kvlist: An optional container of key-values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A metadata dict.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'filename'</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s1">'lineno'</span><span class="p">:</span> <span class="n">lineno</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">kvlist</span><span class="p">:</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kvlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">meta</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.posting_has_conversion">
<code class="highlight language-python">
posting_has_conversion<span class="p">(</span><span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.posting_has_conversion" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if this position involves a conversion.</p>
<p>A conversion is when there is a price attached to the amount but no cost.
This is used on transactions to convert between units.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>an instance of Posting</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if this posting has a price conversion.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>521
522
523
524
525
526
527
528
529
530
531
532
533</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">posting_has_conversion</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""Return true if this position involves a conversion.</span>

<span class="sd">    A conversion is when there is a price attached to the amount but no cost.</span>
<span class="sd">    This is used on transactions to convert between units.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: an instance of Posting</span>
<span class="sd">    Return:</span>
<span class="sd">      A boolean, true if this posting has a price conversion.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.posting_sortkey">
<code class="highlight language-python">
posting_sortkey<span class="p">(</span><span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.posting_sortkey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Sort-key for entries or postings. We sort by date, except that checks
should be placed in front of every list of entries of that same day,
in order to balance linearly.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A Posting or entry instance</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of (date, integer, integer), that forms the sort key for the
posting or entry.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>606
607
608
609
610
611
612
613
614
615
616
617
618
619</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">posting_sortkey</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Sort-key for entries or postings. We sort by date, except that checks</span>
<span class="sd">    should be placed in front of every list of entries of that same day,</span>
<span class="sd">    in order to balance linearly.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A Posting or entry instance</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of (date, integer, integer), that forms the sort key for the</span>
<span class="sd">      posting or entry.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">TxnPosting</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">txn</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">SORT_ORDER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.remove_account_postings">
<code class="highlight language-python">
remove_account_postings<span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.remove_account_postings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Remove all postings with the given account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A string, the account name whose postings we want to remove.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of entries without the rounding postings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_account_postings</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Remove all postings with the given account.</span>

<span class="sd">    Args:</span>
<span class="sd">      account: A string, the account name whose postings we want to remove.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries without the rounding postings.</span>
<span class="sd">    """</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span> <span class="o">==</span> <span class="n">account</span> <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)):</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">postings</span><span class="o">=</span><span class="p">[</span><span class="n">posting</span>
                                             <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span>
                                             <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span> <span class="o">!=</span> <span class="n">account</span><span class="p">])</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.sanity_check_types">
<code class="highlight language-python">
sanity_check_types<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">allow_none_for_tags_and_links</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.sanity_check_types" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that the entry and its postings has all correct data types.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of one of the entries to be checked.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>allow_none_for_tags_and_links</code></td>
<td><code></code></td>
<td>
<p>A boolean, whether to allow plugins to
generate Transaction objects with None as value for the 'tags' or 'links'
attributes.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If there is anything that is unexpected, raises an exception.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sanity_check_types</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">allow_none_for_tags_and_links</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Check that the entry and its postings has all correct data types.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of one of the entries to be checked.</span>
<span class="sd">      allow_none_for_tags_and_links: A boolean, whether to allow plugins to</span>
<span class="sd">        generate Transaction objects with None as value for the 'tags' or 'links'</span>
<span class="sd">        attributes.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If there is anything that is unexpected, raises an exception.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">ALL_DIRECTIVES</span><span class="p">),</span> <span class="s2">"Invalid directive type"</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s2">"Invalid type for meta"</span>
    <span class="k">assert</span> <span class="s1">'filename'</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Missing filename in metadata"</span>
    <span class="k">assert</span> <span class="s1">'lineno'</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s2">"Missing line number in metadata"</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">),</span> <span class="s2">"Invalid date type"</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="p">(</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="s2">"Invalid flag type"</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">,</span> <span class="p">(</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="s2">"Invalid payee type"</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">narration</span><span class="p">,</span> <span class="p">(</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="s2">"Invalid narration type"</span>
        <span class="n">set_types</span> <span class="o">=</span> <span class="p">((</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">allow_none_for_tags_and_links</span>
                     <span class="k">else</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">set_types</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">"Invalid tags type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">,</span> <span class="n">set_types</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">"Invalid links type: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">"Invalid postings list type"</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="p">,</span> <span class="n">Posting</span><span class="p">),</span> <span class="s2">"Invalid posting type"</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Invalid account type"</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="p">(</span><span class="n">Amount</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)),</span> <span class="s2">"Invalid units type"</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="p">(</span><span class="n">Cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)),</span> <span class="s2">"Invalid cost type"</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="p">(</span><span class="n">Amount</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)),</span> <span class="s2">"Invalid price type"</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)),</span> <span class="s2">"Invalid flag type"</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.sorted">
<code class="highlight language-python">
sorted<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.sorted" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience to sort a list of entries, using entry_sortkey().</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A sorted list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>595
596
597
598
599
600
601
602
603</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""A convenience to sort a list of entries, using entry_sortkey().</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A sorted list of directives.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">entry_sortkey</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.data.transaction_has_conversion">
<code class="highlight language-python">
transaction_has_conversion<span class="p">(</span><span class="n">transaction</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.data.transaction_has_conversion" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a Transaction entry, return true if at least one of
the postings has a price conversion (without an associated
cost). These are the source of non-zero conversion balances.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transaction</code></td>
<td><code></code></td>
<td>
<p>an instance of a Transaction entry.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if this transaction contains at least one posting with a
price conversion.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/data.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">transaction_has_conversion</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
    <span class="sd">"""Given a Transaction entry, return true if at least one of</span>
<span class="sd">    the postings has a price conversion (without an associated</span>
<span class="sd">    cost). These are the source of non-zero conversion balances.</span>

<span class="sd">    Args:</span>
<span class="sd">      transaction: an instance of a Transaction entry.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if this transaction contains at least one posting with a</span>
<span class="sd">      price conversion.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Invalid type of entry for transaction: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">transaction</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">posting_has_conversion</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.display_context">
<code>display_context</code>
<a class="headerlink" href="#beancount.core.display_context" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A settings class to offer control over the number of digits rendered.</p>
<p>This module contains routines that can accumulate information on the width and
precision of numbers to be rendered and derive the precision required to render
all of them consistently and under certain common alignment requirements. This
is required in order to output neatly lined up columns of numbers in various
styles.</p>
<p>A common case is that the precision can be observed for numbers present in the
input file. This display precision can be used as the "precision by default" if
we write a routine for which it is inconvenient to feed all the numbers to build
such an accumulator.</p>
<p>Here are all the aspects supported by this module:</p>
<p>PRECISION: Numbers for a particular currency are always rendered to the same
  precision, and they can be rendered to one of two precisions; either</p>
<pre><code>1. the most common number of fractional digits, or
2. the maximum number of digits seen (this is useful for rendering prices).
</code></pre>
<p>ALIGNMENT: Several alignment methods are supported.</p>
<pre><code>"natural": Render the strings as small as possible with no padding, but to
their currency's precision. Like this:

  '1.2345'
  '764'
  '-7,409.01'
  '0.00000125'

"dot-aligned": The periods will align vertically, the left and right sides
  are padded so that the column of numbers has the same width:

  '     1.2345    '
  '   764         '
  '-7,409.01      '
  '     0.00000125'

"right": The strings are all flushed right, the left side is padded so that
  the column of numbers has the same width:

  '     1.2345'
  '        764'
  '  -7,409.01'
  ' 0.00000125'
</code></pre>
<p>SIGN: If a negative sign is present in the input numbers, the rendered numbers
  reserve a space for it. If not, then we save the space.</p>
<p>COMMAS: If the user requests to render commas, commas are rendered in the
  output.</p>
<p>RESERVED: A number of extra integral digits reserved on the left in order to
  allow rendering novel numbers that haven't yet been seen. For example,
  balances may contains much larger numbers than the numbers seen in input
  files, and these need to be accommodated when aligning to the right.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.display_context.Align">
<code>Align</code>
<a class="headerlink" href="#beancount.core.display_context.Align" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Alignment style for numbers.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.display_context.DisplayContext">
<code>DisplayContext</code>
<a class="headerlink" href="#beancount.core.display_context.DisplayContext" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A builder object used to construct a DisplayContext from a series of numbers.</p>
<pre><code>Attributes:
  ccontexts: A dict of currency string to CurrencyContext instance.
  commas: A bool, true if we should render commas. This just gets propagated
    onwards as the default value of to build with.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.display_context.DisplayContext.build">
<code class="highlight language-python">
build<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=&lt;</span><span class="n">Align</span><span class="o">.</span><span class="n">NATURAL</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=&lt;</span><span class="n">Precision</span><span class="o">.</span><span class="n">MOST_COMMON</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">commas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reserved</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.display_context.DisplayContext.build" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Build a formatter for the given display context.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>alignment</code></td>
<td><code></code></td>
<td>
<p>The desired alignment.</p>
</td>
<td><code>&lt;Align.NATURAL: 1&gt;</code></td>
</tr>
<tr>
<td><code>precision</code></td>
<td><code></code></td>
<td>
<p>The desired precision.</p>
</td>
<td><code>&lt;Precision.MOST_COMMON: 1&gt;</code></td>
</tr>
<tr>
<td><code>commas</code></td>
<td><code></code></td>
<td>
<p>Whether to render commas or not. If 'None', the default value carried
by the context will be used.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>reserved</code></td>
<td><code></code></td>
<td>
<p>An integer, the number of extra digits to be allocated in
the maximum width calculations.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/display_context.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
          <span class="n">alignment</span><span class="o">=</span><span class="n">Align</span><span class="o">.</span><span class="n">NATURAL</span><span class="p">,</span>
          <span class="n">precision</span><span class="o">=</span><span class="n">Precision</span><span class="o">.</span><span class="n">MOST_COMMON</span><span class="p">,</span>
          <span class="n">commas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">reserved</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Build a formatter for the given display context.</span>

<span class="sd">    Args:</span>
<span class="sd">      alignment: The desired alignment.</span>
<span class="sd">      precision: The desired precision.</span>
<span class="sd">      commas: Whether to render commas or not. If 'None', the default value carried</span>
<span class="sd">        by the context will be used.</span>
<span class="sd">      reserved: An integer, the number of extra digits to be allocated in</span>
<span class="sd">        the maximum width calculations.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">commas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">commas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commas</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="n">Align</span><span class="o">.</span><span class="n">NATURAL</span><span class="p">:</span>
        <span class="n">build_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_natural</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="n">Align</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">:</span>
        <span class="n">build_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_right</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="n">Align</span><span class="o">.</span><span class="n">DOT</span><span class="p">:</span>
        <span class="n">build_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown alignment: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alignment</span><span class="p">))</span>
    <span class="n">fmtstrings</span> <span class="o">=</span> <span class="n">build_method</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">commas</span><span class="p">,</span> <span class="n">reserved</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DisplayFormatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">fmtstrings</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.display_context.DisplayContext.quantize">
<code class="highlight language-python">
quantize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">precision</span><span class="o">=&lt;</span><span class="n">Precision</span><span class="o">.</span><span class="n">MOST_COMMON</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.display_context.DisplayContext.quantize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Quantize the given number to the given precision.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A Decimal instance, the number to be quantized.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A currency string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>precision</code></td>
<td><code></code></td>
<td>
<p>Which precision to use.</p>
</td>
<td><code>&lt;Precision.MOST_COMMON: 1&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal instance, the quantized number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/display_context.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">quantize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">Precision</span><span class="o">.</span><span class="n">MOST_COMMON</span><span class="p">):</span>
    <span class="sd">"""Quantize the given number to the given precision.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: A Decimal instance, the number to be quantized.</span>
<span class="sd">      currency: A currency string.</span>
<span class="sd">      precision: Which precision to use.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal instance, the quantized number.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">),</span> <span class="s2">"Invalid data: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">ccontext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ccontexts</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span>
    <span class="n">num_fractional_digits</span> <span class="o">=</span> <span class="n">ccontext</span><span class="o">.</span><span class="n">get_fractional</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_fractional_digits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Note: We could probably logging.warn() this situation here.</span>
        <span class="k">return</span> <span class="n">number</span>
    <span class="n">qdigit</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">scaleb</span><span class="p">(</span><span class="o">-</span><span class="n">num_fractional_digits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">number</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">qdigit</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.display_context.DisplayContext.set_commas">
<code class="highlight language-python">
set_commas<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commas</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.display_context.DisplayContext.set_commas" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Set the default value for rendering commas.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/display_context.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>183
184
185</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">set_commas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commas</span><span class="p">):</span>
    <span class="sd">"""Set the default value for rendering commas."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">commas</span> <span class="o">=</span> <span class="n">commas</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.display_context.DisplayContext.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s1">'__default__'</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.display_context.DisplayContext.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Update the builder with the given number for the given currency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>An instance of Decimal to consider for this currency.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>An optional string, the currency this numbers applies to.</p>
</td>
<td><code>'__default__'</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/display_context.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>194
195
196
197
198
199
200
201</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s1">'__default__'</span><span class="p">):</span>
    <span class="sd">"""Update the builder with the given number for the given currency.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: An instance of Decimal to consider for this currency.</span>
<span class="sd">      currency: An optional string, the currency this numbers applies to.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ccontexts</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.display_context.DisplayFormatter">
<code>DisplayFormatter</code>
<a class="headerlink" href="#beancount.core.display_context.DisplayFormatter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A class used to contain various settings that control how we output numbers.
    In particular, the precision used for each currency, and whether or not
    commas should be printed. This object is intended to be passed around to all
    functions that format numbers to strings.</p>
<pre><code>Attributes:
  dcontext: A DisplayContext instance.
  precision: An enum of Precision from which it was built.
  fmtstrings: A dict of currency to pre-baked format strings for it.
  fmtfuncs: A dict of currency to pre-baked formatting functions for it.
</code></pre>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.display_context.Precision">
<code>Precision</code>
<a class="headerlink" href="#beancount.core.display_context.Precision" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The type of precision required.</p>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.distribution">
<code>distribution</code>
<a class="headerlink" href="#beancount.core.distribution" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A simple accumulator for data about a mathematical distribution.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.distribution.Distribution">
<code>Distribution</code>
<a class="headerlink" href="#beancount.core.distribution.Distribution" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A class that computes a histogram of integer values. This is used to compute
    a length that will cover at least some decent fraction of the samples.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.distribution.Distribution.empty">
<code class="highlight language-python">
empty<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.distribution.Distribution.empty" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if the distribution is empty.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/distribution.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>16
17
18
19
20
21
22</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return true if the distribution is empty.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.distribution.Distribution.max">
<code class="highlight language-python">
max<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.distribution.Distribution.max" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the minimum value seen in the distribution.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An element of the value type, or None, if the distribution was empty.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/distribution.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44
45
46
47
48
49
50
51
52</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the minimum value seen in the distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An element of the value type, or None, if the distribution was empty.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.distribution.Distribution.min">
<code class="highlight language-python">
min<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.distribution.Distribution.min" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the minimum value seen in the distribution.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An element of the value type, or None, if the distribution was empty.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/distribution.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33
34
35
36
37
38
39
40
41</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the minimum value seen in the distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An element of the value type, or None, if the distribution was empty.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.distribution.Distribution.mode">
<code class="highlight language-python">
mode<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.distribution.Distribution.mode" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the mode of the distribution.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An element of the value type, or None, if the distribution was empty.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/distribution.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the mode of the distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An element of the value type, or None, if the distribution was empty.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">max_count</span><span class="p">:</span>
            <span class="n">max_count</span> <span class="o">=</span> <span class="n">count</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">max_value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.distribution.Distribution.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.distribution.Distribution.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add a sample to the distribution.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>A value of the function.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/distribution.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>24
25
26
27
28
29
30</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Add a sample to the distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">      value: A value of the function.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.distribution_test">
<code>distribution_test</code>
<a class="headerlink" href="#beancount.core.distribution_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Tests for distribution.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.flags">
<code>flags</code>
<a class="headerlink" href="#beancount.core.flags" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Flag constants.</p>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.getters">
<code>getters</code>
<a class="headerlink" href="#beancount.core.getters" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Getter functions that operate on lists of entries to return various lists of
things that they reference, accounts, tags, links, currencies, etc.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.getters.GetAccounts">
<code>GetAccounts</code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Accounts gatherer.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Balance">
<code class="highlight language-python">
Balance<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Balance" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with a single account attribute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The single account of this directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_one</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with a single account attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The single account of this directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Close">
<code class="highlight language-python">
Close<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Close" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with a single account attribute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The single account of this directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_one</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with a single account attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The single account of this directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Commodity">
<code class="highlight language-python">
Commodity<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Commodity" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with no accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An empty list</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with no accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An empty list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Custom">
<code class="highlight language-python">
Custom<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Custom" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with no accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An empty list</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with no accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An empty list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Document">
<code class="highlight language-python">
Document<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Document" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with a single account attribute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The single account of this directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_one</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with a single account attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The single account of this directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Event">
<code class="highlight language-python">
Event<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Event" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with no accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An empty list</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with no accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An empty list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.get_accounts_use_map">
<code class="highlight language-python">
get_accounts_use_map<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.get_accounts_use_map" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Gather the list of accounts from the list of entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of dictionaries of account name to date, one for first date
used and one for last date used. The keys should be identical.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_accounts_use_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Gather the list of accounts from the list of entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of dictionaries of account name to date, one for first date</span>
<span class="sd">      used and one for last date used. The keys should be identical.</span>
<span class="sd">    """</span>
    <span class="n">accounts_first</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">accounts_last</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">account_</span> <span class="ow">in</span> <span class="n">method</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">account_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accounts_first</span><span class="p">:</span>
                <span class="n">accounts_first</span><span class="p">[</span><span class="n">account_</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>
            <span class="n">accounts_last</span><span class="p">[</span><span class="n">account_</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>
    <span class="k">return</span> <span class="n">accounts_first</span><span class="p">,</span> <span class="n">accounts_last</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.get_entry_accounts">
<code class="highlight language-python">
get_entry_accounts<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.get_entry_accounts" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Gather all the accounts references by a single directive.</p>
<p>Note: This should get replaced by a method on each directive eventually,
that would be the clean way to do this.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>A directive instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of account name strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_entry_accounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Gather all the accounts references by a single directive.</span>

<span class="sd">    Note: This should get replaced by a method on each directive eventually,</span>
<span class="sd">    that would be the clean way to do this.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A directive instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of account name strings.</span>
<span class="sd">    """</span>
    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">method</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Note">
<code class="highlight language-python">
Note<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Note" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with a single account attribute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The single account of this directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_one</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with a single account attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The single account of this directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Open">
<code class="highlight language-python">
Open<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Open" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with a single account attribute.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The single account of this directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_one</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with a single account attribute.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The single account of this directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Pad">
<code class="highlight language-python">
Pad<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Pad" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a Pad directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of Pad.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The two accounts of the Pad directive.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>69
70
71
72
73
74
75
76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">Pad</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process a Pad directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of Pad.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The two accounts of the Pad directive.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">source_account</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Price">
<code class="highlight language-python">
Price<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Price" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with no accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An empty list</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with no accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An empty list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Query">
<code class="highlight language-python">
Query<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Query" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process directives with no accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An empty list</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process directives with no accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An empty list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.getters.GetAccounts.Transaction">
<code class="highlight language-python">
Transaction<span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.GetAccounts.Transaction" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Process a Transaction directive.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of Transaction.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  The accounts of the legs of the transaction.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>58
59
60
61
62
63
64
65
66
67</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">Transaction</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Process a Transaction directive.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of Transaction.</span>
<span class="sd">    Yields:</span>
<span class="sd">      The accounts of the legs of the transaction.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_account_components">
<code class="highlight language-python">
get_account_components<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_account_components" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Gather all the account components available in the given directives.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of strings, the unique account components, including the root
account names.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>147
148
149
150
151
152
153
154
155
156
157
158
159
160</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_components</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Gather all the account components available in the given directives.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of strings, the unique account components, including the root</span>
<span class="sd">      account names.</span>
<span class="sd">    """</span>
    <span class="n">accounts</span> <span class="o">=</span> <span class="n">get_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">components</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_account_open_close">
<code class="highlight language-python">
get_account_open_close<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_account_open_close" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Fetch the open/close entries for each of the accounts.</p>
<p>If an open or close entry happens to be duplicated, accept the earliest
entry (chronologically).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A map of account name strings to pairs of (open-directive, close-directive)
tuples.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_account_open_close</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Fetch the open/close entries for each of the accounts.</span>

<span class="sd">    If an open or close entry happens to be duplicated, accept the earliest</span>
<span class="sd">    entry (chronologically).</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A map of account name strings to pairs of (open-directive, close-directive)</span>
<span class="sd">      tuples.</span>
<span class="sd">    """</span>
    <span class="c1"># A dict of account name to (open-entry, close-entry).</span>
    <span class="n">open_close_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="n">Open</span><span class="p">,</span> <span class="n">Close</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="n">open_close</span> <span class="o">=</span> <span class="n">open_close_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Open</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">previous_entry</span> <span class="o">=</span> <span class="n">open_close</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">previous_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">previous_entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="n">previous_entry</span>
        <span class="n">open_close</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">open_close_map</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_accounts">
<code class="highlight language-python">
get_accounts<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Gather all the accounts references by a list of directives.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of account strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>121
122
123
124
125
126
127
128
129
130</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Gather all the accounts references by a list of directives.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of account strings.</span>
<span class="sd">    """</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">accounts_last</span> <span class="o">=</span> <span class="n">_GetAccounts</span><span class="o">.</span><span class="n">get_accounts_use_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accounts_last</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_accounts_use_map">
<code class="highlight language-python">
get_accounts_use_map<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_accounts_use_map" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Gather all the accounts references by a list of directives.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of dictionaries of account name to date, one for first date
used and one for last date used. The keys should be identical.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>109
110
111
112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_accounts_use_map</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Gather all the accounts references by a list of directives.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of dictionaries of account name to date, one for first date</span>
<span class="sd">      used and one for last date used. The keys should be identical.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">_GetAccounts</span><span class="o">.</span><span class="n">get_accounts_use_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_active_years">
<code class="highlight language-python">
get_active_years<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_active_years" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Yield all the years that have at least one entry in them.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Unique dates see in the list of directives.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_active_years</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Yield all the years that have at least one entry in them.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Unique dates see in the list of directives.</span>
<span class="sd">    """</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">prev_year</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">!=</span> <span class="n">prev_year</span><span class="p">:</span>
            <span class="n">prev_year</span> <span class="o">=</span> <span class="n">year</span>
            <span class="k">assert</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">year</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_all_links">
<code class="highlight language-python">
get_all_links<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_all_links" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a list of all the links seen in the given entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of links strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_links</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Return a list of all the links seen in the given entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of links strings.</span>
<span class="sd">    """</span>
    <span class="n">all_links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="n">all_links</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_links</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_all_payees">
<code class="highlight language-python">
get_all_payees<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_all_payees" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a list of all the unique payees seen in the given entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of payee strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_payees</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Return a list of all the unique payees seen in the given entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of payee strings.</span>
<span class="sd">    """</span>
    <span class="n">all_payees</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">all_payees</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">)</span>
    <span class="n">all_payees</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_payees</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_all_tags">
<code class="highlight language-python">
get_all_tags<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_all_tags" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a list of all the tags seen in the given entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of tag strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_tags</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Return a list of all the tags seen in the given entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of tag strings.</span>
<span class="sd">    """</span>
    <span class="n">all_tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="n">all_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_tags</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_commodity_map">
<code class="highlight language-python">
get_commodity_map<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">create_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_commodity_map" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create map of commodity names to Commodity entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>create_missing</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if you want to automatically generate
missing commodity directives if not present in the output map.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A map of commodity name strings to Commodity directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_commodity_map</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">create_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Create map of commodity names to Commodity entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">      create_missing: A boolean, true if you want to automatically generate</span>
<span class="sd">        missing commodity directives if not present in the output map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A map of commodity name strings to Commodity directives.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">commodities_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Commodity</span><span class="p">):</span>
            <span class="n">commodities_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>

                <span class="c1"># Main currency.</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">commodities_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># Currency in cost.</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="k">if</span> <span class="n">cost</span><span class="p">:</span>
                    <span class="n">commodities_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># Currency in price.</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">price</span><span class="p">:</span>
                    <span class="n">commodities_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Balance</span><span class="p">):</span>
            <span class="n">commodities_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Price</span><span class="p">):</span>
            <span class="n">commodities_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">create_missing</span><span class="p">:</span>
        <span class="c1"># Create missing Commodity directives when they haven't been specified explicitly.</span>
        <span class="c1"># (I think it might be better to always do this from the loader.)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="s1">'&lt;getters&gt;'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">commodities_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">commodity</span><span class="p">:</span> <span class="p">(</span><span class="n">entry</span>
                        <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="n">Commodity</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">commodity</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">commodity</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">commodities_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">return</span> <span class="n">commodities_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_dict_accounts">
<code class="highlight language-python">
get_dict_accounts<span class="p">(</span><span class="n">account_names</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_dict_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a nested dict of all the unique leaf names.
account names are labelled with LABEL=True</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_names</code></td>
<td><code></code></td>
<td>
<p>An iterable of account names (strings)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A nested OrderedDict of account leafs</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_dict_accounts</span><span class="p">(</span><span class="n">account_names</span><span class="p">):</span>
    <span class="sd">"""Return a nested dict of all the unique leaf names.</span>
<span class="sd">    account names are labelled with LABEL=True</span>

<span class="sd">    Args:</span>
<span class="sd">      account_names: An iterable of account names (strings)</span>
<span class="sd">    Returns:</span>
<span class="sd">      A nested OrderedDict of account leafs</span>
<span class="sd">    """</span>
    <span class="n">leveldict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">account_names</span><span class="p">:</span>
        <span class="n">nested_dict</span> <span class="o">=</span> <span class="n">leveldict</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">):</span>
            <span class="n">nested_dict</span> <span class="o">=</span> <span class="n">nested_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="n">nested_dict</span><span class="p">[</span><span class="n">get_dict_accounts</span><span class="o">.</span><span class="n">ACCOUNT_LABEL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">leveldict</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_entry_accounts">
<code class="highlight language-python">
get_entry_accounts<span class="p">(</span><span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_entry_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Gather all the accounts references by a single directive.</p>
<p>Note: This should get replaced by a method on each directive eventually,
that would be the clean way to do this.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A directive instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of account strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>133
134
135
136
137
138
139
140
141
142
143
144</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_entry_accounts</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Gather all the accounts references by a single directive.</span>

<span class="sd">    Note: This should get replaced by a method on each directive eventually,</span>
<span class="sd">    that would be the clean way to do this.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A directive instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A set of account strings.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">_GetAccounts</span><span class="o">.</span><span class="n">get_entry_accounts</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_leveln_parent_accounts">
<code class="highlight language-python">
get_leveln_parent_accounts<span class="p">(</span><span class="n">account_names</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">nrepeats</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_leveln_parent_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a list of all the unique leaf names at level N in an account hierarchy.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_names</code></td>
<td><code></code></td>
<td>
<p>A list of account names (strings)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>level</code></td>
<td><code></code></td>
<td>
<p>The level to cross-cut. 0 is for root accounts.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>nrepeats</code></td>
<td><code></code></td>
<td>
<p>A minimum number of times a leaf is required to be present in the
the list of unique account names in order to be returned by this function.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of leaf node names.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_leveln_parent_accounts</span><span class="p">(</span><span class="n">account_names</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">nrepeats</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Return a list of all the unique leaf names at level N in an account hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_names: A list of account names (strings)</span>
<span class="sd">      level: The level to cross-cut. 0 is for root accounts.</span>
<span class="sd">      nrepeats: A minimum number of times a leaf is required to be present in the</span>
<span class="sd">        the list of unique account names in order to be returned by this function.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of leaf node names.</span>
<span class="sd">    """</span>
    <span class="n">leveldict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">account_names</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
            <span class="n">leveldict</span><span class="p">[</span><span class="n">components</span><span class="p">[</span><span class="n">level</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">{</span><span class="n">level_</span>
              <span class="k">for</span> <span class="n">level_</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">leveldict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
              <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">nrepeats</span><span class="p">}</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_min_max_dates">
<code class="highlight language-python">
get_min_max_dates<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_min_max_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the minimum and maximum dates in the list of entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directive instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>types</code></td>
<td><code></code></td>
<td>
<p>An optional tuple of types to restrict the entries to.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of datetime.date dates, the minimum and maximum dates seen in the
directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_min_max_dates</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the minimum and maximum dates in the list of entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directive instances.</span>
<span class="sd">      types: An optional tuple of types to restrict the entries to.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of datetime.date dates, the minimum and maximum dates seen in the</span>
<span class="sd">      directives.</span>
<span class="sd">    """</span>
    <span class="n">date_first</span> <span class="o">=</span> <span class="n">date_last</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">date_first</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>
        <span class="k">break</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">date_last</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>
        <span class="k">break</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">date_first</span><span class="p">,</span> <span class="n">date_last</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.getters.get_values_meta">
<code class="highlight language-python">
get_values_meta<span class="p">(</span><span class="n">name_to_entries_map</span><span class="p">,</span> <span class="o">*</span><span class="n">meta_keys</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.getters.get_values_meta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get a map of the metadata from a map of entries values.</p>
<p>Given a dict of some key to a directive instance (or None), return a mapping
of the key to the metadata extracted from each directive, or a default
value. This can be used to gather a particular piece of metadata from an
accounts map or a commodities map.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name_to_entries_map</code></td>
<td><code></code></td>
<td>
<p>A dict of something to an entry or None.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>meta_keys</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the keys to fetch from the metadata.</p>
</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>default</code></td>
<td><code></code></td>
<td>
<p>The default value to use if the metadata is not available or if
the value/entry is None.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A mapping of the keys of name_to_entries_map to the values of the 'meta_keys'
metadata. If there are multiple 'meta_keys', each value is a tuple of them.
On the other hand, if there is only a single one, the value itself is returned.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/getters.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_values_meta</span><span class="p">(</span><span class="n">name_to_entries_map</span><span class="p">,</span> <span class="o">*</span><span class="n">meta_keys</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Get a map of the metadata from a map of entries values.</span>

<span class="sd">    Given a dict of some key to a directive instance (or None), return a mapping</span>
<span class="sd">    of the key to the metadata extracted from each directive, or a default</span>
<span class="sd">    value. This can be used to gather a particular piece of metadata from an</span>
<span class="sd">    accounts map or a commodities map.</span>

<span class="sd">    Args:</span>
<span class="sd">      name_to_entries_map: A dict of something to an entry or None.</span>
<span class="sd">      meta_keys: A list of strings, the keys to fetch from the metadata.</span>
<span class="sd">      default: The default value to use if the metadata is not available or if</span>
<span class="sd">        the value/entry is None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A mapping of the keys of name_to_entries_map to the values of the 'meta_keys'</span>
<span class="sd">      metadata. If there are multiple 'meta_keys', each value is a tuple of them.</span>
<span class="sd">      On the other hand, if there is only a single one, the value itself is returned.</span>
<span class="sd">    """</span>
    <span class="n">value_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">name_to_entries_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">meta_key</span> <span class="ow">in</span> <span class="n">meta_keys</span><span class="p">:</span>
            <span class="n">value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                              <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                              <span class="k">else</span> <span class="n">default</span><span class="p">)</span>
        <span class="n">value_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                          <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.interpolate">
<code>interpolate</code>
<a class="headerlink" href="#beancount.core.interpolate" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code used to automatically complete postings without positions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.interpolate.BalanceError">
<code>BalanceError</code>
<a class="headerlink" href="#beancount.core.interpolate.BalanceError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>BalanceError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.interpolate.BalanceError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.interpolate.BalanceError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.interpolate.BalanceError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.interpolate.BalanceError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of BalanceError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.interpolate.BalanceError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.interpolate.BalanceError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.compute_entries_balance">
<code class="highlight language-python">
compute_entries_balance<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.compute_entries_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the balance of all postings of a list of entries.</p>
<p>Sum up all the positions in all the postings of all the transactions in the
list of entries and return an inventory of it.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefix</code></td>
<td><code></code></td>
<td>
<p>If specified, a prefix string to restrict by account name. Only
postings with an account that starts with this prefix will be summed up.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance at which to stop adding up the balance.
The date is exclusive.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_entries_balance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Compute the balance of all postings of a list of entries.</span>

<span class="sd">    Sum up all the positions in all the postings of all the transactions in the</span>
<span class="sd">    list of entries and return an inventory of it.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      prefix: If specified, a prefix string to restrict by account name. Only</span>
<span class="sd">        postings with an account that starts with this prefix will be summed up.</span>
<span class="sd">      date: A datetime.date instance at which to stop adding up the balance.</span>
<span class="sd">        The date is exclusive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="n">total_balance</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">date</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                    <span class="n">total_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_balance</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.compute_entry_context">
<code class="highlight language-python">
compute_entry_context<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">context_entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.compute_entry_context" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the balances of all accounts referenced by entry up to entry.</p>
<p>This provides the inventory of the accounts to which the entry is to be
applied, before and after.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context_entry</code></td>
<td><code></code></td>
<td>
<p>The entry for which we want to obtain the before and after
context.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Two dicts of account-name to Inventory instance, one which represents the
context before the entry is applied, and one that represents the context
after it has been applied.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_entry_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">context_entry</span><span class="p">):</span>
    <span class="sd">"""Compute the balances of all accounts referenced by entry up to entry.</span>

<span class="sd">    This provides the inventory of the accounts to which the entry is to be</span>
<span class="sd">    applied, before and after.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      context_entry: The entry for which we want to obtain the before and after</span>
<span class="sd">        context.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Two dicts of account-name to Inventory instance, one which represents the</span>
<span class="sd">      context before the entry is applied, and one that represents the context</span>
<span class="sd">      after it has been applied.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">context_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"context_entry is missing."</span>

    <span class="c1"># Get the set of accounts for which to compute the context.</span>
    <span class="n">context_accounts</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_entry_accounts</span><span class="p">(</span><span class="n">context_entry</span><span class="p">)</span>

    <span class="c1"># Iterate over the entries until we find the target one and accumulate the</span>
    <span class="c1"># balance.</span>
    <span class="n">context_before</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="n">context_entry</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span> <span class="o">==</span> <span class="n">account</span>
                           <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">context_accounts</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">balance</span> <span class="o">=</span> <span class="n">context_before</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span>
                <span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

    <span class="c1"># Compute the after context for the entry.</span>
    <span class="n">context_after</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">context_before</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context_entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
            <span class="n">balance</span> <span class="o">=</span> <span class="n">context_after</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span>
            <span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">context_before</span><span class="p">,</span> <span class="n">context_after</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.compute_residual">
<code class="highlight language-python">
compute_residual<span class="p">(</span><span class="n">postings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.compute_residual" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the residual of a set of complete postings, and the per-currency precision.</p>
<p>This is used to cross-check a balanced transaction.</p>
<p>The precision is the maximum fraction that is being used for each currency
(a dict). We use the currency of the weight amount in order to infer the
quantization precision for each currency. Integer amounts aren't
contributing to the determination of precision.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory, with the residual of the given list of postings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_residual</span><span class="p">(</span><span class="n">postings</span><span class="p">):</span>
    <span class="sd">"""Compute the residual of a set of complete postings, and the per-currency precision.</span>

<span class="sd">    This is used to cross-check a balanced transaction.</span>

<span class="sd">    The precision is the maximum fraction that is being used for each currency</span>
<span class="sd">    (a dict). We use the currency of the weight amount in order to infer the</span>
<span class="sd">    quantization precision for each currency. Integer amounts aren't</span>
<span class="sd">    contributing to the determination of precision.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory, with the residual of the given list of postings.</span>
<span class="sd">    """</span>
    <span class="n">inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
        <span class="c1"># Skip auto-postings inserted to absorb the residual (rounding error).</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">AUTOMATIC_RESIDUAL</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="c1"># Add to total residual balance.</span>
        <span class="n">inventory</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.fill_residual_posting">
<code class="highlight language-python">
fill_residual_posting<span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account_rounding</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.fill_residual_posting" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>If necessary, insert a posting to absorb the residual.
This makes the transaction balance exactly.</p>
<p>Note: This was developed in order to tweak transactions before exporting
them to Ledger. A better method would be to enable the feature that
automatically inserts these rounding postings on all transactions, and so
maybe this method can be deprecated if we do so.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of a Transaction.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_rounding</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the rounding account that
absorbs residuals / rounding errors.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A possibly new, modified entry with a new posting. If a residual
was not needed - the transaction already balanced perfectly - no new
leg is inserted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fill_residual_posting</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">account_rounding</span><span class="p">):</span>
    <span class="sd">"""If necessary, insert a posting to absorb the residual.</span>
<span class="sd">    This makes the transaction balance exactly.</span>

<span class="sd">    Note: This was developed in order to tweak transactions before exporting</span>
<span class="sd">    them to Ledger. A better method would be to enable the feature that</span>
<span class="sd">    automatically inserts these rounding postings on all transactions, and so</span>
<span class="sd">    maybe this method can be deprecated if we do so.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of a Transaction.</span>
<span class="sd">      account_rounding: A string, the name of the rounding account that</span>
<span class="sd">        absorbs residuals / rounding errors.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A possibly new, modified entry with a new posting. If a residual</span>
<span class="sd">      was not needed - the transaction already balanced perfectly - no new</span>
<span class="sd">      leg is inserted.</span>

<span class="sd">    """</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">compute_residual</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">residual</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
        <span class="n">new_postings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)</span>
        <span class="n">new_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_residual_postings</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">account_rounding</span><span class="p">))</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">postings</span><span class="o">=</span><span class="n">new_postings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entry</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.get_residual_postings">
<code class="highlight language-python">
get_residual_postings<span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">account_rounding</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.get_residual_postings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create postings to book the given residuals.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>residual</code></td>
<td><code></code></td>
<td>
<p>An Inventory, the residual positions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_rounding</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the rounding account that
absorbs residuals / rounding errors.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of new postings to be inserted to reduce the given residual.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_residual_postings</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">account_rounding</span><span class="p">):</span>
    <span class="sd">"""Create postings to book the given residuals.</span>

<span class="sd">    Args:</span>
<span class="sd">      residual: An Inventory, the residual positions.</span>
<span class="sd">      account_rounding: A string, the name of the rounding account that</span>
<span class="sd">        absorbs residuals / rounding errors.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new postings to be inserted to reduce the given residual.</span>
<span class="sd">    """</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="n">AUTOMATIC_META</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">AUTOMATIC_RESIDUAL</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Posting</span><span class="p">(</span><span class="n">account_rounding</span><span class="p">,</span> <span class="o">-</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">residual</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.has_nontrivial_balance">
<code class="highlight language-python">
has_nontrivial_balance<span class="p">(</span><span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.has_nontrivial_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return True if a Posting has a balance amount that would have to be calculated.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>A Posting instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>56
57
58
59
60
61
62
63
64</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">has_nontrivial_balance</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""Return True if a Posting has a balance amount that would have to be calculated.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: A Posting instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">or</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.infer_tolerances">
<code class="highlight language-python">
infer_tolerances<span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">use_cost</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.infer_tolerances" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Infer tolerances from a list of postings.</p>
<p>The tolerance is the maximum fraction that is being used for each currency
(a dict). We use the currency of the weight amount in order to infer the
quantization precision for each currency. Integer amounts aren't
contributing to the determination of precision.</p>
<p>The 'use_cost' option allows one to experiment with letting postings at cost
and at price influence the maximum value of the tolerance. It's tricky to
use and alters the definition of the tolerance in a non-trivial way, if you
use it. The tolerance is expanded by the sum of the cost times a fraction 'M'
of the smallest digits in the number of units for all postings held at cost.</p>
<p>For example, in this transaction:</p>
<pre><code>2006-01-17 * "Plan Contribution"
  Assets:Investments:VWELX 18.572 VWELX {30.96 USD}
  Assets:Investments:VWELX 18.572 VWELX {30.96 USD}
  Assets:Investments:Cash -1150.00 USD
</code></pre>
<p>The tolerance for units of USD will calculated as the MAXIMUM of:</p>
<p>0.01 * M = 0.005 (from the 1150.00 USD leg)</p>
<p>The sum of
    0.001 * M x 30.96 = 0.01548 +
    0.001 * M x 30.96 = 0.01548
                      = 0.03096</p>
<p>So the tolerance for USD in this case is max(0.005, 0.03096) = 0.03096. Prices
contribute similarly to the maximum tolerance allowed.</p>
<p>Note that 'M' above is the inferred_tolerance_multiplier and its default
value is 0.5.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>A dict of options.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>use_cost</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should be using a combination of the smallest
digit of the number times the cost or price in order to infer the tolerance.
If the value is left unspecified (as 'None'), the default value can be
overridden by setting an option.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of currency to the tolerated difference amount to be used for it,
e.g. 0.005.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">infer_tolerances</span><span class="p">(</span><span class="n">postings</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">use_cost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Infer tolerances from a list of postings.</span>

<span class="sd">    The tolerance is the maximum fraction that is being used for each currency</span>
<span class="sd">    (a dict). We use the currency of the weight amount in order to infer the</span>
<span class="sd">    quantization precision for each currency. Integer amounts aren't</span>
<span class="sd">    contributing to the determination of precision.</span>

<span class="sd">    The 'use_cost' option allows one to experiment with letting postings at cost</span>
<span class="sd">    and at price influence the maximum value of the tolerance. It's tricky to</span>
<span class="sd">    use and alters the definition of the tolerance in a non-trivial way, if you</span>
<span class="sd">    use it. The tolerance is expanded by the sum of the cost times a fraction 'M'</span>
<span class="sd">    of the smallest digits in the number of units for all postings held at cost.</span>

<span class="sd">    For example, in this transaction:</span>

<span class="sd">        2006-01-17 * "Plan Contribution"</span>
<span class="sd">          Assets:Investments:VWELX 18.572 VWELX {30.96 USD}</span>
<span class="sd">          Assets:Investments:VWELX 18.572 VWELX {30.96 USD}</span>
<span class="sd">          Assets:Investments:Cash -1150.00 USD</span>

<span class="sd">    The tolerance for units of USD will calculated as the MAXIMUM of:</span>

<span class="sd">      0.01 * M = 0.005 (from the 1150.00 USD leg)</span>

<span class="sd">      The sum of</span>
<span class="sd">        0.001 * M x 30.96 = 0.01548 +</span>
<span class="sd">        0.001 * M x 30.96 = 0.01548</span>
<span class="sd">                          = 0.03096</span>

<span class="sd">    So the tolerance for USD in this case is max(0.005, 0.03096) = 0.03096. Prices</span>
<span class="sd">    contribute similarly to the maximum tolerance allowed.</span>

<span class="sd">    Note that 'M' above is the inferred_tolerance_multiplier and its default</span>
<span class="sd">    value is 0.5.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances.</span>
<span class="sd">      options_map: A dict of options.</span>
<span class="sd">      use_cost: A boolean, true if we should be using a combination of the smallest</span>
<span class="sd">        digit of the number times the cost or price in order to infer the tolerance.</span>
<span class="sd">        If the value is left unspecified (as 'None'), the default value can be</span>
<span class="sd">        overridden by setting an option.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of currency to the tolerated difference amount to be used for it,</span>
<span class="sd">      e.g. 0.005.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">use_cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">use_cost</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">"infer_tolerance_from_cost"</span><span class="p">]</span>

    <span class="n">inferred_tolerance_multiplier</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">"inferred_tolerance_multiplier"</span><span class="p">]</span>

    <span class="n">default_tolerances</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">"inferred_tolerance_default"</span><span class="p">]</span>
    <span class="n">tolerances</span> <span class="o">=</span> <span class="n">default_tolerances</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">cost_tolerances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">postings</span><span class="p">:</span>
        <span class="c1"># Skip the precision on automatically inferred postings.</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">AUTOMATIC_META</span> <span class="ow">in</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Amount</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
            <span class="k">continue</span>

        <span class="c1"># Compute bounds on the number.</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="n">expo</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">()</span><span class="o">.</span><span class="n">exponent</span>
        <span class="k">if</span> <span class="n">expo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Note: the exponent is a negative value.</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">ONE</span><span class="o">.</span><span class="n">scaleb</span><span class="p">(</span><span class="n">expo</span><span class="p">)</span> <span class="o">*</span> <span class="n">inferred_tolerance_multiplier</span>
            <span class="n">tolerances</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tolerance</span><span class="p">,</span>
                                       <span class="n">tolerances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="o">-</span><span class="mi">1024</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_cost</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Compute bounds on the smallest digit of the number implied as cost.</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
            <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">):</span>
                    <span class="n">cost_tolerance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tolerance</span> <span class="o">*</span> <span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">MAXIMUM_TOLERANCE</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">)</span>
                    <span class="n">cost_tolerance</span> <span class="o">=</span> <span class="n">MAXIMUM_TOLERANCE</span>
                    <span class="k">for</span> <span class="n">cost_number</span> <span class="ow">in</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cost_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cost_number</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">cost_tolerance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tolerance</span> <span class="o">*</span> <span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_tolerance</span><span class="p">)</span>
                <span class="n">cost_tolerances</span><span class="p">[</span><span class="n">cost_currency</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cost_tolerance</span>

            <span class="c1"># Compute bounds on the smallest digit of the number implied as cost.</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">Amount</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">price_currency</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">currency</span>
                <span class="n">price_tolerance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tolerance</span> <span class="o">*</span> <span class="n">price</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">MAXIMUM_TOLERANCE</span><span class="p">)</span>
                <span class="n">cost_tolerances</span><span class="p">[</span><span class="n">price_currency</span><span class="p">]</span> <span class="o">+=</span> <span class="n">price_tolerance</span>

    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">tolerance</span> <span class="ow">in</span> <span class="n">cost_tolerances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">tolerances</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tolerance</span><span class="p">,</span> <span class="n">tolerances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="o">-</span><span class="mi">1024</span><span class="p">))</span>

    <span class="n">default</span> <span class="o">=</span> <span class="n">tolerances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">defdict</span><span class="o">.</span><span class="n">ImmutableDictWithDefault</span><span class="p">(</span><span class="n">tolerances</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.is_tolerance_user_specified">
<code class="highlight language-python">
is_tolerance_user_specified<span class="p">(</span><span class="n">tolerance</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.is_tolerance_user_specified" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the given tolerance number was user-specified.</p>
<p>This would allow the user to provide a tolerance like # 0.1234 but not
0.123456. This is used to detect whether a tolerance value # is input by the
user and not inferred automatically.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tolerance</code></td>
<td><code></code></td>
<td>
<p>An instance of Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_tolerance_user_specified</span><span class="p">(</span><span class="n">tolerance</span><span class="p">):</span>
    <span class="sd">"""Return true if the given tolerance number was user-specified.</span>

<span class="sd">    This would allow the user to provide a tolerance like # 0.1234 but not</span>
<span class="sd">    0.123456. This is used to detect whether a tolerance value # is input by the</span>
<span class="sd">    user and not inferred automatically.</span>

<span class="sd">    Args:</span>
<span class="sd">      tolerance: An instance of Decimal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">tolerance</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">()</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_TOLERANCE_DIGITS</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.interpolate.quantize_with_tolerance">
<code class="highlight language-python">
quantize_with_tolerance<span class="p">(</span><span class="n">tolerances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.interpolate.quantize_with_tolerance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Quantize the units using the tolerance dict.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tolerances</code></td>
<td><code></code></td>
<td>
<p>A dict of currency to tolerance Decimalvalues.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A number to quantize.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string currency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal, the number possibly quantized.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/interpolate.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">quantize_with_tolerance</span><span class="p">(</span><span class="n">tolerances</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">"""Quantize the units using the tolerance dict.</span>

<span class="sd">    Args:</span>
<span class="sd">      tolerances: A dict of currency to tolerance Decimalvalues.</span>
<span class="sd">      number: A number to quantize.</span>
<span class="sd">      currency: A string currency.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal, the number possibly quantized.</span>
<span class="sd">    """</span>
    <span class="c1"># Applying rounding to the default tolerance, if there is one.</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="n">quantum</span> <span class="o">=</span> <span class="p">(</span><span class="n">tolerance</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

        <span class="c1"># If the tolerance is a neat number provided by the user,</span>
        <span class="c1"># quantize the inferred numbers. See doc on quantize():</span>
        <span class="c1">#</span>
        <span class="c1"># Unlike other operations, if the length of the coefficient</span>
        <span class="c1"># after the quantize operation would be greater than</span>
        <span class="c1"># precision, then an InvalidOperation is signaled. This</span>
        <span class="c1"># guarantees that, unless there is an error condition, the</span>
        <span class="c1"># quantized exponent is always equal to that of the</span>
        <span class="c1"># right-hand operand.</span>
        <span class="k">if</span> <span class="n">is_tolerance_user_specified</span><span class="p">(</span><span class="n">quantum</span><span class="p">):</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">quantum</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">number</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.inventory">
<code>inventory</code>
<a class="headerlink" href="#beancount.core.inventory" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A container for an inventory of positions.</p>
<p>This module provides a container class that can hold positions. An inventory is
a mapping of positions, where each position is keyed by</p>
<p>(currency: str, cost: Cost) -&gt; position: Position</p>
<p>where</p>
<p>'currency': The commodity under consideration, USD, CAD, or stock units such
     as HOOL, MSFT, AAPL, etc.;</p>
<p>'cost': None or a Cost instance existing of cost currency, number, date, and
     label;</p>
<p>'position': A Position object, whose 'units' attribute is guaranteed to have
    the same currency as 'currency' and whose 'cost' attribute is equal to the
    'cost' key. It basically stores the number of units.</p>
<p>This is meant to accommodate both booked and non-booked amounts. The clever
trick that we pull to do this is that for positions which aren't booked, we
simply leave the 'cost' as None. This is the case for most of the transactions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.inventory.Booking">
<code>Booking</code>
<a class="headerlink" href="#beancount.core.inventory.Booking" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Result of booking a new lot to an existing inventory.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.inventory.Inventory">
<code>Inventory</code>
<a class="headerlink" href="#beancount.core.inventory.Inventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An Inventory is a set of positions.</p>
<pre><code>Attributes:
  positions: A list of Position instances, held in this Inventory object.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__abs__">
<code class="highlight language-python">
__abs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__abs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return an inventory with the absolute value of each position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>192
193
194
195
196
197
198</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return an inventory with the absolute value of each position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Inventory</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__add__">
<code class="highlight language-python">
__add__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__add__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add another inventory to this one. This inventory is not modified.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>433
434
435
436
437
438
439
440
441
442
443</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Add another inventory to this one. This inventory is not modified.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: An instance of Inventory.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="n">new_inventory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
    <span class="n">new_inventory</span> <span class="o">+=</span> <span class="n">other</span>
    <span class="k">return</span> <span class="n">new_inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__copy__">
<code class="highlight language-python">
__copy__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__copy__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A shallow copy of this inventory object.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory, equal to this one.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>124
125
126
127
128
129
130</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""A shallow copy of this inventory object.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory, equal to this one.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__iadd__">
<code class="highlight language-python">
__iadd__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__iadd__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add all the positions of another Inventory instance to this one.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>An instance of Inventory to add to this one.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>This inventory, modified.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>421
422
423
424
425
426
427
428
429
430
431</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Add all the positions of another Inventory instance to this one.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: An instance of Inventory to add to this one.</span>
<span class="sd">    Returns:</span>
<span class="sd">      This inventory, modified.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">get_positions</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new inventory using a list of existing positions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>positions</code></td>
<td><code></code></td>
<td>
<p>A list of Position instances or an existing dict or
Inventory instance.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a new inventory using a list of existing positions.</span>

<span class="sd">    Args:</span>
<span class="sd">      positions: A list of Position instances or an existing dict or</span>
<span class="sd">        Inventory instance.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Inventory</span><span class="p">)):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">positions</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__iter__">
<code class="highlight language-python">
__iter__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__iter__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Iterate over the positions. Note that there is no guaranteed order.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>81
82
83</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Iterate over the positions. Note that there is no guaranteed order."""</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__lt__">
<code class="highlight language-python">
__lt__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__lt__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Inequality comparison operator.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>85
86
87</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Inequality comparison operator."""</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__mul__">
<code class="highlight language-python">
__mul__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__mul__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Scale/multiply the contents of the inventory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scalar</code></td>
<td><code></code></td>
<td>
<p>A Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>200
201
202
203
204
205
206
207
208</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
    <span class="sd">"""Scale/multiply the contents of the inventory.</span>

<span class="sd">    Args:</span>
<span class="sd">      scalar: A Decimal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Inventory</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">scalar</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__neg__">
<code class="highlight language-python">
__neg__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__neg__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return an inventory with the negative of values of this one.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>184
185
186
187
188
189
190</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return an inventory with the negative of values of this one.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Inventory</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="o">-</span><span class="n">pos</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Render as a human-readable string.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, for human consumption.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>102
103
104
105
106
107
108</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Render as a human-readable string.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, for human consumption.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.__str__">
<code class="highlight language-python">
__str__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.__str__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Render as a human-readable string.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, for human consumption.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>102
103
104
105
106
107
108</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Render as a human-readable string.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, for human consumption.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.add_amount">
<code class="highlight language-python">
add_amount<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.add_amount" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add to this inventory using amount and cost. This adds with strict lot
matching, that is, no partial matches are done on the arguments to the
keys of the inventory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>units</code></td>
<td><code></code></td>
<td>
<p>An Amount instance to add.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost</code></td>
<td><code></code></td>
<td>
<p>An instance of Cost or None, as a key to the inventory.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (position, booking) where 'position' is the position that
that was modified BEFORE it was modified, and where 'booking' is a
Booking enum that hints at how the lot was booked to this inventory.
Position may be None if there is no corresponding Position object,
e.g. the position was deleted.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Add to this inventory using amount and cost. This adds with strict lot</span>
<span class="sd">    matching, that is, no partial matches are done on the arguments to the</span>
<span class="sd">    keys of the inventory.</span>

<span class="sd">    Args:</span>
<span class="sd">      units: An Amount instance to add.</span>
<span class="sd">      cost: An instance of Cost or None, as a key to the inventory.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (position, booking) where 'position' is the position that</span>
<span class="sd">      that was modified BEFORE it was modified, and where 'booking' is a</span>
<span class="sd">      Booking enum that hints at how the lot was booked to this inventory.</span>
<span class="sd">      Position may be None if there is no corresponding Position object,</span>
<span class="sd">      e.g. the position was deleted.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Amount</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Internal error: </span><span class="si">{!r}</span><span class="s2"> (type: </span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Internal error: </span><span class="si">{!r}</span><span class="s2"> (type: </span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="c1"># Find the position.</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Note: In order to augment or reduce, all the fields have to match.</span>

        <span class="c1"># Check if reducing.</span>
        <span class="n">booking</span> <span class="o">=</span> <span class="p">(</span><span class="n">Booking</span><span class="o">.</span><span class="n">REDUCED</span>
                   <span class="k">if</span> <span class="ow">not</span> <span class="n">same_sign</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                   <span class="k">else</span> <span class="n">Booking</span><span class="o">.</span><span class="n">AUGMENTED</span><span class="p">)</span>

        <span class="c1"># Compute the new number of units.</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="c1"># If empty, delete the position.</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise update it.</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">),</span> <span class="n">cost</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not found, create a new one.</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="o">.</span><span class="n">IGNORED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
            <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="o">.</span><span class="n">CREATED</span>

    <span class="k">return</span> <span class="n">pos</span><span class="p">,</span> <span class="n">booking</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.add_inventory">
<code class="highlight language-python">
add_inventory<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.add_inventory" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add all the positions of another Inventory instance to this one.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>An instance of Inventory to add to this one.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>This inventory, modified.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>421
422
423
424
425
426
427
428
429
430
431</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Add all the positions of another Inventory instance to this one.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: An instance of Inventory to add to this one.</span>
<span class="sd">    Returns:</span>
<span class="sd">      This inventory, modified.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">get_positions</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.add_position">
<code class="highlight language-python">
add_position<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.add_position" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Add using a position (with strict lot matching).
Return True if this position was booked against and reduced another.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>position</code></td>
<td><code></code></td>
<td>
<p>The Posting or Position to add to this inventory.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (position, booking) where 'position' is the position that
that was modified, and where 'booking' is a Booking enum that hints at
how the lot was booked to this inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
    <span class="sd">"""Add using a position (with strict lot matching).</span>
<span class="sd">    Return True if this position was booked against and reduced another.</span>

<span class="sd">    Args:</span>
<span class="sd">      position: The Posting or Position to add to this inventory.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (position, booking) where 'position' is the position that</span>
<span class="sd">      that was modified, and where 'booking' is a Booking enum that hints at</span>
<span class="sd">      how the lot was booked to this inventory.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="s1">'units'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="s1">'cost'</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Invalid type for position: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Cost</span><span class="p">)),</span> <span class="p">(</span>
        <span class="s2">"Invalid type for cost: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.average">
<code class="highlight language-python">
average<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.average" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Average all lots of the same currency together.</p>
<p>Use the minimum date from each aggregated set of lots.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Average all lots of the same currency together.</span>

<span class="sd">    Use the minimum date from each aggregated set of lots.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
               <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

    <span class="n">average_inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">),</span> <span class="n">positions</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">total_units</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
                          <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">)</span>
        <span class="n">units_amount</span> <span class="o">=</span> <span class="n">Amount</span><span class="p">(</span><span class="n">total_units</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cost_currency</span><span class="p">:</span>
            <span class="n">total_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">(</span><span class="n">position</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
                             <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">)</span>
            <span class="n">cost_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'Infinity'</span><span class="p">)</span>
                           <span class="k">if</span> <span class="n">total_units</span> <span class="o">==</span> <span class="n">ZERO</span>
                           <span class="k">else</span> <span class="p">(</span><span class="n">total_cost</span> <span class="o">/</span> <span class="n">total_units</span><span class="p">))</span>
            <span class="n">min_date</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="n">pos_date</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span> <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">pos_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">min_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_date</span>
                                <span class="k">if</span> <span class="n">min_date</span> <span class="ow">is</span> <span class="kc">None</span>
                                <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_date</span><span class="p">,</span> <span class="n">pos_date</span><span class="p">))</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">min_date</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">average_inventory</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">units_amount</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">average_inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.cost_currencies">
<code class="highlight language-python">
cost_currencies<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.cost_currencies" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the list of unit currencies held in this inventory.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of currency strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>222
223
224
225
226
227
228
229
230</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cost_currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the list of unit currencies held in this inventory.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A set of currency strings.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span>
               <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">cost</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.currencies">
<code class="highlight language-python">
currencies<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.currencies" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the list of unit currencies held in this inventory.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of currency strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>214
215
216
217
218
219
220</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the list of unit currencies held in this inventory.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of currency strings.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">currency</span> <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.currency_pairs">
<code class="highlight language-python">
currency_pairs<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.currency_pairs" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the commodities held in this inventory.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A set of currency strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>232
233
234
235
236
237
238</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">currency_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the commodities held in this inventory.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A set of currency strings.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">currency_pair</span><span class="p">()</span> <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.inventory.Inventory.from_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create an Inventory from a string. This is useful for writing tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A comma-separated string of &lt;number&gt; &lt;currency&gt; with an
optional {&lt;number&gt; &lt;currency&gt;} for the cost.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Inventory with the given balances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create an Inventory from a string. This is useful for writing tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A comma-separated string of &lt;number&gt; &lt;currency&gt; with an</span>
<span class="sd">        optional {&lt;number&gt; &lt;currency&gt;} for the cost.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Inventory with the given balances.</span>
<span class="sd">    """</span>
    <span class="n">new_inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="c1"># We need to split the comma-separated positions but ignore commas</span>
    <span class="c1"># occurring within a {...cost...} specification.</span>
    <span class="n">position_strs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">'([-+]?[0-9,.]+\s+[A-Z]+\s*(?:{[^}]*})?)\s*,?\s*'</span><span class="p">,</span> <span class="n">string</span><span class="p">)[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">position_str</span> <span class="ow">in</span> <span class="n">position_strs</span><span class="p">:</span>
        <span class="n">new_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position_from_string</span><span class="p">(</span><span class="n">position_str</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.get_currency_units">
<code class="highlight language-python">
get_currency_units<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.get_currency_units" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Fetch the total amount across all the position in the given currency.
This may sum multiple lots in the same currency denomination.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency to filter the positions with.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Amount, with the given currency.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_currency_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Fetch the total amount across all the position in the given currency.</span>
<span class="sd">    This may sum multiple lots in the same currency denomination.</span>

<span class="sd">    Args:</span>
<span class="sd">      currency: A string, the currency to filter the positions with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Amount, with the given currency.</span>
<span class="sd">    """</span>
    <span class="n">total_units</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">currency</span><span class="p">:</span>
            <span class="n">total_units</span> <span class="o">+=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span>
    <span class="k">return</span> <span class="n">Amount</span><span class="p">(</span><span class="n">total_units</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.get_only_position">
<code class="highlight language-python">
get_only_position<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.get_only_position" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the first position and assert there are no more.
If the inventory is empty, return None.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>248
249
250
251
252
253
254
255
256</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_only_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the first position and assert there are no more.</span>
<span class="sd">    If the inventory is empty, return None.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"Inventory has more than one expected "</span>
                                 <span class="s2">"position: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.get_positions">
<code class="highlight language-python">
get_positions<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.get_positions" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the positions in this inventory.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A shallow copy of the list of positions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>240
241
242
243
244
245
246</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the positions in this inventory.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A shallow copy of the list of positions.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.is_empty">
<code class="highlight language-python">
is_empty<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.is_empty" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if the inventory is empty, that is, has no positions.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return true if the inventory is empty, that is, has no positions.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.is_mixed">
<code class="highlight language-python">
is_mixed<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.is_mixed" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if the inventory contains a mix of positive and negative lots for
at least one instrument.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_mixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return true if the inventory contains a mix of positive and negative lots for</span>
<span class="sd">    at least one instrument.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="n">signs_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">prev_sign</span> <span class="o">=</span> <span class="n">signs_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">!=</span> <span class="n">prev_sign</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.is_reduced_by">
<code class="highlight language-python">
is_reduced_by<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ramount</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.is_reduced_by" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if the amount could reduce this inventory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ramount</code></td>
<td><code></code></td>
<td>
<p>An instance of Amount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_reduced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ramount</span><span class="p">):</span>
    <span class="sd">"""Return true if the amount could reduce this inventory.</span>

<span class="sd">    Args:</span>
<span class="sd">      ramount: An instance of Amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">ramount</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ramount</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">units</span><span class="o">.</span><span class="n">currency</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">same_sign</span><span class="p">(</span><span class="n">ramount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.is_small">
<code class="highlight language-python">
is_small<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.is_small" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if all the positions in the inventory are small.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tolerances</code></td>
<td><code></code></td>
<td>
<p>A Decimal, the small number of units under which a position
is considered small, or a dict of currency to such epsilon precision.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_small</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerances</span><span class="p">):</span>
    <span class="sd">"""Return true if all the positions in the inventory are small.</span>

<span class="sd">    Args:</span>
<span class="sd">      tolerances: A Decimal, the small number of units under which a position</span>
<span class="sd">        is considered small, or a dict of currency to such epsilon precision.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tolerances</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">small</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">small</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerances</span>
                        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">small</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.reduce">
<code class="highlight language-python">
reduce<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reducer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.reduce" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Reduce an inventory using one of the conversion functions.</p>
<p>See functions in beancount.core.conversions.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>295
296
297
298
299
300
301
302
303
304
305
306</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reducer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Reduce an inventory using one of the conversion functions.</span>

<span class="sd">    See functions in beancount.core.conversions.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="n">inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">inventory</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">reducer</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.segregate_units">
<code class="highlight language-python">
segregate_units<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currencies</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.segregate_units" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Split up the list of positions to the given currencies.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>currencies</code></td>
<td><code></code></td>
<td>
<p>A list of currency strings, the currencies to isolate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of currency to Inventory instances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">segregate_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currencies</span><span class="p">):</span>
    <span class="sd">"""Split up the list of positions to the given currencies.</span>

<span class="sd">    Args:</span>
<span class="sd">      currencies: A list of currency strings, the currencies to isolate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of currency to Inventory instances.</span>
<span class="sd">    """</span>
    <span class="n">per_currency_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">currency</span><span class="p">:</span> <span class="n">Inventory</span><span class="p">()</span>
                         <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies</span><span class="p">}</span>
    <span class="n">per_currency_dict</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">currency</span> <span class="k">if</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">per_currency_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">per_currency_dict</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.inventory.Inventory.to_string">
<code class="highlight language-python">
to_string<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=&lt;</span><span class="n">beancount</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display_context</span><span class="o">.</span><span class="n">DisplayFormatter</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fdddb06de80</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">parens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.Inventory.to_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Convert an Inventory instance to a printable string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayFormatter.</p>
</td>
<td><code>&lt;beancount.core.display_context.DisplayFormatter object at 0x7fdddb06de80&gt;</code></td>
</tr>
<tr>
<td><code>parents</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should surround the results by parentheses.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A formatted string of the quantized amount and symbol.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="n">DEFAULT_FORMATTER</span><span class="p">,</span> <span class="n">parens</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Convert an Inventory instance to a printable string.</span>

<span class="sd">    Args:</span>
<span class="sd">      dformat: An instance of DisplayFormatter.</span>
<span class="sd">      parents: A boolean, true if we should surround the results by parentheses.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A formatted string of the quantized amount and symbol.</span>
<span class="sd">    """</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">'(</span><span class="si">{}</span><span class="s1">)'</span> <span class="k">if</span> <span class="n">parens</span> <span class="k">else</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">'</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.inventory.check_invariants">
<code class="highlight language-python">
check_invariants<span class="p">(</span><span class="n">inv</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.check_invariants" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check the invariants of the Inventory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>inventory</code></td>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>True if the invariants are respected.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_invariants</span><span class="p">(</span><span class="n">inv</span><span class="p">):</span>
    <span class="sd">"""Check the invariants of the Inventory.</span>

<span class="sd">    Args:</span>
<span class="sd">      inventory: An instance of Inventory.</span>
<span class="sd">    Returns:</span>
<span class="sd">      True if the invariants are respected.</span>
<span class="sd">    """</span>
    <span class="c1"># Check that all the keys are unique.</span>
    <span class="n">lots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">inv</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lots</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inv</span><span class="p">),</span> <span class="s2">"Invalid inventory: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inv</span><span class="p">)</span>
    <span class="c1"># Check that none of the amounts is zero.</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">inv</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">,</span> <span class="s2">"Invalid position size: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.inventory.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.inventory.from_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create an Inventory from a string. This is useful for writing tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A comma-separated string of &lt;number&gt; &lt;currency&gt; with an
optional {&lt;number&gt; &lt;currency&gt;} for the cost.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Inventory with the given balances.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/inventory.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create an Inventory from a string. This is useful for writing tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A comma-separated string of &lt;number&gt; &lt;currency&gt; with an</span>
<span class="sd">        optional {&lt;number&gt; &lt;currency&gt;} for the cost.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Inventory with the given balances.</span>
<span class="sd">    """</span>
    <span class="n">new_inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
    <span class="c1"># We need to split the comma-separated positions but ignore commas</span>
    <span class="c1"># occurring within a {...cost...} specification.</span>
    <span class="n">position_strs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">'([-+]?[0-9,.]+\s+[A-Z]+\s*(?:{[^}]*})?)\s*,?\s*'</span><span class="p">,</span> <span class="n">string</span><span class="p">)[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">position_str</span> <span class="ow">in</span> <span class="n">position_strs</span><span class="p">:</span>
        <span class="n">new_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">position_from_string</span><span class="p">(</span><span class="n">position_str</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_inventory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.inventory_test">
<code>inventory_test</code>
<a class="headerlink" href="#beancount.core.inventory_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Unit tests for the Inventory class.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.number">
<code>number</code>
<a class="headerlink" href="#beancount.core.number" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>The module contains the basic Decimal type import.</p>
<p>About Decimal usage:</p>
<ul>
<li>
<p>Do not import Decimal from the 'decimal' or 'cdecimal' modules; always import
  your Decimal class from beancount.core.amount.</p>
</li>
<li>
<p>Prefer to use D() to create new instances of Decimal objects, which
  handles more syntax, e.g., handles None, and numbers with commas.</p>
</li>
</ul>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.number.D">
<code class="highlight language-python">
D<span class="p">(</span><span class="n">strord</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.number.D" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a string into a Decimal object.</p>
<p>This is used in parsing amounts from files in the importers. This is the
main function you should use to build all numbers the system manipulates
(never use floating-point in an accounting system). Commas are stripped and
ignored, as they are assumed to be thousands separators (the French comma
separator as decimal is not supported). This function just returns the
argument if it is already a Decimal object, for convenience.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strord</code></td>
<td><code></code></td>
<td>
<p>A string or Decimal instance.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/number.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">D</span><span class="p">(</span><span class="n">strord</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Convert a string into a Decimal object.</span>

<span class="sd">    This is used in parsing amounts from files in the importers. This is the</span>
<span class="sd">    main function you should use to build all numbers the system manipulates</span>
<span class="sd">    (never use floating-point in an accounting system). Commas are stripped and</span>
<span class="sd">    ignored, as they are assumed to be thousands separators (the French comma</span>
<span class="sd">    separator as decimal is not supported). This function just returns the</span>
<span class="sd">    argument if it is already a Decimal object, for convenience.</span>

<span class="sd">    Args:</span>
<span class="sd">      strord: A string or Decimal instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal instance.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Note: try a map lookup and optimize performance here.</span>
        <span class="k">if</span> <span class="n">strord</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">strord</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Decimal</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strord</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">_CLEAN_NUMBER_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">strord</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strord</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">strord</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strord</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">strord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">strord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"Invalid value to convert: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strord</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Impossible to create Decimal instance from </span><span class="si">{!s}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">strord</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.number.is_fast_decimal">
<code class="highlight language-python">
is_fast_decimal<span class="p">(</span><span class="n">decimal_module</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.number.is_fast_decimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if a fast C decimal implementation is installed.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/number.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>38
39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_fast_decimal</span><span class="p">(</span><span class="n">decimal_module</span><span class="p">):</span>
    <span class="s2">"Return true if a fast C decimal implementation is installed."</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decimal_module</span><span class="o">.</span><span class="n">Decimal</span><span class="p">()</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">BuiltinFunctionType</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.number.round_to">
<code class="highlight language-python">
round_to<span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">increment</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.number.round_to" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Round a number <em>down</em> to a particular increment.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>A Decimal, the number to be rounded.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>increment</code></td>
<td><code></code></td>
<td>
<p>A Decimal, the size of the increment.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal, the rounded number.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/number.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>108
109
110
111
112
113
114
115
116
117</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">round_to</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">increment</span><span class="p">):</span>
    <span class="sd">"""Round a number *down* to a particular increment.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: A Decimal, the number to be rounded.</span>
<span class="sd">      increment: A Decimal, the size of the increment.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal, the rounded number.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">number</span> <span class="o">/</span> <span class="n">increment</span><span class="p">))</span> <span class="o">*</span> <span class="n">increment</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.number.same_sign">
<code class="highlight language-python">
same_sign<span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="n">number2</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.number.same_sign" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if both numbers have the same sign.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number1</code></td>
<td><code></code></td>
<td>
<p>An instance of Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>number2</code></td>
<td><code></code></td>
<td>
<p>An instance of Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/number.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>120
121
122
123
124
125
126
127
128
129</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">same_sign</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="n">number2</span><span class="p">):</span>
    <span class="sd">"""Return true if both numbers have the same sign.</span>

<span class="sd">    Args:</span>
<span class="sd">      number1: An instance of Decimal.</span>
<span class="sd">      number2: An instance of Decimal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">number1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">number2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.position">
<code>position</code>
<a class="headerlink" href="#beancount.core.position" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A position object, which consists of units Amount and cost Cost.</p>
<p>See types below for details.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.position.Cost">
<code>Cost</code>
<a class="headerlink" href="#beancount.core.position.Cost" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Cost(number, currency, date, label)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Cost.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Cost.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Cost.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Cost.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Cost(number, currency, date, label)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Cost.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Cost.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.position.CostSpec">
<code>CostSpec</code>
<a class="headerlink" href="#beancount.core.position.CostSpec" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>CostSpec(number_per, number_total, currency, date, label, merge)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.CostSpec.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.CostSpec.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.CostSpec.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">number_per</span><span class="p">,</span> <span class="n">number_total</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">merge</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.CostSpec.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of CostSpec(number_per, number_total, currency, date, label, merge)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.CostSpec.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.CostSpec.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.position.Position">
<code>Position</code>
<a class="headerlink" href="#beancount.core.position.Position" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A 'Position' is a pair of units and optional cost.
    This is used to track inventories.</p>
<pre><code>Attributes:
  units: An Amount, the number of units and its currency.
  cost: A Cost that represents the lot, or None.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__abs__">
<code class="highlight language-python">
__abs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__abs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the absolute value of the position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Position with the absolute units.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>274
275
276
277
278
279
280</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the absolute value of the position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Position with the absolute units.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">amount_abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__copy__">
<code class="highlight language-python">
__copy__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__copy__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Shallow copy, except for the lot, which can be shared. This is important for
performance reasons; a lot of time is spent here during balancing.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A shallow copy of this position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>245
246
247
248
249
250
251
252
253</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Shallow copy, except for the lot, which can be shared. This is important for</span>
<span class="sd">    performance reasons; a lot of time is spent here during balancing.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A shallow copy of this position.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We use Decimal() for efficiency.</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__eq__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Equality comparison with another Position. The objects are considered equal
if both number and lot are matching, and if the number of units is zero
and the other position is None, that is also okay.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>An instance of Position, or None.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the positions are equal.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Equality comparison with another Position. The objects are considered equal</span>
<span class="sd">    if both number and lot are matching, and if the number of units is zero</span>
<span class="sd">    and the other position is None, that is also okay.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: An instance of Position, or None.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the positions are equal.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">ZERO</span>
            <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">units</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__hash__">
<code class="highlight language-python">
__hash__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__hash__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Compute a hash for this position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A hash of this position object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>179
180
181
182
183
184
185</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Compute a hash for this position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A hash of this position object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__lt__">
<code class="highlight language-python">
__lt__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__lt__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A less-than comparison operator for positions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>Another instance of Position.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>True if this positions is smaller than the other position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>235
236
237
238
239
240
241
242
243</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""A less-than comparison operator for positions.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: Another instance of Position.</span>
<span class="sd">    Returns:</span>
<span class="sd">      True if this positions is smaller than the other position.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sortkey</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">sortkey</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__mul__">
<code class="highlight language-python">
__mul__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__mul__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Scale/multiply the contents of the position.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scalar</code></td>
<td><code></code></td>
<td>
<p>A Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>282
283
284
285
286
287
288
289
290</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
    <span class="sd">"""Scale/multiply the contents of the position.</span>

<span class="sd">    Args:</span>
<span class="sd">      scalar: A Decimal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Inventory.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">amount_mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">scalar</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__neg__">
<code class="highlight language-python">
__neg__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__neg__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Get a copy of this position but with a negative number.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Position which represents the inverse of this Position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>263
264
265
266
267
268
269
270</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Get a copy of this position but with a negative number.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Position which represents the inverse of this Position.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We use Decimal() for efficiency.</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of _Position(units, cost)</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>172
173
174
175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Amount</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Expected an Amount for units; received '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Position</span><span class="o">.</span><span class="n">cost_types</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Expected a Cost for cost; received '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_Position</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a string representation of the position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, a printable representation of the position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>192
193
194
195
196
197
198</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return a string representation of the position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, a printable representation of the position.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.__str__">
<code class="highlight language-python">
__str__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.__str__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a string representation of the position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, a printable representation of the position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>192
193
194
195
196
197
198</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return a string representation of the position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string, a printable representation of the position.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.currency_pair">
<code class="highlight language-python">
currency_pair<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.Position.currency_pair" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the currency pair associated with this position.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of a currency string and a cost currency string or None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>255
256
257
258
259
260
261</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">currency_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return the currency pair associated with this position.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A pair of a currency string and a cost currency string or None.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.from_amounts">
<code class="highlight language-python">
from_amounts<span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.from_amounts" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a position from an amount and a cost.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An amount, that represents the number of units and the lot currency.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_amount</code></td>
<td><code></code></td>
<td>
<p>If not None, represents the cost amount.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Position instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_amounts</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a position from an amount and a cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An amount, that represents the number of units and the lot currency.</span>
<span class="sd">      cost_amount: If not None, represents the cost amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Position instance.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">cost_amount</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_amount</span><span class="p">,</span> <span class="n">Amount</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Invalid type for cost: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_amount</span><span class="p">))</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cost</span><span class="p">(</span><span class="n">cost_amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cost_amount</span> <span class="k">else</span>
            <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.core.position.Position.from_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a position from a string specification.</p>
<p>This is a miniature parser used for building tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string of &lt;number&gt; &lt;currency&gt; with an optional {&lt;number&gt;
&lt;currency&gt;} for the cost, similar to the parser syntax.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create a position from a string specification.</span>

<span class="sd">    This is a miniature parser used for building tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string of &lt;number&gt; &lt;currency&gt; with an optional {&lt;number&gt;</span>
<span class="sd">        &lt;currency&gt;} for the cost, similar to the parser syntax.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Position.</span>
<span class="sd">    """</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="p">(</span><span class="sa">r</span><span class="s1">'\s*(</span><span class="si">{}</span><span class="s1">)\s+(</span><span class="si">{}</span><span class="s1">)'</span>
         <span class="sa">r</span><span class="s1">'(?:\s+{{([^}}]*)}})?'</span>
         <span class="sa">r</span><span class="s1">'\s*$'</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NUMBER_RE</span><span class="p">,</span> <span class="n">CURRENCY_RE</span><span class="p">),</span>
        <span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid string for position: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Parse a cost expression.</span>
    <span class="n">cost_number</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cost_currency</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cost_expression</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">expressions</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'[,/]'</span><span class="p">,</span> <span class="n">cost_expression</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">:</span>

            <span class="c1"># Match a compound number.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s1">'(</span><span class="si">{NUMBER_RE}</span><span class="s1">)\s*(?:#\s*(</span><span class="si">{NUMBER_RE}</span><span class="s1">))?\s+(</span><span class="si">{CURRENCY_RE}</span><span class="s1">)$'</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NUMBER_RE</span><span class="o">=</span><span class="n">NUMBER_RE</span><span class="p">,</span> <span class="n">CURRENCY_RE</span><span class="o">=</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
                <span class="n">expr</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">per_number</span><span class="p">,</span> <span class="n">total_number</span><span class="p">,</span> <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">per_number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">per_number</span><span class="p">)</span> <span class="k">if</span> <span class="n">per_number</span> <span class="k">else</span> <span class="n">ZERO</span>
                <span class="n">total_number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">total_number</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_number</span> <span class="k">else</span> <span class="n">ZERO</span>
                <span class="k">if</span> <span class="n">total_number</span><span class="p">:</span>
                    <span class="c1"># Calculate the per-unit cost.</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">per_number</span> <span class="o">+</span> <span class="n">total_number</span>
                    <span class="n">per_number</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">number</span>
                <span class="n">cost_number</span> <span class="o">=</span> <span class="n">per_number</span>
                <span class="k">continue</span>

            <span class="c1"># Match a date.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(\d\d\d\d)[-/](\d\d)[-/](\d\d)$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
                <span class="k">continue</span>

            <span class="c1"># Match a label.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'"([^"]+)*"$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Match a merge-cost marker.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\*$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Merge-code not supported in string constructor."</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid cost component: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.get_negative">
<code class="highlight language-python">
get_negative<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.Position.get_negative" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Get a copy of this position but with a negative number.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Position which represents the inverse of this Position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>263
264
265
266
267
268
269
270</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Get a copy of this position but with a negative number.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An instance of Position which represents the inverse of this Position.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We use Decimal() for efficiency.</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.is_negative_at_cost">
<code class="highlight language-python">
is_negative_at_cost<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.Position.is_negative_at_cost" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return true if the position is held at cost and negative.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>292
293
294
295
296
297
298</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_negative_at_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return true if the position is held at cost and negative.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">ZERO</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.sortkey">
<code class="highlight language-python">
sortkey<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.Position.sortkey" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a key to sort positions by. This key depends on the order of the
currency of the lot (we want to order common currencies first) and the
number of units.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple, used to sort lists of positions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Return a key to sort positions by. This key depends on the order of the</span>
<span class="sd">    currency of the lot (we want to order common currencies first) and the</span>
<span class="sd">    number of units.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A tuple, used to sort lists of positions.</span>
<span class="sd">    """</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
    <span class="n">order_units</span> <span class="o">=</span> <span class="n">CURRENCY_ORDER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">NCURRENCIES</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">currency</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cost_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span>
        <span class="n">cost_currency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cost_number</span> <span class="o">=</span> <span class="n">ZERO</span>
        <span class="n">cost_currency</span> <span class="o">=</span> <span class="s1">''</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">order_units</span><span class="p">,</span> <span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.position.Position.to_string">
<code class="highlight language-python">
to_string<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=&lt;</span><span class="n">beancount</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display_context</span><span class="o">.</span><span class="n">DisplayFormatter</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fdddb06de80</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.Position.to_string" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Render the position to a string.See to_string() for details.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>187
188
189
190</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="n">DEFAULT_FORMATTER</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Render the position to a string.See to_string() for details.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.position.cost_to_str">
<code class="highlight language-python">
cost_to_str<span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.cost_to_str" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Format an instance of Cost or a CostSpec to a string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cost</code></td>
<td><code></code></td>
<td>
<p>An instance of Cost or CostSpec.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>A DisplayFormatter object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>detail</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should render the non-amount components.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, suitable for formatting.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cost_to_str</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Format an instance of Cost or a CostSpec to a string.</span>

<span class="sd">    Args:</span>
<span class="sd">      cost: An instance of Cost or CostSpec.</span>
<span class="sd">      dformat: A DisplayFormatter object.</span>
<span class="sd">      detail: A boolean, true if we should render the non-amount components.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, suitable for formatting.</span>
<span class="sd">    """</span>
    <span class="n">strlist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">Cost</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">dformat</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'"</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">CostSpec</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="n">amountlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">amountlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_per</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">amountlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'#'</span><span class="p">)</span>
                <span class="n">amountlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">number_total</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">amountlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">amountlist</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'"</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cost</span><span class="o">.</span><span class="n">merge</span><span class="p">:</span>
                <span class="n">strlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'*'</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.position.from_amounts">
<code class="highlight language-python">
from_amounts<span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.from_amounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a position from an amount and a cost.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amount</code></td>
<td><code></code></td>
<td>
<p>An amount, that represents the number of units and the lot currency.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_amount</code></td>
<td><code></code></td>
<td>
<p>If not None, represents the cost amount.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Position instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_amounts</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create a position from an amount and a cost.</span>

<span class="sd">    Args:</span>
<span class="sd">      amount: An amount, that represents the number of units and the lot currency.</span>
<span class="sd">      cost_amount: If not None, represents the cost amount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Position instance.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">cost_amount</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cost_amount</span><span class="p">,</span> <span class="n">Amount</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">"Invalid type for cost: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_amount</span><span class="p">))</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cost</span><span class="p">(</span><span class="n">cost_amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">cost_amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cost_amount</span> <span class="k">else</span>
            <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.position.from_string">
<code class="highlight language-python">
from_string<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.from_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a position from a string specification.</p>
<p>This is a miniature parser used for building tests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string of &lt;number&gt; &lt;currency&gt; with an optional {&lt;number&gt;
&lt;currency&gt;} for the cost, similar to the parser syntax.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A new instance of Position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Create a position from a string specification.</span>

<span class="sd">    This is a miniature parser used for building tests.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string of &lt;number&gt; &lt;currency&gt; with an optional {&lt;number&gt;</span>
<span class="sd">        &lt;currency&gt;} for the cost, similar to the parser syntax.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A new instance of Position.</span>
<span class="sd">    """</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="p">(</span><span class="sa">r</span><span class="s1">'\s*(</span><span class="si">{}</span><span class="s1">)\s+(</span><span class="si">{}</span><span class="s1">)'</span>
         <span class="sa">r</span><span class="s1">'(?:\s+{{([^}}]*)}})?'</span>
         <span class="sa">r</span><span class="s1">'\s*$'</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NUMBER_RE</span><span class="p">,</span> <span class="n">CURRENCY_RE</span><span class="p">),</span>
        <span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid string for position: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Parse a cost expression.</span>
    <span class="n">cost_number</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cost_currency</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cost_expression</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">expressions</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'[,/]'</span><span class="p">,</span> <span class="n">cost_expression</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">:</span>

            <span class="c1"># Match a compound number.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s1">'(</span><span class="si">{NUMBER_RE}</span><span class="s1">)\s*(?:#\s*(</span><span class="si">{NUMBER_RE}</span><span class="s1">))?\s+(</span><span class="si">{CURRENCY_RE}</span><span class="s1">)$'</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NUMBER_RE</span><span class="o">=</span><span class="n">NUMBER_RE</span><span class="p">,</span> <span class="n">CURRENCY_RE</span><span class="o">=</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
                <span class="n">expr</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">per_number</span><span class="p">,</span> <span class="n">total_number</span><span class="p">,</span> <span class="n">cost_currency</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">per_number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">per_number</span><span class="p">)</span> <span class="k">if</span> <span class="n">per_number</span> <span class="k">else</span> <span class="n">ZERO</span>
                <span class="n">total_number</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">total_number</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_number</span> <span class="k">else</span> <span class="n">ZERO</span>
                <span class="k">if</span> <span class="n">total_number</span><span class="p">:</span>
                    <span class="c1"># Calculate the per-unit cost.</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">per_number</span> <span class="o">+</span> <span class="n">total_number</span>
                    <span class="n">per_number</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">number</span>
                <span class="n">cost_number</span> <span class="o">=</span> <span class="n">per_number</span>
                <span class="k">continue</span>

            <span class="c1"># Match a date.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(\d\d\d\d)[-/](\d\d)[-/](\d\d)$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
                <span class="k">continue</span>

            <span class="c1"># Match a label.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'"([^"]+)*"$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Match a merge-cost marker.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\*$'</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Merge-code not supported in string constructor."</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid cost component: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">Cost</span><span class="p">(</span><span class="n">cost_number</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.position.get_position">
<code class="highlight language-python">
get_position<span class="p">(</span><span class="n">posting</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.get_position" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build a Position instance from a Posting instance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>posting</code></td>
<td><code></code></td>
<td>
<p>An instance of Posting.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>125
126
127
128
129
130
131
132
133</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="n">posting</span><span class="p">):</span>
    <span class="sd">"""Build a Position instance from a Posting instance.</span>

<span class="sd">    Args:</span>
<span class="sd">      posting: An instance of Posting.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Position.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.position.to_string">
<code class="highlight language-python">
to_string<span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=&lt;</span><span class="n">beancount</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display_context</span><span class="o">.</span><span class="n">DisplayFormatter</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fdddb06de80</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.position.to_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render the Position or Posting instance to a string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td><code></code></td>
<td>
<p>An instance of Position or Posting.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayFormatter.</p>
</td>
<td><code>&lt;beancount.core.display_context.DisplayFormatter object at 0x7fdddb06de80&gt;</code></td>
</tr>
<tr>
<td><code>detail</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should only render the lot details
beyond the cost (lot-date, label, etc.). If false, we only render
the cost, if present.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the rendered position.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/position.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="n">DEFAULT_FORMATTER</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Render the Position or Posting instance to a string.</span>

<span class="sd">    Args:</span>
<span class="sd">      pos: An instance of Position or Posting.</span>
<span class="sd">      dformat: An instance of DisplayFormatter.</span>
<span class="sd">      detail: A boolean, true if we should only render the lot details</span>
<span class="sd">       beyond the cost (lot-date, label, etc.). If false, we only render</span>
<span class="sd">       the cost, if present.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered position.</span>
<span class="sd">    """</span>
    <span class="n">pos_str</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pos_str</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> {{</span><span class="si">{}</span><span class="s1">}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos_str</span><span class="p">,</span> <span class="n">cost_to_str</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">detail</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pos_str</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.position_test">
<code>position_test</code>
<a class="headerlink" href="#beancount.core.position_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Unit tests for the Position class.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.prices">
<code>prices</code>
<a class="headerlink" href="#beancount.core.prices" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>This module has code that can build a database of historical prices at
various times, from which unrealized capital gains and market value can be
deduced.</p>
<p>Prices are deduced from Price entries found in the file, or perhaps
created by scripts (for example you could build a script that will fetch
live prices online and create entries on-the-fly).</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.prices.PriceMap">
<code>PriceMap</code>
<a class="headerlink" href="#beancount.core.prices.PriceMap" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A price map dictionary.</p>
<pre><code>The keys include both the set of forward (base, quote) pairs and their
inverse. In order to determine which are the forward pairs, access the
'forward_pairs' attribute

Attributes:
  forward_pairs: A list of (base, quote) keys for the forward pairs.
</code></pre>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.build_price_map">
<code class="highlight language-python">
build_price_map<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.build_price_map" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build a price map from a list of arbitrary entries.</p>
<p>If multiple prices are found for the same (currency, cost-currency) pair at
the same date, the latest date is kept and the earlier ones (for that day)
are discarded.</p>
<p>If inverse price pairs are found, e.g. USD in AUD and AUD in USD, the
inverse that has the smallest number of price points is converted into the
one that has the most price points. In that way they are reconciled into a
single one.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives, hopefully including some Price and/or</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict of (currency, cost-currency) keys to sorted lists of (date, number)
pairs, where 'date' is the date the price occurs at and 'number' a Decimal
that represents the price, or rate, between these two
currencies/commodities. Each date occurs only once in the sorted list of
prices of a particular key. All of the inverses are automatically
generated in the price map.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build_price_map</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Build a price map from a list of arbitrary entries.</span>

<span class="sd">    If multiple prices are found for the same (currency, cost-currency) pair at</span>
<span class="sd">    the same date, the latest date is kept and the earlier ones (for that day)</span>
<span class="sd">    are discarded.</span>

<span class="sd">    If inverse price pairs are found, e.g. USD in AUD and AUD in USD, the</span>
<span class="sd">    inverse that has the smallest number of price points is converted into the</span>
<span class="sd">    one that has the most price points. In that way they are reconciled into a</span>
<span class="sd">    single one.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives, hopefully including some Price and/or</span>
<span class="sd">      Transaction entries.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict of (currency, cost-currency) keys to sorted lists of (date, number)</span>
<span class="sd">      pairs, where 'date' is the date the price occurs at and 'number' a Decimal</span>
<span class="sd">      that represents the price, or rate, between these two</span>
<span class="sd">      currencies/commodities. Each date occurs only once in the sorted list of</span>
<span class="sd">      prices of a particular key. All of the inverses are automatically</span>
<span class="sd">      generated in the price map.</span>
<span class="sd">    """</span>
    <span class="c1"># Fetch a list of all the price entries seen in the ledger.</span>
    <span class="n">price_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span>
                     <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Price</span><span class="p">)]</span>

    <span class="c1"># Build a map of exchange rates between these units.</span>
    <span class="c1"># (base-currency, quote-currency) -&gt; List of (date, rate).</span>
    <span class="n">price_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">price_entries</span><span class="p">:</span>
        <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">price_map</span><span class="p">[</span><span class="n">base_quote</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">price</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>

    <span class="c1"># Find pairs of inversed units.</span>
    <span class="n">inversed_units</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">price_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">base_quote</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span> <span class="ow">in</span> <span class="n">price_map</span><span class="p">:</span>
            <span class="n">inversed_units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_quote</span><span class="p">)</span>

    <span class="c1"># Find pairs of inversed units, and swallow the conversion with the smaller</span>
    <span class="c1"># number of rates into the other one.</span>
    <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">inversed_units</span><span class="p">:</span>
        <span class="n">bq_prices</span> <span class="o">=</span> <span class="n">price_map</span><span class="p">[(</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">)]</span>
        <span class="n">qb_prices</span> <span class="o">=</span> <span class="n">price_map</span><span class="p">[(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">)]</span>
        <span class="n">remove</span> <span class="o">=</span> <span class="p">((</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
                  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bq_prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">qb_prices</span><span class="p">)</span>
                  <span class="k">else</span> <span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">))</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">remove</span>

        <span class="n">remove_list</span> <span class="o">=</span> <span class="n">price_map</span><span class="p">[</span><span class="n">remove</span><span class="p">]</span>
        <span class="n">insert_list</span> <span class="o">=</span> <span class="n">price_map</span><span class="p">[(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">)]</span>
        <span class="k">del</span> <span class="n">price_map</span><span class="p">[</span><span class="n">remove</span><span class="p">]</span>

        <span class="n">inverted_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">date</span><span class="p">,</span> <span class="n">ONE</span><span class="o">/</span><span class="n">rate</span><span class="p">)</span>
                         <span class="k">for</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span> <span class="ow">in</span> <span class="n">remove_list</span>
                         <span class="k">if</span> <span class="n">rate</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">]</span>
        <span class="n">insert_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inverted_list</span><span class="p">)</span>

    <span class="c1"># Unzip and sort each of the entries and eliminate duplicates on the date.</span>
    <span class="n">sorted_price_map</span> <span class="o">=</span> <span class="n">PriceMap</span><span class="p">({</span>
        <span class="n">base_quote</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">sorted_uniquify</span><span class="p">(</span><span class="n">date_rates</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">base_quote</span><span class="p">,</span> <span class="n">date_rates</span><span class="p">)</span> <span class="ow">in</span> <span class="n">price_map</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

    <span class="c1"># Compute and insert all the inverted rates.</span>
    <span class="n">forward_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_price_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">),</span> <span class="n">price_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_price_map</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="c1"># Note: You have to filter out zero prices for zero-cost postings, like</span>
        <span class="c1"># gifted options.</span>
        <span class="n">sorted_price_map</span><span class="p">[(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">ONE</span><span class="o">/</span><span class="n">price</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">price_list</span>
            <span class="k">if</span> <span class="n">price</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">]</span>

    <span class="n">sorted_price_map</span><span class="o">.</span><span class="n">forward_pairs</span> <span class="o">=</span> <span class="n">forward_pairs</span>
    <span class="k">return</span> <span class="n">sorted_price_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.get_all_prices">
<code class="highlight language-python">
get_all_prices<span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.get_all_prices" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a sorted list of all (date, number) price pairs.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A price map, which is a dict of (base, quote) -&gt; list of (date,
number) tuples, as created by build_price_map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>base_quote</code></td>
<td><code></code></td>
<td>
<p>A pair of strings, the base currency to lookup, and the quote
currency to lookup, which expresses which units the base currency is
denominated in. This may also just be a string, with a '/' separator.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of (date, Decimal) pairs, sorted by date.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>KeyError</code></td>
<td>
<p>If the base/quote could not be found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_prices</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">):</span>
    <span class="sd">"""Return a sorted list of all (date, number) price pairs.</span>

<span class="sd">    Args:</span>
<span class="sd">      price_map: A price map, which is a dict of (base, quote) -&gt; list of (date,</span>
<span class="sd">        number) tuples, as created by build_price_map.</span>
<span class="sd">      base_quote: A pair of strings, the base currency to lookup, and the quote</span>
<span class="sd">        currency to lookup, which expresses which units the base currency is</span>
<span class="sd">        denominated in. This may also just be a string, with a '/' separator.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of (date, Decimal) pairs, sorted by date.</span>
<span class="sd">    Raises:</span>
<span class="sd">      KeyError: If the base/quote could not be found.</span>
<span class="sd">    """</span>
    <span class="n">base_quote</span> <span class="o">=</span> <span class="n">normalize_base_quote</span><span class="p">(</span><span class="n">base_quote</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_lookup_price_and_inverse</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.get_last_price_entries">
<code class="highlight language-python">
get_last_price_entries<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.get_last_price_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run through the entries until the given date and return the last
Price entry encountered for each (currency, cost-currency) pair.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>An instance of datetime.date. If None, the very latest price
is returned.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of price entries.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_last_price_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
    <span class="sd">"""Run through the entries until the given date and return the last</span>
<span class="sd">    Price entry encountered for each (currency, cost-currency) pair.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      date: An instance of datetime.date. If None, the very latest price</span>
<span class="sd">        is returned.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of price entries.</span>
<span class="sd">    """</span>
    <span class="n">price_entry_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">date</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Price</span><span class="p">):</span>
            <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
            <span class="n">price_entry_map</span><span class="p">[</span><span class="n">base_quote</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">price_entry_map</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">entry_sortkey</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.get_latest_price">
<code class="highlight language-python">
get_latest_price<span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.get_latest_price" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the latest price/rate from a price map for the given base/quote pair.
This is often used to just get the 'current' price if you're looking at the
entire set of entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A price map, which is a dict of (base, quote) -&gt; list of (date,
number) tuples, as created by build_price_map.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (date, number), where 'date' is a datetime.date instance and
'number' is a Decimal of the price, or rate, at that date. The date is the
latest date which we have an available price for in the price map.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_latest_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">):</span>
    <span class="sd">"""Return the latest price/rate from a price map for the given base/quote pair.</span>
<span class="sd">    This is often used to just get the 'current' price if you're looking at the</span>
<span class="sd">    entire set of entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      price_map: A price map, which is a dict of (base, quote) -&gt; list of (date,</span>
<span class="sd">        number) tuples, as created by build_price_map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (date, number), where 'date' is a datetime.date instance and</span>
<span class="sd">      'number' is a Decimal of the price, or rate, at that date. The date is the</span>
<span class="sd">      latest date which we have an available price for in the price map.</span>
<span class="sd">    """</span>
    <span class="n">base_quote</span> <span class="o">=</span> <span class="n">normalize_base_quote</span><span class="p">(</span><span class="n">base_quote</span><span class="p">)</span>

    <span class="c1"># Handle the degenerate case of a currency priced into its own.</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">base_quote</span>
    <span class="k">if</span> <span class="n">quote</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">base</span> <span class="o">==</span> <span class="n">quote</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ONE</span><span class="p">)</span>

    <span class="c1"># Look up the list and return the latest element. The lists are assumed to</span>
    <span class="c1"># be sorted.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">price_list</span> <span class="o">=</span> <span class="n">_lookup_price_and_inverse</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">price_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">price_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">price_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.get_price">
<code class="highlight language-python">
get_price<span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.get_price" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the price as of the given date.</p>
<p>If the date is unspecified, return the latest price.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A price map, which is a dict of (base, quote) -&gt; list of (date,
number) tuples, as created by build_price_map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>base_quote</code></td>
<td><code></code></td>
<td>
<p>A pair of strings, the base currency to lookup, and the quote
currency to lookup, which expresses which units the base currency is
denominated in. This may also just be a string, with a '/' separator.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the date at which we want the conversion
rate.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of (datetime.date, Decimal) instance. If no price information could
be found, return (None, None).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Return the price as of the given date.</span>

<span class="sd">    If the date is unspecified, return the latest price.</span>

<span class="sd">    Args:</span>
<span class="sd">      price_map: A price map, which is a dict of (base, quote) -&gt; list of (date,</span>
<span class="sd">        number) tuples, as created by build_price_map.</span>
<span class="sd">      base_quote: A pair of strings, the base currency to lookup, and the quote</span>
<span class="sd">        currency to lookup, which expresses which units the base currency is</span>
<span class="sd">        denominated in. This may also just be a string, with a '/' separator.</span>
<span class="sd">      date: A datetime.date instance, the date at which we want the conversion</span>
<span class="sd">        rate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (datetime.date, Decimal) instance. If no price information could</span>
<span class="sd">      be found, return (None, None).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_latest_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span>

    <span class="n">base_quote</span> <span class="o">=</span> <span class="n">normalize_base_quote</span><span class="p">(</span><span class="n">base_quote</span><span class="p">)</span>

    <span class="c1"># Handle the degenerate case of a currency priced into its own.</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">base_quote</span>
    <span class="k">if</span> <span class="n">quote</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">base</span> <span class="o">==</span> <span class="n">quote</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ONE</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">price_list</span> <span class="o">=</span> <span class="n">_lookup_price_and_inverse</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect_key</span><span class="o">.</span><span class="n">bisect_right_with_key</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">price_list</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.prices.normalize_base_quote">
<code class="highlight language-python">
normalize_base_quote<span class="p">(</span><span class="n">base_quote</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.prices.normalize_base_quote" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a slash-separated string to a pair of strings.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>base_quote</code></td>
<td><code></code></td>
<td>
<p>A pair of strings, the base currency to lookup, and the quote
currency to lookup, which expresses which units the base currency is
denominated in. This may also just be a string, with a '/' separator.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/prices.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_base_quote</span><span class="p">(</span><span class="n">base_quote</span><span class="p">):</span>
    <span class="sd">"""Convert a slash-separated string to a pair of strings.</span>

<span class="sd">    Args:</span>
<span class="sd">      base_quote: A pair of strings, the base currency to lookup, and the quote</span>
<span class="sd">        currency to lookup, which expresses which units the base currency is</span>
<span class="sd">        denominated in. This may also just be a string, with a '/' separator.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of strings.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_quote</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">base_quote_norm</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">base_quote</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_quote_norm</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">base_quote</span>
        <span class="n">base_quote</span> <span class="o">=</span> <span class="n">base_quote_norm</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_quote</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span> <span class="n">base_quote</span>
    <span class="k">return</span> <span class="n">base_quote</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.realization">
<code>realization</code>
<a class="headerlink" href="#beancount.core.realization" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Realization of specific lists of account postings into reports.</p>
<p>This code converts a list of entries into a tree of RealAccount nodes (which
stands for "realized accounts"). The RealAccount objects contain lists of
Posting instances instead of Transactions, or other entry types that are
attached to an account, such as a Balance or Note entry.</p>
<p>The interface of RealAccount corresponds to that of a regular Python dict, where
the keys are the names of the individual components of an account's name, and
the values are always other RealAccount instances. If you want to get an account
by long account name, there are helper functions in this module for this purpose
(see realization.get(), for instance). RealAccount instances also contain the
final balance of that account, resulting from its list of postings.</p>
<p>You should not build RealAccount trees yourself; instead, you should filter the
list of desired directives to display and call the realize() function with them.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.core.realization.RealAccount">
<code>RealAccount</code>
<a class="headerlink" href="#beancount.core.realization.RealAccount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A realized account, inserted in a tree, that contains the list of realized entries.</p>
<pre><code>Attributes:
  account: A string, the full name of the corresponding account.
  postings: A list of postings associated with this accounting (does not
    include the postings of children accounts).
  balance: The final balance of the list of postings associated with this account.
</code></pre>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.realization.RealAccount.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.realization.RealAccount.__eq__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Equality predicate. All attributes are compared.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>Another instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, True if the two real accounts are equal.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 98
 99
100
101
102
103
104
105
106
107
108
109</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Equality predicate. All attributes are compared.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: Another instance of RealAccount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, True if the two real accounts are equal.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">balance</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">txn_postings</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">txn_postings</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.realization.RealAccount.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.realization.RealAccount.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a RealAccount instance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>a string, the name of the account. Maybe not be None.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>55
56
57
58
59
60
61
62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""Create a RealAccount instance.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: a string, the name of the account. Maybe not be None.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">account_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">txn_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.realization.RealAccount.__ne__">
<code class="highlight language-python">
__ne__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.realization.RealAccount.__ne__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Not-equality predicate. See <strong>eq</strong>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code></code></td>
<td>
<p>Another instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, True if the two real accounts are not equal.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>111
112
113
114
115
116
117
118
119</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Not-equality predicate. See __eq__.</span>

<span class="sd">    Args:</span>
<span class="sd">      other: Another instance of RealAccount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, True if the two real accounts are not equal.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.realization.RealAccount.__setitem__">
<code class="highlight language-python">
__setitem__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.core.realization.RealAccount.__setitem__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Prevent the setting of non-string or non-empty keys on this dict.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>The dictionary key. Must be a string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value, must be a RealAccount instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>KeyError</code></td>
<td>
<p>If the key is not a string, or is invalid.</p>
</td>
</tr>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the value is not a RealAccount instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Prevent the setting of non-string or non-empty keys on this dict.</span>

<span class="sd">    Args:</span>
<span class="sd">      key: The dictionary key. Must be a string.</span>
<span class="sd">      value: The value, must be a RealAccount instance.</span>
<span class="sd">    Raises:</span>
<span class="sd">      KeyError: If the key is not a string, or is invalid.</span>
<span class="sd">      ValueError: If the value is not a RealAccount instance.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Invalid RealAccount key: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">RealAccount</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid RealAccount value: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"RealAccount name '</span><span class="si">{}</span><span class="s2">' inconsistent with key: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">value</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.core.realization.RealAccount.copy">
<code class="highlight language-python">
copy<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.RealAccount.copy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Override dict.copy() to clone a RealAccount.</p>
<p>This is only necessary to correctly implement the copy method.
Otherwise, calling .copy() on a RealAccount instance invokes the base
class' method, which return just a dict.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A cloned instance of RealAccount, with all members shallow-copied.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>86
87
88
89
90
91
92
93
94
95
96</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Override dict.copy() to clone a RealAccount.</span>

<span class="sd">    This is only necessary to correctly implement the copy method.</span>
<span class="sd">    Otherwise, calling .copy() on a RealAccount instance invokes the base</span>
<span class="sd">    class' method, which return just a dict.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A cloned instance of RealAccount, with all members shallow-copied.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.compute_balance">
<code class="highlight language-python">
compute_balance<span class="p">(</span><span class="n">real_account</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.compute_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the total balance of this account and all its subaccounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>A RealAccount instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>472
473
474
475
476
477
478
479
480
481
482
483</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_balance</span><span class="p">(</span><span class="n">real_account</span><span class="p">):</span>
    <span class="sd">"""Compute the total balance of this account and all its subaccounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: A RealAccount instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Inventory.</span>
<span class="sd">    """</span>
    <span class="n">total_balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">real_acc</span> <span class="ow">in</span> <span class="n">iter_children</span><span class="p">(</span><span class="n">real_account</span><span class="p">):</span>
        <span class="n">total_balance</span> <span class="o">+=</span> <span class="n">real_acc</span><span class="o">.</span><span class="n">balance</span>
    <span class="k">return</span> <span class="n">total_balance</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.compute_postings_balance">
<code class="highlight language-python">
compute_postings_balance<span class="p">(</span><span class="n">txn_postings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.compute_postings_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the balance of a list of Postings's or TxnPosting's positions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings</code></td>
<td><code></code></td>
<td>
<p>A list of Posting instances and other directives (which are
skipped).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An Inventory.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_postings_balance</span><span class="p">(</span><span class="n">txn_postings</span><span class="p">):</span>
    <span class="sd">"""Compute the balance of a list of Postings's or TxnPosting's positions.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings: A list of Posting instances and other directives (which are</span>
<span class="sd">        skipped).</span>
<span class="sd">    Returns:</span>
<span class="sd">      An Inventory.</span>
<span class="sd">    """</span>
    <span class="n">final_balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">txn_postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">Posting</span><span class="p">):</span>
            <span class="n">final_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">TxnPosting</span><span class="p">):</span>
            <span class="n">final_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_balance</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.contains">
<code class="highlight language-python">
contains<span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.contains" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>True if the given account node contains the subaccount name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of a direct or indirect subaccount of
this node.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true the name is a child of this node.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>197
198
199
200
201
202
203
204
205
206</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""True if the given account node contains the subaccount name.</span>

<span class="sd">    Args:</span>
<span class="sd">      account_name: A string, the name of a direct or indirect subaccount of</span>
<span class="sd">        this node.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true the name is a child of this node.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">get</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.dump">
<code class="highlight language-python">
dump<span class="p">(</span><span class="n">root_account</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.dump" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a RealAccount node to a line of lines.</p>
<p>Note: this is not meant to be used to produce text reports; the reporting
code should produce an intermediate object that contains the structure of
it, which can then be rendered to ASCII, HTML or CSV formats. This is
intended as a convenient little function for dumping trees of data for
debugging purposes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root_account</code></td>
<td><code></code></td>
<td>
<p>A RealAccount instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A list of tuples of (first_line, continuation_line, real_account) where
  first_line</code></td>
<td>
<p>A string, the first line to render, which includes the
    account name.
  continuation_line: A string, further line to render if necessary.
  real_account: The RealAccount instance which corresponds to this
    line.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">root_account</span><span class="p">):</span>
    <span class="sd">"""Convert a RealAccount node to a line of lines.</span>

<span class="sd">    Note: this is not meant to be used to produce text reports; the reporting</span>
<span class="sd">    code should produce an intermediate object that contains the structure of</span>
<span class="sd">    it, which can then be rendered to ASCII, HTML or CSV formats. This is</span>
<span class="sd">    intended as a convenient little function for dumping trees of data for</span>
<span class="sd">    debugging purposes.</span>

<span class="sd">    Args:</span>
<span class="sd">      root_account: A RealAccount instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of tuples of (first_line, continuation_line, real_account) where</span>
<span class="sd">        first_line: A string, the first line to render, which includes the</span>
<span class="sd">          account name.</span>
<span class="sd">        continuation_line: A string, further line to render if necessary.</span>
<span class="sd">        real_account: The RealAccount instance which corresponds to this</span>
<span class="sd">          line.</span>
<span class="sd">    """</span>
    <span class="c1"># Compute all the lines ahead of time in order to calculate the width.</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Start with the root node. We push the constant prefix before this node,</span>
    <span class="c1"># the account name, and the RealAccount instance. We will maintain a stack</span>
    <span class="c1"># of children nodes to render.</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">''</span><span class="p">,</span> <span class="n">root_account</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">root_account</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">real_account</span><span class="p">,</span> <span class="n">is_last</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">real_account</span> <span class="ow">is</span> <span class="n">root_account</span><span class="p">:</span>
            <span class="c1"># For the root node, we don't want to render any prefix.</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">cont</span> <span class="o">=</span> <span class="s1">''</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Compute the string that precedes the name directly and the one below</span>
            <span class="c1"># that for the continuation lines.</span>
            <span class="c1">#  |</span>
            <span class="c1">#  @@@ Bank1    &lt;----------------</span>
            <span class="c1">#  @@@ |</span>
            <span class="c1">#  |   |-- Checking</span>
            <span class="k">if</span> <span class="n">is_last</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">PREFIX_LEAF_1</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">PREFIX_LEAF_C</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">PREFIX_CHILD_1</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">PREFIX_CHILD_C</span>

        <span class="c1"># Compute the name to render for continuation lines.</span>
        <span class="c1">#  |</span>
        <span class="c1">#  |-- Bank1</span>
        <span class="c1">#  |   @@@       &lt;----------------</span>
        <span class="c1">#  |   |-- Checking</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_account</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cont_name</span> <span class="o">=</span> <span class="n">PREFIX_CHILD_C</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cont_name</span> <span class="o">=</span> <span class="n">PREFIX_LEAF_C</span>

        <span class="c1"># Add a line for this account.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">real_account</span> <span class="ow">is</span> <span class="n">root_account</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">first</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span>
                          <span class="n">cont</span> <span class="o">+</span> <span class="n">cont_name</span><span class="p">,</span>
                          <span class="n">real_account</span><span class="p">))</span>

        <span class="c1"># Push the children onto the stack, being careful with ordering and</span>
        <span class="c1"># marking the last node as such.</span>
        <span class="n">child_items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">child_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">child_items</span><span class="p">)</span>
            <span class="n">child_name</span><span class="p">,</span> <span class="n">child_account</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">child_iter</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cont</span><span class="p">,</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">child_account</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">child_account</span> <span class="ow">in</span> <span class="n">child_iter</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cont</span><span class="p">,</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">child_account</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="c1"># Compute the maximum width of the lines and convert all of them to the same</span>
    <span class="c1"># maximal width. This makes it easy on the client.</span>
    <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span> <span class="k">for</span> <span class="n">first_line</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
    <span class="n">line_format</span> <span class="o">=</span> <span class="s1">'{{:</span><span class="si">{width}</span><span class="s1">}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first_line</span><span class="p">),</span>
             <span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cont_line</span><span class="p">),</span>
             <span class="n">real_node</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">first_line</span><span class="p">,</span> <span class="n">cont_line</span><span class="p">,</span> <span class="n">real_node</span><span class="p">)</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.dump_balances">
<code class="highlight language-python">
dump_balances<span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">at_cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullnames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.dump_balances" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Dump a realization tree with balances.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_root</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>An instance of DisplayFormatter to format the numbers with.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>at_cost</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, render the values at cost.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>fullnames</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, don't render a tree of accounts and
render the full account names.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object to dump the output to. If not specified, we
return the output as a string.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the rendered tree, or nothing, if 'file' was provided.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dump_balances</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">at_cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullnames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Dump a realization tree with balances.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_root: An instance of RealAccount.</span>
<span class="sd">      dformat: An instance of DisplayFormatter to format the numbers with.</span>
<span class="sd">      at_cost: A boolean, if true, render the values at cost.</span>
<span class="sd">      fullnames: A boolean, if true, don't render a tree of accounts and</span>
<span class="sd">        render the full account names.</span>
<span class="sd">      file: A file object to dump the output to. If not specified, we</span>
<span class="sd">        return the output as a string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the rendered tree, or nothing, if 'file' was provided.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">fullnames</span><span class="p">:</span>
        <span class="c1"># Compute the maximum account name length;</span>
        <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_child</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">real_child</span> <span class="ow">in</span> <span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">leaf_only</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">line_format</span> <span class="o">=</span> <span class="s1">'{{:</span><span class="si">{width}</span><span class="s1">}} {{}}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_format</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">       </span><span class="si">{}</span><span class="se">\n</span><span class="s1">'</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">first_line</span><span class="p">,</span> <span class="n">cont_line</span><span class="p">,</span> <span class="n">real_account</span> <span class="ow">in</span> <span class="n">dump</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">at_cost</span><span class="p">:</span>
                <span class="n">rinv</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rinv</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_units</span><span class="p">)</span>
            <span class="n">amounts</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="o">.</span><span class="n">units</span> <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">rinv</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">amount_</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">amount_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">amounts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">amount</span><span class="o">.</span><span class="n">sortkey</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fullnames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_account</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Skip parent accounts with no position to render.</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">first_line</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">cont_line</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.filter">
<code class="highlight language-python">
filter<span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.filter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter a RealAccount tree of nodes by the predicate.</p>
<p>This function visits the tree and applies the predicate on each node. It
returns a partial clone of RealAccount whereby on each node
- either the predicate is true, or
- for at least one child of the node the predicate is true.
All the leaves have the predicate be true.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>predicate</code></td>
<td><code></code></td>
<td>
<p>A callable/function which accepts a real_account and returns
a boolean. If the function returns True, the node is kept.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A shallow clone of RealAccount is always returned.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">predicate</span><span class="p">):</span>
    <span class="sd">"""Filter a RealAccount tree of nodes by the predicate.</span>

<span class="sd">    This function visits the tree and applies the predicate on each node. It</span>
<span class="sd">    returns a partial clone of RealAccount whereby on each node</span>
<span class="sd">    - either the predicate is true, or</span>
<span class="sd">    - for at least one child of the node the predicate is true.</span>
<span class="sd">    All the leaves have the predicate be true.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: An instance of RealAccount.</span>
<span class="sd">      predicate: A callable/function which accepts a real_account and returns</span>
<span class="sd">        a boolean. If the function returns True, the node is kept.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A shallow clone of RealAccount is always returned.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">RealAccount</span><span class="p">)</span>

    <span class="n">real_copy</span> <span class="o">=</span> <span class="n">RealAccount</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
    <span class="n">real_copy</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span>
    <span class="n">real_copy</span><span class="o">.</span><span class="n">txn_postings</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">txn_postings</span>

    <span class="k">for</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">real_child</span> <span class="ow">in</span> <span class="n">real_account</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">real_child_copy</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">real_child</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">real_child_copy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">real_copy</span><span class="p">[</span><span class="n">child_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_child_copy</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_copy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">predicate</span><span class="p">(</span><span class="n">real_account</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">real_copy</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.find_last_active_posting">
<code class="highlight language-python">
find_last_active_posting<span class="p">(</span><span class="n">txn_postings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.find_last_active_posting" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Look at the end of the list of postings, and find the last
posting or entry that is not an automatically added directive.
Note that if the account is closed, the last posting is assumed
to be a Close directive (this is the case if the input is valid
and checks without errors.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>txn_postings</code></td>
<td><code></code></td>
<td>
<p>a list of postings or entries.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An entry, or None, if the input list was empty.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_last_active_posting</span><span class="p">(</span><span class="n">txn_postings</span><span class="p">):</span>
    <span class="sd">"""Look at the end of the list of postings, and find the last</span>
<span class="sd">    posting or entry that is not an automatically added directive.</span>
<span class="sd">    Note that if the account is closed, the last posting is assumed</span>
<span class="sd">    to be a Close directive (this is the case if the input is valid</span>
<span class="sd">    and checks without errors.</span>

<span class="sd">    Args:</span>
<span class="sd">      txn_postings: a list of postings or entries.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An entry, or None, if the input list was empty.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">txn_postings</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">Posting</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="p">(</span><span class="n">TxnPosting</span><span class="p">,</span> <span class="n">Open</span><span class="p">,</span> <span class="n">Close</span><span class="p">,</span> <span class="n">Pad</span><span class="p">,</span> <span class="n">Balance</span><span class="p">,</span> <span class="n">Note</span><span class="p">)):</span>
            <span class="k">continue</span>

        <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">TxnPosting</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="n">flags</span><span class="o">.</span><span class="n">FLAG_UNREALIZED</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">return</span> <span class="n">txn_posting</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.get">
<code class="highlight language-python">
get<span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.get" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Fetch the subaccount name from the real_account node.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount, the parent node to look for
children of.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of a possibly indirect child leaf
found down the tree of 'real_account' nodes.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>default</code></td>
<td><code></code></td>
<td>
<p>The default value that should be returned if the child
subaccount is not found.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A RealAccount instance for the child, or the default value, if the child
is not found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Fetch the subaccount name from the real_account node.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: An instance of RealAccount, the parent node to look for</span>
<span class="sd">        children of.</span>
<span class="sd">      account_name: A string, the name of a possibly indirect child leaf</span>
<span class="sd">        found down the tree of 'real_account' nodes.</span>
<span class="sd">      default: The default value that should be returned if the child</span>
<span class="sd">        subaccount is not found.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A RealAccount instance for the child, or the default value, if the child</span>
<span class="sd">      is not found.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">real_child</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">real_child</span> <span class="ow">is</span> <span class="n">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="n">real_account</span> <span class="o">=</span> <span class="n">real_child</span>
    <span class="k">return</span> <span class="n">real_account</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.get_or_create">
<code class="highlight language-python">
get_or_create<span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.get_or_create" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Fetch the subaccount name from the real_account node.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount, the parent node to look for
children of, or create under.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the direct or indirect child leaf
to get or create.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A RealAccount instance for the child, or the default value, if the child
is not found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="sd">"""Fetch the subaccount name from the real_account node.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: An instance of RealAccount, the parent node to look for</span>
<span class="sd">        children of, or create under.</span>
<span class="sd">      account_name: A string, the name of the direct or indirect child leaf</span>
<span class="sd">        to get or create.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A RealAccount instance for the child, or the default value, if the child</span>
<span class="sd">      is not found.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="n">real_child</span> <span class="o">=</span> <span class="n">real_account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">real_child</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">real_child</span> <span class="o">=</span> <span class="n">RealAccount</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">path</span><span class="p">))</span>
            <span class="n">real_account</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_child</span>
        <span class="n">real_account</span> <span class="o">=</span> <span class="n">real_child</span>
    <span class="k">return</span> <span class="n">real_account</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.get_postings">
<code class="highlight language-python">
get_postings<span class="p">(</span><span class="n">real_account</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.get_postings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a sorted list a RealAccount's postings and children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Posting or directories.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>349
350
351
352
353
354
355
356
357
358
359
360
361
362
363</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_postings</span><span class="p">(</span><span class="n">real_account</span><span class="p">):</span>
    <span class="sd">"""Return a sorted list a RealAccount's postings and children.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: An instance of RealAccount.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Posting or directories.</span>
<span class="sd">    """</span>
    <span class="c1"># We accumulate all the postings at once here instead of incrementally</span>
    <span class="c1"># because we need to return them sorted.</span>
    <span class="n">accumulator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">real_child</span> <span class="ow">in</span> <span class="n">iter_children</span><span class="p">(</span><span class="n">real_account</span><span class="p">):</span>
        <span class="n">accumulator</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">real_child</span><span class="o">.</span><span class="n">txn_postings</span><span class="p">)</span>
    <span class="n">accumulator</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">posting_sortkey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accumulator</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.index_key">
<code class="highlight language-python">
index_key<span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">cmp</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.index_key" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find the index of the first element in 'sequence' which is equal to 'value'.
If 'key' is specified, the value compared to the value returned by this
function. If the value is not found, return None.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sequence</code></td>
<td><code></code></td>
<td>
<p>The sequence to search.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code></code></td>
<td>
<p>The value to search for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code></code></td>
<td>
<p>A predicate to call to obtain the value to compare against.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cmp</code></td>
<td><code></code></td>
<td>
<p>A comparison predicate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The index of the first element found, or None, if the element was not found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">index_key</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">cmp</span><span class="p">):</span>
    <span class="sd">"""Find the index of the first element in 'sequence' which is equal to 'value'.</span>
<span class="sd">    If 'key' is specified, the value compared to the value returned by this</span>
<span class="sd">    function. If the value is not found, return None.</span>

<span class="sd">    Args:</span>
<span class="sd">      sequence: The sequence to search.</span>
<span class="sd">      value: The value to search for.</span>
<span class="sd">      key: A predicate to call to obtain the value to compare against.</span>
<span class="sd">      cmp: A comparison predicate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The index of the first element found, or None, if the element was not found.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">element</span><span class="p">),</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">index</span>
    <span class="k">return</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.iter_children">
<code class="highlight language-python">
iter_children<span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">leaf_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.iter_children" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Iterate this account node and all its children, depth-first.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>real_account</code></td>
<td><code></code></td>
<td>
<p>An instance of RealAccount.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>leaf_only</code></td>
<td><code></code></td>
<td>
<p>A boolean flag, true if we should yield only leaves.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of RealAccount, beginning with this account. The order is
  undetermined.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_children</span><span class="p">(</span><span class="n">real_account</span><span class="p">,</span> <span class="n">leaf_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Iterate this account node and all its children, depth-first.</span>

<span class="sd">    Args:</span>
<span class="sd">      real_account: An instance of RealAccount.</span>
<span class="sd">      leaf_only: A boolean flag, true if we should yield only leaves.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of RealAccount, beginning with this account. The order is</span>
<span class="sd">      undetermined.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">leaf_only</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_account</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">real_account</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">real_child</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">real_subchild</span> <span class="ow">in</span> <span class="n">iter_children</span><span class="p">(</span><span class="n">real_child</span><span class="p">,</span> <span class="n">leaf_only</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">real_subchild</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">real_account</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">real_child</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">real_account</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">real_subchild</span> <span class="ow">in</span> <span class="n">iter_children</span><span class="p">(</span><span class="n">real_child</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">real_subchild</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.iterate_with_balance">
<code class="highlight language-python">
iterate_with_balance<span class="p">(</span><span class="n">txn_postings</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.iterate_with_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Iterate over the entries, accumulating the running balance.</p>
<p>For each entry, this yields tuples of the form:</p>
<p>(entry, postings, change, balance)</p>
<p>entry: This is the directive for this line. If the list contained Posting
  instance, this yields the corresponding Transaction object.
postings: A list of postings on this entry that affect the balance. Only the
  postings encountered in the input list are included; only those affect the
  balance. If 'entry' is not a Transaction directive, this should always be
  an empty list. We preserve the original ordering of the postings as they
  appear in the input list.
change: An Inventory object that reflects the total change due to the
  postings from this entry that appear in the list. For example, if a
  Transaction has three postings and two are in the input list, the sum of
  the two postings will be in the 'change' Inventory object. However, the
  position for the transactions' third posting--the one not included in the
  input list--will not be in this inventory.
balance: An Inventory object that reflects the balance <em>after</em> adding the
  'change' inventory due to this entry's transaction. The 'balance' yielded
  is never None, even for entries that do not affect the balance, that is,
  with an empty 'change' inventory. It's up to the caller, the one rendering
  the entry, to decide whether to render this entry's change for a
  particular entry type.</p>
<p>Note that if the input list of postings-or-entries is not in sorted date
order, two postings for the same entry appearing twice with a different date
in between will cause the entry appear twice. This is correct behavior, and
it is expected that in practice this should never happen anyway, because the
list of postings or entries should always be sorted. This method attempts to
detect this and raises an assertion if this is seen.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>txn_postings</code></td>
<td><code></code></td>
<td>
<p>A list of postings or directive instances.
Postings affect the balance; other entries do not.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Tuples of (entry, postings, change, balance) as described above.</p>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iterate_with_balance</span><span class="p">(</span><span class="n">txn_postings</span><span class="p">):</span>
    <span class="sd">"""Iterate over the entries, accumulating the running balance.</span>

<span class="sd">    For each entry, this yields tuples of the form:</span>

<span class="sd">      (entry, postings, change, balance)</span>

<span class="sd">    entry: This is the directive for this line. If the list contained Posting</span>
<span class="sd">      instance, this yields the corresponding Transaction object.</span>
<span class="sd">    postings: A list of postings on this entry that affect the balance. Only the</span>
<span class="sd">      postings encountered in the input list are included; only those affect the</span>
<span class="sd">      balance. If 'entry' is not a Transaction directive, this should always be</span>
<span class="sd">      an empty list. We preserve the original ordering of the postings as they</span>
<span class="sd">      appear in the input list.</span>
<span class="sd">    change: An Inventory object that reflects the total change due to the</span>
<span class="sd">      postings from this entry that appear in the list. For example, if a</span>
<span class="sd">      Transaction has three postings and two are in the input list, the sum of</span>
<span class="sd">      the two postings will be in the 'change' Inventory object. However, the</span>
<span class="sd">      position for the transactions' third posting--the one not included in the</span>
<span class="sd">      input list--will not be in this inventory.</span>
<span class="sd">    balance: An Inventory object that reflects the balance *after* adding the</span>
<span class="sd">      'change' inventory due to this entry's transaction. The 'balance' yielded</span>
<span class="sd">      is never None, even for entries that do not affect the balance, that is,</span>
<span class="sd">      with an empty 'change' inventory. It's up to the caller, the one rendering</span>
<span class="sd">      the entry, to decide whether to render this entry's change for a</span>
<span class="sd">      particular entry type.</span>

<span class="sd">    Note that if the input list of postings-or-entries is not in sorted date</span>
<span class="sd">    order, two postings for the same entry appearing twice with a different date</span>
<span class="sd">    in between will cause the entry appear twice. This is correct behavior, and</span>
<span class="sd">    it is expected that in practice this should never happen anyway, because the</span>
<span class="sd">    list of postings or entries should always be sorted. This method attempts to</span>
<span class="sd">    detect this and raises an assertion if this is seen.</span>

<span class="sd">    Args:</span>
<span class="sd">      txn_postings: A list of postings or directive instances.</span>
<span class="sd">        Postings affect the balance; other entries do not.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Tuples of (entry, postings, change, balance) as described above.</span>
<span class="sd">    """</span>

    <span class="c1"># The running balance.</span>
    <span class="n">running_balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>

    <span class="c1"># Previous date.</span>
    <span class="n">prev_date</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># A list of entries at the current date.</span>
    <span class="n">date_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">first</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">txn_postings</span><span class="p">:</span>

        <span class="c1"># Get the posting if we are dealing with one.</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">Posting</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">TxnPosting</span><span class="p">):</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">txn_posting</span>

        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">!=</span> <span class="n">prev_date</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">prev_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;</span> <span class="n">prev_date</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"Invalid date order for postings: </span><span class="si">{}</span><span class="s2"> &gt; </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_date</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
            <span class="n">prev_date</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># Flush the dated entries.</span>
            <span class="k">for</span> <span class="n">date_entry</span><span class="p">,</span> <span class="n">date_postings</span> <span class="ow">in</span> <span class="n">date_entries</span><span class="p">:</span>
                <span class="n">change</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">date_postings</span><span class="p">:</span>
                    <span class="c1"># Compute the change due to this transaction and update the</span>
                    <span class="c1"># total balance at the same time.</span>
                    <span class="k">for</span> <span class="n">date_posting</span> <span class="ow">in</span> <span class="n">date_postings</span><span class="p">:</span>
                        <span class="n">change</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">date_posting</span><span class="p">)</span>
                        <span class="n">running_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">date_posting</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">date_entry</span><span class="p">,</span> <span class="n">date_postings</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">running_balance</span>

            <span class="n">date_entries</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">date_entries</span>

        <span class="k">if</span> <span class="n">posting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># De-dup multiple postings on the same transaction entry by</span>
            <span class="c1"># grouping their positions together.</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index_key</span><span class="p">(</span><span class="n">date_entries</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">is_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">date_entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">entry</span><span class="p">,</span> <span class="p">[</span><span class="n">posting</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We are indeed de-duping!</span>
                <span class="n">postings</span> <span class="o">=</span> <span class="n">date_entries</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">postings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is a regular entry; nothing to add/remove.</span>
            <span class="n">date_entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">entry</span><span class="p">,</span> <span class="p">[]))</span>

    <span class="c1"># Flush the final dated entries if any, same as above.</span>
    <span class="k">for</span> <span class="n">date_entry</span><span class="p">,</span> <span class="n">date_postings</span> <span class="ow">in</span> <span class="n">date_entries</span><span class="p">:</span>
        <span class="n">change</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">date_postings</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">date_posting</span> <span class="ow">in</span> <span class="n">date_postings</span><span class="p">:</span>
                <span class="n">change</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">date_posting</span><span class="p">)</span>
                <span class="n">running_balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">date_posting</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">date_entry</span><span class="p">,</span> <span class="n">date_postings</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">running_balance</span>
    <span class="n">date_entries</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.postings_by_account">
<code class="highlight language-python">
postings_by_account<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.postings_by_account" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create lists of postings and balances by account.</p>
<p>This routine aggregates postings and entries grouping them by account name.
The resulting lists contain postings in-lieu of Transaction directives, but
the other directives are stored as entries. This yields a list of postings
or other entries by account. All references to accounts are taken into
account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A mapping of account name to list of TxnPosting instances or
non-Transaction directives, sorted in the same order as the entries.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">postings_by_account</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Create lists of postings and balances by account.</span>

<span class="sd">    This routine aggregates postings and entries grouping them by account name.</span>
<span class="sd">    The resulting lists contain postings in-lieu of Transaction directives, but</span>
<span class="sd">    the other directives are stored as entries. This yields a list of postings</span>
<span class="sd">    or other entries by account. All references to accounts are taken into</span>
<span class="sd">    account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    Returns:</span>
<span class="sd">       A mapping of account name to list of TxnPosting instances or</span>
<span class="sd">       non-Transaction directives, sorted in the same order as the entries.</span>
<span class="sd">    """</span>
    <span class="n">txn_postings_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="c1"># Insert an entry for each of the postings.</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">txn_postings_map</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">TxnPosting</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">posting</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="n">Open</span><span class="p">,</span> <span class="n">Close</span><span class="p">,</span> <span class="n">Balance</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">Document</span><span class="p">)):</span>
            <span class="c1"># Append some other entries in the realized list.</span>
            <span class="n">txn_postings_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Pad</span><span class="p">):</span>
            <span class="c1"># Insert the pad entry in both realized accounts.</span>
            <span class="n">txn_postings_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">txn_postings_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">source_account</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Custom</span><span class="p">):</span>
            <span class="c1"># Insert custom entry for each account in its values.</span>
            <span class="k">for</span> <span class="n">custom_value</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">custom_value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">account</span><span class="o">.</span><span class="n">TYPE</span><span class="p">:</span>
                    <span class="n">txn_postings_map</span><span class="p">[</span><span class="n">custom_value</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">txn_postings_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.core.realization.realize">
<code class="highlight language-python">
realize<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">min_accounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_balance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.core.realization.realize" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Group entries by account, into a "tree" of realized accounts. RealAccount's
are essentially containers for lists of postings and the final balance of
each account, and may be non-leaf accounts (used strictly for organizing
accounts into a hierarchy). This is then used to issue reports.</p>
<p>The lists of postings in each account my be any of the entry types, except
for Transaction, whereby Transaction entries are replaced by the specific
Posting legs that belong to the account. Here's a simple diagram that
summarizes this seemingly complex, but rather simple data structure:</p>
<p>+-------------+ postings  +------+
   | RealAccount |----------&gt;| Open |
   +-------------+           +------+
                                 |
                                 v
                          +------------+     +-------------+
                          | TxnPosting |----&gt;| Transaction |
                          +------------+     +-------------+
                                 |      \                 \\
                                 v       <code>\.__          +---------+
                              +-----+</code>--------&gt;| Posting |
                              | Pad |                   +---------+
                              +-----+
                                 |
                                 v
                            +---------+
                            | Balance |
                            +---------+
                                 |
                                 v
                             +-------+
                             | Close |
                             +-------+
                                 |
                                 .</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>min_accounts</code></td>
<td><code></code></td>
<td>
<p>A list of strings, account names to ensure we create,
regardless of whether there are postings on those accounts or not.
This can be used to ensure the root accounts all exist.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>compute_balance</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should compute the final
balance on the realization.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The root RealAccount instance.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/core/realization.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">realize</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">min_accounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_balance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""Group entries by account, into a "tree" of realized accounts. RealAccount's</span>
<span class="sd">    are essentially containers for lists of postings and the final balance of</span>
<span class="sd">    each account, and may be non-leaf accounts (used strictly for organizing</span>
<span class="sd">    accounts into a hierarchy). This is then used to issue reports.</span>

<span class="sd">    The lists of postings in each account my be any of the entry types, except</span>
<span class="sd">    for Transaction, whereby Transaction entries are replaced by the specific</span>
<span class="sd">    Posting legs that belong to the account. Here's a simple diagram that</span>
<span class="sd">    summarizes this seemingly complex, but rather simple data structure:</span>

<span class="sd">       +-------------+ postings  +------+</span>
<span class="sd">       | RealAccount |----------&gt;| Open |</span>
<span class="sd">       +-------------+           +------+</span>
<span class="sd">                                     |</span>
<span class="sd">                                     v</span>
<span class="sd">                              +------------+     +-------------+</span>
<span class="sd">                              | TxnPosting |----&gt;| Transaction |</span>
<span class="sd">                              +------------+     +-------------+</span>
<span class="sd">                                     |      \                 \\\</span>
<span class="sd">                                     v       `\.__          +---------+</span>
<span class="sd">                                  +-----+         `--------&gt;| Posting |</span>
<span class="sd">                                  | Pad |                   +---------+</span>
<span class="sd">                                  +-----+</span>
<span class="sd">                                     |</span>
<span class="sd">                                     v</span>
<span class="sd">                                +---------+</span>
<span class="sd">                                | Balance |</span>
<span class="sd">                                +---------+</span>
<span class="sd">                                     |</span>
<span class="sd">                                     v</span>
<span class="sd">                                 +-------+</span>
<span class="sd">                                 | Close |</span>
<span class="sd">                                 +-------+</span>
<span class="sd">                                     |</span>
<span class="sd">                                     .</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      min_accounts: A list of strings, account names to ensure we create,</span>
<span class="sd">        regardless of whether there are postings on those accounts or not.</span>
<span class="sd">        This can be used to ensure the root accounts all exist.</span>
<span class="sd">      compute_balance: A boolean, true if we should compute the final</span>
<span class="sd">        balance on the realization.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The root RealAccount instance.</span>
<span class="sd">    """</span>
    <span class="c1"># Create lists of the entries by account.</span>
    <span class="n">txn_postings_map</span> <span class="o">=</span> <span class="n">postings_by_account</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="c1"># Create a RealAccount tree and compute the balance for each.</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">RealAccount</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">txn_postings</span> <span class="ow">in</span> <span class="n">txn_postings_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">real_account</span> <span class="o">=</span> <span class="n">get_or_create</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span>
        <span class="n">real_account</span><span class="o">.</span><span class="n">txn_postings</span> <span class="o">=</span> <span class="n">txn_postings</span>
        <span class="k">if</span> <span class="n">compute_balance</span><span class="p">:</span>
            <span class="n">real_account</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">compute_postings_balance</span><span class="p">(</span><span class="n">txn_postings</span><span class="p">)</span>

    <span class="c1"># Ensure a minimum set of accounts that should exist. This is typically</span>
    <span class="c1"># called with an instance of AccountTypes to make sure that those exist.</span>
    <span class="k">if</span> <span class="n">min_accounts</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">min_accounts</span><span class="p">:</span>
            <span class="n">get_or_create</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">real_root</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.core.realization_test">
<code>realization_test</code>
<a class="headerlink" href="#beancount.core.realization_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Unit tests for realizations.</p>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.ingest.html" title="beancount.ingest">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="index.html" title="beancount"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/xuhcc/beancount-docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="index.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.ingest.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
