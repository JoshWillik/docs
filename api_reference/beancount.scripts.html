<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://xuhcc.github.io/beancount-docs/api_reference/beancount.scripts.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.scripts - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.scripts";
    var mkdocs_page_input_path = "api_reference/beancount.scripts.md";
    var mkdocs_page_url = "/beancount-docs/api_reference/beancount.scripts.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.scripts.html">beancount.scripts</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts">beancount.scripts</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.bake">bake</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.archive">archive()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.archive_zip">archive_zip()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.bake_to_directory">bake_to_directory()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.normalize_filename">normalize_filename()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.relativize_links">relativize_links()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.remove_links">remove_links()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.bake.save_scraped_document">save_scraped_document()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.check">check</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.check_examples_test">check_examples_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.check_examples_test.find_example_files">find_example_files()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.deps">deps</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_cdecimal">check_cdecimal()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_dependencies">check_dependencies()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_import">check_import()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_python">check_python()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.check_python_magic">check_python_magic()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.is_fast_decimal">is_fast_decimal()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.list_dependencies">list_dependencies()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.deps.parse_version">parse_version()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.directories">directories</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.ValidateDirectoryError">ValidateDirectoryError</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.validate_directories">validate_directories()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories.validate_directory">validate_directory()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.directories_test">directories_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.directories_test.TestScriptCheckDirectories">TestScriptCheckDirectories</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.directories_test.TestScriptCheckDirectories.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.directories_test.TestScriptCheckDirectories.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.doctor">doctor</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.RenderError">RenderError</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.doctor.RenderError.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_checkdeps">do_checkdeps()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_context">do_context()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_deps">do_deps()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_directories">do_directories()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_display_context">do_display_context()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_dump_lexer">do_dump_lexer()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_lex">do_lex()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_linked">do_linked()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_list_options">do_list_options()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_missing_open">do_missing_open()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_parse">do_parse()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_print_options">do_print_options()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_roundtrip">do_roundtrip()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.do_validate_html">do_validate_html()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.doctor.get_commands">get_commands()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.example">example</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.check_non_negative">check_non_negative()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.compute_trip_dates">compute_trip_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.contextualize_file">contextualize_file()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.date_iter">date_iter()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.date_random_seq">date_random_seq()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.delay_dates">delay_dates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_balance_checks">generate_balance_checks()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_banking">generate_banking()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_banking_expenses">generate_banking_expenses()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_clearing_entries">generate_clearing_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_commodity_entries">generate_commodity_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_employment_income">generate_employment_income()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_expense_accounts">generate_expense_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_open_entries">generate_open_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_outgoing_transfers">generate_outgoing_transfers()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_periodic_expenses">generate_periodic_expenses()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_prices">generate_prices()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_regular_credit_expenses">generate_regular_credit_expenses()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_retirement_employer_match">generate_retirement_employer_match()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_retirement_investments">generate_retirement_investments()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_tax_accounts">generate_tax_accounts()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_tax_preamble">generate_tax_preamble()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_taxable_investment">generate_taxable_investment()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.generate_trip_entries">generate_trip_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.get_minimum_balance">get_minimum_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.iter_dates_with_balance">iter_dates_with_balance()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.iter_quarters">iter_quarters()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.merge_postings">merge_postings()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.parse">parse()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.postings_for">postings_for()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.price_series">price_series()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.replace">replace()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.validate_output">validate_output()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.example.write_example_file">write_example_file()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.format">format</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.align_beancount">align_beancount()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.compute_most_frequent">compute_most_frequent()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.format.normalize_indent_whitespace">normalize_indent_whitespace()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.setup_test">setup_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.setup_test.TestSetup">TestSetup</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.setup_test.TestSetup.run_setup">run_setup()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.setup_test.TestSetup.setUp">setUp()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.setup_test.TestSetup.tearDown">tearDown()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.sql">sql</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.BalanceWriter">BalanceWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.BalanceWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.BalanceWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.CloseWriter">CloseWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.CloseWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.CloseWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.DirectiveWriter">DirectiveWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.DirectiveWriter.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.DirectiveWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.DocumentWriter">DocumentWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.DocumentWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.DocumentWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.EventWriter">EventWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.EventWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.EventWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.NoteWriter">NoteWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.NoteWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.NoteWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.OpenWriter">OpenWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.OpenWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.OpenWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.PadWriter">PadWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.PadWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.PadWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.PriceWriter">PriceWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.PriceWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.PriceWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.QueryWriter">QueryWriter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.QueryWriter.type">type</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.scripts.sql.QueryWriter.get_detail">get_detail()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.adapt_decimal">adapt_decimal()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.convert_decimal">convert_decimal()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.output_common">output_common()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.output_transactions">output_transactions()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.scripts.sql.setup_decimal_support">setup_decimal_support()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.scripts.tutorial">tutorial</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.scripts</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/xuhcc/beancount-docs/edit/master/docs/api_reference/beancount.scripts.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountscripts">beancount.scripts<a class="headerlink" href="#beancountscripts" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.scripts" id="beancount.scripts" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.scripts" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Implementation of the various scripts available from bin.</p>
<p>This is structured this way because we want all the significant codes under a
single directory, for analysis, grepping and unit testing.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.bake">
<code>bake</code>
<a class="headerlink" href="#beancount.scripts.bake" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Bake a Beancount input file's web files to a directory hierarchy.</p>
<p>You provide a Beancount filename, an output directory, and this script
runs a server and a scraper that puts all the files in the directory,
and if your output name has an archive suffix, we automatically the
fetched directory contents to the archive and delete them.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.archive">
<code class="highlight language-python">
archive<span class="p">(</span><span class="n">command_template</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">archive</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.archive" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Archive the directory to the given tar/gz archive filename.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command_template</code></td>
<td><code></code></td>
<td>
<p>A string, the command template to format with in order
to compute the command to run.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>directory</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the directory to archive.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>archive</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>quiet</code></td>
<td><code></code></td>
<td>
<p>A boolean, True to suppress output.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IOError</code></td>
<td>
<p>if the directory does not exist or if the archive name already</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">archive</span><span class="p">(</span><span class="n">command_template</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">archive</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Archive the directory to the given tar/gz archive filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      command_template: A string, the command template to format with in order</span>
<span class="sd">        to compute the command to run.</span>
<span class="sd">      directory: A string, the name of the directory to archive.</span>
<span class="sd">      archive: A string, the name of the file to output.</span>
<span class="sd">      quiet: A boolean, True to suppress output.</span>
<span class="sd">    Raises:</span>
<span class="sd">      IOError: if the directory does not exist or if the archive name already</span>
<span class="sd">      exists.</span>

<span class="sd">    """</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">archive</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">"Directory to archive '</span><span class="si">{}</span><span class="s2">' does not exist"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">directory</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">archive</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">"Output archive name '</span><span class="si">{}</span><span class="s2">' already exists"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">archive</span><span class="p">))</span>

    <span class="n">command</span> <span class="o">=</span> <span class="n">command_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                                      <span class="n">dirname</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
                                      <span class="n">basename</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
                                      <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">)</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">command</span><span class="p">),</span>
                            <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">if</span> <span class="n">quiet</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">if</span> <span class="n">quiet</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">"Archive failure"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.archive_zip">
<code class="highlight language-python">
archive_zip<span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">archive</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.archive_zip" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Archive the directory to the given tar/gz archive filename.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>directory</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the directory to archive.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>archive</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to output.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">archive_zip</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">archive</span><span class="p">):</span>
    <span class="sd">"""Archive the directory to the given tar/gz archive filename.</span>

<span class="sd">    Args:</span>
<span class="sd">      directory: A string, the name of the directory to archive.</span>
<span class="sd">      archive: A string, the name of the file to output.</span>
<span class="sd">    """</span>
    <span class="c1"># Figure out optimal level of compression among the supported ones in this</span>
    <span class="c1"># installation.</span>
    <span class="k">for</span> <span class="n">spec</span><span class="p">,</span> <span class="n">compression</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">'lzma'</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'bz2'</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">'zlib'</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)]:</span>
        <span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
            <span class="n">zip_compression</span> <span class="o">=</span> <span class="n">compression</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Default is no compression.</span>
        <span class="n">zip_compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>

    <span class="k">with</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
            <span class="n">archive</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zip_compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">archfile</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">relpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">directory</span><span class="p">)</span>
                <span class="n">archfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">relpath</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.bake_to_directory">
<code class="highlight language-python">
bake_to_directory<span class="p">(</span><span class="n">webargs</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.bake_to_directory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Serve and bake a Beancount's web to a directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>webargs</code></td>
<td><code></code></td>
<td>
<p>An argparse parsed options object with the web app arguments.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>output_dir</code></td>
<td><code></code></td>
<td>
<p>A directory name. We don't check here whether it exists or not.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>quiet</code></td>
<td><code></code></td>
<td>
<p>A boolean, True to suppress web server fetch log.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>full_mode</code></td>
<td><code></code></td>
<td>
<p>If true, fetch the full set of pages, not just the subset that
is palatable.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>True on success, False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">bake_to_directory</span><span class="p">(</span><span class="n">webargs</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Serve and bake a Beancount's web to a directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      webargs: An argparse parsed options object with the web app arguments.</span>
<span class="sd">      output_dir: A directory name. We don't check here whether it exists or not.</span>
<span class="sd">      quiet: A boolean, True to suppress web server fetch log.</span>
<span class="sd">      full_mode: If true, fetch the full set of pages, not just the subset that</span>
<span class="sd">        is palatable.</span>
<span class="sd">    Returns:</span>
<span class="sd">      True on success, False otherwise.</span>
<span class="sd">    """</span>
    <span class="n">callback</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">save_scraped_document</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">full_mode</span><span class="p">:</span>
        <span class="n">ignore_regexps</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">regexps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Skip the context pages, too slow.</span>
            <span class="sa">r</span><span class="s1">'/context/'</span><span class="p">,</span>
            <span class="c1"># Skip the component pages... too many.</span>
            <span class="sa">r</span><span class="s1">'/view/component/'</span><span class="p">,</span>
            <span class="c1"># Skip served documents.</span>
            <span class="sa">r</span><span class="s1">'/.*/doc/'</span><span class="p">,</span>
            <span class="c1"># Skip monthly pages.</span>
            <span class="sa">r</span><span class="s1">'/view/year/\d\d\d\d/month/'</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ignore_regexps</span> <span class="o">=</span> <span class="s1">'(</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">regexps</span><span class="p">))</span>

    <span class="n">processed_urls</span><span class="p">,</span> <span class="n">skipped_urls</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">scrape_webapp</span><span class="p">(</span><span class="n">webargs</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                                     <span class="n">callback</span><span class="p">,</span>
                                                     <span class="n">webargs</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                                                     <span class="n">ignore_regexps</span><span class="p">,</span>
                                                     <span class="n">quiet</span><span class="p">,</span>
                                                     <span class="n">webargs</span><span class="o">.</span><span class="n">no_colons</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.normalize_filename">
<code class="highlight language-python">
normalize_filename<span class="p">(</span><span class="n">url</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.normalize_filename" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert URL paths to filenames. Add .html extension if needed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td><code></code></td>
<td>
<p>A string, the url to convert.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, possibly with an extension appended.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_filename</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">"""Convert URL paths to filenames. Add .html extension if needed.</span>

<span class="sd">    Args:</span>
<span class="sd">      url: A string, the url to convert.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, possibly with an extension appended.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'/'</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s1">'index.html'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">BINARY_MATCH</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">url</span> <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.html'</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">'.html'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.relativize_links">
<code class="highlight language-python">
relativize_links<span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">current_url</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.relativize_links" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Make all the links in the contents string relative to an URL.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>html</code></td>
<td><code></code></td>
<td>
<p>An lxml document node.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>current_url</code></td>
<td><code></code></td>
<td>
<p>A string, the URL of the current page, a path to.
a file or a directory. If the path represents a directory, the
path ends with a /.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">relativize_links</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">current_url</span><span class="p">):</span>
    <span class="sd">"""Make all the links in the contents string relative to an URL.</span>

<span class="sd">    Args:</span>
<span class="sd">      html: An lxml document node.</span>
<span class="sd">      current_url: A string, the URL of the current page, a path to.</span>
<span class="sd">        a file or a directory. If the path represents a directory, the</span>
<span class="sd">        path ends with a /.</span>
<span class="sd">    """</span>
    <span class="n">current_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">iterlinks</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
            <span class="n">relative_link</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">normalize_filename</span><span class="p">(</span><span class="n">link</span><span class="p">),</span> <span class="n">current_dir</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">relative_link</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.remove_links">
<code class="highlight language-python">
remove_links<span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.remove_links" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a list of anchors (&lt;a&gt;) from an HTML tree to spans (&lt;span&gt;).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>html</code></td>
<td><code></code></td>
<td>
<p>An lxml document node.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>targets</code></td>
<td><code></code></td>
<td>
<p>A set of string, targets to be removed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>68
69
70
71
72
73
74
75
76
77
78
79</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_links</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
    <span class="sd">"""Convert a list of anchors (&lt;a&gt;) from an HTML tree to spans (&lt;span&gt;).</span>

<span class="sd">    Args:</span>
<span class="sd">      html: An lxml document node.</span>
<span class="sd">      targets: A set of string, targets to be removed.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">iterlinks</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
            <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">'span'</span>
            <span class="n">element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'removed-link'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.bake.save_scraped_document">
<code class="highlight language-python">
save_scraped_document<span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">html_root</span><span class="p">,</span> <span class="n">skipped_urls</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.bake.save_scraped_document" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Callback function to process a document being scraped.</p>
<p>This converts the document to have relative links and writes out the file to
the output directory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output_dir</code></td>
<td><code></code></td>
<td>
<p>A string, the output directory to write.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>url</code></td>
<td><code></code></td>
<td>
<p>A string, the originally requested URL.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>response</code></td>
<td><code></code></td>
<td>
<p>An http response as per urlopen.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>contents</code></td>
<td><code></code></td>
<td>
<p>Bytes, the content of a response.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>html_root</code></td>
<td><code></code></td>
<td>
<p>An lxml root node for the document, optionally. If this is provided,
this avoid you having to reprocess it (for performance reasons).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>skipped_urls</code></td>
<td><code></code></td>
<td>
<p>A set of the links from the file that were skipped.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/bake.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_scraped_document</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">html_root</span><span class="p">,</span> <span class="n">skipped_urls</span><span class="p">):</span>
    <span class="sd">"""Callback function to process a document being scraped.</span>

<span class="sd">    This converts the document to have relative links and writes out the file to</span>
<span class="sd">    the output directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      output_dir: A string, the output directory to write.</span>
<span class="sd">      url: A string, the originally requested URL.</span>
<span class="sd">      response: An http response as per urlopen.</span>
<span class="sd">      contents: Bytes, the content of a response.</span>
<span class="sd">      html_root: An lxml root node for the document, optionally. If this is provided,</span>
<span class="sd">        this avoid you having to reprocess it (for performance reasons).</span>
<span class="sd">      skipped_urls: A set of the links from the file that were skipped.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Invalid status: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="c1"># Ignore directories.</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'/'</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="c1"># Note that we're saving the file under the non-redirected URL, because this</span>
    <span class="c1"># will have to be opened using files and there are no redirects that way.</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'text/html'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">html_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">html_root</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="n">remove_links</span><span class="p">(</span><span class="n">html_root</span><span class="p">,</span> <span class="n">skipped_urls</span><span class="p">)</span>
        <span class="n">relativize_links</span><span class="p">(</span><span class="n">html_root</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html_root</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"html"</span><span class="p">)</span>

    <span class="c1"># Compute output filename and write out the relativized contents.</span>
    <span class="n">output_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span>
                                <span class="n">normalize_filename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.check">
<code>check</code>
<a class="headerlink" href="#beancount.scripts.check" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Parse, check and realize a beancount input file.</p>
<p>This also measures the time it takes to run all these steps.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.check_examples_test">
<code>check_examples_test</code>
<a class="headerlink" href="#beancount.scripts.check_examples_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Just make sure that all the example files can be processed without errors.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.check_examples_test.find_example_files">
<code class="highlight language-python">
find_example_files<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.check_examples_test.find_example_files" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find a list of example files in out repository.</p>
<p>Yields:
  A list of strings, absolute paths to example files Beancount provides.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/check_examples_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>13
14
15
16
17
18
19
20
21
22
23</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_example_files</span><span class="p">():</span>
    <span class="sd">"""Find a list of example files in out repository.</span>

<span class="sd">    Yields:</span>
<span class="sd">      A list of strings, absolute paths to example files Beancount provides.</span>
<span class="sd">    """</span>
    <span class="n">examples_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">find_repository_root</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">'examples'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.beancount'</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.deps">
<code>deps</code>
<a class="headerlink" href="#beancount.scripts.deps" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Check the installation dependencies and report the version numbers of each.</p>
<p>This is meant to be used as an error diagnostic tool.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.check_cdecimal">
<code class="highlight language-python">
check_cdecimal<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.check_cdecimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that Python 3.3 or above is installed.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_cdecimal</span><span class="p">():</span>
    <span class="sd">"""Check that Python 3.3 or above is installed.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    """</span>
    <span class="c1"># Note: this code mirrors and should be kept in-sync with that at the top of</span>
    <span class="c1"># beancount.core.number.</span>

    <span class="c1"># Try the built-in installation.</span>
    <span class="kn">import</span> <span class="nn">decimal</span>
    <span class="k">if</span> <span class="n">is_fast_decimal</span><span class="p">(</span><span class="n">decimal</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">'cdecimal'</span><span class="p">,</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> (built-in)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Try an explicitly installed version.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cdecimal</span>
        <span class="k">if</span> <span class="n">is_fast_decimal</span><span class="p">(</span><span class="n">cdecimal</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s1">'cdecimal'</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cdecimal</span><span class="p">,</span> <span class="s1">'__version__'</span><span class="p">,</span> <span class="s1">'OKAY'</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Not found.</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">'cdecimal'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.check_dependencies">
<code class="highlight language-python">
check_dependencies<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.check_dependencies" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check the runtime dependencies and report their version numbers.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of pairs of (package-name, version-number, sufficient) whereby if a
package has not been installed, its 'version-number' will be set to None.
Otherwise, it will be a string with the version number in it. 'sufficient'
will be True if the version if sufficient for this installation of
Beancount.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_dependencies</span><span class="p">():</span>
    <span class="sd">"""Check the runtime dependencies and report their version numbers.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of pairs of (package-name, version-number, sufficient) whereby if a</span>
<span class="sd">      package has not been installed, its 'version-number' will be set to None.</span>
<span class="sd">      Otherwise, it will be a string with the version number in it. 'sufficient'</span>
<span class="sd">      will be True if the version if sufficient for this installation of</span>
<span class="sd">      Beancount.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="c1"># Check for a complete installation of Python itself.</span>
        <span class="n">check_python</span><span class="p">(),</span>
        <span class="n">check_cdecimal</span><span class="p">(),</span>

        <span class="c1"># Modules we really do need installed.</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'dateutil'</span><span class="p">),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'bottle'</span><span class="p">),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'ply'</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s1">'ply.yacc'</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="s1">'3.4'</span><span class="p">),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'lxml'</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s1">'lxml.etree'</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="s1">'3'</span><span class="p">),</span>

        <span class="c1"># Optionally required to upload data to Google Drive.</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'apiclient'</span><span class="p">),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'oauth2client'</span><span class="p">),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'httplib2'</span><span class="p">),</span>

        <span class="c1"># Optionally required to support various price source fetchers.</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'requests'</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="s1">'2.0'</span><span class="p">),</span>

        <span class="c1"># Optionally required to support imports (identify, extract, file) code.</span>
        <span class="n">check_python_magic</span><span class="p">(),</span>
        <span class="n">check_import</span><span class="p">(</span><span class="s1">'beautifulsoup4'</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s1">'bs4'</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="s1">'4'</span><span class="p">),</span>
        <span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.check_import">
<code class="highlight language-python">
check_import<span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.check_import" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that a particular module name is installed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>package_name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the package and module to be
imported to verify this works. This should have a <strong>version</strong>
attribute on it.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>min_version</code></td>
<td><code></code></td>
<td>
<p>If not None, a string, the minimum version number
we require.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>module_name</code></td>
<td><code></code></td>
<td>
<p>The name of the module to import if it differs from the
package name.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_import</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">min_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Check that a particular module name is installed.</span>

<span class="sd">    Args:</span>
<span class="sd">      package_name: A string, the name of the package and module to be</span>
<span class="sd">        imported to verify this works. This should have a __version__</span>
<span class="sd">        attribute on it.</span>
<span class="sd">      min_version: If not None, a string, the minimum version number</span>
<span class="sd">        we require.</span>
<span class="sd">      module_name: The name of the module to import if it differs from the</span>
<span class="sd">        package name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">module_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">package_name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__version__</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">is_sufficient</span> <span class="o">=</span> <span class="p">(</span><span class="n">parse_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">parse_version</span><span class="p">(</span><span class="n">min_version</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">min_version</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">is_sufficient</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">is_sufficient</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.check_python">
<code class="highlight language-python">
check_python<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.check_python" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that Python 3.3 or above is installed.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>62
63
64
65
66
67
68
69
70
71</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_python</span><span class="p">():</span>
    <span class="sd">"""Check that Python 3.3 or above is installed.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">'python3'</span><span class="p">,</span>
            <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">3</span><span class="p">])),</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.check_python_magic">
<code class="highlight language-python">
check_python_magic<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.check_python_magic" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that a recent-enough version of python-magic is installed.</p>
<p>python-magic is an interface to libmagic, which is used by the 'file' tool
and UNIX to identify file types. Note that there are two Python wrappers
which provide the 'magic' import: python-magic and filemagic. The former is
what we need, which appears to be more recently maintained.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A triple of (package-name, version-number, sufficient) as per
check_dependencies().</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_python_magic</span><span class="p">():</span>
    <span class="sd">"""Check that a recent-enough version of python-magic is installed.</span>

<span class="sd">    python-magic is an interface to libmagic, which is used by the 'file' tool</span>
<span class="sd">    and UNIX to identify file types. Note that there are two Python wrappers</span>
<span class="sd">    which provide the 'magic' import: python-magic and filemagic. The former is</span>
<span class="sd">    what we need, which appears to be more recently maintained.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A triple of (package-name, version-number, sufficient) as per</span>
<span class="sd">      check_dependencies().</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">magic</span>
        <span class="c1"># Check that python-magic and not filemagic is installed.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">magic</span><span class="p">,</span> <span class="s1">'from_file'</span><span class="p">):</span>
            <span class="c1"># 'filemagic' is installed; install python-magic.</span>
            <span class="k">raise</span> <span class="ne">ImportError</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">'python-magic'</span><span class="p">,</span> <span class="s1">'OK'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">'python-magic'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.is_fast_decimal">
<code class="highlight language-python">
is_fast_decimal<span class="p">(</span><span class="n">decimal_module</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.is_fast_decimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if a fast C decimal implementattion is installed.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>74
75
76</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_fast_decimal</span><span class="p">(</span><span class="n">decimal_module</span><span class="p">):</span>
    <span class="s2">"Return true if a fast C decimal implementattion is installed."</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decimal_module</span><span class="o">.</span><span class="n">Decimal</span><span class="p">()</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">BuiltinFunctionType</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.list_dependencies">
<code class="highlight language-python">
list_dependencies<span class="p">(</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span> <span class="n">name</span><span class="o">=</span><span class="s1">'&lt;stderr&gt;'</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.list_dependencies" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check the dependencies and produce a listing on the given file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object to write the output to.</p>
</td>
<td><code>&lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">list_dependencies</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
    <span class="sd">"""Check the dependencies and produce a listing on the given file.</span>

<span class="sd">    Args:</span>
<span class="sd">      file: A file object to write the output to.</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Dependencies:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">package</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">sufficient</span> <span class="ow">in</span> <span class="n">check_dependencies</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"   </span><span class="si">{:16}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">package</span><span class="p">,</span>
            <span class="n">version</span> <span class="ow">or</span> <span class="s1">'NOT INSTALLED'</span><span class="p">,</span>
            <span class="s2">"(INSUFFICIENT)"</span> <span class="k">if</span> <span class="n">version</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sufficient</span> <span class="k">else</span> <span class="s2">""</span><span class="p">),</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.deps.parse_version">
<code class="highlight language-python">
parse_version<span class="p">(</span><span class="n">version_str</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.deps.parse_version" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse the version string into a comparable tuple.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/deps.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>158
159
160</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_version</span><span class="p">(</span><span class="n">version_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""Parse the version string into a comparable tuple."""</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.directories">
<code>directories</code>
<a class="headerlink" href="#beancount.scripts.directories" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Check that document directories mirror a list of accounts correctly.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.directories.ValidateDirectoryError">
<code>ValidateDirectoryError</code>
<a class="headerlink" href="#beancount.scripts.directories.ValidateDirectoryError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A directory validation error.</p>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.directories.validate_directories">
<code class="highlight language-python">
validate_directories<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">document_dirs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.directories.validate_directories" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate a directory hierarchy against a ledger's account names.</p>
<p>Read a ledger's list of account names and check that all the capitalized
subdirectory names under the given roots match the account names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>document_dirs</code></td>
<td><code></code></td>
<td>
<p>A list of string, the directory roots to walk and validate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/directories.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">validate_directories</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">document_dirs</span><span class="p">):</span>
    <span class="sd">"""Validate a directory hierarchy against a ledger's account names.</span>

<span class="sd">    Read a ledger's list of account names and check that all the capitalized</span>
<span class="sd">    subdirectory names under the given roots match the account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      document_dirs: A list of string, the directory roots to walk and validate.</span>
<span class="sd">    """</span>

    <span class="c1"># Get the list of accounts declared in the ledge.</span>
    <span class="n">accounts</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="c1"># For each of the roots, validate the hierarchy of directories.</span>
    <span class="k">for</span> <span class="n">document_dir</span> <span class="ow">in</span> <span class="n">document_dirs</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_directory</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"ERROR: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.directories.validate_directory">
<code class="highlight language-python">
validate_directory<span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.directories.validate_directory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check a directory hierarchy against a list of valid accounts.</p>
<p>Walk the directory hierarchy, and for all directories with names matching
that of accounts (with ":" replaced with "/"), check that they refer to an
account name declared in the given list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>A set or dict of account names.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>document_dir</code></td>
<td><code></code></td>
<td>
<p>A string, the root directory to walk and validate.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An errors for each invalid directory name found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/directories.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">validate_directory</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="n">document_dir</span><span class="p">):</span>
    <span class="sd">"""Check a directory hierarchy against a list of valid accounts.</span>

<span class="sd">    Walk the directory hierarchy, and for all directories with names matching</span>
<span class="sd">    that of accounts (with ":" replaced with "/"), check that they refer to an</span>
<span class="sd">    account name declared in the given list.</span>

<span class="sd">    Args:</span>
<span class="sd">      account: A set or dict of account names.</span>
<span class="sd">      document_dir: A string, the root directory to walk and validate.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An errors for each invalid directory name found.</span>
<span class="sd">    """</span>
    <span class="c1"># Generate all parent accounts in the account_set we're checking against, so</span>
    <span class="c1"># that parent directories with no corresponding account don't warn.</span>
    <span class="n">accounts_with_parents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">accounts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">account_</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">account_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">accounts_with_parents</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">accounts_with_parents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">account_</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">directory</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">account</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">document_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">account_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accounts_with_parents</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidateDirectoryError</span><span class="p">(</span>
                <span class="s2">"Invalid directory '</span><span class="si">{}</span><span class="s2">': no corresponding account '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">directory</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">errors</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.directories_test">
<code>directories_test</code>
<a class="headerlink" href="#beancount.scripts.directories_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.directories_test.TestScriptCheckDirectories">
<code>TestScriptCheckDirectories</code>
<a class="headerlink" href="#beancount.scripts.directories_test.TestScriptCheckDirectories" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.directories_test.TestScriptCheckDirectories.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.directories_test.TestScriptCheckDirectories.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/directories_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>15
16</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.directories_test.TestScriptCheckDirectories.tearDown">
<code class="highlight language-python">
tearDown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.directories_test.TestScriptCheckDirectories.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/directories_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>18
19</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.doctor">
<code>doctor</code>
<a class="headerlink" href="#beancount.scripts.doctor" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Debugging tool for those finding bugs in Beancount.</p>
<p>This tool is able to dump lexer/parser state, and will provide other services in
the name of debugging.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.RenderError">
<code>RenderError</code>
<a class="headerlink" href="#beancount.scripts.doctor.RenderError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>RenderError(source, message, entry)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.doctor.RenderError.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.doctor.RenderError.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.doctor.RenderError.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.doctor.RenderError.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of RenderError(source, message, entry)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.doctor.RenderError.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.doctor.RenderError.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_checkdeps">
<code class="highlight language-python">
do_checkdeps<span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_checkdeps" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Report on the runtime dependencies.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>unused_args</code></td>
<td><code></code></td>
<td>
<p>Ignored.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>178
179
180
181
182
183
184
185
186
187</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_deps</span><span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Report on the runtime dependencies.</span>

<span class="sd">    Args:</span>
<span class="sd">      unused_args: Ignored.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.scripts</span> <span class="kn">import</span> <span class="n">deps</span>
    <span class="n">deps</span><span class="o">.</span><span class="n">list_dependencies</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Use "pip3 install &lt;package&gt;" to install new packages.'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_context">
<code class="highlight language-python">
do_context<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_context" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Describe the context that a particular transaction is applied to.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, which consists in the filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>A tuple of the rest of arguments. We're expecting the first argument
to be a string which contains either a lineno integer or a filename:lineno
combination (which can be used if the location is not in the top-level file).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_context</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Describe the context that a particular transaction is applied to.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, which consists in the filename.</span>
<span class="sd">      args: A tuple of the rest of arguments. We're expecting the first argument</span>
<span class="sd">        to be a string which contains either a lineno integer or a filename:lineno</span>
<span class="sd">        combination (which can be used if the location is not in the top-level file).</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.reports</span> <span class="kn">import</span> <span class="n">context</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>

    <span class="c1"># Check we have the required number of arguments.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">"Missing line number argument."</span><span class="p">)</span>

    <span class="c1"># Load the input files.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Parse the arguments, get the line number.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(.+):(\d+)$"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">search_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(\d+)$"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="c1"># Note: Make sure to use the absolute filename used by the parser to</span>
        <span class="c1"># resolve the file.</span>
        <span class="n">search_filename</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">]</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">"Invalid format for location."</span><span class="p">)</span>

    <span class="n">str_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">render_file_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span>
                                              <span class="n">search_filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_context</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_deps">
<code class="highlight language-python">
do_deps<span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_deps" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Report on the runtime dependencies.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>unused_args</code></td>
<td><code></code></td>
<td>
<p>Ignored.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>178
179
180
181
182
183
184
185
186
187</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_deps</span><span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Report on the runtime dependencies.</span>

<span class="sd">    Args:</span>
<span class="sd">      unused_args: Ignored.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.scripts</span> <span class="kn">import</span> <span class="n">deps</span>
    <span class="n">deps</span><span class="o">.</span><span class="n">list_dependencies</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Use "pip3 install &lt;package&gt;" to install new packages.'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_directories">
<code class="highlight language-python">
do_directories<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_directories" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate a directory hierarchy against a ledger's account names.</p>
<p>Read a ledger's list of account names and check that all the capitalized
subdirectory names under the given roots match the account names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the Beancount input filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>The rest of the arguments provided on the command-line, which in this
case will be interpreted as the names of root directories to validate against
the accounts in the given ledger.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_directories</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Validate a directory hierarchy against a ledger's account names.</span>

<span class="sd">    Read a ledger's list of account names and check that all the capitalized</span>
<span class="sd">    subdirectory names under the given roots match the account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the Beancount input filename.</span>
<span class="sd">      args: The rest of the arguments provided on the command-line, which in this</span>
<span class="sd">        case will be interpreted as the names of root directories to validate against</span>
<span class="sd">        the accounts in the given ledger.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>
    <span class="kn">from</span> <span class="nn">beancount.scripts</span> <span class="kn">import</span> <span class="n">directories</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">directories</span><span class="o">.</span><span class="n">validate_directories</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_display_context">
<code class="highlight language-python">
do_display_context<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_display_context" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print out the precision inferred from the parsed numbers in the input file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, which consists in the filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>A tuple of the rest of arguments. We're expecting the first argument
to be an integer as a string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>355
356
357
358
359
360
361
362
363
364
365
366</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_display_context</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Print out the precision inferred from the parsed numbers in the input file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, which consists in the filename.</span>
<span class="sd">      args: A tuple of the rest of arguments. We're expecting the first argument</span>
<span class="sd">        to be an integer as a string.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dcontext</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_dump_lexer">
<code class="highlight language-python">
do_dump_lexer<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_dump_lexer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Dump the lexer output for a Beancount syntax file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the Beancount input filename.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>25
26
27
28
29
30
31
32
33
34</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_lex</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Dump the lexer output for a Beancount syntax file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the Beancount input filename.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">lexer</span>
    <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lex_iter</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="si">{:12}</span><span class="s1"> </span><span class="si">{:6d}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">'(None)'</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">token</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_lex">
<code class="highlight language-python">
do_lex<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_lex" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Dump the lexer output for a Beancount syntax file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the Beancount input filename.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>25
26
27
28
29
30
31
32
33
34</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_lex</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Dump the lexer output for a Beancount syntax file.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the Beancount input filename.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">lexer</span>
    <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lex_iter</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="si">{:12}</span><span class="s1"> </span><span class="si">{:6d}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">'(None)'</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">token</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_linked">
<code class="highlight language-python">
do_linked<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_linked" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print out a list of transactions linked to the one at the given line.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, which consists in the filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>A tuple of the rest of arguments. We're expecting the first argument
to be an integer as a string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_linked</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Print out a list of transactions linked to the one at the given line.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, which consists in the filename.</span>
<span class="sd">      args: A tuple of the rest of arguments. We're expecting the first argument</span>
<span class="sd">        to be an integer as a string.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">options</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">printer</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">account_types</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">inventory</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">data</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">realization</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>

    <span class="c1"># Parse the arguments, get the line number.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">"Missing line number argument."</span><span class="p">)</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Load the input file.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Find the closest entry.</span>
    <span class="n">closest_entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">],</span> <span class="n">lineno</span><span class="p">)</span>

    <span class="c1"># Find its links.</span>
    <span class="k">if</span> <span class="n">closest_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">"No entry could be found before </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">))</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">(</span><span class="n">closest_entry</span><span class="o">.</span><span class="n">links</span>
             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">closest_entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span>
             <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">EMPTY_SET</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">links</span><span class="p">:</span>
        <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">closest_entry</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Find all linked entries.</span>
        <span class="c1">#</span>
        <span class="c1"># Note that there is an option here: You can either just look at the links</span>
        <span class="c1"># on the closest entry, or you can include the links of the linked</span>
        <span class="c1"># transactions as well. Whichever one you want depends on how you use your</span>
        <span class="c1"># links. Best would be to query the user (in Emacs) when there are many</span>
        <span class="c1"># links present.</span>
        <span class="n">follow_links</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">follow_links</span><span class="p">:</span>
            <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span>
                              <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
                              <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span>
                                  <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="ow">and</span>
                                  <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="o">&amp;</span> <span class="n">links</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
            <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">num_linked</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_entries</span><span class="p">)</span>
                <span class="n">linked_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span>
                                  <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span>
                                  <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span>
                                      <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="ow">and</span>
                                      <span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="o">&amp;</span> <span class="n">links</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_entries</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_linked</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linked_entries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                        <span class="n">links</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>

    <span class="c1"># Render linked entries (in date order) as errors (for Emacs).</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">RenderError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
              <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linked_entries</span><span class="p">]</span>
    <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

    <span class="c1"># Print out balances.</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">linked_entries</span><span class="p">)</span>
    <span class="n">dformat</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">alignment</span><span class="o">=</span><span class="n">display_context</span><span class="o">.</span><span class="n">Align</span><span class="o">.</span><span class="n">DOT</span><span class="p">,</span>
                                            <span class="n">reserved</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">realization</span><span class="o">.</span><span class="n">dump_balances</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">dformat</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="c1"># Print out net income change.</span>
    <span class="n">acctypes</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>
    <span class="n">net_income</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">real_node</span> <span class="ow">in</span> <span class="n">realization</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="n">real_root</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">account_types</span><span class="o">.</span><span class="n">is_income_statement_account</span><span class="p">(</span><span class="n">real_node</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">acctypes</span><span class="p">):</span>
            <span class="n">net_income</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">real_node</span><span class="o">.</span><span class="n">balance</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Net Income: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">net_income</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_list_options">
<code class="highlight language-python">
do_list_options<span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_list_options" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print out a list of the available options.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>unused_args</code></td>
<td><code></code></td>
<td>
<p>Ignored.</p>
</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>141
142
143
144
145
146
147
148</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_list_options</span><span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Print out a list of the available options.</span>

<span class="sd">    Args:</span>
<span class="sd">      unused_args: Ignored.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">options</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">list_options</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_missing_open">
<code class="highlight language-python">
do_missing_open<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_missing_open" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print out Open directives that are missing for the given input file.</p>
<p>This can be useful during demos in order to quickly generate all the
required Open directives without having to type them manually.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, which consists in the filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>A tuple of the rest of arguments. We're expecting the first argument
to be an integer as a string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_missing_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Print out Open directives that are missing for the given input file.</span>

<span class="sd">    This can be useful during demos in order to quickly generate all the</span>
<span class="sd">    required Open directives without having to type them manually.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, which consists in the filename.</span>
<span class="sd">      args: A tuple of the rest of arguments. We're expecting the first argument</span>
<span class="sd">        to be an integer as a string.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">printer</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">data</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">getters</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>

    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Get accounts usage and open directives.</span>
    <span class="n">first_use_map</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts_use_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">open_close_map</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_account_open_close</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">first_use_date</span> <span class="ow">in</span> <span class="n">first_use_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">open_close_map</span><span class="p">:</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">data</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">first_use_date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span>
                          <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span>
    <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">new_entries</span><span class="p">),</span> <span class="n">dcontext</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_parse">
<code class="highlight language-python">
do_parse<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_parse" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run the parser in debug mode.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the Beancount input filename.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_parse</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Run the parser in debug mode.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the Beancount input filename.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">parser</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">yydebug</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_print_options">
<code class="highlight language-python">
do_print_options<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_print_options" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print out the actual options parsed from a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>unused_args</code></td>
<td><code></code></td>
<td>
<p>Ignored.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>151
152
153
154
155
156
157
158
159
160</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_print_options</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Print out the actual options parsed from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      unused_args: Ignored.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">options_map</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_roundtrip">
<code class="highlight language-python">
do_roundtrip<span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_roundtrip" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Round-trip test on arbitrary Ledger.</p>
<p>Read a Ledger's transactions, print them out, re-read them again and compare
them. Both sets of parsed entries should be equal. Both printed files are
output to disk, so you can also run diff on them yourself afterwards.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the Beancount input filename.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_roundtrip</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">unused_args</span><span class="p">):</span>
    <span class="sd">"""Round-trip test on arbitrary Ledger.</span>

<span class="sd">    Read a Ledger's transactions, print them out, re-read them again and compare</span>
<span class="sd">    them. Both sets of parsed entries should be equal. Both printed files are</span>
<span class="sd">    output to disk, so you can also run diff on them yourself afterwards.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the Beancount input filename.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.parser</span> <span class="kn">import</span> <span class="n">printer</span>
    <span class="kn">from</span> <span class="nn">beancount.core</span> <span class="kn">import</span> <span class="n">compare</span>
    <span class="kn">from</span> <span class="nn">beancount</span> <span class="kn">import</span> <span class="n">loader</span>

    <span class="n">round1_filename</span> <span class="o">=</span> <span class="n">round2_filename</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'</span><span class="si">%(levelname)-8s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Read the entries"</span><span class="p">)</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Print them out to a file"</span><span class="p">)</span>
        <span class="n">basename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">round1_filename</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">basename</span><span class="p">,</span> <span class="s1">'.roundtrip1'</span><span class="p">,</span> <span class="n">extension</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">round1_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Read the entries from that file"</span><span class="p">)</span>

        <span class="c1"># Note that we don't want to run any of the auto-generation here, but</span>
        <span class="c1"># parsing now returns incomplete objects and we assume idempotence on a</span>
        <span class="c1"># file that was output from the printer after having been processed, so</span>
        <span class="c1"># it shouldn't add anything new. That is, a processed file printed and</span>
        <span class="c1"># resolve when parsed again should contain the same entries, i.e.</span>
        <span class="c1"># nothing new should be generated.</span>
        <span class="n">entries_roundtrip</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">round1_filename</span><span class="p">)</span>

        <span class="c1"># Print out the list of errors from parsing the results.</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">',----------------------------------------------------------------------'</span><span class="p">)</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'`----------------------------------------------------------------------'</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Print what you read to yet another file"</span><span class="p">)</span>
        <span class="n">round2_filename</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">basename</span><span class="p">,</span> <span class="s1">'.roundtrip2'</span><span class="p">,</span> <span class="n">extension</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">round2_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">entries_roundtrip</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Compare the original entries with the re-read ones"</span><span class="p">)</span>
        <span class="n">same</span><span class="p">,</span> <span class="n">missing1</span><span class="p">,</span> <span class="n">missing2</span> <span class="o">=</span> <span class="n">compare</span><span class="o">.</span><span class="n">compare_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">entries_roundtrip</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">same</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Entries are the same. Congratulations.'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Entries differ!'</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">Missing from original:'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">hash_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n</span><span class="s1">Missing from round-trip:'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">missing2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">hash_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rfilename</span> <span class="ow">in</span> <span class="p">(</span><span class="n">round1_filename</span><span class="p">,</span> <span class="n">round2_filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rfilename</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rfilename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.do_validate_html">
<code class="highlight language-python">
do_validate_html<span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.do_validate_html" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Validate all the HTML files under a directory hierachy.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>directory</code></td>
<td><code></code></td>
<td>
<p>A string, the root directory whose contents to validte.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>args</code></td>
<td><code></code></td>
<td>
<p>A tuple of the rest of arguments.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>369
370
371
372
373
374
375
376
377
378
379
380
381
382</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_validate_html</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">"""Validate all the HTML files under a directory hierachy.</span>

<span class="sd">    Args:</span>
<span class="sd">      directory: A string, the root directory whose contents to validte.</span>
<span class="sd">      args: A tuple of the rest of arguments.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">beancount.web</span> <span class="kn">import</span> <span class="n">scrape</span>
    <span class="n">files</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">scrape</span><span class="o">.</span><span class="n">validate_local_links_in_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'</span><span class="si">%d</span><span class="s1"> files processed'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Missing </span><span class="si">%s</span><span class="s1">'</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">empty</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Empty </span><span class="si">%s</span><span class="s1">'</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.doctor.get_commands">
<code class="highlight language-python">
get_commands<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.doctor.get_commands" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return a list of available commands in this file.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of pairs of (command-name string, docstring).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/doctor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_commands</span><span class="p">():</span>
    <span class="sd">"""Return a list of available commands in this file.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of pairs of (command-name string, docstring).</span>
<span class="sd">    """</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'do_(.*)'</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">misc_utils</span><span class="o">.</span><span class="n">first_paragraph</span><span class="p">(</span><span class="n">attr_value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">commands</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.example">
<code>example</code>
<a class="headerlink" href="#beancount.scripts.example" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Generate a decently-sized example history, based on some rules.</p>
<p>This script is used to generate some meaningful input to Beancount, input that
looks as realistic as possible for a moderately complex mock individual. This
can also be used as an input generator for a stress test for performance
evaluation.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.check_non_negative">
<code class="highlight language-python">
check_non_negative<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.check_non_negative" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that the balance of the given account never goes negative.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>An account string, the account to check the balance for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency to check minimums for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>if the balance goes negative.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">check_non_negative</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Check that the balance of the given account never goes negative.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      account: An account string, the account to check the balance for.</span>
<span class="sd">      currency: A string, the currency to check minimums for.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: if the balance goes negative.</span>
<span class="sd">    """</span>
    <span class="n">previous_date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">!=</span> <span class="n">previous_date</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="n">ZERO</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()),</span> <span class="p">(</span>
                <span class="s2">"Negative balance: </span><span class="si">{}</span><span class="s2"> at: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
        <span class="n">previous_date</span> <span class="o">=</span> <span class="n">date</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.compute_trip_dates">
<code class="highlight language-python">
compute_trip_dates<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.compute_trip_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate dates at reasonable intervals for trips during the given time period.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Pairs of dates for the trips within the period.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_trip_dates</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
    <span class="sd">"""Generate dates at reasonable intervals for trips during the given time period.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Pairs of dates for the trips within the period.</span>
<span class="sd">    """</span>
    <span class="c1"># Min and max number of days remaining at home.</span>
    <span class="n">days_at_home</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">30</span><span class="p">,</span> <span class="mi">13</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1"># Length of trip.</span>
    <span class="n">days_trip</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>

    <span class="c1"># Number of days to ensure no trip at the beginning and the end.</span>
    <span class="n">days_buffer</span> <span class="o">=</span> <span class="mi">21</span>

    <span class="n">date_begin</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_buffer</span><span class="p">)</span>
    <span class="n">date_end</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_buffer</span><span class="p">)</span>

    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">duration_at_home</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">days_at_home</span><span class="p">))</span>
        <span class="n">duration_trip</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">days_trip</span><span class="p">))</span>
        <span class="n">date_trip_begin</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">duration_at_home</span>
        <span class="n">date_trip_end</span> <span class="o">=</span> <span class="n">date_trip_begin</span> <span class="o">+</span> <span class="n">duration_trip</span>
        <span class="k">if</span> <span class="n">date_trip_end</span> <span class="o">&gt;=</span> <span class="n">date_end</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">date_trip_begin</span><span class="p">,</span> <span class="n">date_trip_end</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date_trip_end</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.contextualize_file">
<code class="highlight language-python">
contextualize_file<span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">employer</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.contextualize_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Replace generic strings in the generated file with realistic strings.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contents</code></td>
<td><code></code></td>
<td>
<p>A string, the generic file contents.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, the contextualized version.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">contextualize_file</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">employer</span><span class="p">):</span>
    <span class="sd">"""Replace generic strings in the generated file with realistic strings.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, the generic file contents.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the contextualized version.</span>
<span class="sd">    """</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'CC'</span><span class="p">:</span> <span class="s1">'US'</span><span class="p">,</span>
        <span class="s1">'Bank1'</span><span class="p">:</span> <span class="s1">'BofA'</span><span class="p">,</span>
        <span class="s1">'Bank1_Institution'</span><span class="p">:</span> <span class="s1">'Bank of America'</span><span class="p">,</span>
        <span class="s1">'Bank1_Address'</span><span class="p">:</span> <span class="s1">'123 America Street, LargeTown, USA'</span><span class="p">,</span>
        <span class="s1">'Bank1_Phone'</span><span class="p">:</span> <span class="s1">'+1.012.345.6789'</span><span class="p">,</span>
        <span class="s1">'CreditCard1'</span><span class="p">:</span> <span class="s1">'Chase:Slate'</span><span class="p">,</span>
        <span class="s1">'CreditCard2'</span><span class="p">:</span> <span class="s1">'Amex:BlueCash'</span><span class="p">,</span>
        <span class="s1">'Employer1'</span><span class="p">:</span> <span class="n">employer</span><span class="p">,</span>
        <span class="s1">'Retirement'</span><span class="p">:</span> <span class="s1">'Vanguard'</span><span class="p">,</span>
        <span class="s1">'Retirement_Institution'</span><span class="p">:</span> <span class="s1">'Vanguard Group'</span><span class="p">,</span>
        <span class="s1">'Retirement_Address'</span><span class="p">:</span> <span class="s2">"P.O. Box 1110, Valley Forge, PA 19482-1110"</span><span class="p">,</span>
        <span class="s1">'Retirement_Phone'</span><span class="p">:</span> <span class="s2">"+1.800.523.1188"</span><span class="p">,</span>
        <span class="s1">'Investment'</span><span class="p">:</span> <span class="s1">'ETrade'</span><span class="p">,</span>

        <span class="c1"># Commodities</span>
        <span class="s1">'CCY'</span><span class="p">:</span> <span class="s1">'USD'</span><span class="p">,</span>
        <span class="s1">'VACHR'</span><span class="p">:</span> <span class="s1">'VACHR'</span><span class="p">,</span>
        <span class="s1">'DEFCCY'</span><span class="p">:</span> <span class="s1">'IRAUSD'</span><span class="p">,</span>
        <span class="s1">'MFUND1'</span><span class="p">:</span> <span class="s1">'VBMPX'</span><span class="p">,</span>
        <span class="s1">'MFUND2'</span><span class="p">:</span> <span class="s1">'RGAGX'</span><span class="p">,</span>
        <span class="s1">'STK1'</span><span class="p">:</span> <span class="s1">'ITOT'</span><span class="p">,</span>
        <span class="s1">'STK2'</span><span class="p">:</span> <span class="s1">'VEA'</span><span class="p">,</span>
        <span class="s1">'STK3'</span><span class="p">:</span> <span class="s1">'VHT'</span><span class="p">,</span>
        <span class="s1">'STK4'</span><span class="p">:</span> <span class="s1">'GLD'</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">new_contents</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_contents</span><span class="p">,</span> <span class="n">replacements</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.date_iter">
<code class="highlight language-python">
date_iter<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.date_iter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a sequence of dates.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of datetime.date.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>214
215
216
217
218
219
220
221
222
223
224
225
226
227
228</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
    <span class="sd">"""Generate a sequence of dates.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">date_begin</span> <span class="o">&lt;=</span> <span class="n">date_end</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="n">one_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">one_day</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.date_random_seq">
<code class="highlight language-python">
date_random_seq<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.date_random_seq" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a sequence of dates with some random increase in days.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>days_min</code></td>
<td><code></code></td>
<td>
<p>The minimum number of days to advance on each iteration.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>days_max</code></td>
<td><code></code></td>
<td>
<p>The maximum number of days to advance on each iteration.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of datetime.date.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">):</span>
    <span class="sd">"""Generate a sequence of dates with some random increase in days.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      days_min: The minimum number of days to advance on each iteration.</span>
<span class="sd">      days_max: The maximum number of days to advance on each iteration.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">days_min</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">days_min</span> <span class="o">&lt;=</span> <span class="n">days_max</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">date_begin</span>
    <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">:</span>
        <span class="n">nb_days_forward</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">days_min</span><span class="p">,</span> <span class="n">days_max</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">nb_days_forward</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;=</span> <span class="n">date_end</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.delay_dates">
<code class="highlight language-python">
delay_dates<span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.delay_dates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Delay the dates from the given iterator by some uniformly dranw number of days.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_iter</code></td>
<td><code></code></td>
<td>
<p>An iterator of datetime.date instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>delay_days_min</code></td>
<td><code></code></td>
<td>
<p>The minimum amount of advance days for the transaction.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>delay_days_max</code></td>
<td><code></code></td>
<td>
<p>The maximum amount of advance days for the transaction.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  datetime.date instances.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delay_dates</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">):</span>
    <span class="sd">"""Delay the dates from the given iterator by some uniformly dranw number of days.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator of datetime.date instances.</span>
<span class="sd">      delay_days_min: The minimum amount of advance days for the transaction.</span>
<span class="sd">      delay_days_max: The maximum amount of advance days for the transaction.</span>
<span class="sd">    Yields:</span>
<span class="sd">      datetime.date instances.</span>
<span class="sd">    """</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">last_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">last_date</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtime</span>
        <span class="n">date</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">delay_days_min</span><span class="p">,</span> <span class="n">delay_days_max</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;=</span> <span class="n">last_date</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">yield</span> <span class="n">date</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_balance_checks">
<code class="highlight language-python">
generate_balance_checks<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">date_iter</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_balance_checks" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate balance check entries to the given frequency.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives that contain all the transactions for the
accounts.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>The name of the account for which to generate.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_iter</code></td>
<td><code></code></td>
<td>
<p>Iterator of dates. We generate balance checks at these dates.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of balance check entries.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_balance_checks</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">date_iter</span><span class="p">):</span>
    <span class="sd">"""Generate balance check entries to the given frequency.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives that contain all the transactions for the</span>
<span class="sd">        accounts.</span>
<span class="sd">      account: The name of the account for which to generate.</span>
<span class="sd">      date_iter: Iterator of dates. We generate balance checks at these dates.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of balance check entries.</span>
<span class="sd">    """</span>
    <span class="n">balance_checks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">date_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">swallow</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balance</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">next_date</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">balance</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
                <span class="n">balance_checks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">                  </span><span class="si">{next_date}</span><span class="s2"> balance </span><span class="si">{account}</span><span class="s2"> </span><span class="si">{amount}</span><span class="s2"> CCY</span>
<span class="s2">                """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
                <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">date_iter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">balance_checks</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_banking">
<code class="highlight language-python">
generate_banking<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">amount_initial</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_banking" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a checking account opening.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries which affect this account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>A date instance, the beginning date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>A date instance, the end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount_initial</code></td>
<td><code></code></td>
<td>
<p>A Decimal instance, the amount to initialize the checking
account with.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_banking</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">amount_initial</span><span class="p">):</span>
    <span class="sd">"""Generate a checking account opening.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries which affect this account.</span>
<span class="sd">      date_begin: A date instance, the beginning date.</span>
<span class="sd">      date_end: A date instance, the end date.</span>
<span class="sd">      amount_initial: A Decimal instance, the amount to initialize the checking</span>
<span class="sd">        account with.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">amount_initial_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_initial</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> open Assets:CC:Bank1</span>
<span class="s2">        institution: "Bank1_Institution"</span>
<span class="s2">        address: "Bank1_Address"</span>
<span class="s2">        phone: "Bank1_Phone"</span>

<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> open Assets:CC:Bank1:Checking    CCY</span>
<span class="s2">        account: "00234-48574897"</span>

<span class="s2">      ;; </span><span class="si">{date_begin}</span><span class="s2"> open Assets:CC:Bank1:Savings    CCY</span>

<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> * "Opening Balance for checking account"</span>
<span class="s2">        Assets:CC:Bank1:Checking   </span><span class="si">{amount_initial}</span><span class="s2"> CCY</span>
<span class="s2">        Equity:Opening-Balances    </span><span class="si">{amount_initial_neg}</span><span class="s2"> CCY</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

    <span class="n">date_balance</span> <span class="o">=</span> <span class="n">date_begin</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">account</span> <span class="o">=</span> <span class="s1">'Assets:CC:Bank1:Checking'</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span> <span class="o">+</span> <span class="n">new_entries</span><span class="p">),</span>
                                              <span class="p">[</span><span class="n">account</span><span class="p">],</span> <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">date_balance</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">amount_balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
    <span class="n">bal_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      </span><span class="si">{date_balance}</span><span class="s2"> balance Assets:CC:Bank1:Checking   </span><span class="si">{amount_balance}</span><span class="s2"> CCY</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">new_entries</span> <span class="o">+</span> <span class="n">bal_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_banking_expenses">
<code class="highlight language-python">
generate_banking_expenses<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rent_amount</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_banking_expenses" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate expenses paid out of a checking account, typically living expenses.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>The checking account to generate expenses to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>rent_amount</code></td>
<td><code></code></td>
<td>
<p>The amount of rent.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_banking_expenses</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rent_amount</span><span class="p">):</span>
    <span class="sd">"""Generate expenses paid out of a checking account, typically living expenses.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      account: The checking account to generate expenses to.</span>
<span class="sd">      rent_amount: The amount of rent.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">fee_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">bymonthday</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span>
        <span class="s2">"BANK FEES"</span><span class="p">,</span> <span class="s2">"Monthly bank fee"</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span> <span class="s1">'Expenses:Financial:Fees'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">D</span><span class="p">(</span><span class="s1">'4.00'</span><span class="p">))</span>

    <span class="n">rent_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="s2">"RiverBank Properties"</span><span class="p">,</span> <span class="s2">"Paying the rent"</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span> <span class="s1">'Expenses:Home:Rent'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rent_amount</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">electricity_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s2">"EDISON POWER"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span> <span class="s1">'Expenses:Home:Electricity'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">internet_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
        <span class="s2">"Wine-Tarner Cable"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span> <span class="s1">'Expenses:Home:Internet'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">))</span>

    <span class="n">phone_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span>
        <span class="s2">"Verizon Wireless"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span>
        <span class="n">account</span><span class="p">,</span> <span class="s1">'Expenses:Home:Phone'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">fee_expenses</span> <span class="o">+</span>
                       <span class="n">rent_expenses</span> <span class="o">+</span>
                       <span class="n">electricity_expenses</span> <span class="o">+</span>
                       <span class="n">internet_expenses</span> <span class="o">+</span>
                       <span class="n">phone_expenses</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_clearing_entries">
<code class="highlight language-python">
generate_clearing_entries<span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">account_clear</span><span class="p">,</span> <span class="n">account_from</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_clearing_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate entries to clear the value of an account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_iter</code></td>
<td><code></code></td>
<td>
<p>An iterator of datetime.date instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>payee</code></td>
<td><code></code></td>
<td>
<p>A string, the payee name to use on the transactions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>narration</code></td>
<td><code></code></td>
<td>
<p>A string, the narration to use on the transactions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_clear</code></td>
<td><code></code></td>
<td>
<p>The account to clear.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_from</code></td>
<td><code></code></td>
<td>
<p>The source account to clear 'account_clear' from.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_clearing_entries</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span>
                              <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span>
                              <span class="n">entries</span><span class="p">,</span> <span class="n">account_clear</span><span class="p">,</span> <span class="n">account_from</span><span class="p">):</span>
    <span class="sd">"""Generate entries to clear the value of an account.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator of datetime.date instances.</span>
<span class="sd">      payee: A string, the payee name to use on the transactions.</span>
<span class="sd">      narration: A string, the narration to use on the transactions.</span>
<span class="sd">      entries: A list of entries.</span>
<span class="sd">      account_clear: The account to clear.</span>
<span class="sd">      account_from: The source account to clear 'account_clear' from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="c1"># The next date we're looking for.</span>
    <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">date_iter</span><span class="p">))</span>

    <span class="c1"># Iterate over all the postings of the account to clear.</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_clear</span><span class="p">]):</span>
        <span class="n">balance_clear</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_clear</span><span class="p">]</span>

        <span class="c1"># Check if we need to clear.</span>
        <span class="k">if</span> <span class="n">next_date</span> <span class="o">&lt;=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">pos_amount</span> <span class="o">=</span> <span class="n">balance_clear</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span>
            <span class="n">neg_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">pos_amount</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              </span><span class="si">{next_date}</span><span class="s2"> * "</span><span class="si">{payee}</span><span class="s2">" "</span><span class="si">{narration}</span><span class="s2">"</span>
<span class="s2">                </span><span class="si">{account_clear}</span><span class="s2">     </span><span class="si">{neg_amount.number:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{account_from}</span><span class="s2">      </span><span class="si">{pos_amount.number:.2f}</span><span class="s2"> CCY</span>
<span class="s2">            """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
            <span class="n">balance_clear</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">neg_amount</span><span class="p">)</span>

            <span class="c1"># Advance to the next date we're looking for.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">next_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">date_iter</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_commodity_entries">
<code class="highlight language-python">
generate_commodity_entries<span class="p">(</span><span class="n">date_birth</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_commodity_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a list of Commodity entries for all the currencies we're using.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_birth</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the date of birth of the user.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Commodity entries for all the commodities in use.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_commodity_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
    <span class="sd">"""Create a list of Commodity entries for all the currencies we're using.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A datetime.date instance, the date of birth of the user.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Commodity entries for all the commodities in use.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">        1792-01-01 commodity USD</span>
<span class="s2">          name: "US Dollar"</span>
<span class="s2">          export: "CASH"</span>

<span class="s2">        </span><span class="si">{date_birth}</span><span class="s2"> commodity VACHR</span>
<span class="s2">          name: "Employer Vacation Hours"</span>
<span class="s2">          export: "IGNORE"</span>

<span class="s2">        </span><span class="si">{date_birth}</span><span class="s2"> commodity IRAUSD</span>
<span class="s2">          name: "US 401k and IRA Contributions"</span>
<span class="s2">          export: "IGNORE"</span>

<span class="s2">        2009-05-01 commodity RGAGX</span>
<span class="s2">          name: "American Funds The Growth Fund of America Class R-6"</span>
<span class="s2">          export: "MUTF:RGAGX"</span>
<span class="s2">          price: "USD:google/MUTF:RGAGX"</span>

<span class="s2">        1995-09-18 commodity VBMPX</span>
<span class="s2">          name: "Vanguard Total Bond Market Index Fund Institutional Plus Shares"</span>
<span class="s2">          export: "MUTF:VBMPX"</span>
<span class="s2">          price: "USD:google/MUTF:VBMPX"</span>

<span class="s2">        2004-01-20 commodity ITOT</span>
<span class="s2">          name: "iShares Core S&amp;P Total U.S. Stock Market ETF"</span>
<span class="s2">          export: "NYSEARCA:ITOT"</span>
<span class="s2">          price: "USD:google/NYSEARCA:ITOT"</span>

<span class="s2">        2007-07-20 commodity VEA</span>
<span class="s2">          name: "Vanguard FTSE Developed Markets ETF"</span>
<span class="s2">          export: "NYSEARCA:VEA"</span>
<span class="s2">          price: "USD:google/NYSEARCA:VEA"</span>

<span class="s2">        2004-01-26 commodity VHT</span>
<span class="s2">          name: "Vanguard Health Care ETF"</span>
<span class="s2">          export: "NYSEARCA:VHT"</span>
<span class="s2">          price: "USD:google/NYSEARCA:VHT"</span>

<span class="s2">        2004-11-01 commodity GLD</span>
<span class="s2">          name: "SPDR Gold Trust (ETF)"</span>
<span class="s2">          export: "NYSEARCA:GLD"</span>
<span class="s2">          price: "USD:google/NYSEARCA:GLD"</span>

<span class="s2">        1900-01-01 commodity VMMXX</span>
<span class="s2">          export: "MUTF:VMMXX (MONEY:USD)"</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_employment_income">
<code class="highlight language-python">
generate_employment_income<span class="p">(</span><span class="n">employer_name</span><span class="p">,</span> <span class="n">employer_address</span><span class="p">,</span> <span class="n">annual_salary</span><span class="p">,</span> <span class="n">account_deposit</span><span class="p">,</span> <span class="n">account_retirement</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_employment_income" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate bi-weekly entries for payroll salary income.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>employer_name</code></td>
<td><code></code></td>
<td>
<p>A string, the human-readable name of the employer.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>employer_address</code></td>
<td><code></code></td>
<td>
<p>A string, the address of the employer.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>annual_salary</code></td>
<td><code></code></td>
<td>
<p>A Decimal, the annual salary of the employee.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_deposit</code></td>
<td><code></code></td>
<td>
<p>An account string, the account to deposit the salary to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_retirement</code></td>
<td><code></code></td>
<td>
<p>An account string, the account to deposit retirement
contributions to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives, including open directives for the account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_employment_income</span><span class="p">(</span><span class="n">employer_name</span><span class="p">,</span>
                               <span class="n">employer_address</span><span class="p">,</span>
                               <span class="n">annual_salary</span><span class="p">,</span>
                               <span class="n">account_deposit</span><span class="p">,</span>
                               <span class="n">account_retirement</span><span class="p">,</span>
                               <span class="n">date_begin</span><span class="p">,</span>
                               <span class="n">date_end</span><span class="p">):</span>
    <span class="sd">"""Generate bi-weekly entries for payroll salary income.</span>

<span class="sd">    Args:</span>
<span class="sd">      employer_name: A string, the human-readable name of the employer.</span>
<span class="sd">      employer_address: A string, the address of the employer.</span>
<span class="sd">      annual_salary: A Decimal, the annual salary of the employee.</span>
<span class="sd">      account_deposit: An account string, the account to deposit the salary to.</span>
<span class="sd">      account_retirement: An account string, the account to deposit retirement</span>
<span class="sd">        contributions to.</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives, including open directives for the account.</span>
<span class="sd">    """</span>
    <span class="n">preamble</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> event "employer" "</span><span class="si">{employer_name}</span><span class="s2">, </span><span class="si">{employer_address}</span><span class="s2">"</span>

<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Income:CC:Employer1:Salary           CCY</span>
<span class="s2">        ;</span><span class="si">{date_begin}</span><span class="s2"> open Income:CC:Employer1:AnnualBonus     CCY</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Income:CC:Employer1:GroupTermLife    CCY</span>

<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Income:CC:Employer1:Vacation         VACHR</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Assets:CC:Employer1:Vacation         VACHR</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Vacation                    VACHR</span>

<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Health:Life:GroupTermLife</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Health:Medical:Insurance</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Health:Dental:Insurance</span>
<span class="s2">        </span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Health:Vision:Insurance</span>

<span class="s2">        ;</span><span class="si">{date_begin}</span><span class="s2"> open Expenses:Vacation:Employer</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

    <span class="n">date_prev</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">contrib_retirement</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="n">contrib_socsec</span> <span class="o">=</span> <span class="n">ZERO</span>

    <span class="n">biweekly_pay</span> <span class="o">=</span> <span class="n">annual_salary</span> <span class="o">/</span> <span class="mi">26</span>
    <span class="n">gross</span> <span class="o">=</span> <span class="n">biweekly_pay</span>

    <span class="n">medicare</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.0231'</span><span class="p">)</span>
    <span class="n">federal</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.2303'</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.0791'</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.0379'</span><span class="p">)</span>
    <span class="n">sdi</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'1.12'</span><span class="p">)</span>

    <span class="n">lifeinsurance</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'24.32'</span><span class="p">)</span>
    <span class="n">dental</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'2.90'</span><span class="p">)</span>
    <span class="n">medical</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'27.38'</span><span class="p">)</span>
    <span class="n">vision</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'42.30'</span><span class="p">)</span>

    <span class="n">fixed</span> <span class="o">=</span> <span class="p">(</span><span class="n">medicare</span> <span class="o">+</span> <span class="n">federal</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="n">city</span> <span class="o">+</span> <span class="n">sdi</span> <span class="o">+</span>
             <span class="n">dental</span> <span class="o">+</span> <span class="n">medical</span> <span class="o">+</span> <span class="n">vision</span><span class="p">)</span>

    <span class="c1"># Calculate vacation hours per-pay.</span>
    <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">vacation_hrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ANNUAL_VACATION_DAYS</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'8'</span><span class="p">))</span> <span class="o">/</span> <span class="n">D</span><span class="p">(</span><span class="s1">'26'</span><span class="p">)</span>

    <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">skipiter</span><span class="p">(</span>
            <span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">WEEKLY</span><span class="p">,</span> <span class="n">byweekday</span><span class="o">=</span><span class="n">rrule</span><span class="o">.</span><span class="n">TH</span><span class="p">,</span>
                        <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">date_prev</span> <span class="ow">or</span> <span class="n">date_prev</span><span class="o">.</span><span class="n">year</span> <span class="o">!=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            <span class="n">contrib_retirement</span> <span class="o">=</span> <span class="n">RETIREMENT_LIMITS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">RETIREMENT_LIMITS</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
            <span class="n">contrib_socsec</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'7000'</span><span class="p">)</span>
        <span class="n">date_prev</span> <span class="o">=</span> <span class="n">date</span>

        <span class="n">retirement_uncapped</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.25'</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">retirement</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">contrib_retirement</span><span class="p">,</span> <span class="n">retirement_uncapped</span><span class="p">)</span>
        <span class="n">contrib_retirement</span> <span class="o">-=</span> <span class="n">retirement</span>

        <span class="n">socsec_uncapped</span> <span class="o">=</span> <span class="n">gross</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.0610'</span><span class="p">)</span>
        <span class="n">socsec</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">contrib_socsec</span><span class="p">,</span> <span class="n">socsec_uncapped</span><span class="p">)</span>
        <span class="n">contrib_socsec</span> <span class="o">-=</span> <span class="n">socsec</span>

        <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">deposit</span> <span class="o">=</span> <span class="p">(</span><span class="n">gross</span> <span class="o">-</span> <span class="n">retirement</span> <span class="o">-</span> <span class="n">fixed</span> <span class="o">-</span> <span class="n">socsec</span><span class="p">)</span>

        <span class="n">retirement_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">retirement</span>
        <span class="n">gross_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">gross</span>
        <span class="n">lifeinsurance_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">lifeinsurance</span>
        <span class="n">vacation_hrs_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">vacation_hrs</span>

        <span class="n">template</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">            </span><span class="si">{date}</span><span class="s2"> * "</span><span class="si">{employer_name}</span><span class="s2">" "Payroll"</span>
<span class="s2">              </span><span class="si">{account_deposit}</span><span class="s2">                                 </span><span class="si">{deposit:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              </span><span class="si">{account_retirement}</span><span class="s2">                              </span><span class="si">{retirement:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Assets:CC:Federal:PreTax401k                      </span><span class="si">{retirement_neg:.2f}</span><span class="s2"> DEFCCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Federal:PreTax401k      </span><span class="si">{retirement:.2f}</span><span class="s2"> DEFCCY</span>
<span class="s2">              Income:CC:Employer1:Salary                        </span><span class="si">{gross_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Income:CC:Employer1:GroupTermLife                 </span><span class="si">{lifeinsurance_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Life:GroupTermLife                </span><span class="si">{lifeinsurance:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Dental:Insurance                  </span><span class="si">{dental}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Medical:Insurance                 </span><span class="si">{medical}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Health:Vision:Insurance                  </span><span class="si">{vision}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Medicare                </span><span class="si">{medicare:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Federal                 </span><span class="si">{federal:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:State                   </span><span class="si">{state:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:CityNYC                 </span><span class="si">{city:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:SDI                     </span><span class="si">{sdi:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:SocSec                  </span><span class="si">{socsec:.2f}</span><span class="s2"> CCY</span>
<span class="s2">              Assets:CC:Employer1:Vacation                      </span><span class="si">{vacation_hrs:.2f}</span><span class="s2"> VACHR</span>
<span class="s2">              Income:CC:Employer1:Vacation                      </span><span class="si">{vacation_hrs_neg:.2f}</span><span class="s2"> VACHR</span>
<span class="s2">        """</span>
        <span class="k">if</span> <span class="n">retirement</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="c1"># Remove retirement lines.</span>
            <span class="n">template</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span>
                                 <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                                 <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\bretirement\b'</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

        <span class="n">transactions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">preamble</span> <span class="o">+</span> <span class="n">transactions</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_expense_accounts">
<code class="highlight language-python">
generate_expense_accounts<span class="p">(</span><span class="n">date_birth</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_expense_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate directives for expense accounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_birth</code></td>
<td><code></code></td>
<td>
<p>Birth date of the character.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_expense_accounts</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
    <span class="sd">"""Generate directives for expense accounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: Birth date of the character.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Food:Groceries</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Food:Restaurant</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Food:Coffee</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Food:Alcohol</span>

<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Transport:Tram</span>

<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Home:Rent</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Home:Electricity</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Home:Internet</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Home:Phone</span>

<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Financial:Fees</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Expenses:Financial:Commissions</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_open_entries">
<code class="highlight language-python">
generate_open_entries<span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_open_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a list of Open entries for the given accounts:</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance for the open entries.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>accounts</code></td>
<td><code></code></td>
<td>
<p>A list of account strings.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>An optional currency constraint.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Open directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_open_entries</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Generate a list of Open entries for the given accounts:</span>

<span class="sd">    Args:</span>
<span class="sd">      date: A datetime.date instance for the open entries.</span>
<span class="sd">      accounts: A list of account strings.</span>
<span class="sd">      currency: An optional currency constraint.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Open directives.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="s1">'</span><span class="si">{date}</span><span class="s1"> open </span><span class="si">{account}</span><span class="s1"> </span><span class="si">{currency}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                                                    <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
                                                    <span class="n">currency</span><span class="o">=</span><span class="n">currency</span> <span class="ow">or</span> <span class="s1">''</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_outgoing_transfers">
<code class="highlight language-python">
generate_outgoing_transfers<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">account_out</span><span class="p">,</span> <span class="n">transfer_minimum</span><span class="p">,</span> <span class="n">transfer_threshold</span><span class="p">,</span> <span class="n">transfer_increment</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_outgoing_transfers" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate transfers of accumulated funds out of an account.</p>
<p>This monitors the balance of an account and when it is beyond a threshold,
generate out transfers form that account to another account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of existing entries that affect this account so far.
The generated entries will also affect this account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>An account string, the account to monitor.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_out</code></td>
<td><code></code></td>
<td>
<p>An account string, the savings account to make transfers to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>transfer_minimum</code></td>
<td><code></code></td>
<td>
<p>The minimum amount of funds to always leave in this account
after a transfer.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>transfer_threshold</code></td>
<td><code></code></td>
<td>
<p>The minimum amount of funds to be able to transfer out without
breaking the minimum.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>transfer_increment</code></td>
<td><code></code></td>
<td>
<p>A Decimal, the increment to round transfers to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of new directives, the transfers to add to the given account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_outgoing_transfers</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span>
                                <span class="n">account</span><span class="p">,</span>
                                <span class="n">account_out</span><span class="p">,</span>
                                <span class="n">transfer_minimum</span><span class="p">,</span>
                                <span class="n">transfer_threshold</span><span class="p">,</span>
                                <span class="n">transfer_increment</span><span class="p">):</span>
    <span class="sd">"""Generate transfers of accumulated funds out of an account.</span>

<span class="sd">    This monitors the balance of an account and when it is beyond a threshold,</span>
<span class="sd">    generate out transfers form that account to another account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of existing entries that affect this account so far.</span>
<span class="sd">        The generated entries will also affect this account.</span>
<span class="sd">      account: An account string, the account to monitor.</span>
<span class="sd">      account_out: An account string, the savings account to make transfers to.</span>
<span class="sd">      transfer_minimum: The minimum amount of funds to always leave in this account</span>
<span class="sd">        after a transfer.</span>
<span class="sd">      transfer_threshold: The minimum amount of funds to be able to transfer out without</span>
<span class="sd">        breaking the minimum.</span>
<span class="sd">      transfer_increment: A Decimal, the increment to round transfers to.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new directives, the transfers to add to the given account.</span>
<span class="sd">    """</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>

    <span class="c1"># Reverse the balance amounts taking into account the minimum balance for</span>
    <span class="c1"># all time in the future.</span>
    <span class="n">amounts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">txn_posting</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">])]</span>
    <span class="n">reversed_amounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_amount</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">amounts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">current_amount</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">amounts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">current_amount</span> <span class="o">&lt;</span> <span class="n">last_amount</span><span class="p">:</span>
            <span class="n">reversed_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_amount</span><span class="p">)</span>
            <span class="n">last_amount</span> <span class="o">=</span> <span class="n">current_amount</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reversed_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_amount</span><span class="p">)</span>
    <span class="n">capped_amounts</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">reversed_amounts</span><span class="p">)</span>

    <span class="c1"># Create transfers outward where the future allows it.</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset_amount</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">for</span> <span class="n">current_amount</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">txn_posting</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">capped_amounts</span><span class="p">,</span> <span class="n">amounts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">last_date</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">adjusted_amount</span> <span class="o">=</span> <span class="n">current_amount</span> <span class="o">-</span> <span class="n">offset_amount</span>
        <span class="k">if</span> <span class="n">adjusted_amount</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">transfer_minimum</span> <span class="o">+</span> <span class="n">transfer_threshold</span><span class="p">):</span>
            <span class="n">amount_transfer</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span><span class="n">adjusted_amount</span> <span class="o">-</span> <span class="n">transfer_minimum</span><span class="p">,</span>
                                       <span class="n">transfer_increment</span><span class="p">)</span>

            <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">amount_transfer_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_transfer</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              </span><span class="si">{date}</span><span class="s2"> * "Transfering accumulated savings to other account"</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">          </span><span class="si">{amount_transfer_neg:2f}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{account_out}</span><span class="s2">      </span><span class="si">{amount_transfer:2f}</span><span class="s2"> CCY</span>
<span class="s2">            """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

            <span class="n">offset_amount</span> <span class="o">+=</span> <span class="n">amount_transfer</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_periodic_expenses">
<code class="highlight language-python">
generate_periodic_expenses<span class="p">(</span><span class="n">date_iter</span><span class="p">,</span> <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span> <span class="n">account_from</span><span class="p">,</span> <span class="n">account_to</span><span class="p">,</span> <span class="n">amount_generator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_periodic_expenses" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate periodic expense transactions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_iter</code></td>
<td><code></code></td>
<td>
<p>An iterator for dates or datetimes.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>payee</code></td>
<td><code></code></td>
<td>
<p>A string, the payee name to use on the transactions, or a set of such strings
to randomly choose from</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>narration</code></td>
<td><code></code></td>
<td>
<p>A string, the narration to use on the transactions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_from</code></td>
<td><code></code></td>
<td>
<p>An account string the debited account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_to</code></td>
<td><code></code></td>
<td>
<p>An account string the credited account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>amount_generator</code></td>
<td><code></code></td>
<td>
<p>A callable object to generate variates.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_periodic_expenses</span><span class="p">(</span><span class="n">date_iter</span><span class="p">,</span>
                               <span class="n">payee</span><span class="p">,</span> <span class="n">narration</span><span class="p">,</span>
                               <span class="n">account_from</span><span class="p">,</span> <span class="n">account_to</span><span class="p">,</span>
                               <span class="n">amount_generator</span><span class="p">):</span>
    <span class="sd">"""Generate periodic expense transactions.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_iter: An iterator for dates or datetimes.</span>
<span class="sd">      payee: A string, the payee name to use on the transactions, or a set of such strings</span>
<span class="sd">        to randomly choose from</span>
<span class="sd">      narration: A string, the narration to use on the transactions.</span>
<span class="sd">      account_from: An account string the debited account.</span>
<span class="sd">      account_to: An account string the credited account.</span>
<span class="sd">      amount_generator: A callable object to generate variates.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dtime</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtime</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">amount_generator</span><span class="p">())</span>
        <span class="n">txn_payee</span> <span class="o">=</span> <span class="p">(</span><span class="n">payee</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payee</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                     <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">payee</span><span class="p">))</span>
        <span class="n">txn_narration</span> <span class="o">=</span> <span class="p">(</span><span class="n">narration</span>
                         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">narration</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                         <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">narration</span><span class="p">))</span>
        <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          </span><span class="si">{date}</span><span class="s2"> * "</span><span class="si">{txn_payee}</span><span class="s2">" "</span><span class="si">{txn_narration}</span><span class="s2">"</span>
<span class="s2">            </span><span class="si">{account_from}</span><span class="s2">    </span><span class="si">{amount_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">            </span><span class="si">{account_to}</span><span class="s2">      </span><span class="si">{amount:.2f}</span><span class="s2"> CCY</span>
<span class="s2">        """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_prices">
<code class="highlight language-python">
generate_prices<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_prices" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate weekly or monthyl price entries for the given currencies.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currencies</code></td>
<td><code></code></td>
<td>
<p>A list of currency strings to generate prices for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cost_currency</code></td>
<td><code></code></td>
<td>
<p>A string, the cost currency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Price directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_prices</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">):</span>
    <span class="sd">"""Generate weekly or monthyl price entries for the given currencies.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      currencies: A list of currency strings to generate prices for.</span>
<span class="sd">      cost_currency: A string, the cost currency.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Price directives.</span>
<span class="sd">    """</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.01'</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">currencies</span><span class="p">:</span>
        <span class="n">start_price</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">growth</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">)</span> <span class="c1"># %/year</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">growth</span> <span class="o">*</span> <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">365</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span> <span class="c1"># Vol</span>

        <span class="k">for</span> <span class="n">dtime</span><span class="p">,</span> <span class="n">price_float</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">WEEKLY</span><span class="p">,</span> <span class="n">byweekday</span><span class="o">=</span><span class="n">rrule</span><span class="o">.</span><span class="n">FR</span><span class="p">,</span>
                                                  <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">),</span>
                                      <span class="n">price_series</span><span class="p">(</span><span class="n">start_price</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)):</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">price_float</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">new_metadata</span><span class="p">(</span><span class="n">generate_prices</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Price</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">dtime</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">currency</span><span class="p">,</span>
                               <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">cost_currency</span><span class="p">))</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_regular_credit_expenses">
<code class="highlight language-python">
generate_regular_credit_expenses<span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_regular_credit_expenses" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate expenses paid out of a credit card account, including payments to the
credit card.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_birth</code></td>
<td><code></code></td>
<td>
<p>The user's birth date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_credit</code></td>
<td><code></code></td>
<td>
<p>The credit card account to generate expenses against.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_checking</code></td>
<td><code></code></td>
<td>
<p>The checking account to generate payments from.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_regular_credit_expenses</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                     <span class="n">account_credit</span><span class="p">,</span>
                                     <span class="n">account_checking</span><span class="p">):</span>
    <span class="sd">"""Generate expenses paid out of a credit card account, including payments to the</span>
<span class="sd">    credit card.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: The user's birth date.</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">      account_credit: The credit card account to generate expenses against.</span>
<span class="sd">      account_checking: The checking account to generate payments from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">restaurant_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">RESTAURANT_NAMES</span><span class="p">,</span> <span class="n">RESTAURANT_NARRATIONS</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span> <span class="s1">'Expenses:Food:Restaurant'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">lognormvariate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)),</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">220</span><span class="p">)))</span>

    <span class="n">groceries_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">GROCERIES_NAMES</span><span class="p">,</span> <span class="s2">"Buying groceries"</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span> <span class="s1">'Expenses:Food:Groceries'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">lognormvariate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)),</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">)))</span>

    <span class="n">subway_expenses</span> <span class="o">=</span> <span class="n">generate_periodic_expenses</span><span class="p">(</span>
        <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span>
        <span class="s2">"Metro Transport Authority"</span><span class="p">,</span> <span class="s2">"Tram tickets"</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span> <span class="s1">'Expenses:Transport:Tram'</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">D</span><span class="p">(</span><span class="s1">'120.00'</span><span class="p">))</span>

    <span class="n">credit_expenses</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">restaurant_expenses</span> <span class="o">+</span>
                                  <span class="n">groceries_expenses</span> <span class="o">+</span>
                                  <span class="n">subway_expenses</span><span class="p">)</span>

    <span class="c1"># Entries to open accounts.</span>
    <span class="n">credit_preamble</span> <span class="o">=</span> <span class="n">generate_open_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="p">[</span><span class="n">account_credit</span><span class="p">],</span> <span class="s1">'CCY'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">credit_preamble</span> <span class="o">+</span> <span class="n">credit_expenses</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_retirement_employer_match">
<code class="highlight language-python">
generate_retirement_employer_match<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account_invest</span><span class="p">,</span> <span class="n">account_income</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_retirement_employer_match" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate employer matching contributions into a retirement account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives that cover the retirement account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_invest</code></td>
<td><code></code></td>
<td>
<p>The name of the retirement cash account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_income</code></td>
<td><code></code></td>
<td>
<p>The name of the income account.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of new entries generated for employer contributions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_retirement_employer_match</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account_invest</span><span class="p">,</span> <span class="n">account_income</span><span class="p">):</span>
    <span class="sd">"""Generate employer matching contributions into a retirement account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives that cover the retirement account.</span>
<span class="sd">      account_invest: The name of the retirement cash account.</span>
<span class="sd">      account_income: The name of the income account.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new entries generated for employer contributions.</span>
<span class="sd">    """</span>
    <span class="n">match_frac</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.50'</span><span class="p">)</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      </span><span class="si">{date}</span><span class="s2"> open </span><span class="si">{account_income}</span><span class="s2">   CCY</span>

<span class="s2">    """</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">account_income</span><span class="o">=</span><span class="n">account_income</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_invest</span><span class="p">]):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">match_frac</span>
        <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">ONE_DAY</span>
        <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">          </span><span class="si">{date}</span><span class="s2"> * "Employer match for contribution"</span>
<span class="s2">            </span><span class="si">{account_invest}</span><span class="s2">         </span><span class="si">{amount:.2f}</span><span class="s2"> CCY</span>
<span class="s2">            </span><span class="si">{account_income}</span><span class="s2">         </span><span class="si">{amount_neg:.2f}</span><span class="s2"> CCY</span>

<span class="s2">        """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_retirement_investments">
<code class="highlight language-python">
generate_retirement_investments<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">commodities_items</span><span class="p">,</span> <span class="n">price_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_retirement_investments" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Invest money deposited to the given retirement account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>The root account for all retirement investment sub-accounts.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>commodities_items</code></td>
<td><code></code></td>
<td>
<p>A list of (commodity, fraction to be invested in) items.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A dict of prices, as per beancount.core.prices.build_price_map().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of new directives for the given investments. This also generates account
opening directives for the desired investment commodities.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_retirement_investments</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">commodities_items</span><span class="p">,</span> <span class="n">price_map</span><span class="p">):</span>
    <span class="sd">"""Invest money deposited to the given retirement account.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives</span>
<span class="sd">      account: The root account for all retirement investment sub-accounts.</span>
<span class="sd">      commodities_items: A list of (commodity, fraction to be invested in) items.</span>
<span class="sd">      price_map: A dict of prices, as per beancount.core.prices.build_price_map().</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of new directives for the given investments. This also generates account</span>
<span class="sd">      opening directives for the desired investment commodities.</span>
<span class="sd">    """</span>
    <span class="n">open_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">account_cash</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">'Cash'</span><span class="p">)</span>
    <span class="n">date_origin</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
    <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      </span><span class="si">{date_origin}</span><span class="s2"> open </span><span class="si">{account}</span><span class="s2"> CCY</span>
<span class="s2">        institution: "Retirement_Institution"</span>
<span class="s2">        address: "Retirement_Address"</span>
<span class="s2">        phone: "Retirement_Phone"</span>

<span class="s2">      </span><span class="si">{date_origin}</span><span class="s2"> open </span><span class="si">{account_cash}</span><span class="s2"> CCY</span>
<span class="s2">        number: "882882"</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">commodities_items</span><span class="p">:</span>
        <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          </span><span class="si">{date_origin}</span><span class="s2"> open </span><span class="si">{account}</span><span class="s2">:</span><span class="si">{currency}</span><span class="s2"> </span><span class="si">{currency}</span><span class="s2"></span>
<span class="s2">            number: "882882"</span>
<span class="s2">        """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_cash</span><span class="p">]):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span>
        <span class="n">amount_to_invest</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>

        <span class="c1"># Find the date the following Monday, the date to invest.</span>
        <span class="n">txn_date</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span>
        <span class="k">while</span> <span class="n">txn_date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">!=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">MONDAY</span><span class="p">:</span>
            <span class="n">txn_date</span> <span class="o">+=</span> <span class="n">ONE_DAY</span>

        <span class="n">amount_invested</span> <span class="o">=</span> <span class="n">ZERO</span>
        <span class="k">for</span> <span class="n">commodity</span><span class="p">,</span> <span class="n">fraction</span> <span class="ow">in</span> <span class="n">commodities_items</span><span class="p">:</span>
            <span class="n">amount_fraction</span> <span class="o">=</span> <span class="n">amount_to_invest</span> <span class="o">*</span> <span class="n">D</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>

            <span class="c1"># Find the price at that date.</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="p">(</span><span class="n">commodity</span><span class="p">,</span> <span class="s1">'CCY'</span><span class="p">),</span> <span class="n">txn_date</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="p">(</span><span class="n">amount_fraction</span> <span class="o">/</span> <span class="n">price</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s1">'0.001'</span><span class="p">))</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="p">(</span><span class="n">units</span> <span class="o">*</span> <span class="n">price</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s1">'0.01'</span><span class="p">))</span>
            <span class="n">amount_cash_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_cash</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">              </span><span class="si">{txn_date}</span><span class="s2"> * "Investing </span><span class="si">{fraction:.0%}</span><span class="s2"> of cash in </span><span class="si">{commodity}</span><span class="s2">"</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">:</span><span class="si">{commodity}</span><span class="s2">  </span><span class="si">{units:.3f}</span><span class="s2"> </span><span class="si">{commodity}</span><span class="s2"> {{</span><span class="si">{price:.2f}</span><span class="s2"> CCY}}</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">:Cash         </span><span class="si">{amount_cash_neg:.2f}</span><span class="s2"> CCY</span>

<span class="s2">            """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

            <span class="n">balance</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">(</span><span class="o">-</span><span class="n">amount_cash</span><span class="p">,</span> <span class="s1">'CCY'</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">open_entries</span> <span class="o">+</span> <span class="n">new_entries</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_tax_accounts">
<code class="highlight language-python">
generate_tax_accounts<span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_max</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_tax_accounts" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate accounts and contributino directives for a particular tax year.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>year</code></td>
<td><code></code></td>
<td>
<p>An integer, the year we're to generate this for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_max</code></td>
<td><code></code></td>
<td>
<p>The maximum date to produce an entry for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_tax_accounts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_max</span><span class="p">):</span>
    <span class="sd">"""Generate accounts and contributino directives for a particular tax year.</span>

<span class="sd">    Args:</span>
<span class="sd">      year: An integer, the year we're to generate this for.</span>
<span class="sd">      date_max: The maximum date to produce an entry for.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">date_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">date_filing</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

    <span class="n">date_federal</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_filing</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="n">date_state</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_filing</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>

    <span class="n">quantum</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.01'</span><span class="p">)</span>
    <span class="n">amount_federal</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">quantum</span><span class="p">)</span>
    <span class="n">amount_federal_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_federal</span>
    <span class="n">amount_state</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">quantum</span><span class="p">)</span>
    <span class="n">amount_state_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_state</span>
    <span class="n">amount_payable</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">amount_federal</span> <span class="o">+</span> <span class="n">amount_state</span><span class="p">)</span>

    <span class="n">amount_limit</span> <span class="o">=</span> <span class="n">RETIREMENT_LIMITS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">RETIREMENT_LIMITS</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
    <span class="n">amount_limit_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_limit</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      ;; Open tax accounts for that year.</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Federal:PreTax401k   DEFCCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Medicare             CCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Federal              CCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:CityNYC              CCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:SDI                  CCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:State                CCY</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> open Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:SocSec               CCY</span>

<span class="s2">      ;; Check that the tax amounts have been fully used.</span>
<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> balance Assets:CC:Federal:PreTax401k  0 DEFCCY</span>

<span class="s2">      </span><span class="si">{date_year}</span><span class="s2"> * "Allowed contributions for one year"</span>
<span class="s2">        Income:CC:Federal:PreTax401k     </span><span class="si">{amount_limit_neg}</span><span class="s2"> DEFCCY</span>
<span class="s2">        Assets:CC:Federal:PreTax401k     </span><span class="si">{amount_limit}</span><span class="s2"> DEFCCY</span>

<span class="s2">      </span><span class="si">{date_filing}</span><span class="s2"> * "Filing taxes for </span><span class="si">{year}</span><span class="s2">"</span>
<span class="s2">        Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:Federal      </span><span class="si">{amount_federal:.2f}</span><span class="s2"> CCY</span>
<span class="s2">        Expenses:Taxes:Y</span><span class="si">{year}</span><span class="s2">:CC:State        </span><span class="si">{amount_state:.2f}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable            </span><span class="si">{amount_payable:.2f}</span><span class="s2"> CCY</span>

<span class="s2">      </span><span class="si">{date_federal}</span><span class="s2"> * "FEDERAL TAXPYMT"</span>
<span class="s2">        Assets:CC:Bank1:Checking       </span><span class="si">{amount_federal_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable    </span><span class="si">{amount_federal:.2f}</span><span class="s2"> CCY</span>

<span class="s2">      </span><span class="si">{date_state}</span><span class="s2"> * "STATE TAX &amp; FINANC PYMT"</span>
<span class="s2">        Assets:CC:Bank1:Checking       </span><span class="si">{amount_state_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">        Liabilities:AccountsPayable    </span><span class="si">{amount_state:.2f}</span><span class="s2"> CCY</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_max</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_tax_preamble">
<code class="highlight language-python">
generate_tax_preamble<span class="p">(</span><span class="n">date_birth</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_tax_preamble" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate tax declarations not specific to any particular year.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_birth</code></td>
<td><code></code></td>
<td>
<p>A date instance, the birth date of the character.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>523
524
525
526
527
528
529
530
531
532
533
534
535
536</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_tax_preamble</span><span class="p">(</span><span class="n">date_birth</span><span class="p">):</span>
    <span class="sd">"""Generate tax declarations not specific to any particular year.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A date instance, the birth date of the character.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      ;; Tax accounts not specific to a year.</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Income:CC:Federal:PreTax401k     DEFCCY</span>
<span class="s2">      </span><span class="si">{date_birth}</span><span class="s2"> open Assets:CC:Federal:PreTax401k     DEFCCY</span>

<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_taxable_investment">
<code class="highlight language-python">
generate_taxable_investment<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">stocks</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_taxable_investment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate opening directives and transactions for an investment account.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>A date instance, the beginning date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>A date instance, the end date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries that contains at least the transfers to the investment
account's cash account.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>price_map</code></td>
<td><code></code></td>
<td>
<p>A dict of prices, as per beancount.core.prices.build_price_map().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>stocks</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the list of commodities to invest in.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_taxable_investment</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span> <span class="n">stocks</span><span class="p">):</span>
    <span class="sd">"""Generate opening directives and transactions for an investment account.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: A date instance, the beginning date.</span>
<span class="sd">      date_end: A date instance, the end date.</span>
<span class="sd">      entries: A list of entries that contains at least the transfers to the investment</span>
<span class="sd">        account's cash account.</span>
<span class="sd">      price_map: A dict of prices, as per beancount.core.prices.build_price_map().</span>
<span class="sd">      stocks: A list of strings, the list of commodities to invest in.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directives.</span>
<span class="sd">    """</span>
    <span class="n">account</span> <span class="o">=</span> <span class="s1">'Assets:CC:Investment'</span>
    <span class="n">account_cash</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">'Cash'</span><span class="p">)</span>
    <span class="n">account_gains</span> <span class="o">=</span> <span class="s1">'Income:CC:Investment:Gains'</span>
    <span class="n">account_dividends</span> <span class="o">=</span> <span class="s1">'Income:CC:Investment:Dividends'</span>
    <span class="n">accounts_stocks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Assets:CC:Investment:</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commodity</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">stocks</span><span class="p">]</span>

    <span class="n">open_entries</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> open </span><span class="si">{account}</span><span class="s2">:Cash    CCY</span>
<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> open </span><span class="si">{account_gains}</span><span class="s2">    CCY</span>
<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> open </span><span class="si">{account_dividends}</span><span class="s2">    CCY</span>
<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">stocks</span><span class="p">:</span>
        <span class="n">open_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          </span><span class="si">{date_begin}</span><span class="s2"> open </span><span class="si">{account}</span><span class="s2">:</span><span class="si">{stock}</span><span class="s2"> </span><span class="si">{stock}</span><span class="s2"></span>
<span class="s2">        """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># Figure out dates at which dividends should be distributed, near the end of</span>
    <span class="c1"># each quarter.</span>
    <span class="n">days_to</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="mi">90</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">dividend_dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">quarter_begin</span> <span class="ow">in</span> <span class="n">iter_quarters</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="n">end_of_quarter</span> <span class="o">=</span> <span class="n">quarter_begin</span> <span class="o">+</span> <span class="n">days_to</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">date_begin</span> <span class="o">&lt;</span> <span class="n">end_of_quarter</span> <span class="o">&lt;</span> <span class="n">date_end</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">dividend_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_of_quarter</span><span class="p">)</span>

    <span class="c1"># Iterate over all the dates, but merging in the postings for the cash</span>
    <span class="c1"># account.</span>
    <span class="n">min_amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'1000.00'</span><span class="p">)</span>
    <span class="n">round_amount</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'100.00'</span><span class="p">)</span>
    <span class="n">commission</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'8.95'</span><span class="p">)</span>
    <span class="n">round_units</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
    <span class="n">frac_invest</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'1.00'</span><span class="p">)</span>
    <span class="n">frac_dividend</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s1">'0.004'</span><span class="p">)</span>
    <span class="n">p_daily_buy</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">15</span>  <span class="c1"># days</span>
    <span class="n">p_daily_sell</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">90</span>  <span class="c1"># days</span>

    <span class="n">stocks_inventory</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dividend_date_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dividend_dates</span><span class="p">)</span>
    <span class="n">next_dividend_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dividend_date_iter</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">iter_dates_with_balance</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                                  <span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account_cash</span><span class="p">]):</span>

        <span class="c1"># Check if we should insert a dividend. Note that we could not factor</span>
        <span class="c1"># this out because we want to explicitly reinvest the cash dividends and</span>
        <span class="c1"># we also want the dividends to be proportional to the amount of</span>
        <span class="c1"># invested stock, so one feeds on the other and vice-versa.</span>
        <span class="k">if</span> <span class="n">next_dividend_date</span> <span class="ow">and</span> <span class="n">date</span> <span class="o">&gt;</span> <span class="n">next_dividend_date</span><span class="p">:</span>
            <span class="c1"># Compute the total balances for the stock accounts in order to</span>
            <span class="c1"># create a realistic dividend.</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">account_stock</span> <span class="ow">in</span> <span class="n">accounts_stocks</span><span class="p">:</span>
                <span class="n">total</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">account_stock</span><span class="p">])</span>

            <span class="c1"># Create an entry offering dividends of 1% of the portfolio.</span>
            <span class="n">portfolio_cost</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">)</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="p">(</span><span class="n">frac_dividend</span> <span class="o">*</span> <span class="n">portfolio_cost</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s1">'0.01'</span><span class="p">))</span>
            <span class="n">amount_cash_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount_cash</span>
            <span class="n">dividend</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              </span><span class="si">{next_dividend_date}</span><span class="s2"> * "Dividends on portfolio"</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">:Cash        </span><span class="si">{amount_cash:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{account_dividends}</span><span class="s2">   </span><span class="si">{amount_cash_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">            """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dividend</span><span class="p">)</span>

            <span class="c1"># Advance the next dividend date.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">next_dividend_date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dividend_date_iter</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="n">next_dividend_date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If the balance is high, buy with high probability.</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span>
        <span class="n">total_cash</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
        <span class="k">assert</span> <span class="n">total_cash</span> <span class="o">&gt;=</span> <span class="n">ZERO</span><span class="p">,</span> <span class="p">(</span><span class="s1">'Cash balance is negative: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_cash</span><span class="p">))</span>
        <span class="n">invest_cash</span> <span class="o">=</span> <span class="n">total_cash</span> <span class="o">*</span> <span class="n">frac_invest</span> <span class="o">-</span> <span class="n">commission</span>
        <span class="k">if</span> <span class="n">invest_cash</span> <span class="o">&gt;</span> <span class="n">min_amount</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_daily_buy</span><span class="p">:</span>
                <span class="n">commodities</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">stocks</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stocks</span><span class="p">)))</span>
                <span class="n">lot_amount</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span><span class="n">invest_cash</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">commodities</span><span class="p">),</span> <span class="n">round_amount</span><span class="p">)</span>

                <span class="n">invested_amount</span> <span class="o">=</span> <span class="n">ZERO</span>
                <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">commodities</span><span class="p">:</span>
                    <span class="c1"># Find the price at that date.</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="s1">'CCY'</span><span class="p">),</span> <span class="n">date</span><span class="p">)</span>

                    <span class="n">units</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">((</span><span class="n">lot_amount</span> <span class="o">/</span> <span class="n">price</span><span class="p">),</span> <span class="n">round_units</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">units</span> <span class="o">&lt;=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">amount_cash</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">units</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="n">commission</span><span class="p">)</span>
                    <span class="c1"># logging.info('Buying %s %s @ %s CCY = %s CCY',</span>
                    <span class="c1">#              units, stock, price, units * price)</span>

                    <span class="n">buy</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">                      </span><span class="si">{date}</span><span class="s2"> * "Buy shares of </span><span class="si">{stock}</span><span class="s2">"</span>
<span class="s2">                        </span><span class="si">{account}</span><span class="s2">:Cash                  </span><span class="si">{amount_cash:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                        </span><span class="si">{account}</span><span class="s2">:</span><span class="si">{stock}</span><span class="s2">               </span><span class="si">{units:.0f}</span><span class="s2"> </span><span class="si">{stock}</span><span class="s2"> {{</span><span class="si">{price:.2f}</span><span class="s2"> CCY}}</span>
<span class="s2">                        Expenses:Financial:Commissions  </span><span class="si">{commission:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buy</span><span class="p">)</span>

                    <span class="n">account_stock</span> <span class="o">=</span> <span class="s1">':'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">account</span><span class="p">,</span> <span class="n">stock</span><span class="p">])</span>
                    <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">balances</span><span class="p">[</span><span class="n">account_stock</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">buy</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Don't sell on days you buy.</span>
                <span class="k">continue</span>

        <span class="c1"># Otherwise, sell with low probability.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_daily_sell</span><span class="p">:</span>
            <span class="c1"># Choose the lot with the highest gain or highest loss.</span>
            <span class="n">gains</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">get_positions</span><span class="p">():</span>
                <span class="n">base_quote</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">price_map</span><span class="p">,</span> <span class="n">base_quote</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">price</span> <span class="o">==</span> <span class="n">position</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
                    <span class="k">continue</span> <span class="c1"># Skip lots without movement.</span>
                <span class="n">market_value</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">number</span> <span class="o">*</span> <span class="n">price</span>
                <span class="n">book_value</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">get_cost</span><span class="p">(</span><span class="n">position</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
                <span class="n">gain</span> <span class="o">=</span> <span class="n">market_value</span> <span class="o">-</span> <span class="n">book_value</span>
                <span class="n">gains</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gain</span><span class="p">,</span> <span class="n">market_value</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gains</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Sell either biggest winner or biggest loser.</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lot_tuple</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gains</span><span class="p">)[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">biggest</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">gain</span><span class="p">,</span> <span class="n">market_value</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sell_position</span> <span class="o">=</span> <span class="n">lot_tuple</span>
            <span class="c1">#logging.info('Selling {} for {}'.format(sell_position, market_value))</span>

            <span class="n">sell_position</span> <span class="o">=</span> <span class="o">-</span><span class="n">sell_position</span>
            <span class="n">stock</span> <span class="o">=</span> <span class="n">sell_position</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span>
            <span class="n">amount_cash</span> <span class="o">=</span> <span class="n">market_value</span> <span class="o">-</span> <span class="n">commission</span>
            <span class="n">amount_gain</span> <span class="o">=</span> <span class="o">-</span><span class="n">gain</span>
            <span class="n">sell</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              </span><span class="si">{date}</span><span class="s2"> * "Sell shares of </span><span class="si">{stock}</span><span class="s2">"</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">:</span><span class="si">{stock}</span><span class="s2">               </span><span class="si">{sell_position}</span><span class="s2"> @ </span><span class="si">{price:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{account}</span><span class="s2">:Cash                  </span><span class="si">{amount_cash:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                Expenses:Financial:Commissions  </span><span class="si">{commission:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                </span><span class="si">{account_gains}</span><span class="s2">                 </span><span class="si">{amount_gain:.2f}</span><span class="s2"> CCY</span>
<span class="s2">            """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sell</span><span class="p">)</span>

            <span class="n">balances</span><span class="p">[</span><span class="n">account_cash</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">sell</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">stocks_inventory</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">sell</span><span class="o">.</span><span class="n">postings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">open_entries</span> <span class="o">+</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.generate_trip_entries">
<code class="highlight language-python">
generate_trip_entries<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">trip_city</span><span class="p">,</span> <span class="n">home_city</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.generate_trip_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate more dense expenses for a trip.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the beginning of the trip.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the end of the trip.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>tag</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the tag.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>config</code></td>
<td><code></code></td>
<td>
<p>A list of (payee name, account name, (mu, 3sigma)), where
mu is the mean of the prices to generate and 3sigma is 3 times
the standard deviation.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>trip_city</code></td>
<td><code></code></td>
<td>
<p>A string, the capitalized name of the destination city.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>home_city</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the home city.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account_credit</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the credit card account to pay
the expenses from.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of entries for the trip, all tagged with the given tag.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_trip_entries</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                          <span class="n">tag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span>
                          <span class="n">trip_city</span><span class="p">,</span> <span class="n">home_city</span><span class="p">,</span>
                          <span class="n">account_credit</span><span class="p">):</span>
    <span class="sd">"""Generate more dense expenses for a trip.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: A datetime.date instance, the beginning of the trip.</span>
<span class="sd">      date_end: A datetime.date instance, the end of the trip.</span>
<span class="sd">      tag: A string, the name of the tag.</span>
<span class="sd">      config: A list of (payee name, account name, (mu, 3sigma)), where</span>
<span class="sd">        mu is the mean of the prices to generate and 3sigma is 3 times</span>
<span class="sd">        the standard deviation.</span>
<span class="sd">      trip_city: A string, the capitalized name of the destination city.</span>
<span class="sd">      home_city: A string, the name of the home city.</span>
<span class="sd">      account_credit: A string, the name of the credit card account to pay</span>
<span class="sd">        the expenses from.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of entries for the trip, all tagged with the given tag.</span>
<span class="sd">    """</span>
    <span class="n">p_day_generate</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">payee</span><span class="p">,</span> <span class="n">account_expense</span><span class="p">,</span> <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_day_generate</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma3</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
                <span class="n">amount_neg</span> <span class="o">=</span> <span class="o">-</span><span class="n">amount</span>
                <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">                  </span><span class="si">{date}</span><span class="s2"> * "</span><span class="si">{payee}</span><span class="s2">" "" #</span><span class="si">{tag}</span><span class="s2"></span>
<span class="s2">                    </span><span class="si">{account_credit}</span><span class="s2">     </span><span class="si">{amount_neg:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                    </span><span class="si">{account_expense}</span><span class="s2">    </span><span class="si">{amount:.2f}</span><span class="s2"> CCY</span>
<span class="s2">                """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># Consume the vacation days.</span>
    <span class="n">vacation_hrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_end</span> <span class="o">-</span> <span class="n">date_begin</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">8</span> <span class="c1"># hrs/day</span>
    <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      </span><span class="si">{date_end}</span><span class="s2"> * "Consume vacation days"</span>
<span class="s2">        Assets:CC:Employer1:Vacation -</span><span class="si">{vacation_hrs:.2f}</span><span class="s2"> VACHR</span>
<span class="s2">        Expenses:Vacation             </span><span class="si">{vacation_hrs:.2f}</span><span class="s2"> VACHR</span>
<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># Generate events for the trip.</span>
    <span class="n">new_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      </span><span class="si">{date_begin}</span><span class="s2"> event "location" "</span><span class="si">{trip_city}</span><span class="s2">"</span>
<span class="s2">      </span><span class="si">{date_end}</span><span class="s2">   event "location" "</span><span class="si">{home_city}</span><span class="s2">"</span>
<span class="s2">    """</span><span class="p">,</span> <span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">new_entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.get_minimum_balance">
<code class="highlight language-python">
get_minimum_balance<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.get_minimum_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the minimum balance of the given account according to the entries history.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>account</code></td>
<td><code></code></td>
<td>
<p>An account string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A currency string, for which we want to compute the minimum.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A Decimal number, the minimum amount throughout the history of this account.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_minimum_balance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Compute the minimum balance of the given account according to the entries history.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      account: An account string.</span>
<span class="sd">      currency: A currency string, for which we want to compute the minimum.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Decimal number, the minimum amount throughout the history of this account.</span>
<span class="sd">    """</span>
    <span class="n">min_amount</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">balances</span> <span class="ow">in</span> <span class="n">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">account</span><span class="p">]):</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">balance</span><span class="o">.</span><span class="n">get_currency_units</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">min_amount</span><span class="p">:</span>
            <span class="n">min_amount</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">return</span> <span class="n">min_amount</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.iter_dates_with_balance">
<code class="highlight language-python">
iter_dates_with_balance<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.iter_dates_with_balance" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Iterate over dates, including the balances of the postings iterator.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postings_iter</code></td>
<td><code></code></td>
<td>
<p>An iterator of postings as per postings_for().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Pairs of (data, balances) objects, with
    date: A datetime.date instance
    balances: An Inventory object, representing the current balance.
      You can modify the inventory object to feed back changes in the
      balance.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_dates_with_balance</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">):</span>
    <span class="sd">"""Iterate over dates, including the balances of the postings iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">      postings_iter: An iterator of postings as per postings_for().</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Pairs of (data, balances) objects, with</span>
<span class="sd">        date: A datetime.date instance</span>
<span class="sd">        balances: An Inventory object, representing the current balance.</span>
<span class="sd">          You can modify the inventory object to feed back changes in the</span>
<span class="sd">          balance.</span>
<span class="sd">    """</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="n">merged_txn_postings</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">))</span>
    <span class="n">txn_posting</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">merged_txn_postings</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_iter</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">txn_posting</span> <span class="ow">and</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">date</span><span class="p">:</span>
            <span class="n">posting</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
            <span class="n">txn_posting</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">merged_txn_postings</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">date</span><span class="p">,</span> <span class="n">balances</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.iter_quarters">
<code class="highlight language-python">
iter_quarters<span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.iter_quarters" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Iterate over all quarters between begin and end dates.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>The start date.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>The end date.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Instances of datetime.date at the beginning of the quarters. This will
  include the quarter of the beginning date and of the end date.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">iter_quarters</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">):</span>
    <span class="sd">"""Iterate over all quarters between begin and end dates.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_begin: The start date.</span>
<span class="sd">      date_end: The end date.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Instances of datetime.date at the beginning of the quarters. This will</span>
<span class="sd">      include the quarter of the beginning date and of the end date.</span>
<span class="sd">    """</span>
    <span class="n">quarter</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_begin</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="n">date_begin</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">quarter_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">date_end</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="n">date_end</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">quarter</span> <span class="o">&lt;=</span> <span class="n">quarter_last</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">trimester</span> <span class="o">=</span> <span class="n">quarter</span>
        <span class="k">yield</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">trimester</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quarter</span> <span class="o">==</span> <span class="n">quarter_last</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">trimester</span> <span class="o">=</span> <span class="p">(</span><span class="n">trimester</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">trimester</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">quarter</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">trimester</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.merge_postings">
<code class="highlight language-python">
merge_postings<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.merge_postings" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Merge all the postings from the given account names.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>accounts</code></td>
<td><code></code></td>
<td>
<p>A list of account strings to get the balances for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  A list of TxnPosting's for all the accounts, in sorted order.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">):</span>
    <span class="sd">"""Merge all the postings from the given account names.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      accounts: A list of account strings to get the balances for.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A list of TxnPosting's for all the accounts, in sorted order.</span>
<span class="sd">    """</span>
    <span class="n">real_root</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">merged_postings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">real_account</span> <span class="o">=</span> <span class="n">realization</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">real_root</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">real_account</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">merged_postings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">txn_posting</span>
                               <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">real_account</span><span class="o">.</span><span class="n">txn_postings</span>
                               <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">txn_posting</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">TxnPosting</span><span class="p">))</span>
    <span class="n">merged_postings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">txn_posting</span><span class="p">:</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">txn</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged_postings</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.parse">
<code class="highlight language-python">
parse<span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.parse" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Parse some input string and assert no errors.</p>
<p>This parse function does not just create the object, it also triggers local
interpolation to fill in the missing amounts.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_string</code></td>
<td><code></code></td>
<td>
<p>Beancount input text.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>**replacements</code></td>
<td><code></code></td>
<td>
<p>A dict of keywords to replace to their values.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of directive objects.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">):</span>
    <span class="sd">"""Parse some input string and assert no errors.</span>

<span class="sd">    This parse function does not just create the object, it also triggers local</span>
<span class="sd">    interpolation to fill in the missing amounts.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_string: Beancount input text.</span>
<span class="sd">      **replacements: A dict of keywords to replace to their values.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of directive objects.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">replacements</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">string</span>
        <span class="k">class</span> <span class="nc">IgnoreFormatter</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">check_unused_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">used_args</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">IgnoreFormatter</span><span class="p">()</span>
        <span class="n">formatted_string</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="o">**</span><span class="n">replacements</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted_string</span> <span class="o">=</span> <span class="n">input_string</span>

    <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">formatted_string</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Parsed text has errors"</span><span class="p">)</span>

    <span class="c1"># Interpolation.</span>
    <span class="n">entries</span><span class="p">,</span> <span class="n">unused_balance_errors</span> <span class="o">=</span> <span class="n">booking</span><span class="o">.</span><span class="n">book</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.postings_for">
<code class="highlight language-python">
postings_for<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.postings_for" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Realize the entries and get the list of postings for the given accounts.</p>
<p>All the non-Posting directives are already filtered out.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>accounts</code></td>
<td><code></code></td>
<td>
<p>A list of account strings to get the balances for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>before</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, yield the balance before the position is applied.
The default is to yield the balance after applying the position.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p>Yields:
  Tuples of:
    posting: An instance of TxnPosting
    balances: A dict of Inventory balances for the given accounts <em>after</em>
      applying the posting. These inventory objects can be mutated to adjust
      the balance due to generated transactions to be applied later.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">postings_for</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Realize the entries and get the list of postings for the given accounts.</span>

<span class="sd">    All the non-Posting directives are already filtered out.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      accounts: A list of account strings to get the balances for.</span>
<span class="sd">      before: A boolean, if true, yield the balance before the position is applied.</span>
<span class="sd">        The default is to yield the balance after applying the position.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Tuples of:</span>
<span class="sd">        posting: An instance of TxnPosting</span>
<span class="sd">        balances: A dict of Inventory balances for the given accounts _after_</span>
<span class="sd">          applying the posting. These inventory objects can be mutated to adjust</span>
<span class="sd">          the balance due to generated transactions to be applied later.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accounts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">merged_txn_postings</span> <span class="o">=</span> <span class="n">merge_postings</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">accounts</span><span class="p">)</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">txn_posting</span> <span class="ow">in</span> <span class="n">merged_txn_postings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span>
        <span class="n">posting</span> <span class="o">=</span> <span class="n">txn_posting</span><span class="o">.</span><span class="n">posting</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">txn_posting</span><span class="p">,</span> <span class="n">balances</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.price_series">
<code class="highlight language-python">
price_series<span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.price_series" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a price series based on a simple stochastic model.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start</code></td>
<td><code></code></td>
<td>
<p>The beginning value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mu</code></td>
<td><code></code></td>
<td>
<p>The per-step drift, in units of value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sigma</code></td>
<td><code></code></td>
<td>
<p>Volatility of the changes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Floats, at each step.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">price_series</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">"""Generate a price series based on a simple stochastic model.</span>

<span class="sd">    Args:</span>
<span class="sd">      start: The beginning value.</span>
<span class="sd">      mu: The per-step drift, in units of value.</span>
<span class="sd">      sigma: Volatility of the changes.</span>
<span class="sd">    Yields:</span>
<span class="sd">      Floats, at each step.</span>
<span class="sd">    """</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">normalvariate</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.replace">
<code class="highlight language-python">
replace<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.replace" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Apply word-boundaried regular expression replacements to an indented string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>Some input template string.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>replacements</code></td>
<td><code></code></td>
<td>
<p>A dict of regexp to replacement value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>strip</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should strip the input.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The input string with the replacements applied to it, with the indentation removed.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Apply word-boundaried regular expression replacements to an indented string.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Some input template string.</span>
<span class="sd">      replacements: A dict of regexp to replacement value.</span>
<span class="sd">      strip: A boolean, true if we should strip the input.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The input string with the replacements applied to it, with the indentation removed.</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">from_</span><span class="p">,</span> <span class="n">to_</span> <span class="ow">in</span> <span class="n">replacements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">to_</span><span class="p">):</span>
            <span class="n">to_</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\b</span><span class="si">{}</span><span class="s1">\b'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_</span><span class="p">),</span> <span class="n">to_</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.validate_output">
<code class="highlight language-python">
validate_output<span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">positive_accounts</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.validate_output" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check that the output file validates.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contents</code></td>
<td><code></code></td>
<td>
<p>A string, the output file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>positive_accounts</code></td>
<td><code></code></td>
<td>
<p>A list of strings, account names to check for
non-negative balances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>currency</code></td>
<td><code></code></td>
<td>
<p>A string, the currency to check minimums for.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the output does not validate.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">validate_output</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">positive_accounts</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
    <span class="sd">"""Check that the output file validates.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, the output file.</span>
<span class="sd">      positive_accounts: A list of strings, account names to check for</span>
<span class="sd">        non-negative balances.</span>
<span class="sd">      currency: A string, the currency to check minimums for.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the output does not validate.</span>
<span class="sd">    """</span>
    <span class="n">loaded_entries</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span>
        <span class="n">contents</span><span class="p">,</span>
        <span class="n">log_errors</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
        <span class="n">extra_validations</span><span class="o">=</span><span class="n">validation</span><span class="o">.</span><span class="n">HARDCORE_VALIDATIONS</span><span class="p">)</span>

    <span class="c1"># Sanity checks: Check that the checking balance never goes below zero.</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">positive_accounts</span><span class="p">:</span>
        <span class="n">check_non_negative</span><span class="p">(</span><span class="n">loaded_entries</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.example.write_example_file">
<code class="highlight language-python">
write_example_file<span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">reformat</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.example.write_example_file" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate the example file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>date_birth</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the birth date of our character.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_begin</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the beginning date at which to generate
transactions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>date_end</code></td>
<td><code></code></td>
<td>
<p>A datetime.date instance, the end date at which to generate
transactions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>reformat</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should apply global reformatting to this file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object, where to write out the output.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/example.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write_example_file</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">reformat</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="sd">"""Generate the example file.</span>

<span class="sd">    Args:</span>
<span class="sd">      date_birth: A datetime.date instance, the birth date of our character.</span>
<span class="sd">      date_begin: A datetime.date instance, the beginning date at which to generate</span>
<span class="sd">        transactions.</span>
<span class="sd">      date_end: A datetime.date instance, the end date at which to generate</span>
<span class="sd">        transactions.</span>
<span class="sd">      reformat: A boolean, true if we should apply global reformatting to this file.</span>
<span class="sd">      file: A file object, where to write out the output.</span>
<span class="sd">    """</span>
    <span class="c1"># The following code entirely writes out the output to generic names, such</span>
    <span class="c1"># as "Employer1", "Bank1", and "CCY" (for principal currency). Those names</span>
    <span class="c1"># are purposely chosen to be unique, and only near the very end do we make</span>
    <span class="c1"># renamings to more specific and realistic names.</span>

    <span class="c1"># Name of the checking account.</span>
    <span class="n">account_opening</span> <span class="o">=</span> <span class="s1">'Equity:Opening-Balances'</span>
    <span class="n">account_payable</span> <span class="o">=</span> <span class="s1">'Liabilities:AccountsPayable'</span>
    <span class="n">account_checking</span> <span class="o">=</span> <span class="s1">'Assets:CC:Bank1:Checking'</span>
    <span class="n">account_credit</span> <span class="o">=</span> <span class="s1">'Liabilities:CC:CreditCard1'</span>
    <span class="n">account_retirement</span> <span class="o">=</span> <span class="s1">'Assets:CC:Retirement'</span>
    <span class="n">account_investing</span> <span class="o">=</span> <span class="s1">'Assets:CC:Investment:Cash'</span>

    <span class="c1"># Commodities.</span>
    <span class="n">commodity_entries</span> <span class="o">=</span> <span class="n">generate_commodity_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="c1"># Estimate the rent.</span>
    <span class="n">rent_amount</span> <span class="o">=</span> <span class="n">round_to</span><span class="p">(</span><span class="n">ANNUAL_SALARY</span> <span class="o">/</span> <span class="n">RENT_DIVISOR</span><span class="p">,</span> <span class="n">RENT_INCREMENT</span><span class="p">)</span>

    <span class="c1"># Get a random employer.</span>
    <span class="n">employer_name</span><span class="p">,</span> <span class="n">employer_address</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">EMPLOYERS</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Salary Employment Income"</span><span class="p">)</span>
    <span class="n">income_entries</span> <span class="o">=</span> <span class="n">generate_employment_income</span><span class="p">(</span><span class="n">employer_name</span><span class="p">,</span> <span class="n">employer_address</span><span class="p">,</span>
                                                <span class="n">ANNUAL_SALARY</span><span class="p">,</span>
                                                <span class="n">account_checking</span><span class="p">,</span>
                                                <span class="n">join</span><span class="p">(</span><span class="n">account_retirement</span><span class="p">,</span> <span class="s1">'Cash'</span><span class="p">),</span>
                                                <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Expenses from Banking Accounts"</span><span class="p">)</span>
    <span class="n">banking_expenses</span> <span class="o">=</span> <span class="n">generate_banking_expenses</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                                 <span class="n">account_checking</span><span class="p">,</span> <span class="n">rent_amount</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Regular Expenses via Credit Card"</span><span class="p">)</span>
    <span class="n">credit_regular_entries</span> <span class="o">=</span> <span class="n">generate_regular_credit_expenses</span><span class="p">(</span>
        <span class="n">date_birth</span><span class="p">,</span> <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Credit Card Expenses for Trips"</span><span class="p">)</span>
    <span class="n">trip_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">destinations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">TRIP_DESTINATIONS</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">destinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">date_trip_begin</span><span class="p">,</span> <span class="n">date_trip_end</span><span class="p">),</span> <span class="p">(</span><span class="n">destination_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">compute_trip_dates</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">),</span> <span class="n">destinations</span><span class="p">):</span>

        <span class="c1"># Compute a suitable tag.</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s1">'trip-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">destination_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">),</span>
                                  <span class="n">date_trip_begin</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="c1">#logging.info("%s -- %s %s", tag, date_trip_begin, date_trip_end)</span>

        <span class="c1"># Remove regular entries during this trip.</span>
        <span class="n">credit_regular_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span>
                                  <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">credit_regular_entries</span>
                                  <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">date_trip_begin</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">date_trip_end</span><span class="p">)]</span>

        <span class="c1"># Generate entries for the trip.</span>
        <span class="n">this_trip_entries</span> <span class="o">=</span> <span class="n">generate_trip_entries</span><span class="p">(</span>
            <span class="n">date_trip_begin</span><span class="p">,</span> <span class="n">date_trip_end</span><span class="p">,</span>
            <span class="n">tag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span>
            <span class="n">destination_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">HOME_NAME</span><span class="p">,</span>
            <span class="n">account_credit</span><span class="p">)</span>

        <span class="n">trip_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">this_trip_entries</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Credit Card Payment Entries"</span><span class="p">)</span>
    <span class="n">credit_payments</span> <span class="o">=</span> <span class="n">generate_clearing_entries</span><span class="p">(</span>
        <span class="n">delay_dates</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">rrule</span><span class="p">(</span><span class="n">rrule</span><span class="o">.</span><span class="n">MONTHLY</span><span class="p">,</span>
                                <span class="n">dtstart</span><span class="o">=</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">date_end</span><span class="p">,</span> <span class="n">bymonthday</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s2">"CreditCard1"</span><span class="p">,</span> <span class="s2">"Paying off credit card"</span><span class="p">,</span>
        <span class="n">credit_regular_entries</span><span class="p">,</span>
        <span class="n">account_credit</span><span class="p">,</span> <span class="n">account_checking</span><span class="p">)</span>

    <span class="n">credit_entries</span> <span class="o">=</span> <span class="n">credit_regular_entries</span> <span class="o">+</span> <span class="n">trip_entries</span> <span class="o">+</span> <span class="n">credit_payments</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Tax Filings and Payments"</span><span class="p">)</span>
    <span class="n">tax_preamble</span> <span class="o">=</span> <span class="n">generate_tax_preamble</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="c1"># Figure out all the years we need tax accounts for.</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">account_name</span> <span class="ow">in</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_accounts</span><span class="p">(</span><span class="n">income_entries</span><span class="p">):</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Expenses:Taxes:Y(\d\d\d\d)'</span><span class="p">,</span> <span class="n">account_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">years</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="n">taxes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">year</span><span class="p">,</span> <span class="n">generate_tax_accounts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">date_end</span><span class="p">))</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">years</span><span class="p">)]</span>
    <span class="n">tax_entries</span> <span class="o">=</span> <span class="n">tax_preamble</span> <span class="o">+</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="n">entries</span>
                                                   <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">taxes</span><span class="p">))</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Opening of Banking Accounts"</span><span class="p">)</span>
    <span class="c1"># Open banking accounts and gift the checking account with a balance that</span>
    <span class="c1"># will offset all the amounts to ensure a positive balance throughout its</span>
    <span class="c1"># lifetime.</span>
    <span class="n">entries_for_banking</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">income_entries</span> <span class="o">+</span>
                                      <span class="n">banking_expenses</span> <span class="o">+</span>
                                      <span class="n">credit_entries</span> <span class="o">+</span>
                                      <span class="n">tax_entries</span><span class="p">)</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">get_minimum_balance</span><span class="p">(</span><span class="n">entries_for_banking</span><span class="p">,</span>
                                  <span class="n">account_checking</span><span class="p">,</span> <span class="s1">'CCY'</span><span class="p">)</span>
    <span class="n">banking_entries</span> <span class="o">=</span> <span class="n">generate_banking</span><span class="p">(</span><span class="n">entries_for_banking</span><span class="p">,</span>
                                       <span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                       <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">minimum</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">))</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Transfers to Investment Account"</span><span class="p">)</span>
    <span class="n">banking_transfers</span> <span class="o">=</span> <span class="n">generate_outgoing_transfers</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">income_entries</span> <span class="o">+</span>
                    <span class="n">banking_entries</span> <span class="o">+</span>
                    <span class="n">banking_expenses</span> <span class="o">+</span>
                    <span class="n">credit_entries</span> <span class="o">+</span>
                    <span class="n">tax_entries</span><span class="p">),</span>
        <span class="n">account_checking</span><span class="p">,</span>
        <span class="n">account_investing</span><span class="p">,</span>
        <span class="n">transfer_minimum</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s1">'200'</span><span class="p">),</span>
        <span class="n">transfer_threshold</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s1">'3000'</span><span class="p">),</span>
        <span class="n">transfer_increment</span><span class="o">=</span><span class="n">D</span><span class="p">(</span><span class="s1">'500'</span><span class="p">))</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Prices"</span><span class="p">)</span>
    <span class="c1"># Generate price entries for investment currencies and create a price map to</span>
    <span class="c1"># use for later for generating investment transactions.</span>
    <span class="n">funds_allocation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'MFUND1'</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="s1">'MFUND2'</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">}</span>
    <span class="n">stocks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'STK1'</span><span class="p">,</span> <span class="s1">'STK2'</span><span class="p">,</span> <span class="s1">'STK3'</span><span class="p">,</span> <span class="s1">'STK4'</span><span class="p">]</span>
    <span class="n">price_entries</span> <span class="o">=</span> <span class="n">generate_prices</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                    <span class="nb">sorted</span><span class="p">(</span><span class="n">funds_allocation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">stocks</span><span class="p">,</span> <span class="s1">'CCY'</span><span class="p">)</span>
    <span class="n">price_map</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">build_price_map</span><span class="p">(</span><span class="n">price_entries</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Employer Match Contribution"</span><span class="p">)</span>
    <span class="n">account_match</span> <span class="o">=</span> <span class="s1">'Income:US:Employer1:Match401k'</span>
    <span class="n">retirement_match</span> <span class="o">=</span> <span class="n">generate_retirement_employer_match</span><span class="p">(</span><span class="n">income_entries</span><span class="p">,</span>
                                                          <span class="n">join</span><span class="p">(</span><span class="n">account_retirement</span><span class="p">,</span> <span class="s1">'Cash'</span><span class="p">),</span>
                                                          <span class="n">account_match</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Retirement Investments"</span><span class="p">)</span>
    <span class="n">retirement_entries</span> <span class="o">=</span> <span class="n">generate_retirement_investments</span><span class="p">(</span>
        <span class="n">income_entries</span> <span class="o">+</span> <span class="n">retirement_match</span><span class="p">,</span> <span class="n">account_retirement</span><span class="p">,</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">funds_allocation</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
        <span class="n">price_map</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Taxes Investments"</span><span class="p">)</span>
    <span class="n">investment_entries</span> <span class="o">=</span> <span class="n">generate_taxable_investment</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span>
                                                     <span class="n">banking_transfers</span><span class="p">,</span> <span class="n">price_map</span><span class="p">,</span>
                                                     <span class="n">stocks</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Expense Accounts"</span><span class="p">)</span>
    <span class="n">expense_accounts_entries</span> <span class="o">=</span> <span class="n">generate_expense_accounts</span><span class="p">(</span><span class="n">date_birth</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Equity Accounts"</span><span class="p">)</span>
    <span class="n">equity_entries</span> <span class="o">=</span> <span class="n">generate_open_entries</span><span class="p">(</span><span class="n">date_birth</span><span class="p">,</span> <span class="p">[</span><span class="n">account_opening</span><span class="p">,</span>
                                                        <span class="n">account_payable</span><span class="p">])</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Generating Balance Checks"</span><span class="p">)</span>
    <span class="n">credit_checks</span> <span class="o">=</span> <span class="n">generate_balance_checks</span><span class="p">(</span><span class="n">credit_entries</span><span class="p">,</span> <span class="n">account_credit</span><span class="p">,</span>
                                            <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

    <span class="n">banking_checks</span> <span class="o">=</span> <span class="n">generate_balance_checks</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">income_entries</span> <span class="o">+</span>
                                                         <span class="n">banking_entries</span> <span class="o">+</span>
                                                         <span class="n">banking_expenses</span> <span class="o">+</span>
                                                         <span class="n">banking_transfers</span> <span class="o">+</span>
                                                         <span class="n">credit_entries</span> <span class="o">+</span>
                                                         <span class="n">tax_entries</span><span class="p">),</span>
                                             <span class="n">account_checking</span><span class="p">,</span>
                                             <span class="n">date_random_seq</span><span class="p">(</span><span class="n">date_begin</span><span class="p">,</span> <span class="n">date_end</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Outputting and Formatting Entries"</span><span class="p">)</span>
    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">display_context</span><span class="o">.</span><span class="n">DisplayContext</span><span class="p">()</span>
    <span class="n">default_int_digits</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">precision</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'USD'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="s1">'CAD'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="s1">'VACHR'</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                <span class="s1">'IRAUSD'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="s1">'VBMPX'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                <span class="s1">'RGAGX'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                <span class="s1">'ITOT'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s1">'VEA'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s1">'VHT'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s1">'GLD'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">int_digits</span> <span class="o">=</span> <span class="n">default_int_digits</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">int_digits</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">precision</span>
        <span class="n">dcontext</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="s1">'{{:0</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">f}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">int_digits</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">currency</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">output_section</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n\n\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">FILE_PREAMBLE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Commodities'</span><span class="p">,</span> <span class="n">commodity_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Equity Accounts'</span><span class="p">,</span> <span class="n">equity_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Banking'</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">banking_entries</span> <span class="o">+</span>
                                            <span class="n">banking_expenses</span> <span class="o">+</span>
                                            <span class="n">banking_transfers</span> <span class="o">+</span>
                                            <span class="n">banking_checks</span><span class="p">))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Credit-Cards'</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">credit_entries</span> <span class="o">+</span>
                                                 <span class="n">credit_checks</span><span class="p">))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Taxable Investments'</span><span class="p">,</span> <span class="n">investment_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Retirement Investments'</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">retirement_entries</span> <span class="o">+</span>
                                                           <span class="n">retirement_match</span><span class="p">))</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Sources of Income'</span><span class="p">,</span> <span class="n">income_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Taxes'</span><span class="p">,</span> <span class="n">tax_preamble</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">taxes</span><span class="p">:</span>
        <span class="n">output_section</span><span class="p">(</span><span class="s1">'** Tax Year </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Expenses'</span><span class="p">,</span> <span class="n">expense_accounts_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Prices'</span><span class="p">,</span> <span class="n">price_entries</span><span class="p">)</span>
    <span class="n">output_section</span><span class="p">(</span><span class="s1">'* Cash'</span><span class="p">,</span> <span class="p">[])</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Contextualizing to Realistic Names"</span><span class="p">)</span>
    <span class="n">contents</span><span class="p">,</span> <span class="n">replacements</span> <span class="o">=</span> <span class="n">contextualize_file</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">employer_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reformat</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">align_beancount</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Writing contents"</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Validating Results"</span><span class="p">)</span>
    <span class="n">validate_output</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">replace</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="p">[</span><span class="n">account_checking</span><span class="p">]],</span>
                    <span class="n">replace</span><span class="p">(</span><span class="s1">'CCY'</span><span class="p">,</span> <span class="n">replacements</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.format">
<code>format</code>
<a class="headerlink" href="#beancount.scripts.format" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Align a beancount/ledger input file's numbers.</p>
<p>This reformats at beancount or ledger input file so that the amounts in the
postings are all aligned to the same column. The currency should match.</p>
<p>Note: this does not parse the Beancount ledger. It simply uses regular
expressions and text manipulations to do its work.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.format.align_beancount">
<code class="highlight language-python">
align_beancount<span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">prefix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currency_column</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.format.align_beancount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Reformat Beancount input to align all the numbers at the same column.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contents</code></td>
<td><code></code></td>
<td>
<p>A string, Beancount input syntax to reformat.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefix_width</code></td>
<td><code></code></td>
<td>
<p>An integer, the width in characters to render the account
name to. If this is not specified, a good value is selected
automatically from the contents of the file.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>num_width</code></td>
<td><code></code></td>
<td>
<p>An integer, the width to render each number. If this is not
specified, a good value is selected automatically from the contents of
the file.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>currency_column</code></td>
<td><code></code></td>
<td>
<p>An integer, the column at which to align the currencies.
If given, this overrides the other options.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string, reformatted Beancount input with all the number aligned.
No other changes than whitespace changes should be present between that
return value and the input contents.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/format.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">align_beancount</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">prefix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currency_column</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Reformat Beancount input to align all the numbers at the same column.</span>

<span class="sd">    Args:</span>
<span class="sd">      contents: A string, Beancount input syntax to reformat.</span>
<span class="sd">      prefix_width: An integer, the width in characters to render the account</span>
<span class="sd">        name to. If this is not specified, a good value is selected</span>
<span class="sd">        automatically from the contents of the file.</span>
<span class="sd">      num_width: An integer, the width to render each number. If this is not</span>
<span class="sd">        specified, a good value is selected automatically from the contents of</span>
<span class="sd">        the file.</span>
<span class="sd">      currency_column: An integer, the column at which to align the currencies.</span>
<span class="sd">        If given, this overrides the other options.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, reformatted Beancount input with all the number aligned.</span>
<span class="sd">      No other changes than whitespace changes should be present between that</span>
<span class="sd">      return value and the input contents.</span>

<span class="sd">    """</span>
    <span class="c1"># Find all lines that have a number in them and calculate the maximum length</span>
    <span class="c1"># of the stripped prefix and the number.</span>
    <span class="n">match_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">'([^";]*?)\s+([-+]?\s*[\d,]+(?:\.\d*)?)\s+(</span><span class="si">{}</span><span class="s1">\b.*)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="o">.</span><span class="n">CURRENCY_RE</span><span class="p">),</span>
            <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">match_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Normalize whitespace before lines that has some indent and an account</span>
    <span class="c1"># name.</span>
    <span class="n">norm_match_pairs</span> <span class="o">=</span> <span class="n">normalize_indent_whitespace</span><span class="p">(</span><span class="n">match_pairs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">currency_column</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">norm_match_pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_of_spaces</span> <span class="o">=</span> <span class="n">currency_column</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span>
                <span class="n">spaces</span> <span class="o">=</span> <span class="s1">' '</span> <span class="o">*</span> <span class="n">num_of_spaces</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">spaces</span> <span class="o">+</span> <span class="s1">'  '</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="n">rest</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="c1"># Compute the maximum widths.</span>
    <span class="n">filtered_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match_pairs</span>
                      <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">filtered_pairs</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">filtered_pairs</span><span class="p">)</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">filtered_pairs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Use user-supplied overrides, if available</span>
    <span class="k">if</span> <span class="n">prefix_width</span><span class="p">:</span>
        <span class="n">max_prefix_width</span> <span class="o">=</span> <span class="n">prefix_width</span>
    <span class="k">if</span> <span class="n">num_width</span><span class="p">:</span>
        <span class="n">max_num_width</span> <span class="o">=</span> <span class="n">num_width</span>

    <span class="c1"># Create a format that will admit the maximum width of all prefixes equally.</span>
    <span class="n">line_format</span> <span class="o">=</span> <span class="s1">'{{:&lt;</span><span class="si">{prefix_width}</span><span class="s1">}}  {{:&gt;</span><span class="si">{num_width}</span><span class="s1">}} {{}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix_width</span><span class="o">=</span><span class="n">max_prefix_width</span><span class="p">,</span>
        <span class="n">num_width</span><span class="o">=</span><span class="n">max_num_width</span><span class="p">)</span>

    <span class="c1"># Process each line to an output buffer.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">norm_match_pairs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">formatted_contents</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="c1"># Ensure that the file before and after have only whitespace differences.</span>
    <span class="c1"># This is a sanity check, to make really sure we never change anything but whitespace,</span>
    <span class="c1"># so it's safe.</span>
    <span class="c1"># open('/tmp/before', 'w').write(re.sub(r'[ \t]+', ' ', contents))</span>
    <span class="c1"># open('/tmp/after', 'w').write(re.sub(r'[ \t]+', ' ', formatted_contents))</span>
    <span class="n">old_stripped</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[ \t\n]+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">contents</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="n">new_stripped</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[ \t\n]+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">formatted_contents</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">old_stripped</span> <span class="o">==</span> <span class="n">new_stripped</span><span class="p">),</span> <span class="p">(</span><span class="n">old_stripped</span><span class="p">,</span> <span class="n">new_stripped</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">formatted_contents</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.format.compute_most_frequent">
<code class="highlight language-python">
compute_most_frequent<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.format.compute_most_frequent" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the frequencies of the given elements and return the most frequent.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterable</code></td>
<td><code></code></td>
<td>
<p>A collection of hashable elements.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The most frequent element. If there are no elements in the iterable,
return None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/format.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_most_frequent</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="sd">"""Compute the frequencies of the given elements and return the most frequent.</span>

<span class="sd">    Args:</span>
<span class="sd">      iterable: A collection of hashable elements.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The most frequent element. If there are no elements in the iterable,</span>
<span class="sd">      return None.</span>
<span class="sd">    """</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">frequencies</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">count</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="c1"># Note: In case of a tie, this chooses the longest width.</span>
    <span class="c1"># We could eventually make this an option.</span>
    <span class="k">return</span> <span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.format.normalize_indent_whitespace">
<code class="highlight language-python">
normalize_indent_whitespace<span class="p">(</span><span class="n">match_pairs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.format.normalize_indent_whitespace" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Normalize whitespace before lines that has some indent and an account name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match_pairs</code></td>
<td><code></code></td>
<td>
<p>A list of (prefix, number, rest) tuples.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Another list of (prefix, number, rest) tuples, where prefix may have been
adjusted with a different whitespace prefi.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/format.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_indent_whitespace</span><span class="p">(</span><span class="n">match_pairs</span><span class="p">):</span>
    <span class="sd">"""Normalize whitespace before lines that has some indent and an account name.</span>

<span class="sd">    Args:</span>
<span class="sd">      match_pairs: A list of (prefix, number, rest) tuples.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Another list of (prefix, number, rest) tuples, where prefix may have been</span>
<span class="sd">      adjusted with a different whitespace prefi.</span>
<span class="sd">    """</span>
    <span class="c1"># Compute most frequent account name prefix.</span>
    <span class="n">match_posting</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'([ \t]+)(</span><span class="si">{}</span><span class="s1">.*)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">ACCOUNT_RE</span><span class="p">))</span><span class="o">.</span><span class="n">match</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">compute_most_frequent</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="p">(</span><span class="n">match_posting</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match_pairs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">norm_format</span> <span class="o">=</span> <span class="s1">' '</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">'</span>

    <span class="c1"># Make the necessary adjustments.</span>
    <span class="n">adjusted_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">match_pairs</span><span class="p">:</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">tup</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">match_posting</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">number</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">adjusted_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adjusted_pairs</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.setup_test">
<code>setup_test</code>
<a class="headerlink" href="#beancount.scripts.setup_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A test for setup.py.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.setup_test.TestSetup">
<code>TestSetup</code>
<a class="headerlink" href="#beancount.scripts.setup_test.TestSetup" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.setup_test.TestSetup.run_setup">
<code class="highlight language-python">
run_setup<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">installdir</span><span class="p">,</span> <span class="n">extra_env</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.setup_test.TestSetup.run_setup" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Run setup.py with the given extra environment variables.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>installdir</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the temporary directory to install into.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>extra_env</code></td>
<td><code></code></td>
<td>
<p>A dict, extra environment variables to set in the subprocess.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/setup_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">installdir</span><span class="p">,</span> <span class="n">extra_env</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Run setup.py with the given extra environment variables.</span>

<span class="sd">    Args:</span>
<span class="sd">      installdir: A string, the name of the temporary directory to install into.</span>
<span class="sd">      extra_env: A dict, extra environment variables to set in the subprocess.</span>
<span class="sd">    """</span>
    <span class="n">rootdir</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">find_repository_root</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

    <span class="c1"># Clean previously built "build" output.</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">'setup.py'</span><span class="p">,</span> <span class="s1">'clean'</span><span class="p">,</span> <span class="s1">'--all'</span><span class="p">]</span>
    <span class="n">subprocess_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">extra_env</span><span class="p">:</span>
        <span class="n">subprocess_env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_env</span><span class="p">)</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">,</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">subprocess_env</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Install in a temporary directory.</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">'setup.py'</span><span class="p">,</span> <span class="s1">'install'</span><span class="p">,</span> <span class="s1">'--prefix=</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">installdir</span><span class="p">)]</span>
    <span class="n">subprocess_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">extra_env</span><span class="p">:</span>
        <span class="n">subprocess_env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_env</span><span class="p">)</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">,</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">subprocess_env</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">installdir</span><span class="p">,</span> <span class="s1">'bin'</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">installdir</span><span class="p">,</span> <span class="s1">'lib'</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">installdir</span><span class="p">))),</span> <span class="mi">20</span><span class="p">)</span>

    <span class="c1"># Find bin and library dirs.</span>
    <span class="n">bindir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">installdir</span><span class="p">,</span> <span class="s1">'bin'</span><span class="p">)</span>
    <span class="n">libdir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">installdir</span><span class="p">,</span> <span class="s1">'lib'</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">libdir</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'site-packages'</span><span class="p">:</span>
        <span class="n">libdir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">libdir</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Run at least with the --help option for all the installed tools.</span>
    <span class="k">for</span> <span class="n">binname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">bindir</span><span class="p">):</span>
        <span class="c1"># Skip tools with optional dependencies.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">binname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'bean-'</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bindir</span><span class="p">,</span> <span class="n">binname</span><span class="p">),</span> <span class="s1">'--help'</span><span class="p">]</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">'PYTHONPATH'</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdir</span><span class="p">)},</span>
                                <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">)</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Run some basic commands using the main tools from newly installed version.</span>
    <span class="n">example_filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="s1">'examples/example.beancount'</span><span class="p">)</span>

    <span class="c1"># Run bean-check.</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bindir</span><span class="p">,</span> <span class="s1">'bean-check'</span><span class="p">),</span> <span class="s1">'-v'</span><span class="p">,</span> <span class="n">example_filename</span><span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">'PYTHONPATH'</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdir</span><span class="p">)},</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Run bean-report.</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bindir</span><span class="p">,</span> <span class="s1">'bean-report'</span><span class="p">),</span> <span class="n">example_filename</span><span class="p">,</span> <span class="s1">'balsheet'</span><span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">'PYTHONPATH'</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdir</span><span class="p">)},</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># Run bean-query.</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bindir</span><span class="p">,</span> <span class="s1">'bean-query'</span><span class="p">),</span> <span class="n">example_filename</span><span class="p">,</span> <span class="s1">'balances;'</span><span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">'PYTHONPATH'</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdir</span><span class="p">)},</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="n">rootdir</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.setup_test.TestSetup.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.setup_test.TestSetup.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/setup_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>20
21</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">installdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">'beancount-setup-test.'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.setup_test.TestSetup.tearDown">
<code class="highlight language-python">
tearDown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.setup_test.TestSetup.tearDown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for deconstructing the test fixture after testing it.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/setup_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>23
24
25</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">installdir</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">installdir</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.sql">
<code>sql</code>
<a class="headerlink" href="#beancount.scripts.sql" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Convert a Beancount ledger into an SQL database.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter">
<code>BalanceWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Balance(meta, date, account, amount, tolerance, diff_amount)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">diff_amount</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Balance(meta, date, account, amount, tolerance, diff_amount)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.BalanceWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.BalanceWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>230
231
232
233
234
235</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter">
<code>CloseWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Close(meta, date, account)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Close(meta, date, account)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.CloseWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.CloseWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>203
204</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.DirectiveWriter">
<code>DirectiveWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.DirectiveWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A base class for writers of directives.
    This is used to factor out code for all the simple directives types
    (all types except Transaction).</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.DirectiveWriter.__call__">
<code class="highlight language-python">
__call__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.DirectiveWriter.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a table for a directives.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>connection</code></td>
<td><code></code></td>
<td>
<p>A DBAPI-2.0 Connection object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Create a table for a directives.</span>

<span class="sd">    Args:</span>
<span class="sd">      connection: A DBAPI-2.0 Connection object.</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">columns_text</span> <span class="o">=</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE TABLE </span><span class="si">{name}</span><span class="s2">_detail (</span>
<span class="s2">            id 			INTEGER PRIMARY KEY,</span>
<span class="s2">            </span><span class="si">{columns}</span><span class="s2"></span>
<span class="s2">          );</span>
<span class="s2">        """</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                   <span class="n">columns</span><span class="o">=</span><span class="n">columns_text</span><span class="p">))</span>

        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE VIEW </span><span class="si">{name}</span><span class="s2"> AS</span>
<span class="s2">            SELECT * FROM entry JOIN </span><span class="si">{name}</span><span class="s2">_detail USING (id);</span>
<span class="s2">        """</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Store common data.</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              INSERT INTO entry VALUES (?, ?, ?, ?, ?);</span>
<span class="s2">            """</span><span class="p">,</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                  <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"filename"</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">]))</span>

            <span class="c1"># Store detail data.</span>
            <span class="n">detail_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_detail</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">eid</span><span class="p">,)</span> <span class="o">+</span> <span class="n">detail_data</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">              INSERT INTO </span><span class="si">{name}</span><span class="s2">_detail VALUES (</span><span class="si">{placeholder}</span><span class="s2">);</span>
<span class="s2">            """</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                       <span class="n">placeholder</span><span class="o">=</span><span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">'?'</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">detail_data</span><span class="p">))))</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.DirectiveWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.DirectiveWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>171
172
173
174
175
176
177
178
179
180</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="sd">"""Provide data to store for details table.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An instance of the desired directive.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of the values corresponding to the columns declared in the</span>
<span class="sd">      'columns' attribute.</span>
<span class="sd">    """</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter">
<code>DocumentWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Document(meta, date, account, filename, tags, links)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Document(meta, date, account, filename, tags, links)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.DocumentWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.DocumentWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>300
301
302</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.EventWriter">
<code>EventWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.EventWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Event(meta, date, type, description)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.EventWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.EventWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Event(meta, date, type, description)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.EventWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.EventWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.EventWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>259
260
261</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter">
<code>NoteWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Note(meta, date, account, comment)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Note(meta, date, account, comment)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.NoteWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.NoteWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>246
247
248</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter">
<code>OpenWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Open(meta, date, account, currencies, booking)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">booking</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Open(meta, date, account, currencies, booking)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.OpenWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.OpenWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>191
192
193</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
            <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currencies</span> <span class="ow">or</span> <span class="p">[]))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.PadWriter">
<code>PadWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.PadWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Pad(meta, date, account, source_account)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PadWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PadWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">source_account</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Pad(meta, date, account, source_account)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PadWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.PadWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.PadWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>215
216</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">source_account</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter">
<code>PriceWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Price(meta, date, currency, amount)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Price(meta, date, currency, amount)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.PriceWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.PriceWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>286
287
288
289</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter">
<code>QueryWriter</code>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter.type">
<code>type</code>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter.type" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Query(meta, date, name, query_string)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter.type.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter.type.__getnewargs__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter.type.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter.type.__new__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Create new instance of Query(meta, date, name, query_string)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter.type.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter.type.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.scripts.sql.QueryWriter.get_detail">
<code class="highlight language-python">
get_detail<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.QueryWriter.get_detail" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Provide data to store for details table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry</code></td>
<td><code></code></td>
<td>
<p>An instance of the desired directive.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of the values corresponding to the columns declared in the
'columns' attribute.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>272
273
274</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">query_string</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.sql.adapt_decimal">
<code class="highlight language-python">
adapt_decimal<span class="p">(</span><span class="n">number</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.adapt_decimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Adapt a Decimal instance to a string for creating queries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td><code></code></td>
<td>
<p>An instance of Decimal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A string.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>306
307
308
309
310
311
312
313
314</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">adapt_decimal</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">"""Adapt a Decimal instance to a string for creating queries.</span>

<span class="sd">    Args:</span>
<span class="sd">      number: An instance of Decimal.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.sql.convert_decimal">
<code class="highlight language-python">
convert_decimal<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.convert_decimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a Decimal string to a Decimal instance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A decimal number in a string.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Decimal.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>317
318
319
320
321
322
323
324
325</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_decimal</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Convert a Decimal string to a Decimal instance.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A decimal number in a string.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Decimal.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.sql.output_common">
<code class="highlight language-python">
output_common<span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">unused_entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.output_common" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a table of common data for all entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>connection</code></td>
<td><code></code></td>
<td>
<p>A DBAPI-2.0 Connection object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">output_common</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">unused_entries</span><span class="p">):</span>
    <span class="sd">"""Create a table of common data for all entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      connection: A DBAPI-2.0 Connection object.</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE TABLE entry (</span>
<span class="s2">            id 			INTEGER PRIMARY KEY,</span>
<span class="s2">            date 		DATE,</span>
<span class="s2">            type                CHARACTER(8),</span>
<span class="s2">            source_filename	STRING,</span>
<span class="s2">            source_lineno	INTEGER</span>
<span class="s2">          );</span>
<span class="s2">        """</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.sql.output_transactions">
<code class="highlight language-python">
output_transactions<span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.output_transactions" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create a table for transactions and fill in the data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>connection</code></td>
<td><code></code></td>
<td>
<p>A DBAPI-2.0 Connection object.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">output_transactions</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Create a table for transactions and fill in the data.</span>

<span class="sd">    Args:</span>
<span class="sd">      connection: A DBAPI-2.0 Connection object.</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE TABLE transactions_detail (</span>
<span class="s2">            id 			INTEGER PRIMARY KEY,</span>
<span class="s2">            flag 		CHARACTER(1),</span>
<span class="s2">            payee 		VARCHAR,</span>
<span class="s2">            narration 		VARCHAR,</span>
<span class="s2">            tags                VARCHAR, -- Comma-separated</span>
<span class="s2">            links               VARCHAR  -- Comma-separated</span>
<span class="s2">          );</span>
<span class="s2">        """</span><span class="p">)</span>

        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE VIEW transactions AS</span>
<span class="s2">            SELECT * FROM entry JOIN transactions_detail USING (id);</span>
<span class="s2">        """</span><span class="p">)</span>

        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">          CREATE TABLE postings (</span>
<span class="s2">            posting_id		INTEGER PRIMARY KEY,</span>
<span class="s2">            id 			INTEGER,</span>
<span class="s2">            flag                CHARACTER(1),</span>
<span class="s2">            account             VARCHAR,</span>
<span class="s2">            number              DECIMAL(16, 6),</span>
<span class="s2">            currency            CHARACTER(10),</span>
<span class="s2">            cost_number         DECIMAL(16, 6),</span>
<span class="s2">            cost_currency       CHARACTER(10),</span>
<span class="s2">            cost_date           DATE,</span>
<span class="s2">            cost_label          VARCHAR,</span>
<span class="s2">            price_number        DECIMAL(16, 6),</span>
<span class="s2">            price_currency      CHARACTER(10),</span>
<span class="s2">            FOREIGN KEY(id) REFERENCES entries(id)</span>
<span class="s2">          );</span>
<span class="s2">        """</span><span class="p">)</span>

    <span class="n">postings_count</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              insert into entry values (?, ?, ?, ?, ?);</span>
<span class="s2">            """</span><span class="p">,</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">'txn'</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"filename"</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">"lineno"</span><span class="p">]))</span>

            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">              insert into transactions_detail values (?, ?, ?, ?, ?, ?);</span>
<span class="s2">            """</span><span class="p">,</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">narration</span><span class="p">,</span>
                  <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span> <span class="ow">or</span> <span class="p">()),</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span> <span class="ow">or</span> <span class="p">())))</span>

            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">postings_count</span><span class="p">)</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">units</span>
                <span class="n">cost</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">                  INSERT INTO postings VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);</span>
<span class="s2">                """</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span>
                      <span class="n">posting</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
                      <span class="n">posting</span><span class="o">.</span><span class="n">account</span><span class="p">,</span>
                      <span class="n">units</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                      <span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                      <span class="n">cost</span><span class="o">.</span><span class="n">number</span> <span class="k">if</span> <span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">cost</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">cost</span><span class="o">.</span><span class="n">date</span> <span class="k">if</span> <span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">cost</span><span class="o">.</span><span class="n">label</span> <span class="k">if</span> <span class="n">cost</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">price</span><span class="o">.</span><span class="n">number</span> <span class="k">if</span> <span class="n">price</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">price</span><span class="o">.</span><span class="n">currency</span> <span class="k">if</span> <span class="n">price</span> <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.scripts.sql.setup_decimal_support">
<code class="highlight language-python">
setup_decimal_support<span class="p">()</span> </code>
<a class="headerlink" href="#beancount.scripts.sql.setup_decimal_support" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Setup sqlite3 to support conversions to/from Decimal numbers.</p>
<details class="quote">
<summary>Source code in <code>beancount/scripts/sql.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>328
329
330
331
332</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setup_decimal_support</span><span class="p">():</span>
    <span class="sd">"""Setup sqlite3 to support conversions to/from Decimal numbers.</span>
<span class="sd">    """</span>
    <span class="n">dbapi</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">adapt_decimal</span><span class="p">)</span>
    <span class="n">dbapi</span><span class="o">.</span><span class="n">register_converter</span><span class="p">(</span><span class="s2">"decimal"</span><span class="p">,</span> <span class="n">convert_decimal</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.scripts.tutorial">
<code>tutorial</code>
<a class="headerlink" href="#beancount.scripts.tutorial" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Write output files for the tutorial commands.</p>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.utils.html" title="beancount.utils">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="beancount.reports.html" title="beancount.reports"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/xuhcc/beancount-docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.reports.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.utils.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
