<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://xuhcc.github.io/beancount-docs/api_reference/beancount.query.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.query - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.query";
    var mkdocs_page_input_path = "api_reference/beancount.query.md";
    var mkdocs_page_url = "/beancount-docs/api_reference/beancount.query.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.query.html">beancount.query</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.query">beancount.query</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.numberify">numberify</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.AmountConverter">AmountConverter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.numberify.AmountConverter.dtype">dtype</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.IdentityConverter">IdentityConverter</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.InventoryConverter">InventoryConverter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.numberify.InventoryConverter.dtype">dtype</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.PositionConverter">PositionConverter</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.numberify.PositionConverter.dtype">dtype</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.convert_col_Amount">convert_col_Amount()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.convert_col_Inventory">convert_col_Inventory()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.convert_col_Position">convert_col_Position()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.numberify.numberify_results">numberify_results()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query">query</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query.run_query">run_query()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_compile">query_compile</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.CompilationEnvironment">CompilationEnvironment</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.CompilationEnvironment.get_column">get_column()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.CompilationEnvironment.get_function">get_function()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.CompilationError">CompilationError</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator">EvalAggregator</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator.finalize">finalize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalAggregator.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalColumn">EvalColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom">EvalFrom</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalFrom._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalFunction">EvalFunction</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalNode">EvalNode</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalNode.__call__">__call__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalNode.__eq__">__eq__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalNode.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalNode.childnodes">childnodes()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint">EvalPrint</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalPrint._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery">EvalQuery</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalQuery._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget">EvalTarget</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.EvalTarget._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.ResultSetEnvironment">ResultSetEnvironment</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile.ResultSetEnvironment.get_column">get_column()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile._get_columns_and_aggregates">_get_columns_and_aggregates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile">compile()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_expression">compile_expression()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_from">compile_from()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_group_by">compile_group_by()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_order_by">compile_order_by()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_print">compile_print()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_select">compile_select()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.compile_targets">compile_targets()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.find_unique_name">find_unique_name()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.get_columns_and_aggregates">get_columns_and_aggregates()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.is_aggregate">is_aggregate()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.is_hashable_type">is_hashable_type()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.transform_balances">transform_balances()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile.transform_journal">transform_journal()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_compile_test">query_compile_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase">CompileSelectBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase.assertCompile">assertCompile()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase.assertIndexes">assertIndexes()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase.assertSelectInvariants">assertSelectInvariants()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase.compile">compile()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_compile_test.CompileSelectBase.setUp">setUp()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_env">query_env</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env._Neg">_Neg</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AbsDecimal">AbsDecimal</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AbsInventory">AbsInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AbsPosition">AbsPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AccountColumn">AccountColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AccountSortKey">AccountSortKey</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.AnyMeta">AnyMeta</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.BalanceColumn">BalanceColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CloseDate">CloseDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Coalesce">Coalesce</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertAmount">ConvertAmount</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertAmountWithDate">ConvertAmountWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertInventory">ConvertInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertInventoryWithDate">ConvertInventoryWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertPosition">ConvertPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ConvertPositionWithDate">ConvertPositionWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostCurrencyColumn">CostCurrencyColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostDateColumn">CostDateColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostInventory">CostInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostLabelColumn">CostLabelColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostNumberColumn">CostNumberColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CostPosition">CostPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Count">Count</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Count.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Count.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Count.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Currency">Currency</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CurrencyColumn">CurrencyColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.CurrencyMeta">CurrencyMeta</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Date">Date</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DateAdd">DateAdd</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DateColumn">DateColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DateDiff">DateDiff</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DateEntryColumn">DateEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Day">Day</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DayColumn">DayColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DayEntryColumn">DayEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DescriptionColumn">DescriptionColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.DescriptionEntryColumn">DescriptionEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.EntryMeta">EntryMeta</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FileLocationColumn">FileLocationColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilenameColumn">FilenameColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilenameEntryColumn">FilenameEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilterCurrencyInventory">FilterCurrencyInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilterCurrencyPosition">FilterCurrencyPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilterEntriesEnvironment">FilterEntriesEnvironment</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FilterPostingsEnvironment">FilterPostingsEnvironment</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FindFirst">FindFirst</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.First">First</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.First.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.First.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.First.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FlagColumn">FlagColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.FlagEntryColumn">FlagEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.GetItemStr">GetItemStr</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Grep">Grep</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.GrepN">GrepN</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.IdColumn">IdColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.IdEntryColumn">IdEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.JoinStr">JoinStr</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Last">Last</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Last.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Last.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Last.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Leaf">Leaf</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Length">Length</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.LineNoColumn">LineNoColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.LineNoEntryColumn">LineNoEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.LinksColumn">LinksColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.LinksEntryColumn">LinksEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.MatchAccount">MatchAccount</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Max">Max</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Max.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Max.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Max.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.MaxWidth">MaxWidth</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Meta">Meta</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Min">Min</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Min.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Min.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Min.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Month">Month</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.MonthColumn">MonthColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.MonthEntryColumn">MonthEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.NarrationColumn">NarrationColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.NarrationEntryColumn">NarrationEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Number">Number</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.NumberColumn">NumberColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.OnlyInventory">OnlyInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.OpenDate">OpenDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.OpenMeta">OpenMeta</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.OtherAccountsColumn">OtherAccountsColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Parent">Parent</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ParseDate">ParseDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PayeeColumn">PayeeColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PayeeEntryColumn">PayeeEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PositionColumn">PositionColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PosSignAmount">PosSignAmount</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PosSignDecimal">PosSignDecimal</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PosSignInventory">PosSignInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PosSignPosition">PosSignPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PostingFlagColumn">PostingFlagColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Price">Price</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PriceColumn">PriceColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.PriceWithDate">PriceWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Quarter">Quarter</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Root">Root</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.SafeDiv">SafeDiv</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Str">Str</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Subst">Subst</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Sum">Sum</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Sum.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Sum.initialize">initialize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.Sum.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.SumAmount">SumAmount</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.SumAmount.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.SumBase">SumBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.SumBase.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.SumBase.initialize">initialize()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.SumInventory">SumInventory</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.SumInventory.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.SumPosition">SumPosition</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_env.SumPosition.update">update()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.TagsColumn">TagsColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.TagsEntryColumn">TagsEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.TargetsEnvironment">TargetsEnvironment</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Today">Today</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.TypeColumn">TypeColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.TypeEntryColumn">TypeEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.UnitsInventory">UnitsInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.UnitsPosition">UnitsPosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ValueInventory">ValueInventory</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ValueInventoryWithDate">ValueInventoryWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ValuePosition">ValuePosition</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.ValuePositionWithDate">ValuePositionWithDate</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Weekday">Weekday</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.WeightColumn">WeightColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.Year">Year</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.YearColumn">YearColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.YearEntryColumn">YearEntryColumn</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_env.YearMonth">YearMonth</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_execute">query_execute</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.Allocator">Allocator</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_execute.Allocator.allocate">allocate()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_execute.Allocator.create_store">create_store()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.RowContext">RowContext</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.create_row_context">create_row_context()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.execute_print">execute_print()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.execute_query">execute_query()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.filter_entries">filter_entries()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.flatten_results">flatten_results()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.row_sortkey">row_sortkey()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute.uses_balance_column">uses_balance_column()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_execute_test">query_execute_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_execute_test.QueryBase">QueryBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_execute_test.QueryBase.compile">compile()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_execute_test.QueryBase.parse">parse()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_execute_test.QueryBase.setUp">setUp()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_parser">query_parser</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Balances">Balances</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Balances._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Errors">Errors</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Errors._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Explain">Explain</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Explain._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Journal">Journal</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Journal._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Lexer">Lexer</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Lexer.t_DATE">t_DATE()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Lexer.t_DECIMAL">t_DECIMAL()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Lexer.t_ID">t_ID()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Lexer.t_INTEGER">t_INTEGER()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Lexer.t_STRING">t_STRING()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.ParseError">ParseError</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Parser">Parser</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_balances_statement">p_balances_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_delimiter">p_delimiter()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_errors_statement">p_errors_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_explain_statement">p_explain_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_journal_statement">p_journal_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_print_statement">p_print_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_regular_statement">p_regular_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_reload_statement">p_reload_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_run_statement">p_run_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_statement">p_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Parser.p_summary_func">p_summary_func()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Print">Print</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Print._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Reload">Reload</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Reload._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.RunCustom">RunCustom</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.RunCustom._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.Select">Select</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select.__getnewargs__">__getnewargs__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select.__new__">__new__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select.__repr__">__repr__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select._asdict">_asdict()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select._make">_make()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.Select._replace">_replace()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.SelectParser">SelectParser</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.handle_comma_separated_list">handle_comma_separated_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_account">p_account()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_boolean">p_boolean()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_column">p_column()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_column_list">p_column_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_constant">p_constant()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_distinct">p_distinct()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_empty">p_empty()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expr_index">p_expr_index()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expr_index_list">p_expr_index_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_add">p_expression_add()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_and">p_expression_and()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_column">p_expression_column()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_constant">p_expression_constant()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_contains">p_expression_contains()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_div">p_expression_div()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_eq">p_expression_eq()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_function">p_expression_function()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_gt">p_expression_gt()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_gte">p_expression_gte()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_list">p_expression_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_list_opt">p_expression_list_opt()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_lt">p_expression_lt()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_lte">p_expression_lte()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_match">p_expression_match()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_mul">p_expression_mul()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_ne">p_expression_ne()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_not">p_expression_not()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_or">p_expression_or()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_paren">p_expression_paren()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_expression_sub">p_expression_sub()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_flatten">p_flatten()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_from">p_from()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_from_subselect">p_from_subselect()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_group_by">p_group_by()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_having">p_having()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_limit">p_limit()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_opt_clear">p_opt_clear()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_opt_close">p_opt_close()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_opt_expression">p_opt_expression()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_opt_open">p_opt_open()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_order_by">p_order_by()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_ordering">p_ordering()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_pivot_by">p_pivot_by()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_select_statement">p_select_statement()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_target">p_target()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_target_list">p_target_list()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_target_spec">p_target_spec()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser.SelectParser.p_where">p_where()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser.get_expression_name">get_expression_name()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.query_parser_test">query_parser_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser_test.QueryParserTestBase">QueryParserTestBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser_test.QueryParserTestBase.assertParse">assertParse()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser_test.QueryParserTestBase.parse">parse()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser_test.QueryParserTestBase.setUp">setUp()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser_test.TestSelectFromBase">TestSelectFromBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.query_parser_test.TestSelectFromBase.setUp">setUp()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.query_parser_test.qSelect">qSelect()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.shell">shell</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.BQLShell">BQLShell</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Balances">on_Balances()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Errors">on_Errors()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Explain">on_Explain()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Journal">on_Journal()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Print">on_Print()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Reload">on_Reload()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_RunCustom">on_RunCustom()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.BQLShell.on_Select">on_Select()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.DispatchingShell">DispatchingShell</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.__init__">__init__()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.add_help">add_help()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.cmdloop">cmdloop()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.default">default()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.dispatch">dispatch()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_clear">do_clear()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_EOF">do_EOF()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_exit">do_exit()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_help">do_help()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_history">do_history()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_lex">do_lex()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_parse">do_parse()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_quit">do_quit()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_set">do_set()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.do_tokenize">do_tokenize()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.emptyline">emptyline()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.exit">exit()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.get_pager">get_pager()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.initialize_vars">initialize_vars()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.query.shell.DispatchingShell.run_parser">run_parser()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.convert_bool">convert_bool()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.create_custom_query_map">create_custom_query_map()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.generate_env_attribute_list">generate_env_attribute_list()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.generate_env_attributes">generate_env_attributes()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.get_history">get_history()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.load_history">load_history()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.print_statistics">print_statistics()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.save_history">save_history()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell.summary_statistics">summary_statistics()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.query.shell_test">shell_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell_test.TestUseCases">TestUseCases</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.query.shell_test.runshell">runshell()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.query</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/xuhcc/beancount-docs/edit/master/docs/api_reference/beancount.query.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancountquery">beancount.query<a class="headerlink" href="#beancountquery" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.query" id="beancount.query" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.query" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Transaction and postings filtering syntax parser.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.numberify">
<code>numberify</code>
<a class="headerlink" href="#beancount.query.numberify" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Code to split table columns containing amounts and inventories into number columns.</p>
<p>For example, given a column with this content:</p>
<pre><code>----- amount ------
101.23 USD
   200 JPY
 99.23 USD
 38.34 USD, 100 JPY
</code></pre>
<p>We can convert this into two columns and remove the currencies:</p>
<pre><code>-amount (USD)- -amount (JPY)-
        101.23
                          200
         99.23
         38.34            100
</code></pre>
<p>The point is that the columns should be typed as numbers to make this importable
into a spreadsheet and able to be processed.</p>
<p>Notes:</p>
<ul>
<li>
<p>This handles the Amount, Position and Inventory datatypes. There is code to
  automatically recognize columns containing such types from a table of strings
  and convert such columns to their corresponding guessed data types.</p>
</li>
<li>
<p>The per-currency columns are ordered in decreasing order of the number of
  instances of numbers seen for each currency. So if the most numbers you have
  in a column are USD, then the USD column renders first.</p>
</li>
<li>
<p>Cost basis specifications should be unmodified and reported to a dedicated
  extra column, like this:</p>
<p>----- amount ------
1 AAPL {21.23 USD}</p>
</li>
</ul>
<p>We can convert this into two columns and remove the currencies:</p>
<pre><code>-amount (AAPL)- -Cost basis-
              1 {21.23 USD}
</code></pre>
<p>(Eventually we might support the conversion of cost amounts as well, but they
  may contain other informations, such as a label or a date, so for now we don't
  convert them. I'm not sure there's a good practical use case in doing that
  yet.)</p>
<ul>
<li>
<p>We may provide some options to break out only some of the currencies into
  columns, in order to handle the case where an inventory contains a large
  number of currencies and we want to only operate on a restricte set of
  operating currencies.</p>
</li>
<li>
<p>If you provide a DisplayForamtter object to the numberification routine, they
  quantize each column according to their currency's precision. It is
  recommended that you do that.</p>
</li>
</ul>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.numberify.AmountConverter">
<code>AmountConverter</code>
<a class="headerlink" href="#beancount.query.numberify.AmountConverter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A converter that extracts the number of an amount for a specific currency.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.query.numberify.AmountConverter.dtype">
<code>dtype</code>
<a class="headerlink" href="#beancount.query.numberify.AmountConverter.dtype" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Construct a new Decimal object. 'value' can be an integer, string, tuple,
or another Decimal object. If no value is given, return Decimal('0'). The
context does not affect the conversion and is only passed to determine if
the InvalidOperation trap is active.</p>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.numberify.IdentityConverter">
<code>IdentityConverter</code>
<a class="headerlink" href="#beancount.query.numberify.IdentityConverter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A converter that simply copies its column.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.numberify.InventoryConverter">
<code>InventoryConverter</code>
<a class="headerlink" href="#beancount.query.numberify.InventoryConverter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A converter that extracts the number of a inventory for a specific currency.
    If there are multiple lots we aggregate by currency.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.query.numberify.InventoryConverter.dtype">
<code>dtype</code>
<a class="headerlink" href="#beancount.query.numberify.InventoryConverter.dtype" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Construct a new Decimal object. 'value' can be an integer, string, tuple,
or another Decimal object. If no value is given, return Decimal('0'). The
context does not affect the conversion and is only passed to determine if
the InvalidOperation trap is active.</p>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.numberify.PositionConverter">
<code>PositionConverter</code>
<a class="headerlink" href="#beancount.query.numberify.PositionConverter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A converter that extracts the number of a position for a specific currency.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="beancount.query.numberify.PositionConverter.dtype">
<code>dtype</code>
<a class="headerlink" href="#beancount.query.numberify.PositionConverter.dtype" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Construct a new Decimal object. 'value' can be an integer, string, tuple,
or another Decimal object. If no value is given, return Decimal('0'). The
context does not affect the conversion and is only passed to determine if
the InvalidOperation trap is active.</p>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.numberify.convert_col_Amount">
<code class="highlight language-python">
convert_col_Amount<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.numberify.convert_col_Amount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create converters for a column of type Amount.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the column name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>drows</code></td>
<td><code></code></td>
<td>
<p>The table of objects.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>index</code></td>
<td><code></code></td>
<td>
<p>The column number.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Converter instances, one for each of the currency types found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/numberify.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_col_Amount</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">"""Create converters for a column of type Amount.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the column name.</span>
<span class="sd">      drows: The table of objects.</span>
<span class="sd">      index: The column number.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Converter instances, one for each of the currency types found.</span>
<span class="sd">    """</span>
    <span class="n">currency_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">drow</span> <span class="ow">in</span> <span class="n">drows</span><span class="p">:</span>
        <span class="n">vamount</span> <span class="o">=</span> <span class="n">drow</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vamount</span> <span class="ow">and</span> <span class="n">vamount</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
            <span class="n">currency_map</span><span class="p">[</span><span class="n">vamount</span><span class="o">.</span><span class="n">currency</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">AmountConverter</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">index</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">currency_map</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                      <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.numberify.convert_col_Inventory">
<code class="highlight language-python">
convert_col_Inventory<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.numberify.convert_col_Inventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create converters for a column of type Inventory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the column name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>drows</code></td>
<td><code></code></td>
<td>
<p>The table of objects.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>index</code></td>
<td><code></code></td>
<td>
<p>The column number.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Converter instances, one for each of the currency types found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/numberify.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_col_Inventory</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">"""Create converters for a column of type Inventory.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the column name.</span>
<span class="sd">      drows: The table of objects.</span>
<span class="sd">      index: The column number.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Converter instances, one for each of the currency types found.</span>
<span class="sd">    """</span>
    <span class="n">currency_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">drow</span> <span class="ow">in</span> <span class="n">drows</span><span class="p">:</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">drow</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">currency</span> <span class="ow">in</span> <span class="n">inv</span><span class="o">.</span><span class="n">currencies</span><span class="p">():</span>
            <span class="n">currency_map</span><span class="p">[</span><span class="n">currency</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">InventoryConverter</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">index</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">currency_map</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                      <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.numberify.convert_col_Position">
<code class="highlight language-python">
convert_col_Position<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.numberify.convert_col_Position" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create converters for a column of type Position.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the column name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>drows</code></td>
<td><code></code></td>
<td>
<p>The table of objects.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>index</code></td>
<td><code></code></td>
<td>
<p>The column number.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of Converter instances, one for each of the currency types found.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/numberify.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_col_Position</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">"""Create converters for a column of type Position.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the column name.</span>
<span class="sd">      drows: The table of objects.</span>
<span class="sd">      index: The column number.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of Converter instances, one for each of the currency types found.</span>
<span class="sd">    """</span>
    <span class="n">currency_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">drow</span> <span class="ow">in</span> <span class="n">drows</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">drow</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
            <span class="n">currency_map</span><span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">currency</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">PositionConverter</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">index</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currency</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">currency_map</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                      <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.numberify.numberify_results">
<code class="highlight language-python">
numberify_results<span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.numberify.numberify_results" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Number rows containing Amount, Position or Inventory types.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>result_types</code></td>
<td><code></code></td>
<td>
<p>A list of items describing the names and data types of the items in
each column.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>result_rows</code></td>
<td><code></code></td>
<td>
<p>A list of ResultRow instances.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>dformat</code></td>
<td><code></code></td>
<td>
<p>An optional DisplayFormatter. If set, quantize the numbers by
their currency-specific precision when converting the Amount's,
Position's or Inventory'es..</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of modified (result_types, result_rows) with converted datatypes.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/numberify.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">numberify_results</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">dformat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Number rows containing Amount, Position or Inventory types.</span>

<span class="sd">    Args:</span>
<span class="sd">      result_types: A list of items describing the names and data types of the items in</span>
<span class="sd">        each column.</span>
<span class="sd">      result_rows: A list of ResultRow instances.</span>
<span class="sd">      dformat: An optional DisplayFormatter. If set, quantize the numbers by</span>
<span class="sd">        their currency-specific precision when converting the Amount's,</span>
<span class="sd">        Position's or Inventory'es..</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of modified (result_types, result_rows) with converted datatypes.</span>
<span class="sd">    """</span>
    <span class="c1"># Build an array of converters.</span>
    <span class="n">converters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dtypes</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">col_desc</span>
        <span class="n">convert_col_fun</span> <span class="o">=</span> <span class="n">CONVERTING_TYPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">convert_col_fun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">converters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IdentityConverter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_converters</span> <span class="o">=</span> <span class="n">convert_col_fun</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">drows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">converters</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">col_converters</span><span class="p">)</span>

    <span class="c1"># Derive the output types from the expected outputs from the converters</span>
    <span class="c1"># themselves.</span>
    <span class="n">otypes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">converters</span><span class="p">]</span>

    <span class="c1"># Convert the input rows by processing them through the converters.</span>
    <span class="n">orows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">drow</span> <span class="ow">in</span> <span class="n">drows</span><span class="p">:</span>
        <span class="n">orow</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">converters</span><span class="p">:</span>
            <span class="n">orow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">drow</span><span class="p">,</span> <span class="n">dformat</span><span class="p">))</span>
        <span class="n">orows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orow</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">otypes</span><span class="p">,</span> <span class="n">orows</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query">
<code>query</code>
<a class="headerlink" href="#beancount.query.query" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>A library to run queries. This glues together all the parts of the query engine.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query.run_query">
<code class="highlight language-python">
run_query<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">format_args</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">numberify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query.run_query" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compile and execute a query, return the result types and rows.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries, as produced by the loader.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>A dict of options, as produced by the loader.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>A string, a single BQL query, optionally containing some new-style
(e.g., {}) formatting specifications.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>format_args</code></td>
<td><code></code></td>
<td>
<p>A tuple of arguments to be formatted in the query. This is
just provided as a convenience.</p>
</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>numberify</code></td>
<td><code></code></td>
<td>
<p>If true, numberify the results before returning them.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of result types and result rows.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ParseError</code></td>
<td>
<p>If the statement cannot be parsed.</p>
</td>
</tr>
<tr>
<td><code>CompilationError</code></td>
<td>
<p>If the statement cannot be compiled.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_query</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">format_args</span><span class="p">,</span> <span class="n">numberify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Compile and execute a query, return the result types and rows.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries, as produced by the loader.</span>
<span class="sd">      options_map: A dict of options, as produced by the loader.</span>
<span class="sd">      query: A string, a single BQL query, optionally containing some new-style</span>
<span class="sd">        (e.g., {}) formatting specifications.</span>
<span class="sd">      format_args: A tuple of arguments to be formatted in the query. This is</span>
<span class="sd">        just provided as a convenience.</span>
<span class="sd">      numberify: If true, numberify the results before returning them.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of result types and result rows.</span>
<span class="sd">    Raises:</span>
<span class="sd">      ParseError: If the statement cannot be parsed.</span>
<span class="sd">      CompilationError: If the statement cannot be compiled.</span>
<span class="sd">    """</span>
    <span class="n">env_targets</span> <span class="o">=</span> <span class="n">query_env</span><span class="o">.</span><span class="n">TargetsEnvironment</span><span class="p">()</span>
    <span class="n">env_entries</span> <span class="o">=</span> <span class="n">query_env</span><span class="o">.</span><span class="n">FilterEntriesEnvironment</span><span class="p">()</span>
    <span class="n">env_postings</span> <span class="o">=</span> <span class="n">query_env</span><span class="o">.</span><span class="n">FilterPostingsEnvironment</span><span class="p">()</span>

    <span class="c1"># Apply formatting to the query.</span>
    <span class="n">formatted_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">format_args</span><span class="p">)</span>

    <span class="c1"># Parse the statement.</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">formatted_query</span><span class="p">)</span>

    <span class="c1"># Compile the SELECT statement.</span>
    <span class="n">c_query</span> <span class="o">=</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span>
                                    <span class="n">env_targets</span><span class="p">,</span>
                                    <span class="n">env_postings</span><span class="p">,</span>
                                    <span class="n">env_entries</span><span class="p">)</span>

    <span class="c1"># Execute it to obtain the result rows.</span>
    <span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span> <span class="o">=</span> <span class="n">query_execute</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">c_query</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Numberify the results, if requested.</span>
    <span class="k">if</span> <span class="n">numberify</span><span class="p">:</span>
        <span class="n">dformat</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span> <span class="o">=</span> <span class="n">numberify_lib</span><span class="o">.</span><span class="n">numberify_results</span><span class="p">(</span><span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span><span class="p">,</span> <span class="n">dformat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_compile">
<code>query_compile</code>
<a class="headerlink" href="#beancount.query.query_compile" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Interpreter for the query language's AST.</p>
<p>This code accepts the abstract syntax tree produced by the query parser,
resolves the column and function names, compiles and interpreter and prepares a
query to be run against a list of entries.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.CompilationEnvironment">
<code>CompilationEnvironment</code>
<a class="headerlink" href="#beancount.query.query_compile.CompilationEnvironment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Base class for all compilation contexts. A compilation context provides
    column accessors specific to the particular row objects that we will access.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.CompilationEnvironment.get_column">
<code class="highlight language-python">
get_column<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.CompilationEnvironment.get_column" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a column accessor for the given named column.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the column to access.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>347
348
349
350
351
352
353
354
355
356</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">"""Return a column accessor for the given named column.</span>
<span class="sd">    Args:</span>
<span class="sd">      name: A string, the name of the column to access.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Invalid column name '</span><span class="si">{}</span><span class="s2">' in </span><span class="si">{}</span><span class="s2"> context."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_name</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.CompilationEnvironment.get_function">
<code class="highlight language-python">
get_function<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.CompilationEnvironment.get_function" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a function accessor for the given named function.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the function to access.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">operands</span><span class="p">):</span>
    <span class="sd">"""Return a function accessor for the given named function.</span>
<span class="sd">    Args:</span>
<span class="sd">      name: A string, the name of the function to access.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">operand</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">operands</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># If not found with the operands, try just looking it up by name.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="n">operands</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                                        <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">operand</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="vm">__name__</span>
                                                  <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Invalid function '</span><span class="si">{}</span><span class="s2">' in </span><span class="si">{}</span><span class="s2"> context"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">signature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_name</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.CompilationError">
<code>CompilationError</code>
<a class="headerlink" href="#beancount.query.query_compile.CompilationError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A compiler/interpreter error.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator">
<code>EvalAggregator</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Base class for all aggregator evaluator types.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator.__call__">
<code class="highlight language-python">
__call__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return the value on evaluation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The evaluation object to which the evaluation need to apply.
This is either an entry, a Posting instance, or a particular result
set row from a sub-select. This is the provider for the underlying
data.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The final aggregated value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>322
323
324
325
326
327
328
329
330
331
332</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">"""Return the value on evaluation.</span>

<span class="sd">    Args:</span>
<span class="sd">      context: The evaluation object to which the evaluation need to apply.</span>
<span class="sd">        This is either an entry, a Posting instance, or a particular result</span>
<span class="sd">        set row from a sub-select. This is the provider for the underlying</span>
<span class="sd">        data.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The final aggregated value.</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>279
280
281
282
283
284
285
286
287
288
289</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="sd">"""Allocate handles to store data for a node's aggregate storage.</span>

<span class="sd">    This is called once before beginning aggregations. If you need any</span>
<span class="sd">    kind of per-aggregate storage during the computation phase, get it</span>
<span class="sd">    in this method.</span>

<span class="sd">    Args:</span>
<span class="sd">      allocator: An instance of Allocator, on which you can call allocate() to</span>
<span class="sd">        obtain a handle for a slot to store data on store objects later on.</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator.finalize">
<code class="highlight language-python">
finalize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator.finalize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Finalize this node's aggregate data and return it.</p>
<p>For aggregate methods, this finalizes the node and returns the final
value. The context node will be the alloc instead of the context object.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>311
312
313
314
315
316
317
318
319</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="sd">"""Finalize this node's aggregate data and return it.</span>

<span class="sd">    For aggregate methods, this finalizes the node and returns the final</span>
<span class="sd">    value. The context node will be the alloc instead of the context object.</span>

<span class="sd">    Args:</span>
<span class="sd">      store: An object indexable by handles appropriated during allocate().</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>292
293
294
295
296
297
298
299</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="sd">"""Initialize this node's aggregate data. If the node is not an aggregate,</span>
<span class="sd">    simply initialize the subnodes. Override this method in the aggregator</span>
<span class="sd">    if you need data for storage.</span>

<span class="sd">    Args:</span>
<span class="sd">      store: An object indexable by handles appropriated during allocate().</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalAggregator.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.EvalAggregator.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>302
303
304
305
306
307
308</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">"""Evaluate this node. This is designed to recurse on its children.</span>

<span class="sd">    Args:</span>
<span class="sd">      store: An object indexable by handles appropriated during allocate().</span>
<span class="sd">      context: The object to which the evaluation need to apply (see __call__).</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalColumn">
<code>EvalColumn</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Base class for all column accessors.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom">
<code>EvalFrom</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>EvalFrom(c_expr, open, close, clear)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">c_expr</span><span class="p">,</span> <span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">clear</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of EvalFrom(c_expr, open, close, clear)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new EvalFrom object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalFrom._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalFrom._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new EvalFrom object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalFunction">
<code>EvalFunction</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalFunction" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Base class for all function objects.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalNode">
<code>EvalNode</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalNode" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalNode.__call__">
<code class="highlight language-python">
__call__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalNode.__call__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.
All subclasses must override and implement this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The evaluation object to which the evaluation need to apply.
This is either an entry, a Posting instance, or a particular result
set row from a sub-select. This is the provider for the underlying
data.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The evaluated value for this sub-expression tree.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>68
69
70
71
72
73
74
75
76
77
78
79
80</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">"""Evaluate this node. This is designed to recurse on its children.</span>
<span class="sd">    All subclasses must override and implement this method.</span>

<span class="sd">    Args:</span>
<span class="sd">      context: The evaluation object to which the evaluation need to apply.</span>
<span class="sd">        This is either an entry, a Posting instance, or a particular result</span>
<span class="sd">        set row from a sub-select. This is the provider for the underlying</span>
<span class="sd">        data.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The evaluated value for this sub-expression tree.</span>
<span class="sd">    """</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalNode.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalNode.__eq__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Override the equality operator to compare the data type and a all attributes
of this node. This is used by tests for comparing nodes.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Override the equality operator to compare the data type and a all attributes</span>
<span class="sd">    of this node. This is used by tests for comparing nodes.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalNode.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalNode.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return str(self).</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>48
49
50
51</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                           <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span>
                                     <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalNode.childnodes">
<code class="highlight language-python">
childnodes<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.EvalNode.childnodes" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Returns the child nodes of this node.
Yields:
  A list of EvalNode instances.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">childnodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Returns the child nodes of this node.</span>
<span class="sd">    Yields:</span>
<span class="sd">      A list of EvalNode instances.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
        <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">EvalNode</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">child</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">EvalNode</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">element</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint">
<code>EvalPrint</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>EvalPrint(c_from,)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">c_from</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of EvalPrint(c_from,)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new EvalPrint object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalPrint._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalPrint._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new EvalPrint object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery">
<code>EvalQuery</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>EvalQuery(c_targets, c_from, c_where, group_indexes, order_indexes, ordering, limit, distinct, flatten)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">c_targets</span><span class="p">,</span> <span class="n">c_from</span><span class="p">,</span> <span class="n">c_where</span><span class="p">,</span> <span class="n">group_indexes</span><span class="p">,</span> <span class="n">order_indexes</span><span class="p">,</span> <span class="n">ordering</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">flatten</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of EvalQuery(c_targets, c_from, c_where, group_indexes, order_indexes, ordering, limit, distinct, flatten)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new EvalQuery object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalQuery._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalQuery._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new EvalQuery object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget">
<code>EvalTarget</code>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>EvalTarget(c_expr, name, is_aggregate)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">c_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">is_aggregate</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of EvalTarget(c_expr, name, is_aggregate)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new EvalTarget object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.EvalTarget._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile.EvalTarget._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new EvalTarget object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile.ResultSetEnvironment">
<code>ResultSetEnvironment</code>
<a class="headerlink" href="#beancount.query.query_compile.ResultSetEnvironment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An execution context that provides access to attributes from a result set.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile.ResultSetEnvironment.get_column">
<code class="highlight language-python">
get_column<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.ResultSetEnvironment.get_column" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Override the column getter to provide a single attribute getter.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>387
388
389
390
391</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">"""Override the column getter to provide a single attribute getter.</span>
<span class="sd">    """</span>
    <span class="c1"># FIXME: How do we figure out the data type here? We need the context.</span>
    <span class="k">return</span> <span class="n">AttributeColumn</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile._get_columns_and_aggregates">
<code class="highlight language-python">
_get_columns_and_aggregates<span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_compile._get_columns_and_aggregates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Walk down a tree of nodes and fetch the column accessors and aggregates.</p>
<p>This function ignores all nodes under aggregate nodes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>node</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalNode.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>columns</code></td>
<td><code></code></td>
<td>
<p>An accumulator for columns found so far.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>aggregate</code></td>
<td><code></code></td>
<td>
<p>An accumulator for aggregate notes found so far.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_get_columns_and_aggregates</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span><span class="p">):</span>
    <span class="sd">"""Walk down a tree of nodes and fetch the column accessors and aggregates.</span>

<span class="sd">    This function ignores all nodes under aggregate nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">      node: An instance of EvalNode.</span>
<span class="sd">      columns: An accumulator for columns found so far.</span>
<span class="sd">      aggregate: An accumulator for aggregate notes found so far.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">EvalAggregator</span><span class="p">):</span>
        <span class="n">aggregates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">EvalColumn</span><span class="p">):</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">childnodes</span><span class="p">():</span>
            <span class="n">_get_columns_and_aggregates</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile">
<code class="highlight language-python">
compile<span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">targets_environ</span><span class="p">,</span> <span class="n">postings_environ</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Prepare an AST any of the statement into an executable statement.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>statement</code></td>
<td><code></code></td>
<td>
<p>An instance of the parser's Select, Balances, Journal or Print.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>targets_environ</code></td>
<td><code></code></td>
<td>
<p>A compilation environment for evaluating targets.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postings_environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation environment for evaluating postings filters.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries_environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation environment for evaluating entry filters.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of EvalQuery or EvalPrint, ready to be executed.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CompilationError</code></td>
<td>
<p>If the statement cannot be compiled, or is not one of the
supported statements.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">targets_environ</span><span class="p">,</span> <span class="n">postings_environ</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">):</span>
    <span class="sd">"""Prepare an AST any of the statement into an executable statement.</span>

<span class="sd">    Args:</span>
<span class="sd">      statement: An instance of the parser's Select, Balances, Journal or Print.</span>
<span class="sd">      targets_environ: A compilation environment for evaluating targets.</span>
<span class="sd">      postings_environ: : A compilation environment for evaluating postings filters.</span>
<span class="sd">      entries_environ: : A compilation environment for evaluating entry filters.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of EvalQuery or EvalPrint, ready to be executed.</span>
<span class="sd">    Raises:</span>
<span class="sd">      CompilationError: If the statement cannot be compiled, or is not one of the</span>
<span class="sd">        supported statements.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Balances</span><span class="p">):</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="n">transform_balances</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Journal</span><span class="p">):</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="n">transform_journal</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Select</span><span class="p">):</span>
        <span class="n">c_query</span> <span class="o">=</span> <span class="n">compile_select</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span>
                                 <span class="n">targets_environ</span><span class="p">,</span> <span class="n">postings_environ</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Print</span><span class="p">):</span>
        <span class="n">c_query</span> <span class="o">=</span> <span class="n">compile_print</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
            <span class="s2">"Cannot compile a statement of type '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">statement</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">c_query</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_expression">
<code class="highlight language-python">
compile_expression<span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_expression" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Bind an expression to its execution context.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expr</code></td>
<td><code></code></td>
<td>
<p>The root node of an expression.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>environ</code></td>
<td><code></code></td>
<td>
<p>An CompilationEnvironment instance.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The root node of a bound expression.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="sd">"""Bind an expression to its execution context.</span>

<span class="sd">    Args:</span>
<span class="sd">      expr: The root node of an expression.</span>
<span class="sd">      environ: An CompilationEnvironment instance.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The root node of a bound expression.</span>
<span class="sd">    """</span>
    <span class="c1"># Convert column references to the context.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Column</span><span class="p">):</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
        <span class="n">c_operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">compile_expression</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">operands</span><span class="p">]</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">c_operands</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="n">OPERATORS</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)]</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">node_type</span><span class="p">(</span><span class="n">compile_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">environ</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">BinaryOp</span><span class="p">):</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="n">OPERATORS</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)]</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">node_type</span><span class="p">(</span><span class="n">compile_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">environ</span><span class="p">),</span>
                           <span class="n">compile_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">environ</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">EvalConstant</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"Invalid expression to compile: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c_expr</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_from">
<code class="highlight language-python">
compile_from<span class="p">(</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_from" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compiled a From clause as provided by the parser, in the given environment.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td><code></code></td>
<td>
<p>An instance of query_parser.Select.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation context for evaluating entry filters.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Query, ready to be executed.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_from</span><span class="p">(</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="sd">"""Compiled a From clause as provided by the parser, in the given environment.</span>

<span class="sd">    Args:</span>
<span class="sd">      select: An instance of query_parser.Select.</span>
<span class="sd">      environ: : A compilation context for evaluating entry filters.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of Query, ready to be executed.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">from_clause</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c_expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">compile_expression</span><span class="p">(</span><span class="n">from_clause</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">from_clause</span><span class="o">.</span><span class="n">expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Check that the from clause does not contain aggregates.</span>
        <span class="k">if</span> <span class="n">c_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_expression</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Aggregates are not allowed in from clause"</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">from_clause</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_clause</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">from_clause</span><span class="o">.</span><span class="n">open</span> <span class="o">&gt;</span> <span class="n">from_clause</span><span class="o">.</span><span class="n">close</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Invalid dates: CLOSE date must follow OPEN date"</span><span class="p">)</span>

        <span class="n">c_from</span> <span class="o">=</span> <span class="n">EvalFrom</span><span class="p">(</span><span class="n">c_expression</span><span class="p">,</span>
                          <span class="n">from_clause</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
                          <span class="n">from_clause</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
                          <span class="n">from_clause</span><span class="o">.</span><span class="n">clear</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_from</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">c_from</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_group_by">
<code class="highlight language-python">
compile_group_by<span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">c_targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_group_by" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Process a group-by clause.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group_by</code></td>
<td><code></code></td>
<td>
<p>A GroupBy instance as provided by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>c_targets</code></td>
<td><code></code></td>
<td>
<p>A list of compiled target expressions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>environ</code></td>
<td><code></code></td>
<td>
<p>A compilation context to be used to evaluate GROUP BY expressions.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of
 new_targets</code></td>
<td>
<p>A list of new compiled target nodes.
 group_indexes: If the query is an aggregate query, a list of integer
   indexes to be used for processing grouping. Note that this list may be
   empty (in the case of targets with only aggregates). On the other hand,
   if this is not an aggregated query, this is set to None. So do
   distinguish the empty list vs. None.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_group_by</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">c_targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="sd">"""Process a group-by clause.</span>

<span class="sd">    Args:</span>
<span class="sd">      group_by: A GroupBy instance as provided by the parser.</span>
<span class="sd">      c_targets: A list of compiled target expressions.</span>
<span class="sd">      environ: A compilation context to be used to evaluate GROUP BY expressions.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">       new_targets: A list of new compiled target nodes.</span>
<span class="sd">       group_indexes: If the query is an aggregate query, a list of integer</span>
<span class="sd">         indexes to be used for processing grouping. Note that this list may be</span>
<span class="sd">         empty (in the case of targets with only aggregates). On the other hand,</span>
<span class="sd">         if this is not an aggregated query, this is set to None. So do</span>
<span class="sd">         distinguish the empty list vs. None.</span>
<span class="sd">    """</span>
    <span class="n">new_targets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)</span>
    <span class="n">c_target_expressions</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span> <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">c_targets</span><span class="p">]</span>

    <span class="n">group_indexes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">group_by</span><span class="p">:</span>
        <span class="c1"># Check that HAVING is not supported yet.</span>
        <span class="k">if</span> <span class="n">group_by</span> <span class="ow">and</span> <span class="n">group_by</span><span class="o">.</span><span class="n">having</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"The HAVING clause is not supported yet"</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">group_by</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"Internal error with GROUP-BY parsing"</span>

        <span class="c1"># Compile group-by expressions and resolve them to their targets if</span>
        <span class="c1"># possible. A GROUP-BY column may be one of the following:</span>
        <span class="c1">#</span>
        <span class="c1"># * A reference to a target by name.</span>
        <span class="c1"># * A reference to a target by index (starting at one).</span>
        <span class="c1"># * A new, non-aggregate expression.</span>
        <span class="c1">#</span>
        <span class="c1"># References by name are converted to indexes. New expressions are</span>
        <span class="c1"># inserted into the list of targets as invisible targets.</span>
        <span class="n">targets_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">index</span>
                            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">group_by</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Process target references by index.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">column</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                        <span class="s2">"Invalid GROUP-BY column index </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Process target references by name. These will be parsed as</span>
                <span class="c1"># simple Column expressions. If they refer to a target name, we</span>
                <span class="c1"># resolve them.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Column</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">targets_name_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># Otherwise we compile the expression and add it to the list of</span>
                <span class="c1"># targets to evaluate and index into that new target.</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">c_expr</span> <span class="o">=</span> <span class="n">compile_expression</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>

                    <span class="c1"># Check if the new expression is an aggregate.</span>
                    <span class="n">aggregate</span> <span class="o">=</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                            <span class="s2">"GROUP-BY expressions may not be aggregates: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">column</span><span class="p">))</span>

                    <span class="c1"># Attempt to reconcile the expression with one of the existing</span>
                    <span class="c1"># target expressions.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">c_target_expressions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Add the new target. 'None' for the target name implies it</span>
                        <span class="c1"># should be invisible, not to be rendered.</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_targets</span><span class="p">)</span>
                        <span class="n">new_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvalTarget</span><span class="p">(</span><span class="n">c_expr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">))</span>
                        <span class="n">c_target_expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"Internal error, could not index group-by reference."</span>
            <span class="n">group_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># Check that the group-by column references a non-aggregate.</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">new_targets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">c_expr</span>
            <span class="k">if</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_expr</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                    <span class="s2">"GROUP-BY expressions may not reference aggregates: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">))</span>

            <span class="c1"># Check that the group-by column has a supported hashable type.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_hashable_type</span><span class="p">(</span><span class="n">c_expr</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                    <span class="s2">"GROUP-BY a non-hashable type is not supported: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">column</span><span class="p">))</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If it does not have a GROUP-BY clause...</span>
        <span class="n">aggregate_bools</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_target</span><span class="o">.</span><span class="n">is_aggregate</span> <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">c_targets</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">aggregate_bools</span><span class="p">):</span>
            <span class="c1"># If the query is an aggregate query, check that all the targets are</span>
            <span class="c1"># aggregates.</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">aggregate_bools</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">group_indexes</span> <span class="o">==</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If some of the targets aren't aggregates, automatically infer</span>
                <span class="c1"># that they are to be implicit group by targets. This makes for</span>
                <span class="c1"># a much more convenient syntax for our lightweight SQL, where</span>
                <span class="c1"># grouping is optional.</span>
                <span class="k">if</span> <span class="n">SUPPORT_IMPLICIT_GROUPBY</span><span class="p">:</span>
                    <span class="n">group_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span>
                                     <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)</span>
                                     <span class="k">if</span> <span class="ow">not</span> <span class="n">c_target</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                        <span class="s2">"Aggregate query without a GROUP-BY should have only aggregates"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is not an aggregate query; don't set group_indexes to</span>
            <span class="c1"># anything useful, we won't need it.</span>
            <span class="n">group_indexes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">new_targets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c_targets</span><span class="p">):],</span> <span class="n">group_indexes</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_order_by">
<code class="highlight language-python">
compile_order_by<span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="n">c_targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_order_by" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Process an order-by clause.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_by</code></td>
<td><code></code></td>
<td>
<p>A OrderBy instance as provided by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>c_targets</code></td>
<td><code></code></td>
<td>
<p>A list of compiled target expressions.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>environ</code></td>
<td><code></code></td>
<td>
<p>A compilation context to be used to evaluate ORDER BY expressions.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of
 new_targets</code></td>
<td>
<p>A list of new compiled target nodes.
 order_indexes: A list of integer indexes to be used for processing ordering.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="n">c_targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="sd">"""Process an order-by clause.</span>

<span class="sd">    Args:</span>
<span class="sd">      order_by: A OrderBy instance as provided by the parser.</span>
<span class="sd">      c_targets: A list of compiled target expressions.</span>
<span class="sd">      environ: A compilation context to be used to evaluate ORDER BY expressions.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of</span>
<span class="sd">       new_targets: A list of new compiled target nodes.</span>
<span class="sd">       order_indexes: A list of integer indexes to be used for processing ordering.</span>
<span class="sd">    """</span>
    <span class="n">new_targets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)</span>
    <span class="n">c_target_expressions</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span> <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">c_targets</span><span class="p">]</span>
    <span class="n">order_indexes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Compile order-by expressions and resolve them to their targets if</span>
    <span class="c1"># possible. A ORDER-BY column may be one of the following:</span>
    <span class="c1">#</span>
    <span class="c1"># * A reference to a target by name.</span>
    <span class="c1"># * A reference to a target by index (starting at one).</span>
    <span class="c1"># * A new expression, aggregate or not.</span>
    <span class="c1">#</span>
    <span class="c1"># References by name are converted to indexes. New expressions are</span>
    <span class="c1"># inserted into the list of targets as invisible targets.</span>
    <span class="n">targets_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">index</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">order_by</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Process target references by index.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">column</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                    <span class="s2">"Invalid ORDER-BY column index </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Process target references by name. These will be parsed as</span>
            <span class="c1"># simple Column expressions. If they refer to a target name, we</span>
            <span class="c1"># resolve them.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Column</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">targets_name_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Otherwise we compile the expression and add it to the list of</span>
            <span class="c1"># targets to evaluate and index into that new target.</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">compile_expression</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>

                <span class="c1"># Attempt to reconcile the expression with one of the existing</span>
                <span class="c1"># target expressions.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">c_target_expressions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># Add the new target. 'None' for the target name implies it</span>
                    <span class="c1"># should be invisible, not to be rendered.</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_targets</span><span class="p">)</span>
                    <span class="n">new_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvalTarget</span><span class="p">(</span><span class="n">c_expr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)))</span>
                    <span class="n">c_target_expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"Internal error, could not index order-by reference."</span>
        <span class="n">order_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">new_targets</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c_targets</span><span class="p">):],</span> <span class="n">order_indexes</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_print">
<code class="highlight language-python">
compile_print<span class="p">(</span><span class="n">print_stmt</span><span class="p">,</span> <span class="n">env_entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_print" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compile a Print statement.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>statement</code></td>
<td><code></code></td>
<td>
<p>An instance of query_parser.Print.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries_environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation environment for evaluating entry filters.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of EvalPrint, ready to be executed.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>984
985
986
987
988
989
990
991
992
993
994</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_print</span><span class="p">(</span><span class="n">print_stmt</span><span class="p">,</span> <span class="n">env_entries</span><span class="p">):</span>
    <span class="sd">"""Compile a Print statement.</span>

<span class="sd">    Args:</span>
<span class="sd">      statement: An instance of query_parser.Print.</span>
<span class="sd">      entries_environ: : A compilation environment for evaluating entry filters.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of EvalPrint, ready to be executed.</span>
<span class="sd">    """</span>
    <span class="n">c_from</span> <span class="o">=</span> <span class="n">compile_from</span><span class="p">(</span><span class="n">print_stmt</span><span class="o">.</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">env_entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">EvalPrint</span><span class="p">(</span><span class="n">c_from</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_select">
<code class="highlight language-python">
compile_select<span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">targets_environ</span><span class="p">,</span> <span class="n">postings_environ</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_select" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Prepare an AST for a Select statement into a very rudimentary execution tree.
The execution tree mostly looks much like an AST, but with some nodes
replaced with knowledge specific to an execution context and eventually some
basic optimizations.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td><code></code></td>
<td>
<p>An instance of query_parser.Select.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>targets_environ</code></td>
<td><code></code></td>
<td>
<p>A compilation environment for evaluating targets.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>postings_environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation environment for evaluating postings filters.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries_environ</code></td>
<td><code></code></td>
<td>
<p>: A compilation environment for evaluating entry filters.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of EvalQuery, ready to be executed.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_select</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">targets_environ</span><span class="p">,</span> <span class="n">postings_environ</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">):</span>
    <span class="sd">"""Prepare an AST for a Select statement into a very rudimentary execution tree.</span>
<span class="sd">    The execution tree mostly looks much like an AST, but with some nodes</span>
<span class="sd">    replaced with knowledge specific to an execution context and eventually some</span>
<span class="sd">    basic optimizations.</span>

<span class="sd">    Args:</span>
<span class="sd">      select: An instance of query_parser.Select.</span>
<span class="sd">      targets_environ: A compilation environment for evaluating targets.</span>
<span class="sd">      postings_environ: : A compilation environment for evaluating postings filters.</span>
<span class="sd">      entries_environ: : A compilation environment for evaluating entry filters.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of EvalQuery, ready to be executed.</span>
<span class="sd">    """</span>

    <span class="c1"># Process the FROM clause and figure out the execution environment for the</span>
    <span class="c1"># targets and the where clause.</span>
    <span class="n">from_clause</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">from_clause</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Select</span><span class="p">):</span>
        <span class="n">c_from</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">environ_target</span> <span class="o">=</span> <span class="n">ResultSetEnvironment</span><span class="p">()</span>
        <span class="n">environ_where</span> <span class="o">=</span> <span class="n">ResultSetEnvironment</span><span class="p">()</span>

        <span class="c1"># Remove this when we add support for nested queries.</span>
        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Queries from nested SELECT are not supported yet"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">from_clause</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">From</span><span class="p">):</span>
        <span class="c1"># Bind the from clause contents.</span>
        <span class="n">c_from</span> <span class="o">=</span> <span class="n">compile_from</span><span class="p">(</span><span class="n">from_clause</span><span class="p">,</span> <span class="n">entries_environ</span><span class="p">)</span>
        <span class="n">environ_target</span> <span class="o">=</span> <span class="n">targets_environ</span>
        <span class="n">environ_where</span> <span class="o">=</span> <span class="n">postings_environ</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Unexpected from clause in AST: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_clause</span><span class="p">))</span>

    <span class="c1"># Compile the targets.</span>
    <span class="n">c_targets</span> <span class="o">=</span> <span class="n">compile_targets</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">environ_target</span><span class="p">)</span>

    <span class="c1"># Bind the WHERE expression to the execution environment.</span>
    <span class="k">if</span> <span class="n">select</span><span class="o">.</span><span class="n">where_clause</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c_where</span> <span class="o">=</span> <span class="n">compile_expression</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">where_clause</span><span class="p">,</span> <span class="n">environ_where</span><span class="p">)</span>

        <span class="c1"># Aggregates are disallowed in this clause. Check for this.</span>
        <span class="c1"># NOTE: This should never trigger if the compilation environment does not</span>
        <span class="c1"># contain any aggregate. Just being manic and safe here.</span>
        <span class="k">if</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_where</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"Aggregates are disallowed in WHERE clause"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_where</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Process the GROUP-BY clause.</span>
    <span class="n">new_targets</span><span class="p">,</span> <span class="n">group_indexes</span> <span class="o">=</span> <span class="n">compile_group_by</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">group_by</span><span class="p">,</span>
                                                  <span class="n">c_targets</span><span class="p">,</span>
                                                  <span class="n">environ_target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_targets</span><span class="p">:</span>
        <span class="n">c_targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_targets</span><span class="p">)</span>

    <span class="c1"># Process the ORDER-BY clause.</span>
    <span class="k">if</span> <span class="n">select</span><span class="o">.</span><span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="p">(</span><span class="n">new_targets</span><span class="p">,</span> <span class="n">order_indexes</span><span class="p">)</span> <span class="o">=</span> <span class="n">compile_order_by</span><span class="p">(</span><span class="n">select</span><span class="o">.</span><span class="n">order_by</span><span class="p">,</span>
                                                        <span class="n">c_targets</span><span class="p">,</span>
                                                        <span class="n">environ_target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_targets</span><span class="p">:</span>
            <span class="n">c_targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_targets</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">order_by</span><span class="o">.</span><span class="n">ordering</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">order_indexes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If this is an aggregate query (it groups, see list of indexes), check that</span>
    <span class="c1"># the set of non-aggregates match exactly the group indexes. This should</span>
    <span class="c1"># always be the case at this point, because we have added all the necessary</span>
    <span class="c1"># targets to the list of group-by expressions and should have resolved all</span>
    <span class="c1"># the indexes.</span>
    <span class="k">if</span> <span class="n">group_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">non_aggregate_indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">index</span>
                                    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_targets</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">c_target</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">non_aggregate_indexes</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">group_indexes</span><span class="p">):</span>
            <span class="n">missing_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'"</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c_targets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">non_aggregate_indexes</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">group_indexes</span><span class="p">)]</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                <span class="s2">"All non-aggregates must be covered by GROUP-BY clause in aggregate query; "</span>
                <span class="s2">"the following targets are missing: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">","</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_names</span><span class="p">)))</span>

    <span class="c1"># Check that PIVOT-BY is not supported yet.</span>
    <span class="k">if</span> <span class="n">select</span><span class="o">.</span><span class="n">pivot_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span><span class="s2">"The PIVOT BY clause is not supported yet"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">EvalQuery</span><span class="p">(</span><span class="n">c_targets</span><span class="p">,</span>
                     <span class="n">c_from</span><span class="p">,</span>
                     <span class="n">c_where</span><span class="p">,</span>
                     <span class="n">group_indexes</span><span class="p">,</span>
                     <span class="n">order_indexes</span><span class="p">,</span>
                     <span class="n">ordering</span><span class="p">,</span>
                     <span class="n">select</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
                     <span class="n">select</span><span class="o">.</span><span class="n">distinct</span><span class="p">,</span>
                     <span class="n">select</span><span class="o">.</span><span class="n">flatten</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.compile_targets">
<code class="highlight language-python">
compile_targets<span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.compile_targets" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compile the targets and check for their validity. Process wildcard.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>targets</code></td>
<td><code></code></td>
<td>
<p>A list of target expressions from the parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>environ</code></td>
<td><code></code></td>
<td>
<p>A compilation context for the targets.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of compiled target expressions with resolved names.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile_targets</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="sd">"""Compile the targets and check for their validity. Process wildcard.</span>

<span class="sd">    Args:</span>
<span class="sd">      targets: A list of target expressions from the parser.</span>
<span class="sd">      environ: A compilation context for the targets.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of compiled target expressions with resolved names.</span>
<span class="sd">    """</span>
    <span class="c1"># Bind the targets expressions to the execution context.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Wildcard</span><span class="p">):</span>
        <span class="c1"># Insert the full list of available columns.</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_parser</span><span class="o">.</span><span class="n">Target</span><span class="p">(</span><span class="n">query_parser</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">environ</span><span class="o">.</span><span class="n">wildcard_columns</span><span class="p">]</span>

    <span class="c1"># Compile targets.</span>
    <span class="n">c_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">c_expr</span> <span class="o">=</span> <span class="n">compile_expression</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span>
        <span class="n">target_name</span> <span class="o">=</span> <span class="n">find_unique_name</span><span class="p">(</span>
            <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">get_expression_name</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">expression</span><span class="p">),</span>
            <span class="n">target_names</span><span class="p">)</span>
        <span class="n">target_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
        <span class="n">c_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvalTarget</span><span class="p">(</span><span class="n">c_expr</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)))</span>

    <span class="c1"># Figure out if this query is an aggregate query and check validity of each</span>
    <span class="c1"># target's aggregation type.</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_targets</span><span class="p">):</span>
        <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span> <span class="o">=</span> <span class="n">get_columns_and_aggregates</span><span class="p">(</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span><span class="p">)</span>

        <span class="c1"># Check for mixed aggregates and non-aggregates.</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">and</span> <span class="n">aggregates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                <span class="s2">"Mixed aggregates and non-aggregates are not allowed"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">aggregates</span><span class="p">:</span>
            <span class="c1"># Check for aggregates of aggregates.</span>
            <span class="k">for</span> <span class="n">aggregate</span> <span class="ow">in</span> <span class="n">aggregates</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">aggregate</span><span class="o">.</span><span class="n">childnodes</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">is_aggregate</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CompilationError</span><span class="p">(</span>
                            <span class="s2">"Aggregates of aggregates are not allowed"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c_targets</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.find_unique_name">
<code class="highlight language-python">
find_unique_name<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allocated_set</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.find_unique_name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Come up with a unique name for 'name' amongst 'allocated_set'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code></code></td>
<td>
<p>A string, the prefix of the name to find a unique for.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>allocated_set</code></td>
<td><code></code></td>
<td>
<p>A set of string, the set of already allocated names.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A unique name. 'allocated_set' is unmodified.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">find_unique_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allocated_set</span><span class="p">):</span>
    <span class="sd">"""Come up with a unique name for 'name' amongst 'allocated_set'.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: A string, the prefix of the name to find a unique for.</span>
<span class="sd">      allocated_set: A set of string, the set of already allocated names.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A unique name. 'allocated_set' is unmodified.</span>
<span class="sd">    """</span>
    <span class="c1"># Make sure the name is unique.</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">allocated_set</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.get_columns_and_aggregates">
<code class="highlight language-python">
get_columns_and_aggregates<span class="p">(</span><span class="n">node</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.get_columns_and_aggregates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find the columns and aggregate nodes below this tree.</p>
<p>All nodes under aggregate nodes are ignored.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>node</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalNode.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A pair of (columns, aggregates), both of which are lists of EvalNode instances.
  columns</code></td>
<td>
<p>The list of all columns accessed not under an aggregate node.
  aggregates: The lis tof all aggregate nodes.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_columns_and_aggregates</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">"""Find the columns and aggregate nodes below this tree.</span>

<span class="sd">    All nodes under aggregate nodes are ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">      node: An instance of EvalNode.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of (columns, aggregates), both of which are lists of EvalNode instances.</span>
<span class="sd">        columns: The list of all columns accessed not under an aggregate node.</span>
<span class="sd">        aggregates: The lis tof all aggregate nodes.</span>
<span class="sd">    """</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">aggregates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_get_columns_and_aggregates</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">columns</span><span class="p">,</span> <span class="n">aggregates</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.is_aggregate">
<code class="highlight language-python">
is_aggregate<span class="p">(</span><span class="n">node</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.is_aggregate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the node is an aggregate.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>node</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalNode.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>466
467
468
469
470
471
472
473
474
475
476
477</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_aggregate</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">"""Return true if the node is an aggregate.</span>

<span class="sd">    Args:</span>
<span class="sd">      node: An instance of EvalNode.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="c1"># Note: We could be a tiny bit more efficient here, but it doesn't matter</span>
    <span class="c1"># much. Performance of the query compilation matters very little overall.</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">aggregates</span> <span class="o">=</span> <span class="n">get_columns_and_aggregates</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">aggregates</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.is_hashable_type">
<code class="highlight language-python">
is_hashable_type<span class="p">(</span><span class="n">node</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.is_hashable_type" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the node is of a hashable type.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>node</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalNode.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>480
481
482
483
484
485
486
487
488</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_hashable_type</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">"""Return true if the node is of a hashable type.</span>

<span class="sd">    Args:</span>
<span class="sd">      node: An instance of EvalNode.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.transform_balances">
<code class="highlight language-python">
transform_balances<span class="p">(</span><span class="n">balances</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.transform_balances" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Translate a Balances entry into an uncompiled Select statement.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>balances</code></td>
<td><code></code></td>
<td>
<p>An instance of a Balance object.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of an uncompiled Select object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">transform_balances</span><span class="p">(</span><span class="n">balances</span><span class="p">):</span>
    <span class="sd">"""Translate a Balances entry into an uncompiled Select statement.</span>

<span class="sd">    Args:</span>
<span class="sd">      balances: An instance of a Balance object.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of an uncompiled Select object.</span>
<span class="sd">    """</span>
    <span class="c1">## FIXME: Change the aggregation rules to allow GROUP-BY not to include the</span>
    <span class="c1">## non-aggregate ORDER-BY columns, so we could just GROUP-BY accounts here</span>
    <span class="c1">## instead of having to include the sort-key. I think it should be fine if</span>
    <span class="c1">## the first or last sort-order value gets used, because it would simplify</span>
    <span class="c1">## the input statement.</span>

    <span class="n">cooked_select</span> <span class="o">=</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">      SELECT account, SUM(</span><span class="si">{}</span><span class="s2">(position))</span>
<span class="s2">      GROUP BY account, ACCOUNT_SORTKEY(account)</span>
<span class="s2">      ORDER BY ACCOUNT_SORTKEY(account)</span>

<span class="s2">    """</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">balances</span><span class="o">.</span><span class="n">summary_func</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">cooked_select</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                               <span class="n">balances</span><span class="o">.</span><span class="n">from_clause</span><span class="p">,</span>
                               <span class="n">balances</span><span class="o">.</span><span class="n">where_clause</span><span class="p">,</span>
                               <span class="n">cooked_select</span><span class="o">.</span><span class="n">group_by</span><span class="p">,</span>
                               <span class="n">cooked_select</span><span class="o">.</span><span class="n">order_by</span><span class="p">,</span>
                               <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_compile.transform_journal">
<code class="highlight language-python">
transform_journal<span class="p">(</span><span class="n">journal</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile.transform_journal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Translate a Journal entry into an uncompiled Select statement.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>journal</code></td>
<td><code></code></td>
<td>
<p>An instance of a Journal object.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of an uncompiled Select object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">transform_journal</span><span class="p">(</span><span class="n">journal</span><span class="p">):</span>
    <span class="sd">"""Translate a Journal entry into an uncompiled Select statement.</span>

<span class="sd">    Args:</span>
<span class="sd">      journal: An instance of a Journal object.</span>
<span class="sd">    Returns:</span>
<span class="sd">      An instance of an uncompiled Select object.</span>
<span class="sd">    """</span>
    <span class="n">cooked_select</span> <span class="o">=</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"""</span>

<span class="s2">        SELECT</span>
<span class="s2">           date,</span>
<span class="s2">           flag,</span>
<span class="s2">           MAXWIDTH(payee, 48),</span>
<span class="s2">           MAXWIDTH(narration, 80),</span>
<span class="s2">           account,</span>
<span class="s2">           </span><span class="si">{summary_func}</span><span class="s2">(position),</span>
<span class="s2">           </span><span class="si">{summary_func}</span><span class="s2">(balance)</span>
<span class="s2">        </span><span class="si">{where}</span><span class="s2"></span>

<span class="s2">    """</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="s1">'WHERE account ~ "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">journal</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">journal</span><span class="o">.</span><span class="n">account</span>
                      <span class="k">else</span> <span class="s1">''</span><span class="p">),</span>
               <span class="n">summary_func</span><span class="o">=</span><span class="n">journal</span><span class="o">.</span><span class="n">summary_func</span> <span class="ow">or</span> <span class="s1">''</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">cooked_select</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                               <span class="n">journal</span><span class="o">.</span><span class="n">from_clause</span><span class="p">,</span>
                               <span class="n">cooked_select</span><span class="o">.</span><span class="n">where_clause</span><span class="p">,</span>
                               <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_compile_test">
<code>query_compile_test</code>
<a class="headerlink" href="#beancount.query.query_compile_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase">
<code>CompileSelectBase</code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase.assertCompile">
<code class="highlight language-python">
assertCompile<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase.assertCompile" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Assert parsed and compiled contents from 'query' is 'expected'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expected</code></td>
<td><code></code></td>
<td>
<p>An expected AST to compare against the parsed value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>debug</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, print extra debugging information on the console.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the actual AST does not match the expected one.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertCompile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Assert parsed and compiled contents from 'query' is 'expected'.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected: An expected AST to compare against the parsed value.</span>
<span class="sd">      query: An SQL query to be parsed.</span>
<span class="sd">      debug: A boolean, if true, print extra debugging information on the console.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the actual AST does not match the expected one.</span>
<span class="sd">    """</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">actual</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Expected: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Actual  : </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>
        <span class="k">raise</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase.assertIndexes">
<code class="highlight language-python">
assertIndexes<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">expected_simple_indexes</span><span class="p">,</span> <span class="n">expected_aggregate_indexes</span><span class="p">,</span> <span class="n">expected_group_indexes</span><span class="p">,</span> <span class="n">expected_order_indexes</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase.assertIndexes" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Check the four lists of indexes for comparison.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalQuery, a compiled query statement.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expected_simple_indexes</code></td>
<td><code></code></td>
<td>
<p>The expected visible non-aggregate indexes.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expected_aggregate_indexes</code></td>
<td><code></code></td>
<td>
<p>The expected visible aggregate indexes.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expected_group_indexes</code></td>
<td><code></code></td>
<td>
<p>The expected group_indexes.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expected_order_indexes</code></td>
<td><code></code></td>
<td>
<p>The expected order_indexes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>if the check fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertIndexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">query</span><span class="p">,</span>
                  <span class="n">expected_simple_indexes</span><span class="p">,</span>
                  <span class="n">expected_aggregate_indexes</span><span class="p">,</span>
                  <span class="n">expected_group_indexes</span><span class="p">,</span>
                  <span class="n">expected_order_indexes</span><span class="p">):</span>
    <span class="sd">"""Check the four lists of indexes for comparison.</span>

<span class="sd">    Args:</span>
<span class="sd">      query: An instance of EvalQuery, a compiled query statement.</span>
<span class="sd">      expected_simple_indexes: The expected visible non-aggregate indexes.</span>
<span class="sd">      expected_aggregate_indexes: The expected visible aggregate indexes.</span>
<span class="sd">      expected_group_indexes: The expected group_indexes.</span>
<span class="sd">      expected_order_indexes: The expected order_indexes.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: if the check fails.</span>
<span class="sd">    """</span>
    <span class="c1"># Compute the list of _visible_ aggregates and non-aggregates.</span>
    <span class="n">simple_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span>
                      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">c_target</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">qc</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_target</span><span class="o">.</span><span class="n">expression</span><span class="p">)]</span>
    <span class="n">aggregate_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span>
                         <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">c_target</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="n">qc</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_target</span><span class="o">.</span><span class="n">expression</span><span class="p">)]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">expected_simple_indexes</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">simple_indexes</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">expected_aggregate_indexes</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">aggregate_indexes</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">expected_group_indexes</span><span class="p">)</span> <span class="k">if</span> <span class="n">expected_group_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span><span class="p">)</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">expected_order_indexes</span><span class="p">)</span> <span class="k">if</span> <span class="n">expected_order_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">order_indexes</span><span class="p">)</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">order_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase.assertSelectInvariants">
<code class="highlight language-python">
assertSelectInvariants<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase.assertSelectInvariants" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Assert the invariants on the query.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An instance of EvalQuery, a compiled query statement.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>if the check fails.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertSelectInvariants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="sd">"""Assert the invariants on the query.</span>

<span class="sd">    Args:</span>
<span class="sd">      query: An instance of EvalQuery, a compiled query statement.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: if the check fails.</span>
<span class="sd">    """</span>
    <span class="c1"># Check that the group references cover all the simple indexes.</span>
    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">non_aggregate_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span>
                                 <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">)</span>
                                 <span class="k">if</span> <span class="ow">not</span> <span class="n">qc</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">non_aggregate_indexes</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span><span class="p">),</span>
                         <span class="s2">"Invalid indexes: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase.compile">
<code class="highlight language-python">
compile<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase.compile" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Parse one query and compile it.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The AST.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="sd">"""Parse one query and compile it.</span>

<span class="sd">    Args:</span>
<span class="sd">      query: An SQL query to be parsed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The AST.</span>
<span class="sd">    """</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">c_query</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_targets</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_postings</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c_query</span><span class="p">,</span> <span class="n">qp</span><span class="o">.</span><span class="n">Select</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertSelectInvariants</span><span class="p">(</span><span class="n">c_query</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c_query</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_compile_test.CompileSelectBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_compile_test.CompileSelectBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_compile_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>209
210</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_env">
<code>query_env</code>
<a class="headerlink" href="#beancount.query.query_env" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Environment object for compiler.</p>
<p>This module contains the various column accessors and function evaluators that
are made available by the query compiler via their compilation context objects.
Define new columns and functions here.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env._Neg">
<code>_Neg</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_env._Neg" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the negative value of the argument. This works on various types.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AbsDecimal">
<code>AbsDecimal</code>
<a class="headerlink" href="#beancount.query.query_env.AbsDecimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the length of the argument. This works on sequences.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AbsInventory">
<code>AbsInventory</code>
<a class="headerlink" href="#beancount.query.query_env.AbsInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the length of the argument. This works on sequences.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AbsPosition">
<code>AbsPosition</code>
<a class="headerlink" href="#beancount.query.query_env.AbsPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the length of the argument. This works on sequences.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AccountColumn">
<code>AccountColumn</code>
<a class="headerlink" href="#beancount.query.query_env.AccountColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The account of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AccountSortKey">
<code>AccountSortKey</code>
<a class="headerlink" href="#beancount.query.query_env.AccountSortKey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get a string to sort accounts in order taking into account the types.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.AnyMeta">
<code>AnyMeta</code>
<a class="headerlink" href="#beancount.query.query_env.AnyMeta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get metadata from the posting or its parent transaction's metadata if not present.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.BalanceColumn">
<code>BalanceColumn</code>
<a class="headerlink" href="#beancount.query.query_env.BalanceColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The balance for the posting. These can be summed into inventories.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CloseDate">
<code>CloseDate</code>
<a class="headerlink" href="#beancount.query.query_env.CloseDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the date of the close directive of the account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Coalesce">
<code>Coalesce</code>
<a class="headerlink" href="#beancount.query.query_env.Coalesce" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the first non-null argument</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertAmount">
<code>ConvertAmount</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertAmount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an amount to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertAmountWithDate">
<code>ConvertAmountWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertAmountWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an amount to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertInventory">
<code>ConvertInventory</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an inventory to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertInventoryWithDate">
<code>ConvertInventoryWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertInventoryWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an inventory to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertPosition">
<code>ConvertPosition</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an amount to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ConvertPositionWithDate">
<code>ConvertPositionWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.ConvertPositionWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an amount to a particular currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostCurrencyColumn">
<code>CostCurrencyColumn</code>
<a class="headerlink" href="#beancount.query.query_env.CostCurrencyColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The cost currency of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostDateColumn">
<code>CostDateColumn</code>
<a class="headerlink" href="#beancount.query.query_env.CostDateColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The cost currency of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostInventory">
<code>CostInventory</code>
<a class="headerlink" href="#beancount.query.query_env.CostInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the cost of an inventory.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostLabelColumn">
<code>CostLabelColumn</code>
<a class="headerlink" href="#beancount.query.query_env.CostLabelColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The cost currency of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostNumberColumn">
<code>CostNumberColumn</code>
<a class="headerlink" href="#beancount.query.query_env.CostNumberColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The number of cost units of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CostPosition">
<code>CostPosition</code>
<a class="headerlink" href="#beancount.query.query_env.CostPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the cost of a position.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Count">
<code>Count</code>
<a class="headerlink" href="#beancount.query.query_env.Count" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Count the number of occurrences of the argument.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Count.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Count.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>936
937</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Count.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Count.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>939
940</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Count.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">unused_ontext</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Count.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>942
943</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">unused_ontext</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Currency">
<code>Currency</code>
<a class="headerlink" href="#beancount.query.query_env.Currency" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the currency from an Amount.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CurrencyColumn">
<code>CurrencyColumn</code>
<a class="headerlink" href="#beancount.query.query_env.CurrencyColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The currency of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.CurrencyMeta">
<code>CurrencyMeta</code>
<a class="headerlink" href="#beancount.query.query_env.CurrencyMeta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the metadata dict of the commodity directive of the currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Date">
<code>Date</code>
<a class="headerlink" href="#beancount.query.query_env.Date" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Construct a date with year, month, day arguments</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DateAdd">
<code>DateAdd</code>
<a class="headerlink" href="#beancount.query.query_env.DateAdd" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Adds/subtracts number of days from the given date</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DateColumn">
<code>DateColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DateColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The date of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DateDiff">
<code>DateDiff</code>
<a class="headerlink" href="#beancount.query.query_env.DateDiff" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculates the difference (in days) between two dates</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DateEntryColumn">
<code>DateEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DateEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The date of the directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Day">
<code>Day</code>
<a class="headerlink" href="#beancount.query.query_env.Day" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the day from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DayColumn">
<code>DayColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DayColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The day of the date of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DayEntryColumn">
<code>DayEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DayEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The day of the date of the directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DescriptionColumn">
<code>DescriptionColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DescriptionColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A combination of the payee + narration for the transaction of this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.DescriptionEntryColumn">
<code>DescriptionEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.DescriptionEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A combination of the payee + narration of the transaction, if present.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.EntryMeta">
<code>EntryMeta</code>
<a class="headerlink" href="#beancount.query.query_env.EntryMeta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get some metadata key of the parent directive (Transaction).</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FileLocationColumn">
<code>FileLocationColumn</code>
<a class="headerlink" href="#beancount.query.query_env.FileLocationColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The filename:lineno where the posting was parsed from or created.</p>
<pre><code>If you select this column as the first column, because it renders like
errors, Emacs is able to pick those up and you can navigate between an
arbitrary list of transactions with next-error and previous-error.
</code></pre>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilenameColumn">
<code>FilenameColumn</code>
<a class="headerlink" href="#beancount.query.query_env.FilenameColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The filename where the posting was parsed from or created.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilenameEntryColumn">
<code>FilenameEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.FilenameEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The filename where the directive was parsed from or created.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilterCurrencyInventory">
<code>FilterCurrencyInventory</code>
<a class="headerlink" href="#beancount.query.query_env.FilterCurrencyInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter an inventory to just the specified currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilterCurrencyPosition">
<code>FilterCurrencyPosition</code>
<a class="headerlink" href="#beancount.query.query_env.FilterCurrencyPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter an inventory to just the specified currency.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilterEntriesEnvironment">
<code>FilterEntriesEnvironment</code>
<a class="headerlink" href="#beancount.query.query_env.FilterEntriesEnvironment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An execution context that provides access to attributes on Transactions
    and other entry types.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FilterPostingsEnvironment">
<code>FilterPostingsEnvironment</code>
<a class="headerlink" href="#beancount.query.query_env.FilterPostingsEnvironment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An execution context that provides access to attributes on Postings.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FindFirst">
<code>FindFirst</code>
<a class="headerlink" href="#beancount.query.query_env.FindFirst" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter a string sequence by regular expression and return the first match.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.First">
<code>First</code>
<a class="headerlink" href="#beancount.query.query_env.First" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Keep the first of the values seen.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.First.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.First.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1015
1016</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.First.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.First.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1018
1019</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.First.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.First.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1021
1022
1023
1024</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FlagColumn">
<code>FlagColumn</code>
<a class="headerlink" href="#beancount.query.query_env.FlagColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The flag of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.FlagEntryColumn">
<code>FlagEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.FlagEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The flag the transaction.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.GetItemStr">
<code>GetItemStr</code>
<a class="headerlink" href="#beancount.query.query_env.GetItemStr" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the string value of a dict. The value is always converted to a string.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Grep">
<code>Grep</code>
<a class="headerlink" href="#beancount.query.query_env.Grep" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Match a group against a string and return only the matched portion.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.GrepN">
<code>GrepN</code>
<a class="headerlink" href="#beancount.query.query_env.GrepN" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Match a pattern with subgroups against a string and return the subgroup at the index</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.IdColumn">
<code>IdColumn</code>
<a class="headerlink" href="#beancount.query.query_env.IdColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The unique id of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.IdEntryColumn">
<code>IdEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.IdEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Unique id of a directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.JoinStr">
<code>JoinStr</code>
<a class="headerlink" href="#beancount.query.query_env.JoinStr" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Join a sequence of strings to a single comma-separated string.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Last">
<code>Last</code>
<a class="headerlink" href="#beancount.query.query_env.Last" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Keep the last of the values seen.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Last.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Last.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1036
1037</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Last.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Last.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1039
1040</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Last.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Last.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1042
1043
1044</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Leaf">
<code>Leaf</code>
<a class="headerlink" href="#beancount.query.query_env.Leaf" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of the leaf subaccount.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Length">
<code>Length</code>
<a class="headerlink" href="#beancount.query.query_env.Length" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the length of the argument. This works on sequences.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.LineNoColumn">
<code>LineNoColumn</code>
<a class="headerlink" href="#beancount.query.query_env.LineNoColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The line number from the file the posting was parsed from.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.LineNoEntryColumn">
<code>LineNoEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.LineNoEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The line number from the file the directive was parsed from.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.LinksColumn">
<code>LinksColumn</code>
<a class="headerlink" href="#beancount.query.query_env.LinksColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The set of links of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.LinksEntryColumn">
<code>LinksEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.LinksEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The set of links of the transaction.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.MatchAccount">
<code>MatchAccount</code>
<a class="headerlink" href="#beancount.query.query_env.MatchAccount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A predicate, true if the transaction has at least one posting matching
    the regular expression argument.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Max">
<code>Max</code>
<a class="headerlink" href="#beancount.query.query_env.Max" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the maximum of the values.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Max.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Max.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1077
1078</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Max.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Max.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1080
1081</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Max.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Max.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1083
1084
1085
1086</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]:</span>
        <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.MaxWidth">
<code>MaxWidth</code>
<a class="headerlink" href="#beancount.query.query_env.MaxWidth" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert the argument to a substring. This can be used to ensure maximum width</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Meta">
<code>Meta</code>
<a class="headerlink" href="#beancount.query.query_env.Meta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get some metadata key of the Posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Min">
<code>Min</code>
<a class="headerlink" href="#beancount.query.query_env.Min" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Compute the minimum of the values.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Min.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Min.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1056
1057</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Min.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Min.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1059
1060</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Min.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Min.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1062
1063
1064
1065</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]:</span>
        <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Month">
<code>Month</code>
<a class="headerlink" href="#beancount.query.query_env.Month" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the month from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.MonthColumn">
<code>MonthColumn</code>
<a class="headerlink" href="#beancount.query.query_env.MonthColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The month of the date of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.MonthEntryColumn">
<code>MonthEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.MonthEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The month of the date of the directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.NarrationColumn">
<code>NarrationColumn</code>
<a class="headerlink" href="#beancount.query.query_env.NarrationColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The narration of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.NarrationEntryColumn">
<code>NarrationEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.NarrationEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The narration of the transaction.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Number">
<code>Number</code>
<a class="headerlink" href="#beancount.query.query_env.Number" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the number from an Amount.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.NumberColumn">
<code>NumberColumn</code>
<a class="headerlink" href="#beancount.query.query_env.NumberColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The number of units of the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.OnlyInventory">
<code>OnlyInventory</code>
<a class="headerlink" href="#beancount.query.query_env.OnlyInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get one currency's amount from the inventory.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.OpenDate">
<code>OpenDate</code>
<a class="headerlink" href="#beancount.query.query_env.OpenDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the date of the open directive of the account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.OpenMeta">
<code>OpenMeta</code>
<a class="headerlink" href="#beancount.query.query_env.OpenMeta" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the metadata dict of the open directive of the account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.OtherAccountsColumn">
<code>OtherAccountsColumn</code>
<a class="headerlink" href="#beancount.query.query_env.OtherAccountsColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The list of other accounts in the transcation, excluding that of this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Parent">
<code>Parent</code>
<a class="headerlink" href="#beancount.query.query_env.Parent" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the parent name of the account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ParseDate">
<code>ParseDate</code>
<a class="headerlink" href="#beancount.query.query_env.ParseDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Construct a date with year, month, day arguments</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PayeeColumn">
<code>PayeeColumn</code>
<a class="headerlink" href="#beancount.query.query_env.PayeeColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The payee of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PayeeEntryColumn">
<code>PayeeEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.PayeeEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The payee of the transaction.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PositionColumn">
<code>PositionColumn</code>
<a class="headerlink" href="#beancount.query.query_env.PositionColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The position for the posting. These can be summed into inventories.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PosSignAmount">
<code>PosSignAmount</code>
<a class="headerlink" href="#beancount.query.query_env.PosSignAmount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Correct sign of an Amount based on the usual balance of associated account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PosSignDecimal">
<code>PosSignDecimal</code>
<a class="headerlink" href="#beancount.query.query_env.PosSignDecimal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Correct sign of an Amount based on the usual balance of associated account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PosSignInventory">
<code>PosSignInventory</code>
<a class="headerlink" href="#beancount.query.query_env.PosSignInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Correct sign of an Amount based on the usual balance of associated account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PosSignPosition">
<code>PosSignPosition</code>
<a class="headerlink" href="#beancount.query.query_env.PosSignPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Correct sign of an Amount based on the usual balance of associated account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PostingFlagColumn">
<code>PostingFlagColumn</code>
<a class="headerlink" href="#beancount.query.query_env.PostingFlagColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The flag of the posting itself.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Price">
<code>Price</code>
<a class="headerlink" href="#beancount.query.query_env.Price" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Fetch a price for something at a particular date</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PriceColumn">
<code>PriceColumn</code>
<a class="headerlink" href="#beancount.query.query_env.PriceColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The price attached to the posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.PriceWithDate">
<code>PriceWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.PriceWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Fetch a price for something at a particular date</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Quarter">
<code>Quarter</code>
<a class="headerlink" href="#beancount.query.query_env.Quarter" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the quarter from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Root">
<code>Root</code>
<a class="headerlink" href="#beancount.query.query_env.Root" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the root name(s) of the account.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.SafeDiv">
<code>SafeDiv</code>
<a class="headerlink" href="#beancount.query.query_env.SafeDiv" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A division operation that swallows dbz exceptions and outputs 0 instead.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Str">
<code>Str</code>
<a class="headerlink" href="#beancount.query.query_env.Str" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert the argument to a string.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Subst">
<code>Subst</code>
<a class="headerlink" href="#beancount.query.query_env.Subst" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Substitute leftmost non-overlapping occurrences of pattern by replacement.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Sum">
<code>Sum</code>
<a class="headerlink" href="#beancount.query.query_env.Sum" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculate the sum of the numerical argument.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Sum.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Sum.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>955
956</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Sum.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Sum.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>958
959</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.Sum.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.Sum.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>961
962
963
964</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.SumAmount">
<code>SumAmount</code>
<a class="headerlink" href="#beancount.query.query_env.SumAmount" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculate the sum of the amount. The result is an Inventory.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.SumAmount.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.SumAmount.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>988
989
990</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span><span class="o">.</span><span class="n">add_amount</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.SumBase">
<code>SumBase</code>
<a class="headerlink" href="#beancount.query.query_env.SumBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.SumBase.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.SumBase.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate handles to store data for a node's aggregate storage.</p>
<p>This is called once before beginning aggregations. If you need any
kind of per-aggregate storage during the computation phase, get it
in this method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocator</code></td>
<td><code></code></td>
<td>
<p>An instance of Allocator, on which you can call allocate() to
obtain a handle for a slot to store data on store objects later on.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>974
975</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allocator</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">allocate</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.SumBase.initialize">
<code class="highlight language-python">
initialize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.SumBase.initialize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize this node's aggregate data. If the node is not an aggregate,
simply initialize the subnodes. Override this method in the aggregator
if you need data for storage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>977
978</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.SumInventory">
<code>SumInventory</code>
<a class="headerlink" href="#beancount.query.query_env.SumInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculate the sum of the inventories. The result is an Inventory.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.SumInventory.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.SumInventory.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1004
1005
1006</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span><span class="o">.</span><span class="n">add_inventory</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.SumPosition">
<code>SumPosition</code>
<a class="headerlink" href="#beancount.query.query_env.SumPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculate the sum of the position. The result is an Inventory.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_env.SumPosition.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_env.SumPosition.update" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate this node. This is designed to recurse on its children.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code></code></td>
<td>
<p>An object indexable by handles appropriated during allocate().</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>The object to which the evaluation need to apply (see <strong>call</strong>).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_env.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>996
997
998</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_args</span><span class="p">(</span><span class="n">context</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">]</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.TagsColumn">
<code>TagsColumn</code>
<a class="headerlink" href="#beancount.query.query_env.TagsColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The set of tags of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.TagsEntryColumn">
<code>TagsEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.TagsEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The set of tags of the transaction.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.TargetsEnvironment">
<code>TargetsEnvironment</code>
<a class="headerlink" href="#beancount.query.query_env.TargetsEnvironment" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An execution context that provides access to attributes on Postings.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Today">
<code>Today</code>
<a class="headerlink" href="#beancount.query.query_env.Today" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Today's date</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.TypeColumn">
<code>TypeColumn</code>
<a class="headerlink" href="#beancount.query.query_env.TypeColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The data type of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.TypeEntryColumn">
<code>TypeEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.TypeEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The data type of the directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.UnitsInventory">
<code>UnitsInventory</code>
<a class="headerlink" href="#beancount.query.query_env.UnitsInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the number of units of an inventory (stripping cost).</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.UnitsPosition">
<code>UnitsPosition</code>
<a class="headerlink" href="#beancount.query.query_env.UnitsPosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the number of units of a position (stripping cost).</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ValueInventory">
<code>ValueInventory</code>
<a class="headerlink" href="#beancount.query.query_env.ValueInventory" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an inventory to its market value at the current date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ValueInventoryWithDate">
<code>ValueInventoryWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.ValueInventoryWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Coerce an inventory to its market value at a particular date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ValuePosition">
<code>ValuePosition</code>
<a class="headerlink" href="#beancount.query.query_env.ValuePosition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a position to its cost currency at the market value.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.ValuePositionWithDate">
<code>ValuePositionWithDate</code>
<a class="headerlink" href="#beancount.query.query_env.ValuePositionWithDate" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a position to its cost currency at the market value of a particular date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Weekday">
<code>Weekday</code>
<a class="headerlink" href="#beancount.query.query_env.Weekday" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract a 3-letter weekday from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.WeightColumn">
<code>WeightColumn</code>
<a class="headerlink" href="#beancount.query.query_env.WeightColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The computed weight used for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.Year">
<code>Year</code>
<a class="headerlink" href="#beancount.query.query_env.Year" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the year from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.YearColumn">
<code>YearColumn</code>
<a class="headerlink" href="#beancount.query.query_env.YearColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The year of the date of the parent transaction for this posting.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.YearEntryColumn">
<code>YearEntryColumn</code>
<a class="headerlink" href="#beancount.query.query_env.YearEntryColumn" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The year of the date of the directive.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_env.YearMonth">
<code>YearMonth</code>
<a class="headerlink" href="#beancount.query.query_env.YearMonth" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract the year and month from a date.</p>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_execute">
<code>query_execute</code>
<a class="headerlink" href="#beancount.query.query_execute" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Execution of interpreter on data rows.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_execute.Allocator">
<code>Allocator</code>
<a class="headerlink" href="#beancount.query.query_execute.Allocator" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A helper class to count slot allocations and return unique handles to them.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_execute.Allocator.allocate">
<code class="highlight language-python">
allocate<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.Allocator.allocate" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Allocate a new slot to store row aggregation information.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A unique handle used to index into an row-aggregation store (an integer).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>106
107
108
109
110
111
112
113
114</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Allocate a new slot to store row aggregation information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A unique handle used to index into an row-aggregation store (an integer).</span>
<span class="sd">    """</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">handle</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_execute.Allocator.create_store">
<code class="highlight language-python">
create_store<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.Allocator.create_store" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new row-aggregation store suitable to contain all the node allocations.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A store that can accomodate and be indexed by all the allocated slot handles.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>116
117
118
119
120
121
122</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Create a new row-aggregation store suitable to contain all the node allocations.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A store that can accomodate and be indexed by all the allocated slot handles.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_execute.RowContext">
<code>RowContext</code>
<a class="headerlink" href="#beancount.query.query_execute.RowContext" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A dumb container for information used by a row expression.</p>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.create_row_context">
<code class="highlight language-python">
create_row_context<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.create_row_context" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Create the context container which we will use to evaluate rows.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>196
197
198
199
200
201
202
203
204
205
206
207
208</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_row_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
    <span class="sd">"""Create the context container which we will use to evaluate rows."""</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RowContext</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">()</span>

    <span class="c1"># Initialize some global properties for use by some of the accessors.</span>
    <span class="n">context</span><span class="o">.</span><span class="n">options_map</span> <span class="o">=</span> <span class="n">options_map</span>
    <span class="n">context</span><span class="o">.</span><span class="n">account_types</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get_account_types</span><span class="p">(</span><span class="n">options_map</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">open_close_map</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_account_open_close</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">commodity_map</span> <span class="o">=</span> <span class="n">getters</span><span class="o">.</span><span class="n">get_commodity_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">price_map</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">build_price_map</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">context</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.execute_print">
<code class="highlight language-python">
execute_print<span class="p">(</span><span class="n">c_print</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.execute_print" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print entries from a print statement specification.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>c_print</code></td>
<td><code></code></td>
<td>
<p>An instance of a compiled EvalPrint statemnet.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>A parser's option_map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>The output file to print to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">execute_print</span><span class="p">(</span><span class="n">c_print</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="sd">"""Print entries from a print statement specification.</span>

<span class="sd">    Args:</span>
<span class="sd">      c_print: An instance of a compiled EvalPrint statemnet.</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: A parser's option_map.</span>
<span class="sd">      file: The output file to print to.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">c_print</span> <span class="ow">and</span> <span class="n">c_print</span><span class="o">.</span><span class="n">c_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">create_row_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">filter_entries</span><span class="p">(</span><span class="n">c_print</span><span class="o">.</span><span class="n">c_from</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="c1"># Create a context that renders all numbers with their natural</span>
    <span class="c1"># precision, but honors the commas option. This is kept in sync with</span>
    <span class="c1"># {2c694afe3140} to avoid a dependency.</span>
    <span class="n">dcontext</span> <span class="o">=</span> <span class="n">display_context</span><span class="o">.</span><span class="n">DisplayContext</span><span class="p">()</span>
    <span class="n">dcontext</span><span class="o">.</span><span class="n">set_commas</span><span class="p">(</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span><span class="o">.</span><span class="n">commas</span><span class="p">)</span>
    <span class="n">printer</span><span class="o">.</span><span class="n">print_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.execute_query">
<code class="highlight language-python">
execute_query<span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.execute_query" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Given a compiled select statement, execute the query.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An instance of a query_compile.Query</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>A parser's option_map.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A pair of</code></td>
<td>
<p>result_types: A list of (name, data-type) item pairs.
  result_rows: A list of ResultRow tuples of length and types described by
    'result_types'.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">):</span>
    <span class="sd">"""Given a compiled select statement, execute the query.</span>

<span class="sd">    Args:</span>
<span class="sd">      query: An instance of a query_compile.Query</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: A parser's option_map.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of:</span>
<span class="sd">        result_types: A list of (name, data-type) item pairs.</span>
<span class="sd">        result_rows: A list of ResultRow tuples of length and types described by</span>
<span class="sd">          'result_types'.</span>
<span class="sd">    """</span>
    <span class="c1"># Figure out the result types that describe what we return.</span>
    <span class="n">result_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">c_expr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">c_targets</span>
                    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># Create a class for each final result.</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">ResultRow</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'ResultRow'</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">name</span>
                                        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">c_targets</span>
                                        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>

    <span class="c1"># Pre-compute lists of the expressions to evaluate.</span>
    <span class="n">group_indexes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                     <span class="k">else</span> <span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span><span class="p">)</span>

    <span class="c1"># Indexes of the columns for result rows and order rows.</span>
    <span class="n">result_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span>
                      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">c_target</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="n">order_indexes</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">order_indexes</span>

    <span class="c1"># Figure out if we need to compute balance.</span>
    <span class="n">uses_balance</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">uses_balance_column</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                               <span class="p">[</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span> <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">c_where</span><span class="p">]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">c_where</span> <span class="k">else</span> <span class="p">[]))</span>

    <span class="n">context</span> <span class="o">=</span> <span class="n">create_row_context</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Filter the entries using the FROM clause.</span>
    <span class="n">filt_entries</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_entries</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c_from</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">c_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
                    <span class="n">entries</span><span class="p">)</span>

    <span class="c1"># Dispatch between the non-aggregated queries and aggregated queries.</span>
    <span class="n">c_where</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">c_where</span>
    <span class="n">schwartz_rows</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Precompute a list of expressions to be evaluated.</span>
    <span class="n">c_target_exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span> <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">group_indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># This is a non-aggregated query.</span>

        <span class="c1"># Iterate over all the postings once and produce schwartzian rows.</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">filter_type</span><span class="p">(</span><span class="n">filt_entries</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="n">context</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span>
                <span class="k">if</span> <span class="n">c_where</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c_where</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
                    <span class="c1"># Compute the balance.</span>
                    <span class="k">if</span> <span class="n">uses_balance</span><span class="p">:</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

                    <span class="c1"># Evaluate all the values.</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_expr</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_target_exprs</span><span class="p">]</span>

                    <span class="c1"># Compute result and sort-key objects.</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">ResultRow</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                             <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">result_indexes</span><span class="p">)</span>
                    <span class="n">sortkey</span> <span class="o">=</span> <span class="n">row_sortkey</span><span class="p">(</span><span class="n">order_indexes</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">c_target_exprs</span><span class="p">)</span>
                    <span class="n">schwartz_rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sortkey</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># This is an aggregated query.</span>

        <span class="c1"># Precompute lists of non-aggregate and aggregate expressions to</span>
        <span class="c1"># evaluate. For aggregate targets, we hunt down the aggregate</span>
        <span class="c1"># sub-expressions to evaluate, to avoid recursion during iteration.</span>
        <span class="n">c_nonaggregate_exprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">c_aggregate_exprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_target_exprs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">group_indexes</span><span class="p">:</span>
                <span class="n">c_nonaggregate_exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">aggregate_exprs</span> <span class="o">=</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">get_columns_and_aggregates</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
                <span class="n">c_aggregate_exprs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aggregate_exprs</span><span class="p">)</span>
        <span class="c1"># Note: it is possible that there are no aggregates to compute here. You could</span>
        <span class="c1"># have all columns be non-aggregates and group-by the entire list of columns.</span>

        <span class="c1"># Pre-allocate handles in aggregation nodes.</span>
        <span class="n">allocator</span> <span class="o">=</span> <span class="n">Allocator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_aggregate_exprs</span><span class="p">:</span>
            <span class="n">c_expr</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">allocator</span><span class="p">)</span>

        <span class="c1"># Iterate over all the postings to evaluate the aggregates.</span>
        <span class="n">agg_store</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">misc_utils</span><span class="o">.</span><span class="n">filter_type</span><span class="p">(</span><span class="n">filt_entries</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="n">context</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">posting</span> <span class="o">=</span> <span class="n">posting</span>
                <span class="k">if</span> <span class="n">c_where</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c_where</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
                    <span class="c1"># Compute the balance.</span>
                    <span class="k">if</span> <span class="n">uses_balance</span><span class="p">:</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">add_position</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>

                    <span class="c1"># Compute the non-aggregate expressions.</span>
                    <span class="n">row_key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">c_expr</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_nonaggregate_exprs</span><span class="p">)</span>

                    <span class="c1"># Get an appropriate store for the unique key of this row.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">store</span> <span class="o">=</span> <span class="n">agg_store</span><span class="p">[</span><span class="n">row_key</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="c1"># This is a row; create a new store.</span>
                        <span class="n">store</span> <span class="o">=</span> <span class="n">allocator</span><span class="o">.</span><span class="n">create_store</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_aggregate_exprs</span><span class="p">:</span>
                            <span class="n">c_expr</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
                        <span class="n">agg_store</span><span class="p">[</span><span class="n">row_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">store</span>

                    <span class="c1"># Update the aggregate expressions.</span>
                    <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_aggregate_exprs</span><span class="p">:</span>
                        <span class="n">c_expr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c1"># Iterate over all the aggregations to produce the schwartzian rows.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">agg_store</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Finalize the store.</span>
            <span class="k">for</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="n">c_aggregate_exprs</span><span class="p">:</span>
                <span class="n">c_expr</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">c_expr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_target_exprs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">group_indexes</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">key_iter</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">c_expr</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Compute result and sort-key objects.</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ResultRow</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">result_indexes</span><span class="p">)</span>
            <span class="n">sortkey</span> <span class="o">=</span> <span class="n">row_sortkey</span><span class="p">(</span><span class="n">order_indexes</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">c_target_exprs</span><span class="p">)</span>
            <span class="n">schwartz_rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sortkey</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

    <span class="c1"># Order results if requested.</span>
    <span class="k">if</span> <span class="n">order_indexes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schwartz_rows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                           <span class="n">reverse</span><span class="o">=</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">ordering</span> <span class="o">==</span> <span class="s1">'DESC'</span><span class="p">))</span>

    <span class="c1"># Extract final results, in sorted order at this point.</span>
    <span class="n">result_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">schwartz_rows</span><span class="p">]</span>

    <span class="c1"># Apply distinct.</span>
    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">distinct</span><span class="p">:</span>
        <span class="n">result_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">uniquify</span><span class="p">(</span><span class="n">result_rows</span><span class="p">))</span>

    <span class="c1"># Apply limit.</span>
    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result_rows</span> <span class="o">=</span> <span class="n">result_rows</span><span class="p">[:</span><span class="n">query</span><span class="o">.</span><span class="n">limit</span><span class="p">]</span>

    <span class="c1"># Flatten inventories if requested.</span>
    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
        <span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span> <span class="o">=</span> <span class="n">flatten_results</span><span class="p">(</span><span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.filter_entries">
<code class="highlight language-python">
filter_entries<span class="p">(</span><span class="n">c_from</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.filter_entries" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Filter the entries by the given compiled FROM clause.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>c_from</code></td>
<td><code></code></td>
<td>
<p>A compiled From clause instance.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>A parser's option_map.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>context</code></td>
<td><code></code></td>
<td>
<p>A prototype of RowContext to use for evaluation.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of filtered entries.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter_entries</span><span class="p">(</span><span class="n">c_from</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">"""Filter the entries by the given compiled FROM clause.</span>

<span class="sd">    Args:</span>
<span class="sd">      c_from: A compiled From clause instance.</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: A parser's option_map.</span>
<span class="sd">      context: A prototype of RowContext to use for evaluation.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of filtered entries.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">c_from</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c_from</span><span class="p">,</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">EvalFrom</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">entries</span>

    <span class="c1"># Process the OPEN clause.</span>
    <span class="k">if</span> <span class="n">c_from</span><span class="o">.</span><span class="n">open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c_from</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="n">open_date</span> <span class="o">=</span> <span class="n">c_from</span><span class="o">.</span><span class="n">open</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">summarize</span><span class="o">.</span><span class="n">open_opt</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">open_date</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Process the CLOSE clause.</span>
    <span class="k">if</span> <span class="n">c_from</span><span class="o">.</span><span class="n">close</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c_from</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
            <span class="n">close_date</span> <span class="o">=</span> <span class="n">c_from</span><span class="o">.</span><span class="n">close</span>
            <span class="n">entries</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">summarize</span><span class="o">.</span><span class="n">close_opt</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">close_date</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">c_from</span><span class="o">.</span><span class="n">close</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">entries</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">summarize</span><span class="o">.</span><span class="n">close_opt</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Process the CLEAR clause.</span>
    <span class="k">if</span> <span class="n">c_from</span><span class="o">.</span><span class="n">clear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entries</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">summarize</span><span class="o">.</span><span class="n">clear_opt</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Filter the entries with the FROM clause's expression.</span>
    <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c_from</span><span class="o">.</span><span class="n">c_expr</span>
    <span class="k">if</span> <span class="n">c_expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># A simple function receives a context; how come close_date() is</span>
        <span class="c1"># accepted in the context of a FROM clause? It shouldn't be.</span>
        <span class="n">new_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">if</span> <span class="n">c_expr</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
                <span class="n">new_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">new_entries</span>

    <span class="k">return</span> <span class="n">entries</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.flatten_results">
<code class="highlight language-python">
flatten_results<span class="p">(</span><span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.flatten_results" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert inventories in result types to have a row for each.</p>
<p>This routine will expand all result lines with an inventory into a new line
for each position.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>result_types</code></td>
<td><code></code></td>
<td>
<p>A list of (name, data-type) item pairs.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>result_rows</code></td>
<td><code></code></td>
<td>
<p>A list of ResultRow tuples of length and types described by
'result_types'.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>result_types</code></td>
<td>
<p>A list of (name, data-type) item pairs. There should be no
  Inventory types anymore.
result_rows: A list of ResultRow tuples of length and types described by
  'result_types'. All inventories from the input should have been converted
  to Position types.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">flatten_results</span><span class="p">(</span><span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span><span class="p">):</span>
    <span class="sd">"""Convert inventories in result types to have a row for each.</span>

<span class="sd">    This routine will expand all result lines with an inventory into a new line</span>
<span class="sd">    for each position.</span>

<span class="sd">    Args:</span>
<span class="sd">        result_types: A list of (name, data-type) item pairs.</span>
<span class="sd">        result_rows: A list of ResultRow tuples of length and types described by</span>
<span class="sd">          'result_types'.</span>
<span class="sd">    Returns:</span>
<span class="sd">        result_types: A list of (name, data-type) item pairs. There should be no</span>
<span class="sd">          Inventory types anymore.</span>
<span class="sd">        result_rows: A list of ResultRow tuples of length and types described by</span>
<span class="sd">          'result_types'. All inventories from the input should have been converted</span>
<span class="sd">          to Position types.</span>
<span class="sd">    """</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">index</span>
                  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">result_type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_types</span><span class="p">)</span>
                  <span class="k">if</span> <span class="n">result_type</span> <span class="ow">is</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">indexes</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">result_types</span><span class="p">,</span> <span class="n">result_rows</span><span class="p">)</span>

    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">ResultRow</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">result_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># We have to make at least some conversions.</span>
    <span class="n">num_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_types</span><span class="p">)</span>
    <span class="n">output_rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">result_row</span> <span class="ow">in</span> <span class="n">result_rows</span><span class="p">:</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result_row</span><span class="p">[</span><span class="n">icol</span><span class="p">])</span> <span class="k">for</span> <span class="n">icol</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rows</span><span class="p">):</span>
            <span class="n">output_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">icol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_columns</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">result_row</span><span class="p">[</span><span class="n">icol</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">icol</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span> <span class="k">if</span> <span class="n">irow</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">output_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">output_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResultRow</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">output_row</span><span class="p">))</span>

    <span class="c1"># Convert the types.</span>
    <span class="n">output_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">Position</span>
                            <span class="k">if</span> <span class="n">result_type</span> <span class="ow">is</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span>
                            <span class="k">else</span> <span class="n">result_type</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result_type</span> <span class="ow">in</span> <span class="n">result_types</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">output_types</span><span class="p">,</span> <span class="n">output_rows</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.row_sortkey">
<code class="highlight language-python">
row_sortkey<span class="p">(</span><span class="n">order_indexes</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">c_exprs</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.row_sortkey" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a sortkey for the given values.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>order_indexes</code></td>
<td><code></code></td>
<td>
<p>The indexes by which the rows should be sorted.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>values</code></td>
<td><code></code></td>
<td>
<p>The computed values in the row.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>c_exprs</code></td>
<td><code></code></td>
<td>
<p>The matching c_expr's.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple, the sortkey.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">row_sortkey</span><span class="p">(</span><span class="n">order_indexes</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">c_exprs</span><span class="p">):</span>
    <span class="sd">"""Generate a sortkey for the given values.</span>

<span class="sd">    Args:</span>
<span class="sd">      order_indexes: The indexes by which the rows should be sorted.</span>
<span class="sd">      values: The computed values in the row.</span>
<span class="sd">      c_exprs: The matching c_expr's.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple, the sortkey.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">order_indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">order_indexes</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_MIN_VALUES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c_exprs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                   <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>
                   <span class="k">else</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_execute.uses_balance_column">
<code class="highlight language-python">
uses_balance_column<span class="p">(</span><span class="n">c_expr</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute.uses_balance_column" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return true if the expression accesses the special 'balance' column.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>c_expr</code></td>
<td><code></code></td>
<td>
<p>A compiled expression tree (an EvalNode node).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A boolean, true if the expression contains a BalanceColumn node.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>155
156
157
158
159
160
161
162
163
164</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">uses_balance_column</span><span class="p">(</span><span class="n">c_expr</span><span class="p">):</span>
    <span class="sd">"""Return true if the expression accesses the special 'balance' column.</span>

<span class="sd">    Args:</span>
<span class="sd">      c_expr: A compiled expression tree (an EvalNode node).</span>
<span class="sd">    Returns:</span>
<span class="sd">      A boolean, true if the expression contains a BalanceColumn node.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c_expr</span><span class="p">,</span> <span class="n">query_env</span><span class="o">.</span><span class="n">BalanceColumn</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">uses_balance_column</span><span class="p">(</span><span class="n">c_node</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_node</span> <span class="ow">in</span> <span class="n">c_expr</span><span class="o">.</span><span class="n">childnodes</span><span class="p">()))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_execute_test">
<code>query_execute_test</code>
<a class="headerlink" href="#beancount.query.query_execute_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_execute_test.QueryBase">
<code>QueryBase</code>
<a class="headerlink" href="#beancount.query.query_execute_test.QueryBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_execute_test.QueryBase.compile">
<code class="highlight language-python">
compile<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bql_string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute_test.QueryBase.compile" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Parse a query and compile it.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bql_string</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A compiled EvalQuery node.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>45
46
47
48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bql_string</span><span class="p">):</span>
    <span class="sd">"""Parse a query and compile it.</span>

<span class="sd">    Args:</span>
<span class="sd">      bql_string: An SQL query to be parsed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A compiled EvalQuery node.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">qc</span><span class="o">.</span><span class="n">compile_select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">bql_string</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_targets</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_postings</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">xcontext_entries</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_execute_test.QueryBase.parse">
<code class="highlight language-python">
parse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bql_string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute_test.QueryBase.parse" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Parse a query.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bql_string</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A parsed statement (Select() node).</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37
38
39
40
41
42
43</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bql_string</span><span class="p">):</span>
    <span class="sd">"""Parse a query.</span>

<span class="sd">    Args:</span>
<span class="sd">      bql_string: An SQL query to be parsed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A parsed statement (Select() node).</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">bql_string</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_execute_test.QueryBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_execute_test.QueryBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_execute_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>31
32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_parser">
<code>query_parser</code>
<a class="headerlink" href="#beancount.query.query_parser" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Parser for Beancount Query Language.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Balances">
<code>Balances</code>
<a class="headerlink" href="#beancount.query.query_parser.Balances" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Balances(summary_func, from_clause, where_clause)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">summary_func</span><span class="p">,</span> <span class="n">from_clause</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Balances(summary_func, from_clause, where_clause)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Balances object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Balances._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Balances._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Balances object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Errors">
<code>Errors</code>
<a class="headerlink" href="#beancount.query.query_parser.Errors" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Errors()</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Errors()</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Errors object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Errors._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Errors._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Errors object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Explain">
<code>Explain</code>
<a class="headerlink" href="#beancount.query.query_parser.Explain" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Explain(statement,)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Explain(statement,)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Explain object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Explain._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Explain._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Explain object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Journal">
<code>Journal</code>
<a class="headerlink" href="#beancount.query.query_parser.Journal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Journal(account, summary_func, from_clause)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">summary_func</span><span class="p">,</span> <span class="n">from_clause</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Journal(account, summary_func, from_clause)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Journal object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Journal._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Journal._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Journal object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Lexer">
<code>Lexer</code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>PLY lexer for the Beancount Query Language.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Lexer.t_DATE">
<code class="highlight language-python">
t_DATE<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer.t_DATE" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>(#(\"[^\"]<em>\"|\'[^\']</em>\')|\d\d\d\d-\d\d-\d\d)</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>238
239
240
241
242
243
244</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">t_DATE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sa">r</span><span class="s2">"(\#(</span><span class="se">\"</span><span class="s2">[^</span><span class="se">\"</span><span class="s2">]*</span><span class="se">\"</span><span class="s2">|\'[^\']*\')|\d\d\d\d-\d\d-\d\d)"</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'#'</span><span class="p">:</span>
        <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">token</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Lexer.t_DECIMAL">
<code class="highlight language-python">
t_DECIMAL<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer.t_DECIMAL" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>[-+]?([0-9]+.[0-9]<em>|[0-9]</em>.[0-9]+)</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>265
266
267
268</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">t_DECIMAL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sa">r</span><span class="s2">"[-+]?([0-9]+\.[0-9]*|[0-9]*\.[0-9]+)"</span>
    <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">token</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Lexer.t_ID">
<code class="highlight language-python">
t_ID<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer.t_ID" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>[a-zA-Z][a-zA-Z_]*</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>223
224
225
226
227
228
229
230
231</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">t_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="s2">"[a-zA-Z][a-zA-Z_]*"</span>
    <span class="n">utoken</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">utoken</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
        <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">utoken</span>
        <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">token</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Lexer.t_INTEGER">
<code class="highlight language-python">
t_INTEGER<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer.t_INTEGER" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>[-+]?[0-9]+</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>270
271
272
273</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">t_INTEGER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sa">r</span><span class="s2">"[-+]?[0-9]+"</span>
    <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">token</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Lexer.t_STRING">
<code class="highlight language-python">
t_STRING<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Lexer.t_STRING" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>("[^"]<em>"|'[^']</em>')</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>233
234
235
236</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">t_STRING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="s2">"(</span><span class="se">\"</span><span class="s2">[^</span><span class="se">\"</span><span class="s2">]*</span><span class="se">\"</span><span class="s2">|</span><span class="se">\'</span><span class="s2">[^</span><span class="se">\'</span><span class="s2">]*</span><span class="se">\'</span><span class="s2">)"</span>
    <span class="n">token</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">token</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.ParseError">
<code>ParseError</code>
<a class="headerlink" href="#beancount.query.query_parser.ParseError" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A parser error.</p>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Parser">
<code>Parser</code>
<a class="headerlink" href="#beancount.query.query_parser.Parser" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>PLY parser for the Beancount Query Language's full command syntax.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_balances_statement">
<code class="highlight language-python">
p_balances_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_balances_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>balances_statement : BALANCES summary_func from where</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>682
683
684
685
686</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_balances_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    balances_statement : BALANCES summary_func from where</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Balances</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_delimiter">
<code class="highlight language-python">
p_delimiter<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_delimiter" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>delimiter : SEMI
          | empty</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>676
677
678
679
680</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    delimiter : SEMI</span>
<span class="sd">              | empty</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_errors_statement">
<code class="highlight language-python">
p_errors_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_errors_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>errors_statement : ERRORS</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>717
718
719
720
721</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_errors_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    errors_statement : ERRORS</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Errors</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_explain_statement">
<code class="highlight language-python">
p_explain_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_explain_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>top_statement : EXPLAIN statement delimiter</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>660
661
662</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_explain_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"top_statement : EXPLAIN statement delimiter"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Explain</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_journal_statement">
<code class="highlight language-python">
p_journal_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_journal_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>journal_statement : JOURNAL summary_func from
                  | JOURNAL account summary_func from</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>688
689
690
691
692
693</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_journal_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    journal_statement : JOURNAL summary_func from</span>
<span class="sd">                      | JOURNAL account summary_func from</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Journal</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">Journal</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_print_statement">
<code class="highlight language-python">
p_print_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_print_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>print_statement : PRINT from</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>702
703
704
705
706</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_print_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    print_statement : PRINT from</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_regular_statement">
<code class="highlight language-python">
p_regular_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_regular_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>top_statement : statement delimiter</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>656
657
658</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_regular_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"top_statement : statement delimiter"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_reload_statement">
<code class="highlight language-python">
p_reload_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_reload_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>reload_statement : RELOAD</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>723
724
725
726
727</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_reload_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    reload_statement : RELOAD</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Reload</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_run_statement">
<code class="highlight language-python">
p_run_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_run_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>run_statement : RUN ID
              | RUN STRING
              | RUN ASTERISK
              | RUN empty</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>708
709
710
711
712
713
714
715</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_run_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    run_statement : RUN ID</span>
<span class="sd">                  | RUN STRING</span>
<span class="sd">                  | RUN ASTERISK</span>
<span class="sd">                  | RUN empty</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">RunCustom</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_statement">
<code class="highlight language-python">
p_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>statement : select_statement
          | balances_statement
          | journal_statement
          | print_statement
          | run_statement
          | errors_statement
          | reload_statement</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>664
665
666
667
668
669
670
671
672
673
674</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    statement : select_statement</span>
<span class="sd">              | balances_statement</span>
<span class="sd">              | journal_statement</span>
<span class="sd">              | print_statement</span>
<span class="sd">              | run_statement</span>
<span class="sd">              | errors_statement</span>
<span class="sd">              | reload_statement</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Parser.p_summary_func">
<code class="highlight language-python">
p_summary_func<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.Parser.p_summary_func" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>summary_func : empty
             | AT ID</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>695
696
697
698
699
700</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_summary_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    summary_func : empty</span>
<span class="sd">                 | AT ID</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Print">
<code>Print</code>
<a class="headerlink" href="#beancount.query.query_parser.Print" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print(from_clause,)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">from_clause</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Print(from_clause,)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Print object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Print._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Print._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Print object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Reload">
<code>Reload</code>
<a class="headerlink" href="#beancount.query.query_parser.Reload" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Reload()</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Reload()</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Reload object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Reload._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Reload._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Reload object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.RunCustom">
<code>RunCustom</code>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>RunCustom(query_name,)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">query_name</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of RunCustom(query_name,)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new RunCustom object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.RunCustom._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.RunCustom._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new RunCustom object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.Select">
<code>Select</code>
<a class="headerlink" href="#beancount.query.query_parser.Select" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Select(targets, from_clause, where_clause, group_by, order_by, pivot_by, limit, distinct, flatten)</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select.__getnewargs__">
<code class="highlight language-python">
__getnewargs__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select.__getnewargs__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return self as a plain tuple.  Used by copy and pickle.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>427
428
429</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return self as a plain tuple.  Used by copy and pickle.'</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">from_clause</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span> <span class="n">group_by</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">pivot_by</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">flatten</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select.__new__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create new instance of Select(targets, from_clause, where_clause, group_by, order_by, pivot_by, limit, distinct, flatten)</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a nicely formatted representation string</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>419
420
421</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a nicely formatted representation string'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select._asdict">
<code class="highlight language-python">
_asdict<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select._asdict" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new dict which maps field names to their values.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>423
424
425</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">'Return a new dict which maps field names to their values.'</span>
    <span class="k">return</span> <span class="n">_dict</span><span class="p">(</span><span class="n">_zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select._make">
<code class="highlight language-python">
_make<span class="p">(</span><span class="n">iterable</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select._make" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Make a new Select object from a sequence or iterable</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tuple_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s1"> arguments, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.Select._replace">
<code class="highlight language-python">
_replace<span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-private"><code>private</code></small>
</span>
<a class="headerlink" href="#beancount.query.query_parser.Select._replace" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return a new Select object replacing specified fields with new values</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>410
411
412
413
414</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_map</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Got unexpected field names: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="si">!r}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser.SelectParser">
<code>SelectParser</code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>PLY parser for the Beancount Query Language's SELECT statement.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.handle_comma_separated_list">
<code class="highlight language-python">
handle_comma_separated_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.handle_comma_separated_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handle a list of 0, 1 or more comma-separated values.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td><code></code></td>
<td>
<p>A gramar object.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>323
324
325
326
327
328
329
330
331</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">handle_comma_separated_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""Handle a list of 0, 1 or more comma-separated values.</span>
<span class="sd">    Args:</span>
<span class="sd">      p: A gramar object.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_account">
<code class="highlight language-python">
p_account<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_account" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>account : STRING</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>333
334
335
336
337</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    account : STRING</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_boolean">
<code class="highlight language-python">
p_boolean<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_boolean" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>boolean : TRUE
        | FALSE</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>625
626
627
628
629
630</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    boolean : TRUE</span>
<span class="sd">            | FALSE</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'TRUE'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_column">
<code class="highlight language-python">
p_column<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_column" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>column : ID</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>601
602
603
604
605</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    column : ID</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_column_list">
<code class="highlight language-python">
p_column_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_column_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>column_list : column
            | column_list COMMA column</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>607
608
609
610
611
612</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_column_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    column_list : column</span>
<span class="sd">                | column_list COMMA column</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_comma_separated_list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_constant">
<code class="highlight language-python">
p_constant<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_constant" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>constant : NULL
         | boolean
         | INTEGER
         | DECIMAL
         | STRING
         | DATE</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>614
615
616
617
618
619
620
621
622
623</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    constant : NULL</span>
<span class="sd">             | boolean</span>
<span class="sd">             | INTEGER</span>
<span class="sd">             | DECIMAL</span>
<span class="sd">             | STRING</span>
<span class="sd">             | DATE</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'NULL'</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_distinct">
<code class="highlight language-python">
p_distinct<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_distinct" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>distinct : empty
         | DISTINCT</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>346
347
348
349
350
351</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    distinct : empty</span>
<span class="sd">             | DISTINCT</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'DISTINCT'</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_empty">
<code class="highlight language-python">
p_empty<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_empty" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>empty :</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>632
633
634
635</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    empty :</span>
<span class="sd">    """</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expr_index">
<code class="highlight language-python">
p_expr_index<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expr_index" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expr_index : expression
           | INTEGER</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>436
437
438
439
440
441</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expr_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    expr_index : expression</span>
<span class="sd">               | INTEGER</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expr_index_list">
<code class="highlight language-python">
p_expr_index_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expr_index_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expr_index_list : expr_index
                | expr_index_list COMMA expr_index</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>429
430
431
432
433
434</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expr_index_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    expr_index_list : expr_index</span>
<span class="sd">                    | expr_index_list COMMA expr_index</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_comma_separated_list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_add">
<code class="highlight language-python">
p_expression_add<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_add" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression PLUS expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>567
568
569</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression PLUS expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_and">
<code class="highlight language-python">
p_expression_and<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_and" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression AND expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>503
504
505</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression AND expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_column">
<code class="highlight language-python">
p_expression_column<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_column" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : column</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : column"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_constant">
<code class="highlight language-python">
p_expression_constant<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_constant" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : constant</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>555
556
557</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : constant"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_contains">
<code class="highlight language-python">
p_expression_contains<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_contains" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression IN expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>547
548
549</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression IN expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Contains</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_div">
<code class="highlight language-python">
p_expression_div<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_div" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression SLASH expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>563
564
565</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression SLASH expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_eq">
<code class="highlight language-python">
p_expression_eq<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_eq" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression EQ expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>519
520
521</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression EQ expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Equal</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_function">
<code class="highlight language-python">
p_expression_function<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_function" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : ID LPAREN expression_list_opt RPAREN</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>575
576
577</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : ID LPAREN expression_list_opt RPAREN"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_gt">
<code class="highlight language-python">
p_expression_gt<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_gt" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression GT expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>527
528
529</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression GT expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Greater</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_gte">
<code class="highlight language-python">
p_expression_gte<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_gte" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression GTE expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>531
532
533</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_gte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression GTE expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">GreaterEq</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_list">
<code class="highlight language-python">
p_expression_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression_list : expression
                | expression_list COMMA expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>594
595
596
597
598
599</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    expression_list : expression</span>
<span class="sd">                    | expression_list COMMA expression</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_comma_separated_list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_list_opt">
<code class="highlight language-python">
p_expression_list_opt<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_list_opt" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression_list_opt : empty
                    | expression
                    | expression_list COMMA expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>586
587
588
589
590
591
592</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_list_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    expression_list_opt : empty</span>
<span class="sd">                        | expression</span>
<span class="sd">                        | expression_list COMMA expression</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_comma_separated_list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_lt">
<code class="highlight language-python">
p_expression_lt<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_lt" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression LT expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>535
536
537</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression LT expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Less</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_lte">
<code class="highlight language-python">
p_expression_lte<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_lte" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression LTE expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>539
540
541</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_lte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression LTE expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">LessEq</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_match">
<code class="highlight language-python">
p_expression_match<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_match" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression TILDE expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>543
544
545</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression TILDE expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Match</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_mul">
<code class="highlight language-python">
p_expression_mul<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_mul" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression ASTERISK expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>559
560
561</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression ASTERISK expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mul</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_ne">
<code class="highlight language-python">
p_expression_ne<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_ne" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression NE expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>523
524
525</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_ne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression NE expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Not</span><span class="p">(</span><span class="n">Equal</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_not">
<code class="highlight language-python">
p_expression_not<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_not" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : NOT expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>511
512
513</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : NOT expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Not</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_or">
<code class="highlight language-python">
p_expression_or<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_or" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression OR expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>507
508
509</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression OR expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_paren">
<code class="highlight language-python">
p_expression_paren<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_paren" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : LPAREN expression RPAREN</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>515
516
517</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_paren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : LPAREN expression RPAREN"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_expression_sub">
<code class="highlight language-python">
p_expression_sub<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_expression_sub" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>expression : expression MINUS expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>571
572
573</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_expression_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">"expression : expression MINUS expression"</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sub</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_flatten">
<code class="highlight language-python">
p_flatten<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_flatten" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>flatten : empty
        | FLATTEN</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>486
487
488
489
490
491</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    flatten : empty</span>
<span class="sd">            | FLATTEN</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'FLATTEN'</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_from">
<code class="highlight language-python">
p_from<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_from" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>from : empty
     | FROM opt_expression opt_open opt_close opt_clear</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>374
375
376
377
378
379
380
381
382
383
384</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    from : empty</span>
<span class="sd">         | FROM opt_expression opt_open opt_close opt_clear</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s2">"Empty FROM expression is not allowed"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">From</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_from_subselect">
<code class="highlight language-python">
p_from_subselect<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_from_subselect" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>from_subselect : from
               | FROM LPAREN select_statement RPAREN</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>386
387
388
389
390
391
392
393
394</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_from_subselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    from_subselect : from</span>
<span class="sd">                   | FROM LPAREN select_statement RPAREN</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_group_by">
<code class="highlight language-python">
p_group_by<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_group_by" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>group_by : empty
         | GROUP BY expr_index_list having</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>443
444
445
446
447
448</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_group_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    group_by : empty</span>
<span class="sd">             | GROUP BY expr_index_list having</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupBy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_having">
<code class="highlight language-python">
p_having<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_having" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>having : empty
       | HAVING expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>450
451
452
453
454
455</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_having</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    having : empty</span>
<span class="sd">           | HAVING expression</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_limit">
<code class="highlight language-python">
p_limit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_limit" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>limit : empty
      | LIMIT INTEGER</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>479
480
481
482
483
484</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    limit : empty</span>
<span class="sd">          | LIMIT INTEGER</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_opt_clear">
<code class="highlight language-python">
p_opt_clear<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_opt_clear" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>opt_clear : empty
          | CLEAR</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>413
414
415
416
417
418</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_opt_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    opt_clear : empty</span>
<span class="sd">              | CLEAR</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'CLEAR'</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_opt_close">
<code class="highlight language-python">
p_opt_close<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_opt_close" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>opt_close : empty
          | CLOSE
          | CLOSE ON DATE</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>403
404
405
406
407
408
409
410
411</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_opt_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    opt_close : empty</span>
<span class="sd">              | CLOSE</span>
<span class="sd">              | CLOSE ON DATE</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="kc">True</span>
                                     <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'CLOSE'</span><span class="p">)</span> <span class="k">else</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">default_close_date</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_opt_expression">
<code class="highlight language-python">
p_opt_expression<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_opt_expression" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>opt_expression : empty
               | expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>579
580
581
582
583
584</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_opt_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    opt_expression : empty</span>
<span class="sd">                   | expression</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_opt_open">
<code class="highlight language-python">
p_opt_open<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_opt_open" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>opt_open : empty
         | OPEN ON DATE</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>396
397
398
399
400
401</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_opt_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    opt_open : empty</span>
<span class="sd">             | OPEN ON DATE</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_order_by">
<code class="highlight language-python">
p_order_by<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_order_by" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>order_by : empty
         | ORDER BY expr_index_list ordering</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>457
458
459
460
461
462</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_order_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    order_by : empty</span>
<span class="sd">             | ORDER BY expr_index_list ordering</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">OrderBy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_ordering">
<code class="highlight language-python">
p_ordering<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_ordering" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>ordering : empty
         | ASC
         | DESC</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>464
465
466
467
468
469
470</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_ordering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    ordering : empty</span>
<span class="sd">             | ASC</span>
<span class="sd">             | DESC</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_pivot_by">
<code class="highlight language-python">
p_pivot_by<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_pivot_by" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>pivot_by : empty
         | PIVOT BY column_list</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>472
473
474
475
476
477</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_pivot_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    pivot_by : empty</span>
<span class="sd">             | PIVOT BY column_list</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PivotBy</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_select_statement">
<code class="highlight language-python">
p_select_statement<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_select_statement" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>select_statement : SELECT distinct target_spec from_subselect where                            group_by order_by pivot_by limit flatten</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>339
340
341
342
343
344</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_select_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    select_statement : SELECT distinct target_spec from_subselect where \</span>
<span class="sd">                       group_by order_by pivot_by limit flatten</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_target">
<code class="highlight language-python">
p_target<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_target" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>target : expression AS ID
       | expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>367
368
369
370
371
372</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    target : expression AS ID</span>
<span class="sd">           | expression</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_target_list">
<code class="highlight language-python">
p_target_list<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_target_list" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>target_list : target
            | target_list COMMA target</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>360
361
362
363
364
365</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_target_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    target_list : target</span>
<span class="sd">                | target_list COMMA target</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_comma_separated_list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_target_spec">
<code class="highlight language-python">
p_target_spec<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_target_spec" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>target_spec : ASTERISK
            | target_list</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>353
354
355
356
357
358</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_target_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    target_spec : ASTERISK</span>
<span class="sd">                | target_list</span>
<span class="sd">    """</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wildcard</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'*'</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser.SelectParser.p_where">
<code class="highlight language-python">
p_where<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.SelectParser.p_where" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>where : empty
      | WHERE expression</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>420
421
422
423
424
425
426
427</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">p_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    where : empty</span>
<span class="sd">          | WHERE expression</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">"Empty WHERE clause is not allowed"</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_parser.get_expression_name">
<code class="highlight language-python">
get_expression_name<span class="p">(</span><span class="n">expr</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser.get_expression_name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Come up with a reasonable identifier for an expression.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expr</code></td>
<td><code></code></td>
<td>
<p>An expression node.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_expression_name</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">"""Come up with a reasonable identifier for an expression.</span>

<span class="sd">    Args:</span>
<span class="sd">      expr: An expression node.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Function</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">operands</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_expression_name</span><span class="p">(</span><span class="n">operand</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">'_'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Constant</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'c</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[^a-z0-9]+'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">UnaryOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'_'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                         <span class="n">get_expression_name</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">operand</span><span class="p">)])</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">BinaryOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'_'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                         <span class="n">get_expression_name</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">),</span>
                         <span class="n">get_expression_name</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">right</span><span class="p">)])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"Unknown expression type."</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.query_parser_test">
<code>query_parser_test</code>
<a class="headerlink" href="#beancount.query.query_parser_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser_test.QueryParserTestBase">
<code>QueryParserTestBase</code>
<a class="headerlink" href="#beancount.query.query_parser_test.QueryParserTestBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser_test.QueryParserTestBase.assertParse">
<code class="highlight language-python">
assertParse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser_test.QueryParserTestBase.assertParse" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Assert parsed contents from 'query' is 'expected'.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>expected</code></td>
<td><code></code></td>
<td>
<p>An expected AST to compare against the parsed value.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>debug</code></td>
<td><code></code></td>
<td>
<p>A boolean, if true, print extra debugging information on the console.</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AssertionError</code></td>
<td>
<p>If the actual AST does not match the expected one.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">assertParse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Assert parsed contents from 'query' is 'expected'.</span>

<span class="sd">    Args:</span>
<span class="sd">      expected: An expected AST to compare against the parsed value.</span>
<span class="sd">      query: An SQL query to be parsed.</span>
<span class="sd">      debug: A boolean, if true, print extra debugging information on the console.</span>
<span class="sd">    Raises:</span>
<span class="sd">      AssertionError: If the actual AST does not match the expected one.</span>
<span class="sd">    """</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">actual</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser_test.QueryParserTestBase.parse">
<code class="highlight language-python">
parse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser_test.QueryParserTestBase.parse" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Parse one query.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query</code></td>
<td><code></code></td>
<td>
<p>An SQL query to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The AST.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30
31
32
33
34
35
36
37</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="sd">"""Parse one query.</span>

<span class="sd">    Args:</span>
<span class="sd">      query: An SQL query to be parsed.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The AST.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser_test.QueryParserTestBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser_test.QueryParserTestBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.query_parser_test.TestSelectFromBase">
<code>TestSelectFromBase</code>
<a class="headerlink" href="#beancount.query.query_parser_test.TestSelectFromBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.query_parser_test.TestSelectFromBase.setUp">
<code class="highlight language-python">
setUp<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser_test.TestSelectFromBase.setUp" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Hook method for setting up the test fixture before exercising it.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>336
337
338
339
340
341
342
343</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">qp</span><span class="o">.</span><span class="n">Target</span><span class="p">(</span><span class="n">qp</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">'a'</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="n">qp</span><span class="o">.</span><span class="n">Target</span><span class="p">(</span><span class="n">qp</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">'b'</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">qp</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">'d'</span><span class="p">),</span>
                         <span class="n">qp</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
                             <span class="n">qp</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="s1">'max'</span><span class="p">,</span> <span class="p">[</span><span class="n">qp</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">'e'</span><span class="p">)]),</span>
                             <span class="n">qp</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="mi">17</span><span class="p">)))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.query_parser_test.qSelect">
<code class="highlight language-python">
qSelect<span class="p">(</span><span class="n">target_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">where_clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pivot_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distinct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.query_parser_test.qSelect" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A convenience constructor for writing tests without having to provide all arguments.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/query_parser_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>11
12
13
14
15
16
17
18
19</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">qSelect</span><span class="p">(</span><span class="n">target_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">from_clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">where_clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pivot_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distinct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">"A convenience constructor for writing tests without having to provide all arguments."</span>
    <span class="k">return</span> <span class="n">qp</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">target_spec</span><span class="p">,</span>
                     <span class="n">from_clause</span><span class="p">,</span> <span class="n">where_clause</span><span class="p">,</span>
                     <span class="n">group_by</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">pivot_by</span><span class="p">,</span>
                     <span class="n">limit</span><span class="p">,</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">flatten</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.shell">
<code>shell</code>
<a class="headerlink" href="#beancount.query.shell" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>An interactive command-line shell interpreter for the Beancount Query Language.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.shell.BQLShell">
<code>BQLShell</code>
<a class="headerlink" href="#beancount.query.shell.BQLShell" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An interactive shell interpreter for the Beancount query language.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Balances">
<code class="highlight language-python">
on_Balances<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Balances" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Select balances of some subset of postings. This command is a
convenience and converts into an equivalent Select statement, designed
to extract the most sensible list of columns for the register of a list
of entries as a table.</p>
<p>The general form of a JOURNAL statement loosely follows SQL syntax:</p>
<p>BALANCE [FROM_CLAUSE]</p>
<p>See the SELECT query help for more details on the FROM clause.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>473
474
475
476
477
478
479
480
481
482
483
484
485
486</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Balances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Select balances of some subset of postings. This command is a</span>
<span class="sd">    convenience and converts into an equivalent Select statement, designed</span>
<span class="sd">    to extract the most sensible list of columns for the register of a list</span>
<span class="sd">    of entries as a table.</span>

<span class="sd">    The general form of a JOURNAL statement loosely follows SQL syntax:</span>

<span class="sd">       BALANCE [FROM_CLAUSE]</span>

<span class="sd">    See the SELECT query help for more details on the FROM clause.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_Select</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Errors">
<code class="highlight language-python">
on_Errors<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors_statement</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Errors" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Print the errors that occurred during parsing.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>318
319
320
321
322
323
324
325</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors_statement</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Print the errors that occurred during parsing.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">print_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'(No errors)'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Explain">
<code class="highlight language-python">
on_Explain<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">explain</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Explain" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Compile and print a compiled statement for debugging.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">explain</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Compile and print a compiled statement for debugging.</span>
<span class="sd">    """</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">"Parsed statement:"</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">"  </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">explain</span><span class="o">.</span><span class="n">statement</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>

    <span class="c1"># Compile the select statement and print it uot.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">explain</span><span class="o">.</span><span class="n">statement</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">env_targets</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">env_postings</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">env_entries</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">CompilationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">pr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">pr</span><span class="p">(</span><span class="s2">"Compiled query:"</span><span class="p">)</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">"  </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
    <span class="n">pr</span><span class="p">(</span><span class="s2">"Targets:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c_target</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">c_targets</span><span class="p">:</span>
        <span class="n">pr</span><span class="p">(</span><span class="s2">"  '</span><span class="si">{}</span><span class="s2">'</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">c_target</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">'(invisible)'</span><span class="p">,</span>
            <span class="s1">' (aggregate)'</span> <span class="k">if</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">is_aggregate</span><span class="p">(</span><span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span><span class="p">)</span> <span class="k">else</span> <span class="s1">''</span><span class="p">,</span>
            <span class="n">c_target</span><span class="o">.</span><span class="n">c_expr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">pr</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Journal">
<code class="highlight language-python">
on_Journal<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">journal</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Journal" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Select a journal of some subset of postings. This command is a
convenience and converts into an equivalent Select statement, designed
to extract the most sensible list of columns for the register of a list
of entries as a table.</p>
<p>The general form of a JOURNAL statement loosely follows SQL syntax:</p>
<p>JOURNAL &lt;account-regexp&gt; [FROM_CLAUSE]</p>
<p>See the SELECT query help for more details on the FROM clause.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>458
459
460
461
462
463
464
465
466
467
468
469
470
471</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Journal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">journal</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Select a journal of some subset of postings. This command is a</span>
<span class="sd">    convenience and converts into an equivalent Select statement, designed</span>
<span class="sd">    to extract the most sensible list of columns for the register of a list</span>
<span class="sd">    of entries as a table.</span>

<span class="sd">    The general form of a JOURNAL statement loosely follows SQL syntax:</span>

<span class="sd">       JOURNAL &lt;account-regexp&gt; [FROM_CLAUSE]</span>

<span class="sd">    See the SELECT query help for more details on the FROM clause.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_Select</span><span class="p">(</span><span class="n">journal</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Print">
<code class="highlight language-python">
on_Print<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_stmt</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Print" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Print entries in Beancount format.</p>
<p>The general form of a PRINT statement includes an SQL-like FROM
selector:</p>
<p>PRINT [FROM &lt;from_expr&gt; ...]</p>
<p>Where:</p>
<p>from_expr: A logical expression that matches on the attributes of
    the directives. See SELECT command for details (this FROM expression
    supports all the same expressions including its OPEN, CLOSE and
    CLEAR operations).</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_stmt</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Print entries in Beancount format.</span>

<span class="sd">    The general form of a PRINT statement includes an SQL-like FROM</span>
<span class="sd">    selector:</span>

<span class="sd">       PRINT [FROM &lt;from_expr&gt; ...]</span>

<span class="sd">    Where:</span>

<span class="sd">      from_expr: A logical expression that matches on the attributes of</span>
<span class="sd">        the directives. See SELECT command for details (this FROM expression</span>
<span class="sd">        supports all the same expressions including its OPEN, CLOSE and</span>
<span class="sd">        CLEAR operations).</span>

<span class="sd">    """</span>
    <span class="c1"># Compile the print statement.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c_print</span> <span class="o">=</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">print_stmt</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_targets</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_postings</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_entries</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">CompilationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'ERROR: </span><span class="si">{}</span><span class="s1">.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="ow">is</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
        <span class="n">query_execute</span><span class="o">.</span><span class="n">execute_print</span><span class="p">(</span><span class="n">c_print</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">,</span>
                                    <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pager</span><span class="p">()</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">query_execute</span><span class="o">.</span><span class="n">execute_print</span><span class="p">(</span><span class="n">c_print</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Reload">
<code class="highlight language-python">
on_Reload<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_statement</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Reload" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Reload the input file without restarting the shell.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>310
311
312
313
314
315
316</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_statement</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Reload the input file without restarting the shell.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadfun</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">:</span>
        <span class="n">print_statistics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_RunCustom">
<code class="highlight language-python">
on_RunCustom<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_stmt</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_RunCustom" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Run a custom query instead of a SQL command.</p>
<p>RUN &lt;custom-query-name&gt;</p>
<p>Where:</p>
<p>custom-query-name: Should be the name of a custom query to be defined
    in the Beancount input file.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_RunCustom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_stmt</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Run a custom query instead of a SQL command.</span>

<span class="sd">       RUN &lt;custom-query-name&gt;</span>

<span class="sd">    Where:</span>

<span class="sd">      custom-query-name: Should be the name of a custom query to be defined</span>
<span class="sd">        in the Beancount input file.</span>

<span class="sd">    """</span>
    <span class="n">custom_query_map</span> <span class="o">=</span> <span class="n">create_custom_query_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">run_stmt</span><span class="o">.</span><span class="n">query_name</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># List the available queries.</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">custom_query_map</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"*"</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">query</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">custom_query_map</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_parser</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">query_string</span><span class="p">,</span> <span class="n">default_close_date</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">custom_query_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"ERROR: Query '</span><span class="si">{}</span><span class="s2">' not found"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">query_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.BQLShell.on_Select">
<code class="highlight language-python">
on_Select<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.BQLShell.on_Select" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Extract data from a query on the postings.</p>
<p>The general form of a SELECT statement loosely follows SQL syntax, with
some mild and idiomatic extensions:</p>
<p>SELECT [DISTINCT] [&lt;targets&gt;|*]
   [FROM &lt;from_expr&gt; [OPEN ON &lt;date&gt;] [CLOSE [ON &lt;date&gt;]] [CLEAR]]
   [WHERE &lt;where_expr&gt;]
   [GROUP BY &lt;groups&gt;]
   [ORDER BY &lt;groups&gt; [ASC|DESC]]
   [LIMIT num]</p>
<p>Where:</p>
<p>targets: A list of desired output attributes from the postings, and
    expressions on them. Some of the attributes of the parent transaction
    directive are made available in this context as well. Simple functions
    (that return a single value per row) and aggregation functions (that
    return a single value per group) are available. For the complete
    list of supported columns and functions, see help on "targets".
    You can also provide a wildcard here, which will select a reasonable
    default set of columns for rendering a journal.</p>
<p>from_expr: A logical expression that matches on the attributes of
    the directives (not postings). This allows you to select a subset of
    transactions, so the accounting equation is respected for balance
    reports. For the complete list of supported columns and functions,
    see help on "from".</p>
<p>where_expr: A logical expression that matches on the attributes of
    postings. The available columns are similar to those in the targets
    clause, without the aggregation functions.</p>
<p>OPEN clause: replace all the transactions before the given date by
    summarizing entries and transfer Income and Expenses balances to
    Equity.</p>
<p>CLOSE clause: Remove all the transactions after the given date and</p>
<p>CLEAR: Transfer final Income and Expenses balances to Equity.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_Select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Extract data from a query on the postings.</span>

<span class="sd">    The general form of a SELECT statement loosely follows SQL syntax, with</span>
<span class="sd">    some mild and idiomatic extensions:</span>

<span class="sd">       SELECT [DISTINCT] [&lt;targets&gt;|*]</span>
<span class="sd">       [FROM &lt;from_expr&gt; [OPEN ON &lt;date&gt;] [CLOSE [ON &lt;date&gt;]] [CLEAR]]</span>
<span class="sd">       [WHERE &lt;where_expr&gt;]</span>
<span class="sd">       [GROUP BY &lt;groups&gt;]</span>
<span class="sd">       [ORDER BY &lt;groups&gt; [ASC|DESC]]</span>
<span class="sd">       [LIMIT num]</span>

<span class="sd">    Where:</span>

<span class="sd">      targets: A list of desired output attributes from the postings, and</span>
<span class="sd">        expressions on them. Some of the attributes of the parent transaction</span>
<span class="sd">        directive are made available in this context as well. Simple functions</span>
<span class="sd">        (that return a single value per row) and aggregation functions (that</span>
<span class="sd">        return a single value per group) are available. For the complete</span>
<span class="sd">        list of supported columns and functions, see help on "targets".</span>
<span class="sd">        You can also provide a wildcard here, which will select a reasonable</span>
<span class="sd">        default set of columns for rendering a journal.</span>

<span class="sd">      from_expr: A logical expression that matches on the attributes of</span>
<span class="sd">        the directives (not postings). This allows you to select a subset of</span>
<span class="sd">        transactions, so the accounting equation is respected for balance</span>
<span class="sd">        reports. For the complete list of supported columns and functions,</span>
<span class="sd">        see help on "from".</span>

<span class="sd">      where_expr: A logical expression that matches on the attributes of</span>
<span class="sd">        postings. The available columns are similar to those in the targets</span>
<span class="sd">        clause, without the aggregation functions.</span>

<span class="sd">      OPEN clause: replace all the transactions before the given date by</span>
<span class="sd">        summarizing entries and transfer Income and Expenses balances to</span>
<span class="sd">        Equity.</span>

<span class="sd">      CLOSE clause: Remove all the transactions after the given date and</span>

<span class="sd">      CLEAR: Transfer final Income and Expenses balances to Equity.</span>

<span class="sd">    """</span>
    <span class="c1"># Compile the SELECT statement.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c_query</span> <span class="o">=</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_targets</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_postings</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">env_entries</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">CompilationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'ERROR: </span><span class="si">{}</span><span class="s1">.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Execute it to obtain the result rows.</span>
    <span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span> <span class="o">=</span> <span class="n">query_execute</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">c_query</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">)</span>

    <span class="c1"># Output the resulting rows.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rrows</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"(empty)"</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'format'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">'text'</span><span class="p">:</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'boxed'</span><span class="p">],</span>
                        <span class="n">spaced</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'spaced'</span><span class="p">],</span>
                        <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'expand'</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="ow">is</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pager</span><span class="p">()</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">query_render</span><span class="o">.</span><span class="n">render_text</span><span class="p">(</span><span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">],</span>
                                             <span class="n">file</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query_render</span><span class="o">.</span><span class="n">render_text</span><span class="p">(</span><span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">'csv'</span><span class="p">:</span>
            <span class="c1"># Numberify CSV output if requested.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'numberify'</span><span class="p">]:</span>
                <span class="n">dformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
                <span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span> <span class="o">=</span> <span class="n">numberify</span><span class="o">.</span><span class="n">numberify_results</span><span class="p">(</span><span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span><span class="p">,</span> <span class="n">dformat</span><span class="p">)</span>

            <span class="n">query_render</span><span class="o">.</span><span class="n">render_csv</span><span class="p">(</span><span class="n">rtypes</span><span class="p">,</span> <span class="n">rrows</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'dcontext'</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span>
                                    <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">'expand'</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">output_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_SUPPORTED_FORMATS</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Unsupported output format: '</span><span class="si">{}</span><span class="s2">'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_format</span><span class="p">),</span>
                  <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.shell.DispatchingShell">
<code>DispatchingShell</code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A usable convenient shell for interpreting commands, with history.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_interactive</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">default_format</span><span class="p">,</span> <span class="n">do_numberify</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a shell with history.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>is_interactive</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if this serves an interactive tty.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>parser</code></td>
<td><code></code></td>
<td>
<p>A command parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>outfile</code></td>
<td><code></code></td>
<td>
<p>An output file object to write communications to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>default_format</code></td>
<td><code></code></td>
<td>
<p>A string, the default output format.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_interactive</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">default_format</span><span class="p">,</span> <span class="n">do_numberify</span><span class="p">):</span>
    <span class="sd">"""Create a shell with history.</span>

<span class="sd">    Args:</span>
<span class="sd">      is_interactive: A boolean, true if this serves an interactive tty.</span>
<span class="sd">      parser: A command parser.</span>
<span class="sd">      outfile: An output file object to write communications to.</span>
<span class="sd">      default_format: A string, the default output format.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_interactive</span> <span class="ow">and</span> <span class="n">readline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">load_history</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">HISTORY_FILENAME</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_interactive</span> <span class="o">=</span> <span class="n">is_interactive</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_vars</span><span class="p">(</span><span class="n">default_format</span><span class="p">,</span> <span class="n">do_numberify</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.add_help">
<code class="highlight language-python">
add_help<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.add_help" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Attach help functions for each of the parsed token handlers.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>139
140
141
142
143
144
145
146
147
148</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">"Attach help functions for each of the parsed token handlers."</span>
    <span class="k">for</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'on_(.*)'</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">command_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s1">'help_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
                <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">func</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                          <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.cmdloop">
<code class="highlight language-python">
cmdloop<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.cmdloop" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Override cmdloop to handle keyboard interrupts.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>166
167
168
169
170
171
172
173</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">cmdloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Override cmdloop to handle keyboard interrupts."""</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cmdloop</span><span class="p">()</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">(Interrupted)'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.default">
<code class="highlight language-python">
default<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.default" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Default handling of lines which aren't recognized as native shell commands.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>line</code></td>
<td><code></code></td>
<td>
<p>The string to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>253
254
255
256
257
258
259</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">"""Default handling of lines which aren't recognized as native shell commands.</span>

<span class="sd">    Args:</span>
<span class="sd">      line: The string to be parsed.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_parser</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.dispatch">
<code class="highlight language-python">
dispatch<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.dispatch" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Dispatch the given statement to a suitable method.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>statement</code></td>
<td><code></code></td>
<td>
<p>An instance provided by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Whatever the invoked method happens to return.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
    <span class="sd">"""Dispatch the given statement to a suitable method.</span>

<span class="sd">    Args:</span>
<span class="sd">      statement: An instance provided by the parser.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Whatever the invoked method happens to return.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'on_</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Internal error: statement '</span><span class="si">{}</span><span class="s2">' is unsupported."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">),</span>
              <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_clear">
<code class="highlight language-python">
do_clear<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_clear" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Clear the history.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>185
186
187</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="s2">"Clear the history."</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">clear_history</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_EOF">
<code class="highlight language-python">
do_EOF<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_EOF" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Exit the parser.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>280
281
282
283</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Exit the parser."""</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_exit">
<code class="highlight language-python">
do_exit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_exit" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Exit the parser.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>280
281
282
283</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Exit the parser."""</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_help">
<code class="highlight language-python">
do_help<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_help" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Strip superfluous semicolon.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>175
176
177</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="sd">"""Strip superfluous semicolon."""</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">do_help</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'; </span><span class="se">\t</span><span class="s1">'</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_history">
<code class="highlight language-python">
do_history<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_history" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Print the command-line history statement.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>179
180
181
182
183</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="s2">"Print the command-line history statement."</span>
    <span class="k">if</span> <span class="n">readline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">get_history</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_entries</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_lex">
<code class="highlight language-python">
do_lex<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_lex" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Just run the lexer on the following command and print the output.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>216
217
218
219
220
221</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_lex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="s2">"Just run the lexer on the following command and print the output."</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_parse">
<code class="highlight language-python">
do_parse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_parse" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Just run the parser on the following command and print the output.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>225
226
227
228
229
230
231
232
233
234
235</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="s2">"Just run the parser on the following command and print the output."</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"INPUT: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">query_parser</span><span class="o">.</span><span class="n">ParseError</span><span class="p">,</span>
            <span class="n">query_compile</span><span class="o">.</span><span class="n">CompilationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_quit">
<code class="highlight language-python">
do_quit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_quit" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Exit the parser.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>280
281
282
283</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Exit the parser."""</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_set">
<code class="highlight language-python">
do_set<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_set" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Get/set shell settings variables.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="s2">"Get/set shell settings variables."</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">varname</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Variable '</span><span class="si">{}</span><span class="s2">' does not exist."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">),</span>
                      <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">converted_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_types</span><span class="p">[</span><span class="n">varname</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">converted_value</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">converted_value</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Variable '</span><span class="si">{}</span><span class="s2">' does not exist."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">),</span>
                      <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Invalid number of arguments."</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.do_tokenize">
<code class="highlight language-python">
do_tokenize<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.do_tokenize" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Just run the lexer on the following command and print the output.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>216
217
218
219
220
221</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">do_lex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="s2">"Just run the lexer on the following command and print the output."</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.emptyline">
<code class="highlight language-python">
emptyline<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.emptyline" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Do nothing on an empty line.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>277
278</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">emptyline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Do nothing on an empty line."""</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.exit">
<code class="highlight language-python">
exit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.exit" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Exit the parser.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>280
281
282
283</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="sd">"""Exit the parser."""</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.get_pager">
<code class="highlight language-python">
get_pager<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.get_pager" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create and return a context manager to write to, a pager subprocess if required.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A pair of a file object to write to, and a pipe object to wait on (or</p>
</td>
</tr>
</tbody>
</table>
<p>None if not necessary to wait).</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_pager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Create and return a context manager to write to, a pager subprocess if required.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A pair of a file object to write to, and a pipe object to wait on (or</span>
<span class="sd">    None if not necessary to wait).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pager</span><span class="o">.</span><span class="n">ConditionalPager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'pager'</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                      <span class="n">minlines</span><span class="o">=</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_screen_height</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">'buffer'</span><span class="p">)</span> <span class="k">else</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pager</span><span class="o">.</span><span class="n">flush_only</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.initialize_vars">
<code class="highlight language-python">
initialize_vars<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_format</span><span class="p">,</span> <span class="n">do_numberify</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.initialize_vars" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Initialize the setting variables of the interactive shell.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_format</span><span class="p">,</span> <span class="n">do_numberify</span><span class="p">):</span>
    <span class="sd">"""Initialize the setting variables of the interactive shell."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vars_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'pager'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'format'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'boxed'</span><span class="p">:</span> <span class="n">convert_bool</span><span class="p">,</span>
        <span class="s1">'spaced'</span><span class="p">:</span> <span class="n">convert_bool</span><span class="p">,</span>
        <span class="s1">'expand'</span><span class="p">:</span> <span class="n">convert_bool</span><span class="p">,</span>
        <span class="s1">'numberify'</span><span class="p">:</span> <span class="n">convert_bool</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'pager'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'PAGER'</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="s1">'format'</span><span class="p">:</span> <span class="n">default_format</span><span class="p">,</span>
        <span class="s1">'boxed'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">'spaced'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">'expand'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">'numberify'</span><span class="p">:</span> <span class="n">do_numberify</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.query.shell.DispatchingShell.run_parser">
<code class="highlight language-python">
run_parser<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">default_close_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.DispatchingShell.run_parser" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handle statements via our parser instance and dispatch to appropriate methods.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>line</code></td>
<td><code></code></td>
<td>
<p>The string to be parsed.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>default_close_date</code></td>
<td><code></code></td>
<td>
<p>A datetimed.date instance, the default close date.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">default_close_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Handle statements via our parser instance and dispatch to appropriate methods.</span>

<span class="sd">    Args:</span>
<span class="sd">      line: The string to be parsed.</span>
<span class="sd">      default_close_date: A datetimed.date instance, the default close date.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">,</span>
                                      <span class="n">default_close_date</span><span class="o">=</span><span class="n">default_close_date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">query_parser</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.convert_bool">
<code class="highlight language-python">
convert_bool<span class="p">(</span><span class="n">string</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.convert_bool" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Convert a string to a boolean.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string representing a boolean.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The corresponding boolean.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>81
82
83
84
85
86
87
88
89</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_bool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">"""Convert a string to a boolean.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: A string representing a boolean.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The corresponding boolean.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'f'</span><span class="p">,</span> <span class="s1">'false'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.create_custom_query_map">
<code class="highlight language-python">
create_custom_query_map<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.create_custom_query_map" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Extract a mapping of the custom queries from the list of entries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of entries.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A map of query-name strings to Query directives.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_custom_query_map</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Extract a mapping of the custom queries from the list of entries.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of entries.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A map of query-name strings to Query directives.</span>
<span class="sd">    """</span>
    <span class="n">query_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Query</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">query_map</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Duplicate query: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">query_map</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
    <span class="k">return</span> <span class="n">query_map</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.generate_env_attribute_list">
<code class="highlight language-python">
generate_env_attribute_list<span class="p">(</span><span class="n">env</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.generate_env_attribute_list" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a dictionary of rendered attribute lists for help.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>env</code></td>
<td><code></code></td>
<td>
<p>An instance of an environment.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dict with keys 'columns', 'functions' and 'aggregates' to rendered
and formatted strings.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_env_attribute_list</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="sd">"""Generate a dictionary of rendered attribute lists for help.</span>

<span class="sd">    Args:</span>
<span class="sd">      env: An instance of an environment.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A dict with keys 'columns', 'functions' and 'aggregates' to rendered</span>
<span class="sd">      and formatted strings.</span>
<span class="sd">    """</span>
    <span class="n">wrapper</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span><span class="n">initial_indent</span><span class="o">=</span><span class="s1">'  '</span><span class="p">,</span>
                                   <span class="n">subsequent_indent</span><span class="o">=</span><span class="s1">'    '</span><span class="p">,</span>
                                   <span class="n">drop_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

    <span class="n">str_columns</span> <span class="o">=</span> <span class="n">generate_env_attributes</span><span class="p">(</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">str_simple</span> <span class="o">=</span> <span class="n">generate_env_attributes</span><span class="p">(</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">EvalAggregator</span><span class="p">))</span>
    <span class="n">str_aggregate</span> <span class="o">=</span> <span class="n">generate_env_attributes</span><span class="p">(</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">EvalAggregator</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">str_columns</span><span class="p">,</span>
                <span class="n">functions</span><span class="o">=</span><span class="n">str_simple</span><span class="p">,</span>
                <span class="n">aggregates</span><span class="o">=</span><span class="n">str_aggregate</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.generate_env_attributes">
<code class="highlight language-python">
generate_env_attributes<span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">field_dict</span><span class="p">,</span> <span class="n">filter_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.generate_env_attributes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Generate a string of all the help functions of the attributes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>wrapper</code></td>
<td><code></code></td>
<td>
<p>A TextWrapper instance to format the paragraphs.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>field_dict</code></td>
<td><code></code></td>
<td>
<p>A dict of the field-names to the node instances, fetch from an
environment.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>filter_pred</code></td>
<td><code></code></td>
<td>
<p>A predicate to filter the desired columns. This is applied to
the evaluator node instances.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A formatted multiline string, ready for insertion in a help text.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_env_attributes</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">field_dict</span><span class="p">,</span> <span class="n">filter_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Generate a string of all the help functions of the attributes.</span>

<span class="sd">    Args:</span>
<span class="sd">      wrapper: A TextWrapper instance to format the paragraphs.</span>
<span class="sd">      field_dict: A dict of the field-names to the node instances, fetch from an</span>
<span class="sd">        environment.</span>
<span class="sd">      filter_pred: A predicate to filter the desired columns. This is applied to</span>
<span class="sd">        the evaluator node instances.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A formatted multiline string, ready for insertion in a help text.</span>
<span class="sd">    """</span>
    <span class="c1"># Expand the name if its key has argument types.</span>
    <span class="c1">#</span>
    <span class="c1"># FIXME: Render the __intypes__ here nicely instead of the key.</span>
    <span class="n">flat_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column_cls</span> <span class="ow">in</span> <span class="n">field_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">column_cls</span><span class="p">,</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">EvalFunction</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dtypes</span> <span class="ow">in</span> <span class="n">column_cls</span><span class="o">.</span><span class="n">__intypes__</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

        <span class="n">flat_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">column_cls</span><span class="p">))</span>

    <span class="c1"># Render each of the attributes.</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column_cls</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">flat_items</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filter_pred</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_pred</span><span class="p">(</span><span class="n">column_cls</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">column_cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">"[See class </span><span class="si">{}</span><span class="s2">]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">column_cls</span><span class="p">,</span> <span class="n">query_compile</span><span class="o">.</span><span class="n">EvalColumn</span><span class="p">):</span>
            <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">" Type: </span><span class="si">{}</span><span class="s2">."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_cls</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="c1"># if hasattr(column_cls, '__equivalent__'):</span>
            <span class="c1">#     docstring += " Attribute:{}.".format(column_cls.__equivalent__)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[ </span><span class="se">\t</span><span class="s1">]+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">docstring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">"'</span><span class="si">{}</span><span class="s2">': </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.get_history">
<code class="highlight language-python">
get_history<span class="p">(</span><span class="n">max_entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.get_history" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Return the history in the readline buffer.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max_entries</code></td>
<td><code></code></td>
<td>
<p>An integer, the maximum number of entries to return.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A list of string, the previous history of commands.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_history</span><span class="p">(</span><span class="n">max_entries</span><span class="p">):</span>
    <span class="sd">"""Return the history in the readline buffer.</span>

<span class="sd">    Args:</span>
<span class="sd">      max_entries: An integer, the maximum number of entries to return.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A list of string, the previous history of commands.</span>
<span class="sd">    """</span>
    <span class="n">num_entries</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">get_current_history_length</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">num_entries</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_entries</span> <span class="o">-</span> <span class="n">max_entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">readline</span><span class="o">.</span><span class="n">get_history_item</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">num_entries</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.load_history">
<code class="highlight language-python">
load_history<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.load_history" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Load the shell's past history.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file containing the shell history.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_history</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Load the shell's past history.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file containing the shell history.</span>
<span class="sd">    """</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s2">"tab:complete"</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">readline</span><span class="p">,</span> <span class="s2">"read_history_file"</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">read_history_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># Don't error on absent file.</span>
            <span class="k">pass</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">save_history</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.print_statistics">
<code class="highlight language-python">
print_statistics<span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.print_statistics" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Print summary statistics to stdout.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options_map</code></td>
<td><code></code></td>
<td>
<p>An options map. as produced by the parser.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>outfile</code></td>
<td><code></code></td>
<td>
<p>A file object to write to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>734
735
736
737
738
739
740
741
742
743
744
745
746
747</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_statistics</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">options_map</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
    <span class="sd">"""Print summary statistics to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      options_map: An options map. as produced by the parser.</span>
<span class="sd">      outfile: A file object to write to.</span>
<span class="sd">    """</span>
    <span class="n">num_directives</span><span class="p">,</span> <span class="n">num_transactions</span><span class="p">,</span> <span class="n">num_postings</span> <span class="o">=</span> <span class="n">summary_statistics</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">'title'</span> <span class="ow">in</span> <span class="n">options_map</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Input file: "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options_map</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]),</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Ready with </span><span class="si">{}</span><span class="s2"> directives (</span><span class="si">{}</span><span class="s2"> postings in </span><span class="si">{}</span><span class="s2"> transactions)."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">num_directives</span><span class="p">,</span> <span class="n">num_postings</span><span class="p">,</span> <span class="n">num_transactions</span><span class="p">),</span>
          <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.save_history">
<code class="highlight language-python">
save_history<span class="p">(</span><span class="n">filename</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.save_history" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Save the shell history. This should be invoked on exit.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code></code></td>
<td>
<p>A string, the name of the file to save the history to.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>57
58
59
60
61
62
63</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_history</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Save the shell history. This should be invoked on exit.</span>

<span class="sd">    Args:</span>
<span class="sd">      filename: A string, the name of the file to save the history to.</span>
<span class="sd">    """</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">write_history_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell.summary_statistics">
<code class="highlight language-python">
summary_statistics<span class="p">(</span><span class="n">entries</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell.summary_statistics" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Calculate basic summary statistics to output a brief welcome message.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entries</code></td>
<td><code></code></td>
<td>
<p>A list of directives.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A tuple of three integers, the total number of directives parsed, the total number
of transactions and the total number of postings there in.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/query/shell.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">summary_statistics</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">"""Calculate basic summary statistics to output a brief welcome message.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A tuple of three integers, the total number of directives parsed, the total number</span>
<span class="sd">      of transactions and the total number of postings there in.</span>
<span class="sd">    """</span>
    <span class="n">num_directives</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">num_transactions</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_postings</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">):</span>
            <span class="n">num_transactions</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">num_postings</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num_directives</span><span class="p">,</span> <span class="n">num_transactions</span><span class="p">,</span> <span class="n">num_postings</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.query.shell_test">
<code>shell_test</code>
<a class="headerlink" href="#beancount.query.shell_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.query.shell_test.TestUseCases">
<code>TestUseCases</code>
<a class="headerlink" href="#beancount.query.shell_test.TestUseCases" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Testing all the use cases from the proposal here.
    I'm hoping to replace reports by these queries instead.</p>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.query.shell_test.runshell">
<code class="highlight language-python">
runshell<span class="p">(</span><span class="n">function</span><span class="p">)</span> </code>
<a class="headerlink" href="#beancount.query.shell_test.runshell" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorate a function to run the shell and return the output.</p>
<details class="quote">
<summary>Source code in <code>beancount/query/shell_test.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27
28
29
30
31
32
33
34
35
36</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">runshell</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="sd">"""Decorate a function to run the shell and return the output."""</span>
    <span class="k">def</span> <span class="nf">test_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">loadfun</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">entries</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">options_map</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="k">as</span> <span class="n">stdout</span><span class="p">:</span>
            <span class="n">shell_obj</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">BQLShell</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">loadfun</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="n">shell_obj</span><span class="o">.</span><span class="n">on_Reload</span><span class="p">()</span>
            <span class="n">shell_obj</span><span class="o">.</span><span class="n">onecmd</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdout</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">test_function</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.reports.html" title="beancount.reports">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="beancount.plugins.html" title="beancount.plugins"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/xuhcc/beancount-docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.plugins.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.reports.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
