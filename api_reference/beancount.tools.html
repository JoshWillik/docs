<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://beancount.github.io/docs/api_reference/beancount.tools.html" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>beancount.tools - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="../css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "beancount.tools";
    var mkdocs_page_input_path = "api_reference/beancount.tools.md";
    var mkdocs_page_url = "/docs/api_reference/beancount.tools.html";
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Beancount Documentation</a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../how_we_share_expenses.html">How We Share Expenses</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../health_care_expenses.html">Health Care Expenses</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calculating_portolio_returns.html">Calculating Portfolio Returns</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Enhancement Proposals &amp; Discussions</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="../a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="beancount.tools.html">beancount.tools</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#beancount.tools">beancount.tools</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.tools.treeify">treeify</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.Node">Node</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify.Node.__repr__">__repr__()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.create_tree">create_tree()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.dump_tree">dump_tree()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.enum_tree_by_input_line_num">enum_tree_by_input_line_num()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.find_column">find_column()</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify.render_tree">render_tree()</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beancount.tools.treeify_test">treeify_test</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase">TestTreeifyBase</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify">treeify()</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify_equal">treeify_equal()</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beancount.tools.treeify_test.treeify">treeify()</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.utils.html">beancount.utils</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>API reference »</li>
<li>beancount.tools</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/beancount/docs/edit/master/docs/api_reference/beancount.tools.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="beancounttools">beancount.tools<a class="headerlink" href="#beancounttools" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#beancount.tools" id="beancount.tools" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#beancount.tools" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<p>Standalone tools that aren't linked to Beancount but that are useful with it.</p>
<p>The beancount.scripts package contains the implementation of scripts which
invoke the Beancount library code. This beancount.tools package implements other
tools which aren't directly invoking Beancount library code and which could be
theoretically copied and used independently. However, these are to be
distributed with Beancount and in order to maintain all the source code together
they are put in this package and invokes from stubs under beancount/bin/, just
like the other scripts.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.tools.treeify">
<code>beancount.tools.treeify</code>
<a class="headerlink" href="#beancount.tools.treeify" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Identify a column of text that contains hierarchical id and treeify that column.</p>
<p>This script will inspect a text file and attempt to find a vertically
left-aligned column of text that contains identifiers with multiple components,
such as "Assets:US:Bank:Checking", and replace those by a tree-like structure rendered
in ASCII, inserting new empty lines where necessary to create the tree.</p>
<p>Note: If your paths have spaces in them, this will not work. Space is used as a
delimiter to detect the end of a column. You can customize the delimiter with an
option.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.tools.treeify.Node">
<code>beancount.tools.treeify.Node</code>
<a class="headerlink" href="#beancount.tools.treeify.Node" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>A node with a name attribute, a list of line numbers and a list of children
    (from its parent class).</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.tools.treeify.Node.__repr__">
<code class="highlight language-python">
beancount.tools.treeify.Node.__repr__
(self)

        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#beancount.tools.treeify.Node.__repr__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Return str(self).</p>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def __str__(self):
    return '&lt;Node {} {}&gt;'.format(self.name, [node.name for node in self])
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify.create_tree">
<code class="highlight language-python">
beancount.tools.treeify.create_tree
(column_matches, regexp_split)

        </code>
<a class="headerlink" href="#beancount.tools.treeify.create_tree" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Build up a tree from a list of matches.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>column_matches</code></td>
<td><code></code></td>
<td>
<p>A list of (line-number, name) pairs.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>regexp_split</code></td>
<td><code></code></td>
<td>
<p>A regular expression string, to use for splitting the names
of components.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>An instance of Node, the root node of the created tree.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def create_tree(column_matches, regexp_split):
    """Build up a tree from a list of matches.

    Args:
      column_matches: A list of (line-number, name) pairs.
      regexp_split: A regular expression string, to use for splitting the names
        of components.
    Returns:
      An instance of Node, the root node of the created tree.
    """
    root = Node('')
    for no, name in column_matches:
        parts = re.split(regexp_split, name)
        node = root
        for part in parts:
            last_node = node[-1] if node else None
            if last_node is None or last_node.name != part:
                last_node = Node(part)
                node.append(last_node)
            node = last_node
        node.nos.append(no)
    return root
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify.dump_tree">
<code class="highlight language-python">
beancount.tools.treeify.dump_tree
(node, file=&lt;_io.StringIO object at 0x7f2e48578790&gt;, prefix='')

        </code>
<a class="headerlink" href="#beancount.tools.treeify.dump_tree" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render a tree as a tree.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>node</code></td>
<td><code></code></td>
<td>
<p>An instance of Node.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>file</code></td>
<td><code></code></td>
<td>
<p>A file object to write to.</p>
</td>
<td><code>&lt;_io.StringIO object at 0x7f2e48578790&gt;</code></td>
</tr>
<tr>
<td><code>prefix</code></td>
<td><code></code></td>
<td>
<p>A prefix string for each of the lines of the children.</p>
</td>
<td><code>''</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def dump_tree(node, file=sys.stdout, prefix=''):
    """Render a tree as a tree.

    Args:
      node: An instance of Node.
      file: A file object to write to.
      prefix: A prefix string for each of the lines of the children.
    """
    file.write(prefix)
    file.write(node.name)
    file.write('\n')
    for child in node:
        dump_tree(child, file, prefix + '... ')
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify.enum_tree_by_input_line_num">
<code class="highlight language-python">
beancount.tools.treeify.enum_tree_by_input_line_num
(tree_lines)

        </code>
<a class="headerlink" href="#beancount.tools.treeify.enum_tree_by_input_line_num" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Accumulate the lines of a tree until a line number is found.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tree_lines</code></td>
<td><code></code></td>
<td>
<p>A list of lines as returned by render_tree.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p>Yields:
  Pairs of (line number, list of (line, node)).</p>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def enum_tree_by_input_line_num(tree_lines):
    """Accumulate the lines of a tree until a line number is found.

    Args:
      tree_lines: A list of lines as returned by render_tree.
    Yields:
      Pairs of (line number, list of (line, node)).
    """
    pending = []
    for first_line, cont_line, node in tree_lines:
        if not node.nos:
            pending.append((first_line, node))
        else:
            line = first_line
            for no in node.nos:
                pending.append((line, node))
                line = cont_line
                yield (no, pending)
                pending = []
    if pending:
        yield (None, pending)
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify.find_column">
<code class="highlight language-python">
beancount.tools.treeify.find_column
(lines, pattern, delimiter)

        </code>
<a class="headerlink" href="#beancount.tools.treeify.find_column" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find a valid column with hierarchical data in the text lines.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lines</code></td>
<td><code></code></td>
<td>
<p>A list of strings, the contents of the input.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>pattern</code></td>
<td><code></code></td>
<td>
<p>A regular expression for the hierarchical entries.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>delimiter</code></td>
<td><code></code></td>
<td>
<p>A regular expression that dictates how we detect the
end of a column. Normally this is a single space. If the patterns
contain spaces, you will need to increase this.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A tuple of
  matches</code></td>
<td>
<p>A list of (line-number, name) tuples where 'name' is the
    hierarchical string to treeify and line-number is an integer, the
    line number where this applies.
  left: An integer, the leftmost column.
  right: An integer, the rightmost column.
Note that not all line numbers may be present, so you may need to
skip some. However, they are in guaranteed in sorted order.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def find_column(lines, pattern, delimiter):
    """Find a valid column with hierarchical data in the text lines.

    Args:
      lines: A list of strings, the contents of the input.
      pattern: A regular expression for the hierarchical entries.
      delimiter: A regular expression that dictates how we detect the
        end of a column. Normally this is a single space. If the patterns
        contain spaces, you will need to increase this.
    Returns:
      A tuple of
        matches: A list of (line-number, name) tuples where 'name' is the
          hierarchical string to treeify and line-number is an integer, the
          line number where this applies.
        left: An integer, the leftmost column.
        right: An integer, the rightmost column.
      Note that not all line numbers may be present, so you may need to
      skip some. However, they are in guaranteed in sorted order.
    """
    # A mapping of the line beginning position to its match object.
    beginnings = collections.defaultdict(list)
    pattern_and_whitespace = "({})(?P&lt;ws&gt;{}.|$)".format(pattern, delimiter)
    for no, line in enumerate(lines):
        for match in re.finditer(pattern_and_whitespace, line):
            beginnings[match.start()].append((no, line, match))

    # For each potential column found, verify that it is valid. A valid column
    # will have the maximum of its content text not overlap with any of the
    # following text. We assume that a column will have been formatted to full
    # width and that no text following the line overlap with the column, even in
    # its trailing whitespace.
    #
    # In other words, the following example is a violation because "10,990.74"
    # overlaps with the end of "Insurance" and so this would not be recognized
    # as a valid column:
    #
    # Expenses:Food:Restaurant     10,990.74 USD
    # Expenses:Health:Dental:Insurance   208.80 USD
    #
    for leftmost_column, column_matches in sorted(beginnings.items()):

        # Compute the location of the rightmost column of text.
        rightmost_column = max(match.end(1) for _, _, match in column_matches)

        # Compute the leftmost location of the content following the column text
        # and past its whitespace.
        following_column = min(match.end() if match.group('ws') else 10000
                               for _, _, match in column_matches)

        if rightmost_column &lt; following_column:
            # We process only the very first match.
            return_matches = [(no, match.group(1).rstrip())
                              for no, _, match in column_matches]
            return return_matches, leftmost_column, rightmost_column
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify.render_tree">
<code class="highlight language-python">
beancount.tools.treeify.render_tree
(root)

        </code>
<a class="headerlink" href="#beancount.tools.treeify.render_tree" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Render a tree of nodes.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A list of tuples of (first_line, continuation_line, node) where
  first_line</code></td>
<td>
<p>A string, the first line to render, which includes the
    account name.
  continuation_line: A string, further line to render if necessary.
  node: The Node instance which corresponds to this line.
and an integer, the width of the new columns.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def render_tree(root):
    """Render a tree of nodes.

    Returns:
      A list of tuples of (first_line, continuation_line, node) where
        first_line: A string, the first line to render, which includes the
          account name.
        continuation_line: A string, further line to render if necessary.
        node: The Node instance which corresponds to this line.
      and an integer, the width of the new columns.
    """
    # Compute all the lines ahead of time in order to calculate the width.
    lines = []

    # Start with the root node. We push the constant prefix before this node,
    # the account name, and the RealAccount instance. We will maintain a stack
    # of children nodes to render.
    stack = [('', root.name, root, True)]
    while stack:
        prefix, name, node, is_last = stack.pop(-1)

        if node is root:
            # For the root node, we don't want to render any prefix.
            first = cont = ''
        else:
            # Compute the string that precedes the name directly and the one below
            # that for the continuation lines.
            #  |
            #  @@@ Bank1    &lt;----------------
            #  @@@ |
            #  |   |-- Checking
            if is_last:
                first = prefix + PREFIX_LEAF_1
                cont = prefix + PREFIX_LEAF_C
            else:
                first = prefix + PREFIX_CHILD_1
                cont = prefix + PREFIX_CHILD_C

        # Compute the name to render for continuation lines.
        #  |
        #  |-- Bank1
        #  |   @@@       &lt;----------------
        #  |   |-- Checking
        if len(node) &gt; 0:
            cont_name = PREFIX_CHILD_C
        else:
            cont_name = PREFIX_LEAF_C

        # Add a line for this account.
        if not (node is root and not name):
            lines.append((first + name,
                          cont + cont_name,
                          node))

        # Push the children onto the stack, being careful with ordering and
        # marking the last node as such.
        if node:
            child_items = reversed(node)
            child_iter = iter(child_items)
            child_node = next(child_iter)
            stack.append((cont, child_node.name, child_node, True))
            for child_node in child_iter:
                stack.append((cont, child_node.name, child_node, False))

    if not lines:
        return lines

    # Compute the maximum width of the lines and convert all of them to the same
    # maximal width. This makes it easy on the client.
    max_width = max(len(first_line) for first_line, _, __ in lines)
    line_format = '{{:{width}}}'.format(width=max_width)
    return [(line_format.format(first_line),
             line_format.format(cont_line),
             node)
            for (first_line, cont_line, node) in lines], max_width
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="beancount.tools.treeify_test">
<code>beancount.tools.treeify_test</code>
<a class="headerlink" href="#beancount.tools.treeify_test" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Unit tests for treeify tool.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="beancount.tools.treeify_test.TestTreeifyBase">
<code>beancount.tools.treeify_test.TestTreeifyBase</code>
<a class="headerlink" href="#beancount.tools.treeify_test.TestTreeifyBase" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.tools.treeify_test.TestTreeifyBase.treeify">
<code class="highlight language-python">
beancount.tools.treeify_test.TestTreeifyBase.treeify
(self, string, expect_errors=False, options=None)

        </code>
<a class="headerlink" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Run treeify on the given string and assert no errors.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>A string, the input contents to run on.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expect_errors</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should expect there to be errors.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>An optional list of options for the subprogram.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The converted output string. This fails the test if there were any
errors.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def treeify(self, string, expect_errors=False, options=None):
    """Run treeify on the given string and assert no errors.

    Args:
      string: A string, the input contents to run on.
      expect_errors: A boolean, true if we should expect there to be errors.
      options: An optional list of options for the subprogram.
    Returns:
      The converted output string. This fails the test if there were any
      errors.
    """
    returncode, output, errors = treeify(string, options)
    actual_errors = returncode != 0 or bool(errors)
    if actual_errors != expect_errors:
        if expect_errors:
            self.fail("Missing expected errors")
        else:
            self.fail("Unexpected errors: {}".format(errors))
    return output
</code></pre>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="beancount.tools.treeify_test.TestTreeifyBase.treeify_equal">
<code class="highlight language-python">
beancount.tools.treeify_test.TestTreeifyBase.treeify_equal
(self, string, expected, expect_errors=False, options=None)

        </code>
<a class="headerlink" href="#beancount.tools.treeify_test.TestTreeifyBase.treeify_equal" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Assert an expected treeification result.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>An expected input contents string to treeify.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expected</code></td>
<td><code></code></td>
<td>
<p>A string, the expected treeified output.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>expect_errors</code></td>
<td><code></code></td>
<td>
<p>A boolean, true if we should expect there to be errors.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>An optional list of options for the subprogram.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The actual output string. This fails the test if there the expected
output differed from the actual.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def treeify_equal(self, string, expected, expect_errors=False, options=None):
    """Assert an expected treeification result.

    Args:
      string: An expected input contents string to treeify.
      expected: A string, the expected treeified output.
      expect_errors: A boolean, true if we should expect there to be errors.
      options: An optional list of options for the subprogram.
    Returns:
      The actual output string. This fails the test if there the expected
      output differed from the actual.
    """
    input_ = textwrap.dedent(string)
    output = self.treeify(input_, expect_errors, options)
    expected = textwrap.dedent(expected)
    if DEBUG:
        print('-(input)----------------------------------')
        print(input_)
        print('-(output)---------------------------------')
        print(output)
        print('-(expected)-------------------------------')
        print(expected)
        print('------------------------------------------')
    self.assertEqual(expected, output)
    return output
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="beancount.tools.treeify_test.treeify">
<code class="highlight language-python">
beancount.tools.treeify_test.treeify
(string, options=None)

        </code>
<a class="headerlink" href="#beancount.tools.treeify_test.treeify" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Run treeify on the string.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code></code></td>
<td>
<p>The input string to feed treeify.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>options</code></td>
<td><code></code></td>
<td>
<p>An optional list of options for the subprogram.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>The treeified string.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>beancount/tools/treeify_test.py</code></summary>
<pre class="highlight"><code class="language-python linenums">def treeify(string, options=None):
    """Run treeify on the string.

    Args:
      string: The input string to feed treeify.
      options: An optional list of options for the subprogram.
    Returns:
      The treeified string.
    """
    pipe = subprocess.Popen([PROGRAM] + (options or []),
                            shell=False,
                            stdin=subprocess.PIPE,
                            stdout=subprocess.PIPE,
                            stderr=subprocess.PIPE)
    output, errors = pipe.communicate(string.encode('utf-8'))
    return (pipe.returncode,
            output.decode('utf-8') if output else '',
            errors.decode('utf-8') if errors else '')
</code></pre>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="beancount.utils.html" title="beancount.utils">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="beancount.scripts.html" title="beancount.scripts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/beancount/docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="beancount.scripts.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="beancount.utils.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../js/extra.js"></script>
<script defer="" src="../search/main.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
