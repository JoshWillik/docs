<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://beancount.github.io/docs/28_settlement_dates_in_beancount.html" rel="canonical"/>
<link href="img/favicon.ico" rel="shortcut icon"/>
<title>Settlement Dates in Beancount - Beancount Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="css/theme.css" rel="stylesheet">
<link href="css/theme_extra.css" rel="stylesheet"/>
<link href="css/custom.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "Settlement Dates in Beancount";
    var mkdocs_page_input_path = "28_settlement_dates_in_beancount.md";
    var mkdocs_page_url = "/docs/28_settlement_dates_in_beancount.html";
  </script>
<script defer="" src="js/jquery-2.1.1.min.js"></script>
<script defer="" src="js/modernizr-2.8.3.min.js"></script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="."> Beancount Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Index</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Outline</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Users</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="01_command_line_accounting_in_context.html">Command Line Accounting in Context</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_the_double_entry_counting_method.html">The Double Entry Counting Method</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="03_installing_beancount.html">Installing Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="04_running_beancount_and_generating_reports.html">Running Beancount and Generating Reports</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_getting_started_with_beancount.html">Getting Started with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="06_beancount_language_syntax.html">Beancount Language Syntax</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="07_beancount_options_reference.html">Beancount Options Reference</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="08_precision_tolerances.html">Precision Tolerances</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="09_beancount_query_language.html">Beancount Query Language</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="10_beancount_cheat_sheet.html">Beancount Cheat Sheet</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="11_how_inventories_work.html">How Inventories Work</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="12_exporting_your_portfolio.html">Exporting Your Portfolio</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="13_tutorial_example.html">Tutorial &amp; Example</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="14_beancount_history_and_credits.html">Beancount History and Credits</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="15_a_comparison_of_beancount_and_ledger_hledger.html">A Comparison of Beancount and Ledger Hledger</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="16_fetching_prices_in_beancount.html">Fetching Prices in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="17_importing_external_data.html">Importing External Data</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Cookbooks &amp; Examples</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="18_command_line_accounting_cookbook.html">Command Line Accounting Cookbook</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="19_trading_with_beancount.html">Trading with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="20_stock_vesting_in_beancount.html">Stock Vesting in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="21_sharing_expenses_with_beancount.html">Sharing Expenses with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="22_how_we_share_expenses.html">How We Share Expenses</a>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#">Documentation for Developers</a>
<ul>
<li class="toctree-l2"><a class="reference internal" href="23_beancount_scripting_plugins.html">Beancount Scripting Plugins</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="24_beancount_design_doc.html">Beancount Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="25_ledgerhub_design_doc.html">Ledgerhub Design Doc</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="26_external_contributions.html">External Contributions</a>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="#">Enhancement Proposals &amp; Discussions</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="27_a_proposal_for_an_improvement_on_inventory_booking.html">A Proposal for an Improvement on Inventory Booking</a>
</li>
<li class="toctree-l2 current"><a class="reference internal current" href="28_settlement_dates_in_beancount.html">Settlement Dates in Beancount</a>
<ul class="current">
<li class="toctree-l3"><a class="reference internal" href="#motivation">Motivation</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#proposal-description">Proposal Description</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#settlement-dates">Settlement Dates</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#transfer-accounts">Transfer Accounts</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#remaining-questions">Remaining Questions</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unrooting-transactions">Unrooting Transactions</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#previous-work">Previous Work</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#ledger-effective-and-auxiliary-dates">Ledger Effective and Auxiliary Dates</a>
</li>
<li class="toctree-l4"><a class="reference internal" href="#gnucash">GnuCash</a>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a>
<ul>
<li class="toctree-l4"><a class="reference internal" href="#threads">Threads</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="29_balance_assertions_in_beancount.html">Balance Assertions in Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="30_fund_accounting_with_beancount.html">Fund Accounting with Beancount</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="31_rounding_precision_in_beancount.html">Rounding Precision in Beancount</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_reference/index.html">beancount</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.core.html">beancount.core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.ingest.html">beancount.ingest</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.loader.html">beancount.loader</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.ops.html">beancount.ops</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.parser.html">beancount.parser</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.plugins.html">beancount.plugins</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.prices.html">beancount.prices</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.query.html">beancount.query</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.reports.html">beancount.reports</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.scripts.html">beancount.scripts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.utils.html">beancount.utils</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/beancount.web.html">beancount.web</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href=".">Beancount Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href=".">Docs</a> »</li>
<li>Enhancement Proposals &amp; Discussions »</li>
<li>Outline »</li>
<li>Settlement Dates in Beancount</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/beancount/docs/edit/master/docs/28_settlement_dates_in_beancount.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="settlement-dates-transfer-accounts-in-beancount">Settlement Dates &amp; Transfer Accounts in Beancount<a id="title"></a><a class="headerlink" href="#settlement-dates-transfer-accounts-in-beancount" title="Permanent link"></a></h1>
<p>Martin Blais, July 2014</p>
<p><a href="http://furius.ca/beancount/doc/proposal-dates"><span class="underline">http://furius.ca/beancount/doc/proposal-dates</span></a></p>
<blockquote>
<p><a href="#motivation"><span class="underline">Motivation</span></a></p>
<p><a href="#_1t2cyy3ee86k"><span class="underline">Proposal Description</span></a></p>
<p><a href="#remaining-questions"><span class="underline">Remaining Questions</span></a></p>
<p><a href="#_svp0j511dy5a"><span class="underline">Previous Work</span></a></p>
<p><a href="#ledger-effective-and-auxiliary-dates"><span class="underline">Ledger Effective and Auxiliary Dates</span></a></p>
<p><a href="#references"><span class="underline">References</span></a></p>
</blockquote>
<h2 id="motivation">Motivation<a id="motivation"></a><a class="headerlink" href="#motivation" title="Permanent link"></a></h2>
<p>When a trade executes in an investment account, there is most often a delay between the date that the transaction is carried out (the “transaction date”) and the date that the funds are deposited in an associated cash account (the “settlement date”). This makes imported balance assertions sometimes requiring the fudging of their dates, and sometimes they can even be impossible. This document proposes the addition of an optional “settlement date” to be attached to a transaction or a posting, and associated semantics for how to deal with the problem.</p>
<h2 id="proposal-description">Proposal Description<a id="proposal-description"></a><a class="headerlink" href="#proposal-description" title="Permanent link"></a></h2>
<h3 id="settlement-dates">Settlement Dates<a id="settlement-dates"></a><a class="headerlink" href="#settlement-dates" title="Permanent link"></a></h3>
<p>In the first implementation of Beancount I used to have two dates attached to a transaction, but I never did anything with them. The alternate date would get attached but was ignored thereafter. The meaning of it is that it should have split the transaction into two, with some sort of transfer account, that might have been useful semantics, I never developed it.</p>
<p>Something like this as input:</p>
<pre><code>2014-06-23=2014-06-28 * "Sale"
   Assets:ScottTrade:GOOG    -10 GOOG {589.00 USD}
   S Assets:ScottTrade:Cash
</code></pre>
<p>where the “S” posting flag marks the leg “to be postponed to the settlement date.”</p>
<p>Alternatively, you could attach the date to a posting:</p>
<pre><code>2014-06-23 * "Sale"
   Assets:ScottTrade:GOOG    -10 GOOG {589.00 USD}
   2014-06-28 Assets:ScottTrade:Cash
</code></pre>
<p>Both of the above syntax proposals allow you to specify which postings are meant to be postponed to settlement. The second one is more flexible, as each posting could potentially have a different date, but the more constrained syntax of the first would create less complications.</p>
<p>Either of these could get translated to multiple transactions with a transfer account to absorb the pending amount:</p>
<pre><code>2014-06-23 * "Sale" ^settlement-3463873948
   Assets:ScottTrade:GOOG    -10 GOOG {589.00 USD}
   Assets:ScottTrade:Transfer

2014-06-28 * "Sale" ^settlement-3463873948
   Assets:ScottTrade:Transfer
   Assets:ScottTrade:Cash        5890.00 USD
</code></pre>
<p>So far, I’ve been getting away with fudging the dates on balance assertions where necessary. I have relatively few sales, so this hasn’t been a big problem so far. I’m not convinced it needs a solution yet, maybe the best thing to do is just to document how to deal with the issue when it occurs.</p>
<p>Maybe someone can convince me otherwise.</p>
<h3 id="transfer-accounts">Transfer Accounts<a id="transfer-accounts"></a><a class="headerlink" href="#transfer-accounts" title="Permanent link"></a></h3>
<p>In the previous section, we discuss a style whereby a single entry moving money between two accounts contains two dates and results in two separate entries. An auxiliary problem, which is related in its solution, is how to carry out the reverse operation, that is, how to <em>merge</em> two separate entries posting to a common transfer account (sometimes called a “<a href="https://en.wikipedia.org/wiki/Suspense_account"><span class="underline">suspense account</span></a>”).</p>
<p>For example, a user may want to input the two sides of a transaction separately, e.g. by running import scripts on separate input files, and instead of having to reconcile and merge those by hand, we would want to explicitly support this by identifying matching transactions to these transfer accounts and creating a common link between them.</p>
<p>Most importantly, we want to be able to easily identify which of the transactions is not matched on the other side, which indicates missing data.</p>
<ul>
<li>
<p>There is a prototype of this under <a href="https://bitbucket.org/blais/beancount/src/tip/src/python/beancount/plugins/tag_pending.py?at=default"><span class="underline">beancount.plugins.tag_pending</span></a>.</p>
</li>
<li>
<p>Also see redstreet0’s “<a href="https://groups.google.com/d/msgid/beancount/8adbb83d-a7c7-476a-97ca-d600d110db20%40googlegroups.com?utm_medium=email&amp;utm_source=footer"><span class="underline">zerosum</span></a>” plugin from <a href="https://groups.google.com/d/msgid/beancount/8adbb83d-a7c7-476a-97ca-d600d110db20%40googlegroups.com?utm_medium=email&amp;utm_source=footer"><span class="underline">this thread</span></a>.</p>
</li>
</ul>
<h2 id="remaining-questions">Remaining Questions<a id="remaining-questions"></a><a class="headerlink" href="#remaining-questions" title="Permanent link"></a></h2>
<p><em>How do we determine a proper transfer account name? Is a subaccount a reasonable approach? What if a user would like to have a single global limbo account?</em></p>
<pre><code>TODO
</code></pre>
<p><em>Does this property solve the problem of making balance assertions between trade and settlement?</em></p>
<pre><code>TODO [Write out a detailed example]
</code></pre>
<p><em>Any drawbacks?</em></p>
<pre><code>TODO
</code></pre>
<p><em>How does this affect the balance sheet and income statement, if any? Is it going to be obvious to users what the amounts in these limbo/transfer accounts are?</em></p>
<pre><code>TODO
</code></pre>
<h2 id="unrooting-transactions">Unrooting Transactions<a id="unrooting-transactions"></a><a class="headerlink" href="#unrooting-transactions" title="Permanent link"></a></h2>
<p>A wilder idea would be to add an extra level in the transaction-posting hierarchy, adding the capability to group multiple partial transactions, and move the balancing rule to that level. Basically, two transactions input separately and then grouped - by some rule, or trivially by themselves - could form a new unit of balance rule.</p>
<p>That would be a much more demanding change on the schema and on the Beancount design but would allow to natively support partial transactions, keeping their individual dates, descriptions, etc. Maybe that's a better model? Consider the advantages.</p>
<h2 id="previous-work">Previous Work<a id="previous-work"></a><a class="headerlink" href="#previous-work" title="Permanent link"></a></h2>
<h3 id="ledger-effective-and-auxiliary-dates">Ledger Effective and Auxiliary Dates<a id="ledger-effective-and-auxiliary-dates"></a><a class="headerlink" href="#ledger-effective-and-auxiliary-dates" title="Permanent link"></a></h3>
<p>Ledger has the concept of “<a href="http://ledger-cli.org/3.0/doc/ledger3.html#Auxiliary-dates"><span class="underline">auxiliary dates</span></a>”. The way these work is straightforward: any transaction may have a second date, and the user can select at runtime (with <code>--aux-date</code>) whether the main date or the auxiliary dates are meant to be used.</p>
<p>It is unclear to me how this is meant to be used in practice, in the presence of balance assertions. Without balance assertions, I can see how it would just work: you’d render everything with settlement dates only. This would probably only make sense for specific reports.</p>
<p>I would much rather keep a single semantic for the set of transactions that gets parsed in; the idea that the meaning of the transactions varies depending on the invocation conditions would set a precedent in Beancount, I’d prefer not to break this nice property, so by default I’d prefer to avoid implementing this solution.</p>
<p>Auxiliary dates are also known as “<a href="http://ledger-cli.org/3.0/doc/ledger3.html#Effective-Dates"><span class="underline">effective dates</span></a>” and can be associated with each individual posting. Auxiliary dates are secondary to the the “primary date” or the “actual date”, being the posting date of the record):</p>
<pre><code>2008/10/16 * (2090) Bountiful Blessings Farm
    Expenses:Food:Groceries                  $ 37.50  ; [=2008/10/01]
    Expenses:Food:Groceries                  $ 37.50  ; [=2008/11/01]
    Expenses:Food:Groceries                  $ 37.50  ; [=2008/12/01]
    Expenses:Food:Groceries                  $ 37.50  ; [=2009/01/01]
    Expenses:Food:Groceries                  $ 37.50  ; [=2009/02/01]
    Expenses:Food:Groceries                  $ 37.50  ; [=2009/03/01]
    Assets:Checking
</code></pre>
<p>The original motivation for this was for budgeting, allow one to move accounting of expenses to neighboring budget periods in order to carry over actual paid amounts to those periods. Bank amounts in one month could be set against a budget from the immediately preceding or following month, as needed. (Note: John Wiegley)</p>
<p>This is similar to one of the syntaxes I’m suggesting above—letting the user specify a date for each posting—but the other postings are not split as independent transactions. The usage of those dates is similarly triggered by a command-line option (<code>--effective</code>). I’m assuming that the posting on the checking account above occurs at once at 2008/10/16, regardless of reporting date. Let’s verify this:</p>
<pre><code>$ ledger -f settlement1.lgr reg checking --effective
08-Oct-16 Bountiful Blessings.. Assets:Checking           $ -225.00    $ -225.00
</code></pre>
<p>That’s what I thought. This works, but a problem with this approach is that any balance sheet drawn between 2008/10/01 (the earliest effective date) and 2009/03/01 (the latest effective date) would not balance. Between those dates, some amounts are “in limbo” and drawing up a balance sheet at one of those dates would not balance.</p>
<p>This would break an invariant in Beancount: we require that you should always be able to draw a balance sheet at any point in time, and any subset of transactions should balance. I would rather implement this by splitting this example transaction into many other ones, as in the proposal above, moving those temporary amounts living in limbo in an explicit “limbo” or “transfer” account, where each transaction balances. Moreover, this step can be implemented as a transformation stage, replacing the transaction with effective dates by one transaction for each posting where the effective date differs from the transaction’s date (this could be enabled on demand via a plugin).</p>
<h3 id="gnucash">GnuCash<a id="gnucash"></a><a class="headerlink" href="#gnucash" title="Permanent link"></a></h3>
<p><em>TODO(blais) - How is this handled in GnuCash and other GUI systems? Is there a standard account method?</em></p>
<h2 id="references">References<a id="references"></a><a class="headerlink" href="#references" title="Permanent link"></a></h2>
<p>The IRS <a href="http://www.irs.gov/publications/p17/ch14.html"><span class="underline">requires you to use the trade date and NOT the settlement date</span></a> for tax reporting; from the IRS Publication 17:</p>
<blockquote>
<p><strong>Securities traded on established market.</strong> For securities traded on an established securities market, your holding period begins the day after the trade date you bought the securities, and ends on the trade date you sold them.</p>
<p><img src="28_settlement_dates_in_beancount/media/1336b54a60f8aa4b92957260378207d6479e7c39.gif" style="width:0.5625in;height:0.5625in"/>Do not confuse the trade date with the settlement date, which is the date by which the stock must be delivered and payment must be made.</p>
<p><strong>Example.</strong></p>
<p>You are a cash method, calendar year taxpayer. You sold stock at a gain on December 30, 2013. According to the rules of the stock exchange, the sale was closed by delivery of the stock 4 trading days after the sale, on January 6, 2014. You received payment of the sales price on that same day. Report your gain on your 2013 return, even though you received the payment in 2014. The gain is long term or short term depending on whether you held the stock more than 1 year. Your holding period ended on December 30. If you had sold the stock at a loss, you would also report it on your 2013 return.</p>
</blockquote>
<h3 id="threads">Threads<a id="threads"></a><a class="headerlink" href="#threads" title="Permanent link"></a></h3>
<ul>
<li>
<p><a href="https://groups.google.com/d/msg/ledger-cli/ooxbPVRinSs/ymkRCerhxjcJ"><span class="underline">An interesting "feature by coincidence"</span></a></p>
</li>
<li>
<p><a href="https://groups.google.com/d/msg/beancount/z9sPboW4U3c/UfJbIVzwmpMJ"><span class="underline">First Opinions, Coming from Ledger</span></a></p>
</li>
</ul>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="29_balance_assertions_in_beancount.html" title="Balance Assertions in Beancount">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="27_a_proposal_for_an_improvement_on_inventory_booking.html" title="A Proposal for an Improvement on Inventory Booking"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/beancount/docs/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="27_a_proposal_for_an_improvement_on_inventory_booking.html" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="29_balance_assertions_in_beancount.html" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '.';</script>
<script defer="" src="js/theme.js"></script>
<script defer="" src="js/extra.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
